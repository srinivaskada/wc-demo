import{E as t,r as i,h as n,H as e,c as r}from"./p-798be65d.js";const s=()=>{const t=document;return!!(t.fullScreen||t.mozFullScreen||t.webkitIsFullScreen||t.webkitFullscreenElement)},o=class{constructor(t){i(this,t)}getText(){return(this.first||"")+((t=this.middle)?` ${t}`:"")+((i=this.last)?` ${i}`:"");var t,i}render(){return n(e,null,n("div",null,"Hello, World! I'm ",this.getText()),n("div",{class:"svg-container",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4z"/></svg>'}),n("img",{src:(i="cat.jpeg",t.LOCAL?`/surf-wc-assets/media/${i}`:t.ASSET_BASE_URL?t.ASSET_BASE_URL:`${t.ASSET_BASE_URL}/media/${i}`)}));var i}};function a(t){return t.dispatchEvent(new Event("restartVideo")),!0}function u(){var t,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],e=void 0,r=void 0;/trident/i.test(n[1])&&(e="IE",r=(t=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||""),"Chrome"===n[1]?null==(t=i.match(/\bOPR|Edge\/(\d+)/))?(e=n[1],r=n[2]):t[0].indexOf("Edge")>-1?(e="Edge",r=t[1]):(e=t[0],null!=t[1]?r=t[1]:"OPR"==e&&(r=t.input.substring(t.input.indexOf("OPR/")+4))):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=i.match(/version\/(\d+)/i))&&n.splice(1,1,t[1]),e=n[0],r=n[1]);var s=i.indexOf("("),o=i.indexOf(")"),a=i.substring(s+1,o),u=!1;return["linux","windows","mac"].forEach((function(t){a.toLowerCase().includes(t.toLowerCase())&&(u=!0)})),["android","iphone"].forEach((function(t){a.toLowerCase().includes(t.toLowerCase())&&(u=!1)})),{name:e,version:r,os:a,isDesktop:u}}o.style=".host{display:block}";const c=function(t){let i,n,e;const r=t.videoElement;var s=t.videoSource,o=new URL(s).hostname;const c=function(...t){console.log(`WebRTC-[${n||"peer_id Not set"}]`,...t)};var l,h,f,d,m,v={iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"}]},p={video:!0,audio:!1},g=0;function w(t){x("ERROR: "+t),d.close()}function b(){return r}function y(t){c(t)}function x(t){!function(...t){console.error(`WebRTC-[${n||"peer_id Not set"}]`,...t)}(t)}function k(){c(m);var t=b();t&&(t.pause(),t.src="",t.load())}function T(t){c("Got local description: "+JSON.stringify(t)),f.setLocalDescription(t).then((function(){y("Sending SDP answer"),i={sdp:f.localDescription},d.send(JSON.stringify(i))}))}function S(t){c("httpGetAnswer(): "+t)}function E(t){if(c("Received "+t.data),t.data.startsWith("ERROR"))w(t.data);else{if(t.data.startsWith("HELLO")){var i=t.data.split(" ");return n=i[1],y("Registered with server, waiting for call"),l=s.replace("#PEERID#",n.toString()),c("sendMessageToStartCall(): ",l),void function(t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){c(n.readyState),4==n.readyState&&200==n.status?i(n.responseText):4==n.readyState&&setTimeout((()=>a(r)),3e3)},n.open("GET",t,!0),n.send(null)}(l,S)}try{e=JSON.parse(t.data)}catch(i){return void(i instanceof SyntaxError?w("Error parsing incoming JSON: "+t.data):w("Unknown error parsing response: "+t.data))}var o;f||function(t){g=0,c("Creating RTCPeerConnection"),(f=new RTCPeerConnection(v)).onaddstream=A,m="safari"==u().name.toLowerCase()?function(){var t;if(t=p,c(JSON.stringify(t)),navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(t);x("Browser doesn't support getUserMedia!")}().then((t=>(c("Adding local stream"),f.addStream(t),t))).catch(x):new Promise((function(t){t(!0)})),t.sdp||c("WARNING: First message wasn't an SDP message!?"),f.onicecandidate=t=>{null!=t.candidate?d.send(JSON.stringify({ice:t.candidate})):c("ICE Candidate was null, done")},f.oniceconnectionstatechange=t=>{c(t),c(f),f&&f.iceConnectionState&&(c(f.iceConnectionState),"failed"==f.iceConnectionState&&(f.oniceconnectionstatechange=()=>{},a(r)))},y("Created peer connection for call, waiting for SDP")}(e),null!=e.sdp?function(t){f.setRemoteDescription(t).then((()=>{y("Remote SDP set"),"offer"==t.type&&(y("Got SDP offer"),m.then((()=>{y("Got local stream, creating answer"),f.createAnswer().then(T).catch(x)})).catch(x))})).catch(x)}(e.sdp):null!=e.ice?(o=new RTCIceCandidate(e.ice),f.addIceCandidate(o).catch(x)):w("Unknown incoming JSON: "+e)}var l}function O(t){c("Server close"),y("Disconnected from server"),k(),f&&(f.close(),f=null),"stop"!=t.reason&&a(r)}function j(t){x("Unable to connect to server, did you add an exception for the certificate? "+JSON.stringify(t)),a(r)}function M(){if(g++,c(g),n=Math.floor(999990*Math.random()+10).toString(),c("peer_id is",n),h=h||"8443",window.location.protocol.startsWith("file"))l=l||"0.0.0.0";else{if(!window.location.protocol.startsWith("http"))throw new Error("Don't know how to connect to the signalling server with uri"+window.location);l=l||window.location.hostname}var t="wss://"+(l=o)+":"+h;y("Connecting to server "+t),(d=new WebSocket(t)).addEventListener("open",(()=>{d.send("HELLO "+n),y("Registering with server"),g=0})),d.addEventListener("error",j),d.addEventListener("message",E),d.addEventListener("close",O)}function A(t){const i=t.stream.getVideoTracks(),n=t.stream.getAudioTracks();i.length>0?(c("Incoming stream: "+i.length+" video tracks and "+n.length+" audio tracks"),b().srcObject=t.stream):w("Stream with unknown tracks added, resetting")}return M(),{play:M,stop:function(){k(),d.close(4e3,"stop"),f&&(f.oniceconnectionstatechange=()=>{},f.close(),f=null)}}};var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function f(t,i,n){return t(n={path:i,exports:{},require:function(){return d()}},n.exports),n.exports}function d(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const m=h(f((function(t){var i;"undefined"!=typeof window&&(i=function(){return function(t){var i={};function n(e){if(i[e])return i[e].exports;var r=i[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=i,n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)n.d(e,r,function(i){return t[i]}.bind(null,r));return e},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */function(t){var i=Object.prototype.hasOwnProperty,n="~";function e(){}function r(t,i,n){this.fn=t,this.context=i,this.once=n||!1}function s(t,i,e,s,o){if("function"!=typeof e)throw new TypeError("The listener must be a function");var a=new r(e,s||t,o),u=n?n+i:i;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],a]:t._events[u].push(a):(t._events[u]=a,t._eventsCount++),t}function o(t,i){0==--t._eventsCount?t._events=new e:delete t._events[i]}function a(){this._events=new e,this._eventsCount=0}Object.create&&(e.prototype=Object.create(null),(new e).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)i.call(t,e)&&r.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t){var i=this._events[n?n+t:t];if(!i)return[];if(i.fn)return[i.fn];for(var e=0,r=i.length,s=new Array(r);e<r;e++)s[e]=i[e].fn;return s},a.prototype.listenerCount=function(t){var i=this._events[n?n+t:t];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,i,e,r,s,o){var a=n?n+t:t;if(!this._events[a])return!1;var u,c,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,i),!0;case 3:return l.fn.call(l.context,i,e),!0;case 4:return l.fn.call(l.context,i,e,r),!0;case 5:return l.fn.call(l.context,i,e,r,s),!0;case 6:return l.fn.call(l.context,i,e,r,s,o),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,i);break;case 3:l[c].fn.call(l[c].context,i,e);break;case 4:l[c].fn.call(l[c].context,i,e,r);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(t,i,n){return s(this,t,i,n,!1)},a.prototype.once=function(t,i,n){return s(this,t,i,n,!0)},a.prototype.removeListener=function(t,i,e,r){var s=n?n+t:t;if(!this._events[s])return this;if(!i)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==i||r&&!a.once||e&&a.context!==e||o(this,s);else{for(var u=0,c=[],l=a.length;u<l;u++)(a[u].fn!==i||r&&!a[u].once||e&&a[u].context!==e)&&c.push(a[u]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var i;return t?this._events[i=n?n+t:t]&&o(this,i):(this._events=new e,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */function(t){var i,n,e,r,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,n=/^([^\/?#]*)([^]*)$/,e=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,t.exports=s={buildAbsoluteURL:function(t,i,e){if(e=e||{},t=t.trim(),!(i=i.trim())){if(!e.alwaysNormalize)return t;var r=s.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(i);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return e.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):i;var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=n.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var c={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var l=a.path,h=l.substring(0,l.lastIndexOf("/")+1)+o.path;c.path=s.normalizePath(h)}else c.path=a.path,o.params||(c.params=a.params,o.query||(c.query=a.query));return null===c.path&&(c.path=e.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(c)},parseURL:function(t){var n=i.exec(t);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(e,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */function(t,i,n){function e(t){var i={};function n(e){if(i[e])return i[e].exports;var r=i[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=i,n.i=function(t){return t},n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:e})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="/",n.oe=function(t){throw console.error(t),t};var e=n(n.s=ENTRY_MODULE);return e.default||e}var r="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,i,e){var o={};o[e]=[];var a=i.toString(),u=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return o;for(var c,l=u[1],h=new RegExp("(\\\\n|\\W)"+s(l)+r,"g");c=h.exec(a);)"dll-reference"!==c[3]&&o[e].push(c[3]);for(h=new RegExp("\\("+s(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+r,"g");c=h.exec(a);)t[c[2]]||(o[e].push(c[1]),t[c[2]]=n(c[1]).m),o[c[2]]=o[c[2]]||[],o[c[2]].push(c[4]);for(var f=Object.keys(o),d=0;d<f.length;d++)for(var m=0;m<o[f[d]].length;m++)isNaN(1*o[f[d]][m])||(o[f[d]][m]=1*o[f[d]][m]);return o}function a(t){return Object.keys(t).reduce((function(i,n){return i||t[n].length>0}),!1)}t.exports=function(t,i){var r={main:n.m},s=(i=i||{}).all?{main:Object.keys(r.main)}:function(t,i){for(var n={main:[i]},e={main:[]},r={main:{}};a(n);)for(var s=Object.keys(n),u=0;u<s.length;u++){var c=s[u],l=n[c].pop();if(r[c]=r[c]||{},!r[c][l]&&t[c][l]){r[c][l]=!0,e[c]=e[c]||[],e[c].push(l);for(var h=o(t,t[c][l],c),f=Object.keys(h),d=0;d<f.length;d++)n[f[d]]=n[f[d]]||[],n[f[d]]=n[f[d]].concat(h[f[d]])}}return e}(r,t),u="";Object.keys(s).filter((function(t){return"main"!==t})).forEach((function(t){for(var i=0;s[t][i];)i++;s[t].push(i),r[t][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+t+" = ("+e.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+s[t].map((function(i){return JSON.stringify(i)+": "+r[t][i].toString()})).join(",")+"});\n"})),u=u+"new (("+e.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var c=new window.Blob([u],{type:"text/javascript"});if(i.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),h=new window.Worker(l);return h.objectURL=l,h}},"./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */function(t,i,n){n.r(i),n.d(i,"hlsDefaultConfig",(function(){return T})),n.d(i,"mergeConfig",(function(){return S})),n.d(i,"enableStreamingMode",(function(){return E}));var e=n(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts"),r=n(/*! ./controller/audio-stream-controller */"./src/controller/audio-stream-controller.ts"),s=n(/*! ./controller/audio-track-controller */"./src/controller/audio-track-controller.ts"),o=n(/*! ./controller/subtitle-stream-controller */"./src/controller/subtitle-stream-controller.ts"),a=n(/*! ./controller/subtitle-track-controller */"./src/controller/subtitle-track-controller.ts"),u=n(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts"),c=n(/*! ./controller/timeline-controller */"./src/controller/timeline-controller.ts"),l=n(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts"),h=n(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts"),f=n(/*! ./controller/eme-controller */"./src/controller/eme-controller.ts"),d=n(/*! ./controller/cmcd-controller */"./src/controller/cmcd-controller.ts"),m=n(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts"),v=n(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts"),p=n(/*! ./utils/cues */"./src/utils/cues.ts"),g=n(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts"),w=n(/*! ./utils/logger */"./src/utils/logger.ts");function b(){return(b=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function y(t,i){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);i&&(e=e.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,e)}return n}function x(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?y(Object(n),!0).forEach((function(i){k(t,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}function k(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}var T=x(x({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:e.default,bufferController:u.default,capLevelController:l.default,fpsController:h.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:p.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:o.SubtitleStreamController,subtitleTrackController:a.default,timelineController:c.TimelineController,audioStreamController:r.default,audioTrackController:s.default,emeController:f.default,cmcdController:d.default});function S(t,i){if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==i.liveMaxLatencyDurationCount&&(void 0===i.liveSyncDurationCount||i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(void 0===i.liveSyncDuration||i.liveMaxLatencyDuration<=i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return b({},t,i)}function E(t){var i=t.loader;i!==v.default&&i!==m.default?(w.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Object(v.fetchSupported)()&&(t.loader=v.default,t.progressive=!0,t.enableSoftwareAES=!0,w.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/abr-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts"),s=n(/*! ../events */"./src/events.ts"),o=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=n(/*! ../errors */"./src/errors.ts"),u=n(/*! ../types/loader */"./src/types/loader.ts"),c=n(/*! ../utils/logger */"./src/utils/logger.ts");function l(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}i.default=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var i=t.config;this.bwEstimator=new r.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var i,n,h=t.prototype;return h.registerListeners=function(){var t=this.hls;t.on(s.Events.FRAG_LOADING,this.onFragLoading,this),t.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(s.Events.FRAG_LOADING,this.onFragLoading,this),t.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},h.onFragLoading=function(t,i){var n,e=i.frag;e.type===u.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=e,this.partCurrent=null!=(n=i.part)?n:null,this.timer=self.setInterval(this.onCheck,100)))},h.onLevelLoaded=function(t,i){var n=this.hls.config;i.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},h._abandonRulesCheck=function(){var t=this.fragCurrent,i=this.partCurrent,n=this.hls,r=n.autoLevelEnabled,a=n.config,u=n.media;if(t&&u){var l=i?i.stats:t.stats,h=i?i.duration:t.duration;if(l.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!u.paused&&u.playbackRate&&u.readyState){var f=performance.now()-l.loading.start,d=Math.abs(u.playbackRate);if(!(f<=500*h/d)){var m=n.levels,v=n.minAutoLevel,p=l.total||Math.max(l.loaded,Math.round(h*m[t.level].maxBitrate/8)),g=Math.max(1,l.bwEstimate?l.bwEstimate/8:1e3*l.loaded/f),w=(p-l.loaded)/g,b=u.currentTime,y=(o.BufferHelper.bufferInfo(u,b,a.maxBufferHole).end-b)/d;if(!(y>=2*h/d||w<=y)){var x,k=Number.POSITIVE_INFINITY;for(x=t.level-1;x>v&&!((k=h*m[x].maxBitrate/(6.4*g))<y);x--);if(!(k>=w)){var T=this.bwEstimator.getEstimate();c.logger.warn("Fragment "+t.sn+(i?" part "+i.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+"\n      Current BW estimate: "+(Object(e.isFiniteNumber)(T)?(T/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+w.toFixed(3)+" s\n      Estimated load time for the next fragment: "+k.toFixed(3)+" s\n      Time to underbuffer: "+y.toFixed(3)+" s"),n.nextLoadLevel=x,this.bwEstimator.sample(f,l.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),n.trigger(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:l})}}}}}},h.onFragLoaded=function(t,i){var n=i.frag,r=i.part;if(n.type===u.PlaylistLevelType.MAIN&&Object(e.isFiniteNumber)(n.sn)){var o=r?r.stats:n.stats,a=r?r.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[n.level],l=(c.loaded?c.loaded.bytes:0)+o.loaded,h=(c.loaded?c.loaded.duration:0)+a;c.loaded={bytes:l,duration:h},c.realBitrate=Math.round(8*l/h)}n.bitrateTest&&(this.onFragBuffered(s.Events.FRAG_BUFFERED,{stats:o,frag:n,part:r,id:n.type}),n.bitrateTest=!1)}},h.onFragBuffered=function(t,i){var n=i.frag,e=i.part,r=e?e.stats:n.stats;if(!r.aborted&&n.type===u.PlaylistLevelType.MAIN&&"initSegment"!==n.sn){var s=r.parsing.end-r.loading.start;this.bwEstimator.sample(s,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=n.bitrateTest?s/1e3:0}},h.onError=function(t,i){switch(i.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},h.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},h.getNextABRAutoLevel=function(){var t=this.fragCurrent,i=this.partCurrent,n=this.hls,e=n.maxAutoLevel,r=n.config,s=n.minAutoLevel,a=n.media,u=i?i.duration:t?t.duration:0,l=a?a.currentTime:0,h=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(o.BufferHelper.bufferInfo(a,l,r.maxBufferHole).end-l)/h,m=this.findBestLevel(f,s,e,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(m>=0)return m;c.logger.trace((d?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=u?Math.min(u,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(!d){var w=this.bitrateTestDelay;w&&(v=(u?Math.min(u,r.maxLoadingDelay):r.maxLoadingDelay)-w,c.logger.trace("bitrate test took "+Math.round(1e3*w)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),p=g=1)}return m=this.findBestLevel(f,s,e,d+v,p,g),Math.max(m,0)},h.findBestLevel=function(t,i,n,e,r,s){for(var o,a=this.fragCurrent,u=this.partCurrent,l=this.lastLoadedFragLevel,h=this.hls.levels,f=h[l],d=!(null==f||null===(o=f.details)||void 0===o||!o.live),m=null==f?void 0:f.codecSet,v=u?u.duration:a?a.duration:0,p=n;p>=i;p--){var g=h[p];if(g&&(!m||g.codecSet===m)){var w,b=g.details,y=(u?null==b?void 0:b.partTarget:null==b?void 0:b.averagetargetduration)||v,x=h[p].maxBitrate,k=x*y/(w=p<=l?r*t:s*t);if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+p+"/"+Math.round(w)+"/"+x+"/"+y+"/"+e+"/"+k),w>x&&(!k||d&&!this.bitrateTestDelay||k<e))return p}}return-1},i=t,(n=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,i=this.bwEstimator;if(!(-1===t||i&&i.canEstimate()))return t;var n=this.getNextABRAutoLevel();return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}}])&&l(i.prototype,n),t}()},"./src/controller/audio-stream-controller.ts":
/*!***************************************************!*\
  !*** ./src/controller/audio-stream-controller.ts ***!
  \***************************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),s=n(/*! ../events */"./src/events.ts"),o=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=n(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),u=n(/*! ../types/level */"./src/types/level.ts"),c=n(/*! ../types/loader */"./src/types/loader.ts"),l=n(/*! ../loader/fragment */"./src/loader/fragment.ts"),h=n(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts"),f=n(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),d=n(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),m=n(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),v=n(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),p=n(/*! ../errors */"./src/errors.ts"),g=n(/*! ../utils/logger */"./src/utils/logger.ts");function w(){return(w=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function b(t,i){return(b=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}i.default=function(t){var i,n;function y(i,n){var e;return(e=t.call(this,i,n,"[audio-stream-controller]")||this).videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e._registerListeners(),e}n=t,(i=y).prototype=Object.create(n.prototype),i.prototype.constructor=i,b(i,n);var x=y.prototype;return x.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},x._registerListeners=function(){var t=this.hls;t.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(s.Events.ERROR,this.onError,this),t.on(s.Events.BUFFER_RESET,this.onBufferReset,this),t.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x._unregisterListeners=function(){var t=this.hls;t.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(s.Events.ERROR,this.onError,this),t.off(s.Events.BUFFER_RESET,this.onBufferReset,this),t.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x.onInitPtsFound=function(t,i){var n=i.frag,e=i.initPTS;if("main"===i.id){var s=n.cc;this.initPTS[n.cc]=e,this.log("InitPTS for cc: "+s+" found from main: "+e),this.videoTrackCC=s,this.state===r.State.WAITING_INIT_PTS&&this.tick()}},x.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=r.State.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=r.State.IDLE):(this.loadedmetadata=!1,this.state=r.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},x.doTick=function(){switch(this.state){case r.State.IDLE:this.doTickIdle();break;case r.State.WAITING_TRACK:var i,n=this.levels,e=null==n||null===(i=n[this.trackId])||void 0===i?void 0:i.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=r.State.WAITING_INIT_PTS}break;case r.State.FRAG_LOADING_WAITING_RETRY:var s,a=performance.now(),u=this.retryDate;(!u||a>=u||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=r.State.IDLE);break;case r.State.WAITING_INIT_PTS:var c=this.waitingData;if(c){var l=c.frag,h=c.part,f=c.cache,d=c.complete;if(void 0!==this.initPTS[l.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=r.State.FRAG_LOADING;var v={frag:l,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(v),d&&t.prototype._handleFragmentLoadComplete.call(this,v)}else if(this.videoTrackCC!==this.waitingVideoCC)g.logger.log("Waiting fragment cc ("+l.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var p=this.getLoadPosition(),w=o.BufferHelper.bufferInfo(this.mediaBuffer,p,this.config.maxBufferHole);Object(m.fragmentWithinToleranceTest)(w.end,this.config.maxFragLookUpTolerance,l)<0&&(g.logger.log("Waiting fragment cc ("+l.cc+") @ "+l.start+" cancelled because another fragment at "+w.end+" is needed"),this.clearWaitingFragment())}}else this.state=r.State.IDLE}this.onTickEnd()},x.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=r.State.IDLE)},x.onTickEnd=function(){var t=this.media;t&&t.readyState&&(!this.loadedmetadata&&(this.mediaBuffer?this.mediaBuffer:t).buffered.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime)},x.doTickIdle=function(){var t,i,n=this.hls,e=this.levels,o=this.media,a=this.trackId;if(e&&e[a]&&(o||!this.startFragRequested&&n.config.startFragPrefetch)){var u=e[a].details;if(!u||u.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(u))this.state=r.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,l.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.AUDIO);if(null!==h){var f=h.len,d=this.getMaxBufferLength(),m=this.audioSwitch;if(!(f>=d)||m){if(!m&&this._streamEnded(h,u))return n.trigger(s.Events.BUFFER_EOS,{type:"audio"}),void(this.state=r.State.ENDED);var v=u.fragments[0].start,p=h.end;if(m){var g=this.getLoadPosition();p=g,u.PTSKnown&&g<v&&(h.end>v||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=v+.05)}var w=this.getNextFragment(p,u);w?"identity"!==(null===(t=w.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(i=w.decryptdata)&&void 0!==i&&i.key?this.loadFragment(w,u,p):this.loadKey(w,u):this.bufferFlushed=!0}}}}},x.getMaxBufferLength=function(){var i=t.prototype.getMaxBufferLength.call(this),n=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN);return null===n?i:Math.max(i,n.len)},x.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},x.onAudioTracksUpdated=function(t,i){var n=i.audioTracks;this.resetTransmuxer(),this.levels=n.map((function(t){return new u.Level(t)}))},x.onAudioTrackSwitching=function(t,i){var n=!!i.url;this.trackId=i.id;var e=this.fragCurrent;null!=e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=r.State.IDLE):this.state=r.State.STOPPED,this.tick()},x.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},x.onLevelLoaded=function(t,i){this.mainDetails=i.details},x.onAudioTrackLoaded=function(t,i){var n,e=this.levels,s=i.details,o=i.id;if(e){this.log("Track "+o+" loaded ["+s.startSN+","+s.endSN+"],duration:"+s.totalduration);var a=e[o],u=0;if(s.live||null!==(n=a.details)&&void 0!==n&&n.live){var c=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!c)return;!a.details&&s.hasProgramDateTime&&c.hasProgramDateTime?(Object(v.alignMediaPlaylistByPDT)(s,c),u=s.fragments[0].start):u=this.alignPlaylists(s,a.details)}a.details=s,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(a.details,u),this.state!==r.State.WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=r.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+o)},x._handleFragmentLoadProgress=function(t){var i,n=t.frag,e=t.part,s=t.payload,o=this.config,a=this.trackId,u=this.levels;if(u){var l=u[a];console.assert(l,"Audio track is defined on fragment load progress");var m=l.details;console.assert(m,"Audio track details are defined on fragment load progress");var v=o.defaultAudioCodec||l.audioCodec||"mp4a.40.2",p=this.transmuxer;p||(p=this.transmuxer=new f.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[n.cc],b=null===(i=n.initSegment)||void 0===i?void 0:i.data;if(void 0!==w){var y=e?e.index:-1,x=new d.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,s.byteLength,y,-1!==y);p.push(s,b,v,"",n,e,m.totalduration,!1,x,w)}else g.logger.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+m.startSN+" ,"+m.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:n,part:e,cache:new h.default,complete:!1}).cache.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=r.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},x._handleFragmentLoadComplete=function(i){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,i)},x.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},x.onBufferCreated=function(t,i){var n=i.tracks.audio;n&&(this.mediaBuffer=n.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},x.onFragBuffered=function(t,i){var n=i.frag,e=i.part;n.type===c.PlaylistLevelType.AUDIO&&(this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(e?" p: "+e.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,e)))},x.onError=function(i,n){switch(n.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,n);break;case p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==r.State.ERROR&&this.state!==r.State.STOPPED&&(this.state=n.fatal?r.State.ERROR:r.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===n.parent&&(this.state===r.State.PARSING||this.state===r.State.PARSED)){var e=!0,s=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);s&&s.len>.5&&(e=!this.reduceMaxBufferLength(s.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},x.onBufferFlushed=function(t,i){i.type===l.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},x._handleTransmuxComplete=function(t){var i,n="audio",e=this.hls,o=t.remuxResult,a=t.chunkMeta,u=this.getCurrentContext(a);if(!u)return this.warn("The loading context changed while buffering fragment "+a.sn+" of level "+a.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(a.level);var c=u.frag,h=u.part,f=o.audio,d=o.text,m=o.id3,v=o.initSegment;if(!this.fragContextChanged(c)){if(this.state=r.State.PARSING,this.audioSwitch&&f&&this.completeAudioSwitch(),null!=v&&v.tracks&&(this._bufferInitSegment(v.tracks,c,a),e.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:n,tracks:v.tracks})),f){var p=f.startPTS,g=f.endPTS,b=f.startDTS,y=f.endDTS;h&&(h.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:p,endPTS:g,startDTS:b,endDTS:y}),c.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,p,g,b,y),this.bufferFragmentData(f,c,h,a)}if(null!=m&&null!==(i=m.samples)&&void 0!==i&&i.length){var x=w({frag:c,id:n},m);e.trigger(s.Events.FRAG_PARSING_METADATA,x)}if(d){var k=w({frag:c,id:n},d);e.trigger(s.Events.FRAG_PARSING_USERDATA,k)}}},x._bufferInitSegment=function(t,i,n){if(this.state===r.State.PARSING){t.video&&delete t.video;var e=t.audio;if(e){e.levelCodec=e.codec,e.id="audio",this.log("Init audio buffer, container:"+e.container+", codecs[parsed]=["+e.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t);var o=e.initSegment;null!=o&&o.byteLength&&this.hls.trigger(s.Events.BUFFER_APPENDING,{type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:o}),this.tick()}}},x.loadFragment=function(i,n,s){var o=this.fragmentTracker.getState(i);this.fragCurrent=i,(this.audioSwitch||o===a.FragmentState.NOT_LOADED||o===a.FragmentState.PARTIAL)&&("initSegment"===i.sn?this._loadInitSegment(i):n.live&&!Object(e.isFiniteNumber)(this.initPTS[i.cc])?(this.log("Waiting for video PTS in continuity counter "+i.cc+" of live stream before loading audio fragment "+i.sn+" of level "+this.trackId),this.state=r.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,i,n,s)))},x.completeAudioSwitch=function(){var i=this.hls,n=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,i.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:n})},y}(r.default)},"./src/controller/audio-track-controller.ts":
/*!**************************************************!*\
  !*** ./src/controller/audio-track-controller.ts ***!
  \**************************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../errors */"./src/errors.ts"),s=n(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),o=n(/*! ../types/loader */"./src/types/loader.ts");function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function u(t,i){return(u=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}i.default=function(t){var i,n;function s(i){var n;return(n=t.call(this,i,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}n=t,(i=s).prototype=Object.create(n.prototype),i.prototype.constructor=i,u(i,n);var c,l,h=s.prototype;return h.registerListeners=function(){var t=this.hls;t.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(e.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(e.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(e.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(e.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(e.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(e.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},h.onManifestParsed=function(t,i){this.tracks=i.audioTracks||[]},h.onAudioTrackLoaded=function(t,i){var n=i.id,e=i.details,r=this.tracksInGroup[n];if(r){var s=r.details;r.details=i.details,this.log("audioTrack "+n+" loaded ["+e.startSN+"-"+e.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,i,s))}else this.warn("Invalid audio track id "+n)},h.onLevelLoading=function(t,i){this.switchLevel(i.level)},h.onLevelSwitching=function(t,i){this.switchLevel(i.level)},h.switchLevel=function(t){var i=this.hls.levels[t];if(null!=i&&i.audioGroupIds){var n=i.audioGroupIds[i.urlId];if(this.groupId!==n){this.groupId=n;var r=this.tracks.filter((function(t){return!n||t.groupId===n}));this.selectDefaultTrack&&!r.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var s={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(e.Events.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}}},h.onError=function(i,n){t.prototype.onError.call(this,i,n),!n.fatal&&n.context&&n.context.type===o.PlaylistContextType.AUDIO_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},h.setAudioTrack=function(t){var i=this.tracksInGroup;if(t<0||t>=i.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=i[this.trackId];this.log("Now switching to audio-track index "+t);var r=i[t],s=r.id,o=r.groupId,a=void 0===o?"":o,u=r.name,c=r.type,l=r.url;if(this.trackId=t,this.trackName=u,this.selectDefaultTrack=!1,this.hls.trigger(e.Events.AUDIO_TRACK_SWITCHING,{id:s,groupId:a,name:u,type:c,url:l}),!r.details||r.details.live){var h=this.switchParams(r.url,null==n?void 0:n.details);this.loadPlaylist(h)}}},h.selectInitialTrack=function(){console.assert(this.tracksInGroup.length,"Initial audio track should be selected when tracks are known");var t=this.findTrackId(this.trackName)||this.findTrackId();-1!==t?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},h.findTrackId=function(t){for(var i=this.tracksInGroup,n=0;n<i.length;n++){var e=i[n];if((!this.selectDefaultTrack||e.default)&&(!t||t===e.name))return e.id}return-1},h.loadPlaylist=function(t){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var n=i.id,r=i.groupId,s=i.url;if(t)try{s=t.addDirectives(s)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(e.Events.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null})}},c=s,(l=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&a(c.prototype,l),s}(s.default)},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
  !*** ./src/controller/base-playlist-controller.ts ***!
  \****************************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return u}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../types/level */"./src/types/level.ts"),s=n(/*! ./level-helper */"./src/controller/level-helper.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=n(/*! ../errors */"./src/errors.ts"),u=function(){function t(t,i){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=o.logger.log.bind(o.logger,i+":"),this.warn=o.logger.warn.bind(o.logger,i+":"),this.hls=t}var i=t.prototype;return i.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},i.onError=function(t,i){i.fatal&&i.type===a.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},i.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},i.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},i.stopLoad=function(){this.canLoad=!1,this.clearTimer()},i.switchParams=function(t,i){var n=null==i?void 0:i.renditionReports;if(n)for(var s=0;s<n.length;s++){var o=n[s],a=""+o.URI;if(a===t.substr(-a.length)){var u=parseInt(o["LAST-MSN"]),c=parseInt(o["LAST-PART"]);if(i&&this.hls.config.lowLatencyMode){var l=Math.min(i.age-i.partTarget,i.targetduration);void 0!==c&&l>i.partTarget&&(c+=1)}if(Object(e.isFiniteNumber)(u))return new r.HlsUrlParameters(u,Object(e.isFiniteNumber)(c)?c:void 0,r.HlsSkip.No)}}},i.loadPlaylist=function(){},i.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},i.playlistLoaded=function(t,i,n){var e=this,r=i.details,o=i.stats,a=o.loading.end?Math.max(0,self.performance.now()-o.loading.end):0;if(r.advancedDateTime=Date.now()-a,r.live||null!=n&&n.live){if(r.reloaded(n),n&&this.log("live playlist "+t+" "+(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:"MISSED")),n&&r.fragments.length>0&&Object(s.mergeDetails)(n,r),!this.canLoad||!r.live)return;var u,c=void 0,l=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){var h=this.hls.config.lowLatencyMode,f=r.lastPartSn,d=r.endSN,m=r.lastPartIndex,v=f===d;-1!==m?(c=v?d+1:f,l=v?h?0:m:m+1):c=d+1;var p=r.age,g=Math.min(p+r.ageHeader-r.partTarget,1.5*r.targetduration);if(g>0){if(n&&g>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+g+" with playlist age: "+r.age),g=0;else{var w=Math.floor(g/r.targetduration);c+=w,void 0!==l&&(l+=Math.round(g%r.targetduration/r.partTarget)),this.log("CDN Tune-in age: "+r.ageHeader+"s last advanced "+p.toFixed(2)+"s goal: "+g+" skip sn "+w+" to part "+l)}r.tuneInGoal=g}if(u=this.getDeliveryDirectives(r,i.deliveryDirectives,c,l),h||!v)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(r,i.deliveryDirectives,c,l);var b=Object(s.computeReloadInterval)(r,o);void 0!==c&&r.canBlockReload&&(b-=r.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(b)+" ms"),this.timer=self.setTimeout((function(){return e.loadPlaylist(u)}),b)}else this.clearTimer()},i.getDeliveryDirectives=function(t,i,n,e){var s=Object(r.getSkipValue)(t,n);return null!=i&&i.skip&&t.deltaUpdateFailed&&(n=i.msn,e=i.part,s=r.HlsSkip.No),new r.HlsUrlParameters(n,e,s)},i.retryLoadingOrFail=function(t){var i,n=this,e=this.hls.config,r=this.retryCount<e.levelLoadingMaxRetry;if(r)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(i=t.context)&&void 0!==i&&i.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*e.levelLoadingRetryDelay,e.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return n.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return r},t}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
  !*** ./src/controller/base-stream-controller.ts ***!
  \**************************************************/
/*! exports provided: State, default */function(t,i,n){n.r(i),n.d(i,"State",(function(){return x})),n.d(i,"default",(function(){return k}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../task-loop */"./src/task-loop.ts"),s=n(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),o=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=n(/*! ../utils/logger */"./src/utils/logger.ts"),u=n(/*! ../events */"./src/events.ts"),c=n(/*! ../errors */"./src/errors.ts"),l=n(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),h=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),f=n(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),d=n(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),m=n(/*! ./level-helper */"./src/controller/level-helper.ts"),v=n(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts"),p=n(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),g=n(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts"),w=n(/*! ../types/loader */"./src/types/loader.ts");function b(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function y(t,i){return(y=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var x={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},k=function(t){var i,n;function r(i,n,e){var r;return(r=t.call(this)||this).hls=void 0,r.fragPrevious=null,r.fragCurrent=null,r.fragmentTracker=void 0,r.transmuxer=null,r._state=x.STOPPED,r.media=void 0,r.mediaBuffer=void 0,r.config=void 0,r.bitrateTest=!1,r.lastCurrentTime=0,r.nextLoadPosition=0,r.startPosition=0,r.loadedmetadata=!1,r.fragLoadError=0,r.retryDate=0,r.levels=null,r.fragmentLoader=void 0,r.levelLastLoaded=null,r.startFragRequested=!1,r.decrypter=void 0,r.initPTS=[],r.onvseeking=null,r.onvended=null,r.logPrefix="",r.log=void 0,r.warn=void 0,r.logPrefix=e,r.log=a.logger.log.bind(a.logger,e+":"),r.warn=a.logger.warn.bind(a.logger,e+":"),r.hls=i,r.fragmentLoader=new v.default(i.config),r.fragmentTracker=n,r.config=i.config,r.decrypter=new p.default(i,i.config),i.on(u.Events.KEY_LOADED,r.onKeyLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r)),r}n=t,(i=r).prototype=Object.create(n.prototype),i.prototype.constructor=i,y(i,n);var k,T,S=r.prototype;return S.doTick=function(){this.onTickEnd()},S.onTickEnd=function(){},S.startLoad=function(){},S.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=x.STOPPED},S._streamEnded=function(t,i){var n=this.fragCurrent,e=this.fragmentTracker;if(!i.live&&n&&n.sn>=i.endSN&&!t.nextStart){var r=i.partList;if(null!=r&&r.length){var a=r[r.length-1];return o.BufferHelper.isBuffered(this.media,a.start+a.duration/2)}var u=e.getState(n);return u===s.FragmentState.PARTIAL||u===s.FragmentState.OK}return!1},S.onMediaAttached=function(t,i){var n=this.media=this.mediaBuffer=i.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var e=this.config;this.levels&&e.autoStartLoad&&this.state===x.STOPPED&&this.startLoad(e.startPosition)},S.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},S.onMediaSeeking=function(){var t=this.config,i=this.fragCurrent,n=this.media,r=this.state,s=n?n.currentTime:0,a=o.BufferHelper.bufferInfo(this.mediaBuffer||n,s,t.maxBufferHole);if(this.log("media seeking to "+(Object(e.isFiniteNumber)(s)?s.toFixed(3):s)+", state: "+r),r===x.ENDED)this.resetLoadingState();else if(i&&!a.len){var u=t.maxFragLookUpTolerance,c=s>i.start+i.duration+u;(s<i.start-u||c)&&(c&&i.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.loader.abort()),this.resetLoadingState())}n&&(this.lastCurrentTime=s),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()},S.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},S.onKeyLoaded=function(t,i){if(this.state===x.KEY_LOADING&&i.frag===this.fragCurrent&&this.levels){this.state=x.IDLE;var n=this.levels[i.frag.level].details;n&&this.loadFragment(i.frag,n,i.frag.start)}},S.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},S.onHandlerDestroyed=function(){this.state=x.STOPPED,this.hls.off(u.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},S.loadKey=function(t,i){this.log("Loading key for "+t.sn+" of ["+i.startSN+"-"+i.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=x.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(u.Events.KEY_LOADING,{frag:t})},S.loadFragment=function(t,i,n){this._loadFragForPlayback(t,i,n)},S._loadFragForPlayback=function(t,i,n){var e=this;this._doFragLoad(t,i,n,(function(i){if(e.fragContextChanged(t))return e.warn("Fragment "+t.sn+(i.part?" p: "+i.part.index:"")+" of level "+t.level+" was dropped during download."),void e.fragmentTracker.removeFragment(t);t.stats.chunkCount++,e._handleFragmentLoadProgress(i)})).then((function(i){if(i){e.fragLoadError=0;var n=e.state;if(!e.fragContextChanged(t))return"payload"in i&&(e.log("Loaded fragment "+t.sn+" of level "+t.level),e.hls.trigger(u.Events.FRAG_LOADED,i),e.state===x.BACKTRACKING)?(e.fragmentTracker.backtrack(t,i),void e.resetFragmentLoading(t)):void e._handleFragmentLoadComplete(i);(n===x.FRAG_LOADING||n===x.BACKTRACKING||!e.fragCurrent&&n===x.PARSING)&&(e.fragmentTracker.removeFragment(t),e.state=x.IDLE)}})).catch((function(i){e.warn(i),e.resetFragmentLoading(t)}))},S.flushMainBuffer=function(t,i,n){if(void 0===n&&(n=null),t-i){var e={startOffset:t,endOffset:i,type:n};this.fragLoadError=0,this.hls.trigger(u.Events.BUFFER_FLUSHING,e)}},S._loadInitSegment=function(t){var i=this;this._doFragLoad(t).then((function(n){if(!n||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return n})).then((function(n){var e=i.hls,r=n.payload,s=t.decryptdata;if(r&&r.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var o=self.performance.now();return i.decrypter.webCryptoDecrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).then((function(i){var r=self.performance.now();return e.trigger(u.Events.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:o,tdecrypt:r}}),n.payload=i,n}))}return n})).then((function(n){var e=i.fragCurrent,r=i.hls,s=i.levels;if(!s)throw new Error("init load aborted, missing levels");console.assert(s[t.level].details,"Level details are defined when init segment is loaded");var o=t.stats;i.state=x.IDLE,i.fragLoadError=0,t.data=new Uint8Array(n.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),n.frag===e&&r.trigger(u.Events.FRAG_BUFFERED,{stats:o,frag:e,part:null,id:t.type}),i.tick()})).catch((function(n){i.warn(n),i.resetFragmentLoading(t)}))},S.fragContextChanged=function(t){var i=this.fragCurrent;return!t||!i||t.level!==i.level||t.sn!==i.sn||t.urlId!==i.urlId},S.fragBufferedComplete=function(t,i){this.log("Buffered "+t.type+" sn: "+t.sn+(i?" part: "+i.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+g.default.toString(o.BufferHelper.getBuffered(this.mediaBuffer?this.mediaBuffer:this.media))),this.state=x.IDLE,this.tick()},S._handleFragmentLoadComplete=function(t){var i=this.transmuxer;if(i){var n=t.frag,e=t.part,r=t.partsLoaded,s=!r||0===r.length||r.some((function(t){return!t})),o=new l.ChunkMetadata(n.level,n.sn,n.stats.chunkCount+1,0,e?e.index:-1,!s);i.flush(o)}},S._handleFragmentLoadProgress=function(){},S._doFragLoad=function(t,i,n,r){var s=this;if(void 0===n&&(n=null),!this.levels)throw new Error("frag load aborted, missing levels");if(n=Math.max(t.start,n||0),this.config.lowLatencyMode&&i){var o=i.partList;if(o&&r){n>t.end&&i.fragmentHint&&(t=i.fragmentHint);var a=this.getNextPart(o,t,n);if(a>-1){var c=o[a];return this.log("Loading part sn: "+t.sn+" p: "+c.index+" cc: "+t.cc+" of playlist ["+i.startSN+"-"+i.endSN+"] parts [0-"+a+"-"+(o.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=c.start+c.duration,this.state=x.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:t,part:o[a],targetBufferTime:n}),this.doFragPartsLoad(t,o,a,r).catch((function(t){return s.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(o,n))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(i?"of ["+i.startSN+"-"+i.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),Object(e.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=x.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:t,targetBufferTime:n}),this.fragmentLoader.load(t,r).catch((function(t){return s.handleFragLoadError(t)}))},S.doFragPartsLoad=function(t,i,n,e){var r=this;return new Promise((function(s,o){var a=[];!function n(c){var l=i[c];r.fragmentLoader.loadPart(t,l,e).then((function(e){a[l.index]=e;var o=e.part;r.hls.trigger(u.Events.FRAG_LOADED,e);var h=i[c+1];if(!h||h.fragment!==t)return s({frag:t,part:o,partsLoaded:a});n(c+1)})).catch(o)}(n)}))},S.handleFragLoadError=function(t){var i=t.data;return i&&i.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(u.Events.ERROR,i),null},S._handleTransmuxerFlush=function(t){var i=this.getCurrentContext(t);if(i&&this.state===x.PARSING){var n=i.frag,e=i.part,r=i.level,s=self.performance.now();n.stats.parsing.end=s,e&&(e.stats.parsing.end=s),this.updateLevelTiming(n,e,r,t.partial)}else this.fragCurrent||(this.state=x.IDLE)},S.getCurrentContext=function(t){var i=this.levels,n=t.level,e=t.sn,r=t.part;if(!i||!i[n])return this.warn("Levels object was unset while buffering fragment "+e+" of level "+n+". The current chunk will not be buffered."),null;var s=i[n],o=r>-1?Object(m.getPartWith)(s,e,r):null,a=o?o.fragment:Object(m.getFragmentWithSN)(s,e,this.fragCurrent);return a?{frag:a,part:o,level:s}:null},S.bufferFragmentData=function(t,i,n,e){if(t&&this.state===x.PARSING){var r=t.data1,s=t.data2,o=r;r&&s&&(o=Object(h.appendUint8Array)(r,s)),o&&o.length&&(this.hls.trigger(u.Events.BUFFER_APPENDING,{type:t.type,frag:i,part:n,chunkMeta:e,parent:i.type,data:o}),t.dropped&&t.independent&&!n&&this.flushBufferGap(i))}},S.flushBufferGap=function(t){var i=this.media;if(i)if(o.BufferHelper.isBuffered(i,i.currentTime)){var n=i.currentTime,e=o.BufferHelper.bufferInfo(i,n,0),r=Math.min(2*this.config.maxFragLookUpTolerance,.25*t.duration),s=Math.max(Math.min(t.start-r,e.end-r),n+r);t.start-s>r&&this.flushMainBuffer(s,t.start)}else this.flushMainBuffer(0,t.start)},S.getFwdBufferInfo=function(t,i){var n=this.config,r=this.getLoadPosition();if(!Object(e.isFiniteNumber)(r))return null;var s=o.BufferHelper.bufferInfo(t,r,n.maxBufferHole);if(0===s.len&&void 0!==s.nextStart){var a=this.fragmentTracker.getBufferedFrag(r,i);if(a&&s.nextStart<a.end)return o.BufferHelper.bufferInfo(t,r,Math.max(s.nextStart,n.maxBufferHole))}return s},S.getMaxBufferLength=function(t){var i,n=this.config;return i=t?Math.max(8*n.maxBufferSize/t,n.maxBufferLength):n.maxBufferLength,Math.min(i,n.maxMaxBufferLength)},S.reduceMaxBufferLength=function(t){var i=this.config;return i.maxMaxBufferLength>=(t||i.maxBufferLength)&&(i.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+i.maxMaxBufferLength+"s"),!0)},S.getNextFragment=function(t,i){var n,e,r=i.fragments,s=r.length;if(!s)return null;var o,a=this.config,u=r[0].start;if(i.live){var c=a.initialLiveManifestSize;if(s<c)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+c+")"),null;i.PTSKnown||this.startFragRequested||-1!==this.startPosition||(o=this.getInitialLiveFragment(i,r),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=u&&(o=r[0]);return o||(o=this.getFragmentAtPosition(t,a.lowLatencyMode?i.partEnd:i.fragmentEnd,i)),null===(n=o)||void 0===n||!n.initSegment||null!==(e=o)&&void 0!==e&&e.initSegment.data||this.bitrateTest||(o=o.initSegment),o},S.getNextPart=function(t,i,n){for(var e=-1,r=!1,s=!0,o=0,a=t.length;o<a;o++){var u=t[o];if(s=s&&!u.independent,e>-1&&n<u.start)break;var c=u.loaded;!c&&(r||u.independent||s)&&u.fragment===i&&(e=o),r=c}return e},S.loadedEndOfParts=function(t,i){var n=t[t.length-1];return n&&i>n.start&&n.loaded},S.getInitialLiveFragment=function(t,i){var n=this.fragPrevious,e=null;if(n){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),e=Object(d.findFragmentByPDT)(i,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!e){var r=n.sn+1;if(r>=t.startSN&&r<=t.endSN){var s=i[r-t.startSN];n.cc===s.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(e=s).sn)}e||(e=Object(d.findFragWithCC)(i,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+e.sn)}}else{var o=this.hls.liveSyncPosition;null!==o&&(e=this.getFragmentAtPosition(o,this.bitrateTest?t.fragmentEnd:t.edge,t))}return e},S.getFragmentAtPosition=function(t,i,n){var e,r=this.config,o=this.fragPrevious,a=n.fragments,u=n.endSN,c=n.fragmentHint,l=r.maxFragLookUpTolerance,h=!!(r.lowLatencyMode&&n.partList&&c);if(h&&c&&!this.bitrateTest&&(a=a.concat(c),u=c.sn),t<i){var f=t>i-l?0:l;e=Object(d.findFragmentByPTS)(o,a,t,f)}else e=a[a.length-1];if(e){var m=e.sn-n.startSN,v=o&&e.level===o.level,p=a[m+1];if(this.fragmentTracker.getState(e)===s.FragmentState.BACKTRACKED){e=null;for(var g=m;a[g]&&this.fragmentTracker.getState(a[g])===s.FragmentState.BACKTRACKED;)e=o?a[g--]:a[--g];e||(e=p)}else o&&e.sn===o.sn&&!h&&v&&(e.sn<u&&this.fragmentTracker.getState(p)!==s.FragmentState.OK?(this.log("SN "+e.sn+" just loaded, load next one: "+p.sn),e=p):e=null)}return e},S.synchronizeToLiveEdge=function(t){var i=this.config,n=this.media;if(n){var e=this.hls.liveSyncPosition,r=n.currentTime,s=t.edge,o=r>=t.fragments[0].start-i.maxFragLookUpTolerance&&r<=s;null!==e&&n.duration>e&&(r<e||!o)&&(!o&&n.readyState<4||r<s-(void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*t.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=e),n.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+e.toFixed(3)),n.currentTime=e))}},S.alignPlaylists=function(t,i){var n=this.levelLastLoaded,r=this.fragPrevious,s=null!==n?this.levels[n]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var a=t.fragments[0].start,u=!i,c=t.alignedSliding&&Object(e.isFiniteNumber)(a);if(u||!c&&!a){Object(f.alignStream)(r,s,t);var l=t.fragments[0].start;return this.log("Live playlist sliding: "+l.toFixed(2)+" start-sn: "+(i?i.startSN:"na")+"->"+t.startSN+" prev-sn: "+(r?r.sn:"na")+" fragments: "+o),l}return a},S.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},S.setStartPosition=function(t,i){var n=this.startPosition;if(n<i&&(n=-1),-1===n||-1===this.lastCurrentTime){var r=t.startTimeOffset;Object(e.isFiniteNumber)(r)?(n=i+r,r<0&&(n+=t.totalduration),n=Math.min(Math.max(i,n),i+t.totalduration),this.log("Start time offset "+r+" found in playlist, adjust startPosition to "+n),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||i:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},S.getLoadPosition=function(){var t=this.media,i=0;return this.loadedmetadata&&t?i=t.currentTime:this.nextLoadPosition&&(i=this.nextLoadPosition),i},S.handleFragLoadAborted=function(t,i){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(i?" part"+i.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},S.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=x.IDLE)},S.onFragmentOrKeyLoadError=function(t,i){if(!i.fatal){var n=i.frag;if(n&&n.type===t){var e=this.fragCurrent;console.assert(e&&n.sn===e.sn&&n.level===e.level&&n.urlId===e.urlId,"Frag load error must match current frag to retry");var r=this.config;if(this.fragLoadError+1<=r.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(n.level))return;var s=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" failed to load, retrying in "+s+"ms"),this.retryDate=self.performance.now()+s,this.fragLoadError++,this.state=x.FRAG_LOADING_WAITING_RETRY}else i.levelRetry?(t===w.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=x.IDLE):(a.logger.error(i.details+" reaches max retry, redispatch as fatal ..."),i.fatal=!0,this.hls.stopLoad(),this.state=x.ERROR)}}},S.afterBufferFlushed=function(t,i,n){if(t){var e=o.BufferHelper.getBuffered(t);this.fragmentTracker.detectEvictedFragments(i,e,n),this.state===x.ENDED&&this.resetLoadingState()}},S.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=x.IDLE},S.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var i=this.levels?this.levels[t].details:null;if(null!=i&&i.live)return this.startPosition=-1,this.setStartPosition(i,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},S.updateLevelTiming=function(t,i,n,e){var r=this,s=n.details;console.assert(!!s,"level.details must be defined"),Object.keys(t.elementaryStreams).reduce((function(i,o){var a=t.elementaryStreams[o];if(a){var c=a.endPTS-a.startPTS;if(c<=0)return r.warn("Could not parse fragment "+t.sn+" "+o+" duration reliably ("+c+") resetting transmuxer to fallback to playlist timing"),r.resetTransmuxer(),i||!1;var l=e?0:Object(m.updateFragPTSDTS)(s,t,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return r.hls.trigger(u.Events.LEVEL_PTS_UPDATED,{details:s,level:n,drift:l,type:o,frag:t,start:a.startPTS,end:a.endPTS}),!0}return i}),!1)?(this.state=x.PARSED,this.hls.trigger(u.Events.FRAG_PARSED,{frag:t,part:i})):this.resetLoadingState()},S.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},k=r,(T=[{key:"state",get:function(){return this._state},set:function(t){var i=this._state;i!==t&&(this._state=t,this.log(i+"->"+t))}}])&&b(k.prototype,T),r}(r.default)},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/buffer-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return d}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=n(/*! ../errors */"./src/errors.ts"),a=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=n(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),c=n(/*! ../loader/fragment */"./src/loader/fragment.ts"),l=n(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts"),h=Object(u.getMediaSource)(),f=/([ha]vc.)(?:\.[^.,]+)+/,d=function(){function t(t){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,n=i.media,e=i.mediaSource;s.logger.log("[buffer-controller]: Media source opened"),n&&(i.updateMediaElementDuration(),t.trigger(r.Events.MEDIA_ATTACHED,{media:n})),e&&e.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){s.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){s.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var i=t.prototype;return i.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},i.destroy=function(){this.unregisterListeners(),this.details=null},i.registerListeners=function(){var t=this.hls;t.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(r.Events.BUFFER_RESET,this.onBufferReset,this),t.on(r.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(r.Events.BUFFER_EOS,this.onBufferEos,this),t.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(r.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(r.Events.FRAG_PARSED,this.onFragParsed,this),t.on(r.Events.FRAG_CHANGED,this.onFragChanged,this)},i.unregisterListeners=function(){var t=this.hls;t.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(r.Events.BUFFER_RESET,this.onBufferReset,this),t.off(r.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(r.Events.BUFFER_EOS,this.onBufferEos,this),t.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(r.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(r.Events.FRAG_PARSED,this.onFragParsed,this),t.off(r.Events.FRAG_CHANGED,this.onFragChanged,this)},i._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new l.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},i.onManifestParsed=function(t,i){var n=2;(i.audio&&!i.video||!i.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,s.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(t,i){var n=this.media=i.media;if(n&&h){var e=this.mediaSource=new h;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(e),this._objectUrl=n.src}},i.onMediaDetaching=function(){var t=this.media,i=this.mediaSource,n=this._objectUrl;if(i){if(s.logger.log("[buffer-controller]: media source detaching"),"open"===i.readyState)try{i.endOfStream()}catch(t){s.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(n&&self.URL.revokeObjectURL(n),t.src===n?(t.removeAttribute("src"),t.load()):s.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(r.Events.MEDIA_DETACHED,void 0)},i.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(i){var n=t.sourceBuffer[i];try{n&&(t.removeBufferListeners(i),t.mediaSource&&t.mediaSource.removeSourceBuffer(n),t.sourceBuffer[i]=void 0)}catch(t){s.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",t)}})),this._initSourceBuffer()},i.onBufferCodecs=function(t,i){var n=this,e=this.getSourceBufferTypes().length;Object.keys(i).forEach((function(t){if(e){var r=n.tracks[t];if(r&&"function"==typeof r.buffer.changeType){var s=i[t],o=s.codec,a=s.levelCodec,u=s.container;(r.levelCodec||r.codec).replace(f,"$1")!==(a||o).replace(f,"$1")&&n.appendChangeType(t,u+";codecs="+(a||o))}}else n.pendingTracks[t]=i[t]})),e||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.appendChangeType=function(t,i){var n=this,e=this.operationQueue,r={execute:function(){var r=n.sourceBuffer[t];r&&(s.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+i),r.changeType(i)),e.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(i){s.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",i)}};e.append(r,t)},i.onBufferAppending=function(t,i){var n=this,e=this.hls,u=this.operationQueue,c=this.tracks,l=i.data,h=i.type,f=i.frag,d=i.part,m=i.chunkMeta,v=m.buffering[h],p=self.performance.now();v.start=p;var g=f.stats.buffering,w=d?d.stats.buffering:null;0===g.start&&(g.start=p),w&&0===w.start&&(w.start=p);var b=c.audio,y="audio"===h&&1===m.id&&"audio/mpeg"===(null==b?void 0:b.container);u.append({execute:function(){if(v.executeStart=self.performance.now(),y){var t=n.sourceBuffer[h];if(t){var i=f.start-t.timestampOffset;Math.abs(i)>=.1&&(s.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+i+") sn: "+f.sn+")"),t.timestampOffset=f.start)}}n.appendExecutor(l,h)},onStart:function(){},onComplete:function(){var t=self.performance.now();v.executeEnd=v.end=t,0===g.first&&(g.first=t),w&&0===w.first&&(w.first=t);var i=n.sourceBuffer,e={};for(var s in i)e[s]=a.BufferHelper.getBuffered(i[s]);n.appendError=0,n.hls.trigger(r.Events.BUFFER_APPENDED,{type:h,frag:f,part:d,chunkMeta:m,parent:f.type,timeRanges:e})},onError:function(t){s.logger.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",t);var i={type:o.ErrorTypes.MEDIA_ERROR,parent:f.type,details:o.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?i.details=o.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,i.details=o.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>e.config.appendErrorMaxRetry&&(s.logger.error("[buffer-controller]: Failed "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i.fatal=!0)),e.trigger(r.Events.ERROR,i)}},h)},i.onBufferFlushing=function(t,i){var n=this,e=this.operationQueue,o=function(t){return{execute:n.removeExecutor.bind(n,t,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(r.Events.BUFFER_FLUSHED,{type:t})},onError:function(i){s.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",i)}}};i.type?e.append(o(i.type),i.type):this.getSourceBufferTypes().forEach((function(t){e.append(o(t),t)}))},i.onFragParsed=function(t,i){var n=this,e=i.frag,o=i.part,a=[],u=o?o.elementaryStreams:e.elementaryStreams;u[c.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(u[c.ElementaryStreamTypes.AUDIO]&&a.push("audio"),u[c.ElementaryStreamTypes.VIDEO]&&a.push("video")),0===a.length&&s.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+e.type+" level: "+e.level+" sn: "+e.sn),this.blockBuffers((function(){var t=self.performance.now();e.stats.buffering.end=t,o&&(o.stats.buffering.end=t),n.hls.trigger(r.Events.FRAG_BUFFERED,{frag:e,part:o,stats:o?o.stats:e.stats,id:e.type})}),a)},i.onFragChanged=function(){this.flushBackBuffer()},i.onBufferEos=function(t,i){var n=this;this.getSourceBufferTypes().reduce((function(t,e){var r=n.sourceBuffer[e];return i.type&&i.type!==e||r&&!r.ended&&(r.ended=!0,s.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),t&&!(r&&!r.ended)}),!0)&&this.blockBuffers((function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},i.onLevelUpdated=function(t,i){var n=i.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},i.flushBackBuffer=function(){var t=this.hls,i=this.details,n=this.media,s=this.sourceBuffer;if(n&&null!==i){var o=this.getSourceBufferTypes();if(o.length){var u=i.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(e.isFiniteNumber)(u)&&!(u<0)){var c=n.currentTime,l=i.levelTargetDuration,h=Math.max(u,l),f=Math.floor(c/l)*l-h;o.forEach((function(n){var e=s[n];if(e){var o=a.BufferHelper.getBuffered(e);o.length>0&&f>o.start(0)&&(t.trigger(r.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),i.live&&t.trigger(r.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),t.trigger(r.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:n}))}}))}}}},i.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,i=this.hls,n=this.mediaSource,r=t.fragments[0].start+t.totalduration,o=this.media.duration,a=Object(e.isFiniteNumber)(n.duration)?n.duration:0;t.live&&i.config.liveDurationInfinity?(s.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(t)):(r>a&&r>o||!Object(e.isFiniteNumber)(o))&&(s.logger.log("[buffer-controller]: Updating Media Source duration to "+r.toFixed(3)),n.duration=r)}},i.updateSeekableRange=function(t){var i=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=i&&i.setLiveSeekableRange){var e=Math.max(0,n[0].start),r=Math.max(e,e+t.totalduration);i.setLiveSeekableRange(e,r)}},i.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,i=this.operationQueue,n=this.pendingTracks,e=Object.keys(n).length;if(e&&!t||2===e){this.createSourceBuffers(n),this.pendingTracks={};var s=this.getSourceBufferTypes();if(0===s.length)return void this.hls.trigger(r.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach((function(t){i.executeNext(t)}))}},i.createSourceBuffers=function(t){var i=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var e=0;for(var a in t)if(!i[a]){var u=t[a];if(!u)throw Error("source buffer exists for track "+a+", however track does not");var c=u.levelCodec||u.codec,l=u.container+";codecs="+c;s.logger.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var h=i[a]=n.addSourceBuffer(l),f=a;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[a]={buffer:h,codec:c,container:u.container,levelCodec:u.levelCodec,id:u.id},e++}catch(t){s.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(r.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:l})}}e&&this.hls.trigger(r.Events.BUFFER_CREATED,{tracks:this.tracks})},i._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},i._onSBUpdateEnd=function(t){var i=this.operationQueue;i.current(t).onComplete(),i.shiftAndExecuteNext(t)},i._onSBUpdateError=function(t,i){s.logger.error("[buffer-controller]: "+t+" SourceBuffer error",i),this.hls.trigger(r.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(t);n&&n.onError(i)},i.removeExecutor=function(t,i,n){var r=this.media,o=this.mediaSource,a=this.operationQueue,u=this.sourceBuffer[t];if(!r||!o||!u)return s.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(t);var c=Object(e.isFiniteNumber)(r.duration)?r.duration:1/0,l=Object(e.isFiniteNumber)(o.duration)?o.duration:1/0,h=Math.max(0,i),f=Math.min(n,c,l);f>h?(s.logger.log("[buffer-controller]: Removing ["+h+","+f+"] from the "+t+" SourceBuffer"),console.assert(!u.updating,t+" sourceBuffer must not be updating"),u.remove(h,f)):a.shiftAndExecuteNext(t)},i.appendExecutor=function(t,i){var n=this.operationQueue,e=this.sourceBuffer[i];if(!e)return s.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(i);e.ended=!1,console.assert(!e.updating,i+" sourceBuffer must not be updating"),e.appendBuffer(t)},i.blockBuffers=function(t,i){var n=this;if(void 0===i&&(i=this.getSourceBufferTypes()),i.length){var e=this.operationQueue,r=i.map((function(t){return e.appendBlocker(t)}));Promise.all(r).then((function(){t(),i.forEach((function(t){var i=n.sourceBuffer[t];i&&i.updating||e.shiftAndExecuteNext(t)}))}))}else s.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist")},i.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},i.addBufferListener=function(t,i,n){var e=this.sourceBuffer[t];if(e){var r=n.bind(this,t);this.listeners[t].push({event:i,listener:r}),e.addEventListener(i,r)}},i.removeBufferListeners=function(t){var i=this.sourceBuffer[t];i&&this.listeners[t].forEach((function(t){i.removeEventListener(t.event,t.listener)}))},t}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
  !*** ./src/controller/buffer-operation-queue.ts ***!
  \**************************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return r}));var e=n(/*! ../utils/logger */"./src/utils/logger.ts"),r=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var i=t.prototype;return i.append=function(t,i){var n=this.queues[i];n.push(t),1===n.length&&this.buffers[i]&&this.executeNext(i)},i.insertAbort=function(t,i){this.queues[i].unshift(t),this.executeNext(i)},i.appendBlocker=function(t){var i,n=new Promise((function(t){i=t}));return this.append({execute:i,onStart:function(){},onComplete:function(){},onError:function(){}},t),n},i.executeNext=function(t){var i=this.buffers[t],n=this.queues[t];if(n.length){var r=n[0];try{r.execute()}catch(s){e.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(s),i&&i.updating||(n.shift(),this.executeNext(t))}}},i.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},i.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/cap-level-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts");function r(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}i.default=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var i,n,s,o=t.prototype;return o.setStreamController=function(t){this.streamController=t},o.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var t=this.hls;t.on(e.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var t=this.hls;t.off(e.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(i,n){t.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},o.onMediaAttaching=function(t,i){this.media=i.media instanceof HTMLVideoElement?i.media:null},o.onManifestParsed=function(t,i){var n=this.hls;this.restrictedLevels=[],this.firstLevel=i.firstLevel,n.config.capLevelToPlayerSize&&i.video&&this.startCapping()},o.onBufferCodecs=function(t,i){this.hls.config.capLevelToPlayerSize&&i.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var i=this.hls;i.autoLevelCapping=this.getMaxLevel(t.length-1),i.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=i.autoLevelCapping}}},o.getMaxLevel=function(i){var n=this,e=this.hls.levels;if(!e.length)return-1;var r=e.filter((function(e,r){return t.isLevelAllowed(r,n.restrictedLevels)&&r<=i}));return this.clientRect=null,t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,i={width:0,height:0};if(t){var n=t.getBoundingClientRect();i.width=n.width,i.height=n.height,i.width||i.height||(i.width=n.right-n.left||t.width||0,i.height=n.bottom-n.top||t.height||0)}return this.clientRect=i,i},t.isLevelAllowed=function(t,i){return void 0===i&&(i=[]),-1===i.indexOf(t)},t.getMaxLevelByMediaSize=function(t,i,n){if(!t||!t.length)return-1;for(var e,r,s=t.length-1,o=0;o<t.length;o+=1){var a=t[o];if((a.width>=i||a.height>=n)&&(e=a,!(r=t[o+1])||e.width!==r.width||e.height!==r.height)){s=o;break}}return s},i=t,s=[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(t){}return t}}],(n=[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}])&&r(i.prototype,n),s&&r(i,s),t}()},"./src/controller/cmcd-controller.ts":
/*!*******************************************!*\
  !*** ./src/controller/cmcd-controller.ts ***!
  \*******************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return f}));var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../types/cmcd */"./src/types/cmcd.ts"),s=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts");function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function u(t,i,n){return i&&a(t.prototype,i),n&&a(t,n),t}function c(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,i){if(t){if("string"==typeof t)return l(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function h(){return(h=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}var f=function(){function t(i){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(t){try{n.apply(t,{ot:r.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(t){o.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var i=t.frag,e=n.hls.levels[i.level],s=n.getObjectType(i),a={d:1e3*i.duration,ot:s};s!==r.CMCDObjectType.VIDEO&&s!==r.CMCDObjectType.AUDIO&&s!=r.CMCDObjectType.MUXED||(a.br=e.bitrate/1e3,a.tb=n.getTopBandwidth(s)/1e3,a.bl=n.getBufferLength(s)),n.apply(t,a)}catch(t){o.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=i;var e=this.config=i.config,s=e.cmcd;null!=s&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||t.uuid(),this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.registerListeners())}var i=t.prototype;return i.registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(e.Events.BUFFER_CREATED,this.onBufferCreated,this)},i.unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(e.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},i.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},i.onMediaAttached=function(t,i){this.media=i.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},i.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},i.onBufferCreated=function(t,i){var n,e;this.audioBuffer=null===(n=i.tracks.audio)||void 0===n?void 0:n.buffer,this.videoBuffer=null===(e=i.tracks.video)||void 0===e?void 0:e.buffer},i.createData=function(){var t;return{v:r.CMCDVersion,sf:r.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},i.apply=function(i,n){if(void 0===n&&(n={}),h(n,this.createData()),this.starved&&(n.ot===r.CMCDObjectType.INIT||n.ot===r.CMCDObjectType.VIDEO||n.ot===r.CMCDObjectType.MUXED)&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering),this.useHeaders){var e=t.toHeaders(n);if(!Object.keys(e).length)return;i.headers||(i.headers={}),h(i.headers,e)}else{var s=t.toQuery(n);if(!s)return;i.url=t.appendQueryToUri(i.url,s)}},i.getObjectType=function(t){var i=t.type;return"subtitle"===i?r.CMCDObjectType.TIMED_TEXT:"initSegment"===t.sn?r.CMCDObjectType.INIT:"audio"===i?r.CMCDObjectType.AUDIO:"main"===i?this.hls.audioTracks.length?r.CMCDObjectType.VIDEO:r.CMCDObjectType.MUXED:void 0},i.getTopBandwidth=function(t){var i,n=0,e=this.hls;if(t===r.CMCDObjectType.AUDIO)i=e.audioTracks;else{var s=e.maxAutoLevel;i=e.levels.slice(0,s>-1?s+1:e.levels.length)}for(var o,a=c(i);!(o=a()).done;){var u=o.value;u.bitrate>n&&(n=u.bitrate)}return n>0?n:NaN},i.getBufferLength=function(t){var i=this.hls.media,n=t===r.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return n&&i?1e3*s.BufferHelper.bufferInfo(n,i.currentTime,this.config.maxBufferHole).len:NaN},i.createPlaylistLoader=function(){var t=this.applyPlaylistData,i=this.config.pLoader||this.config.loader;return function(){function n(t){this.loader=void 0,this.loader=new i(t)}var e=n.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,n,e){t(i),this.loader.load(i,n,e)},u(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},i.createFragmentLoader=function(){var t=this.applyFragmentData,i=this.config.fLoader||this.config.loader;return function(){function n(t){this.loader=void 0,this.loader=new i(t)}var e=n.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,n,e){t(i),this.loader.load(i,n,e)},u(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),i=t.toString();return URL.revokeObjectURL(t),i.substr(i.lastIndexOf("/")+1)},t.serialize=function(t){for(var i,n=[],e=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},r=function(t){return Math.round(t)},s=function(t){return 100*r(t/100)},o={br:r,d:r,bl:s,dl:s,mtp:s,nor:function(t){return encodeURIComponent(t)},rtp:s,tb:r},a=c(Object.keys(t||{}).sort());!(i=a()).done;){var u=i.value,l=t[u];if(e(l)&&!("v"===u&&1===l||"pr"==u&&1===l)){var h=o[u];h&&(l=h(l));var f,d=typeof l;f="ot"===u||"sf"===u||"st"===u?u+"="+l:"boolean"===d?u:"number"===d?u+"="+l:u+"="+JSON.stringify(l),n.push(f)}}return n.join(",")},t.toHeaders=function(i){for(var n={},e=["Object","Request","Session","Status"],r=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,a=Object.keys(i);o<a.length;o++){var u=a[o];r[null!=s[u]?s[u]:1][u]=i[u]}for(var c=0;c<r.length;c++){var l=t.serialize(r[c]);l&&(n["CMCD-"+e[c]]=l)}return n},t.toQuery=function(i){return"CMCD="+encodeURIComponent(t.serialize(i))},t.appendQueryToUri=function(t,i){if(!i)return t;var n=t.includes("?")?"&":"?";return""+t+n+i},t}()},"./src/controller/eme-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/eme-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../errors */"./src/errors.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=n(/*! ../utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}i.default=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var i,n,u=t.prototype;return u.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},u._registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this)},u._unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this)},u.getLicenseServerUrl=function(t){switch(t){case o.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},u._attemptKeySystemAccess=function(t,i,n){var e=this,r=function(t,i,n,e){switch(t){case o.KeySystems.WIDEVINE:return function(t,i,n){var e={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})})),i.forEach((function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})})),[e]}(i,n,e);default:throw new Error("Unknown key-system: "+t)}}(t,i,n,this._drmSystemOptions);s.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(t,r);this.mediaKeysPromise=a.then((function(i){return e._onMediaKeySystemAccessObtained(t,i)})),a.catch((function(i){s.logger.error('Failed to obtain key-system "'+t+'" access:',i)}))},u._onMediaKeySystemAccessObtained=function(t,i){var n=this;s.logger.log('Access for key-system "'+t+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:i,mediaKeySystemDomain:t};this._mediaKeysList.push(e);var r=Promise.resolve().then((function(){return i.createMediaKeys()})).then((function(i){return e.mediaKeys=i,s.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),i}));return r.catch((function(t){s.logger.error("Failed to create media-keys:",t)})),r},u._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(i){i.mediaKeysSession||(i.mediaKeysSession=i.mediaKeys.createSession(),t._onNewMediaKeySession(i.mediaKeysSession))}))},u._onNewMediaKeySession=function(t){var i=this;s.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(n){i._onKeySessionMessage(t,n.message)}),!1)},u._onKeySessionMessage=function(t,i){s.logger.log("Got EME message event, creating license request"),this._requestLicense(i,(function(i){s.logger.log("Received license data (length: "+(i?i.byteLength:i)+"), updating key-session"),t.update(i)}))},u.onMediaEncrypted=function(t){var i=this;if(s.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var n=function(n){i._media&&(i._attemptSetMediaKeys(n),i._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(n).catch(n)},u._attemptSetMediaKeys=function(){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});s.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},u._generateRequestWithPreferredKeySession=function(t,i){var n=this,o=this._mediaKeysList[0];if(!o)return s.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(o.mediaKeysSessionInitialized)s.logger.warn("Key-Session already initialized but requested again");else{var a=o.mediaKeysSession;if(!a)return s.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!i)return s.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});s.logger.log('Generating key-session request for "'+t+'" init data type'),o.mediaKeysSessionInitialized=!0,a.generateRequest(t,i).then((function(){s.logger.debug("Key-session generation succeeded")})).catch((function(t){s.logger.error("Error generating key-session request:",t),n.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},u._createLicenseXhr=function(t,i,n){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,t,i,n);var r=this._licenseXhrSetup;if(r)try{r.call(this.hls,e,t),r=void 0}catch(t){s.logger.error(t)}try{e.readyState||e.open("POST",t,!0),r&&r.call(this.hls,e,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},u._onLicenseRequestReadyStageChange=function(t,i,n,o){switch(t.readyState){case 4:if(200===t.status){this._requestLicenseFailureCount=0,s.logger.log("License request succeeded");var a=t.response,u=this._licenseResponseCallback;if(u)try{a=u.call(this.hls,t,i)}catch(t){s.logger.error(t)}o(a)}else{if(s.logger.error("License Request XHR failed ("+i+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});s.logger.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),this._requestLicense(n,o)}}},u._generateLicenseRequestChallenge=function(t,i){switch(t.mediaKeySystemDomain){case o.KeySystems.WIDEVINE:return i}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},u._requestLicense=function(t,i){s.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return s.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var o=this.getLicenseServerUrl(n.mediaKeySystemDomain),a=this._createLicenseXhr(o,t,i);s.logger.log("Sending license request to URL: "+o);var u=this._generateLicenseRequestChallenge(n,t);a.send(u)}catch(t){s.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.KEY_SYSTEM_ERROR,details:r.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},u.onMediaAttached=function(t,i){if(this._emeEnabled){var n=i.media;this._media=n,n.addEventListener("encrypted",this._onMediaEncrypted)}},u.onMediaDetached=function(){var t=this._media,i=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(i.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},u.onManifestParsed=function(t,i){if(this._emeEnabled){var n=i.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),e=i.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(o.KeySystems.WIDEVINE,n,e)}},i=t,(n=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&a(i.prototype,n),t}()},"./src/controller/fps-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/fps-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../utils/logger */"./src/utils/logger.ts");i.default=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var i=t.prototype;return i.setStreamController=function(t){this.streamController=t},i.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},i.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching)},i.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},i.onMediaAttaching=function(t,i){var n=this.hls.config;if(n.capLevelOnFPSDrop){var e=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},i.checkFPS=function(t,i,n){var s=performance.now();if(i){if(this.lastTime){var o=n-this.lastDroppedFrames,a=i-this.lastDecodedFrames,u=1e3*o/(s-this.lastTime),c=this.hls;if(c.trigger(e.Events.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),u>0&&o>c.config.fpsDroppedMonitoringThreshold*a){var l=c.currentLevel;r.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=l)&&(c.trigger(e.Events.FPS_DROP_LEVEL_CAPPING,{level:l-=1,droppedLevel:c.currentLevel}),c.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=i}},i.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var i=t.getVideoPlaybackQuality();this.checkFPS(t,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}()},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-finders.ts ***!
  \********************************************/
/*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */function(t,i,n){n.r(i),n.d(i,"findFragmentByPDT",(function(){return s})),n.d(i,"findFragmentByPTS",(function(){return o})),n.d(i,"fragmentWithinToleranceTest",(function(){return a})),n.d(i,"pdtWithinToleranceTest",(function(){return u})),n.d(i,"findFragWithCC",(function(){return c}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../utils/binary-search */"./src/utils/binary-search.ts");function s(t,i,n){if(null===i||!Array.isArray(t)||!t.length||!Object(e.isFiniteNumber)(i))return null;if(i<(t[0].programDateTime||0))return null;if(i>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<t.length;++r){var s=t[r];if(u(i,n,s))return s}return null}function o(t,i,n,e){void 0===n&&(n=0),void 0===e&&(e=0);var s=null;return t?s=i[t.sn-i[0].sn+1]||null:0===n&&0===i[0].start&&(s=i[0]),s&&0===a(n,e,s)?s:r.default.search(i,a.bind(null,n,e))||s}function a(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0);var e=Math.min(i,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-e<=t?1:n.start-e>t&&n.start?-1:0}function u(t,i,n){var e=1e3*Math.min(i,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-e>t}function c(t,i){return r.default.search(t,(function(t){return t.cc<i?1:t.cc>i?-1:0}))}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-tracker.ts ***!
  \********************************************/
/*! exports provided: FragmentState, FragmentTracker */function(t,i,n){n.r(i),n.d(i,"FragmentState",(function(){return e})),n.d(i,"FragmentTracker",(function(){return o}));var e,r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../types/loader */"./src/types/loader.ts");!function(t){t.NOT_LOADED="NOT_LOADED",t.BACKTRACKED="BACKTRACKED",t.APPENDING="APPENDING",t.PARTIAL="PARTIAL",t.OK="OK"}(e||(e={}));var o=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var i=t.prototype;return i._registerListeners=function(){var t=this.hls;t.on(r.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(r.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(r.Events.FRAG_LOADED,this.onFragLoaded,this)},i._unregisterListeners=function(){var t=this.hls;t.off(r.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(r.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(r.Events.FRAG_LOADED,this.onFragLoaded,this)},i.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},i.getAppendedFrag=function(t,i){if(i===s.PlaylistLevelType.MAIN){var n=this.activeFragment,e=this.activeParts;if(!n)return null;if(e)for(var r=e.length;r--;){var o=e[r],a=o?o.end:n.appendedPTS;if(o.start<=t&&void 0!==a&&t<=a)return r>9&&(this.activeParts=e.slice(r-9)),o}else if(n.start<=t&&void 0!==n.appendedPTS&&t<=n.appendedPTS)return n}return this.getBufferedFrag(t,i)},i.getBufferedFrag=function(t,i){for(var n=this.fragments,e=Object.keys(n),r=e.length;r--;){var s=n[e[r]];if((null==s?void 0:s.body.type)===i&&s.buffered){var o=s.body;if(o.start<=t&&t<=o.end)return o}}return null},i.detectEvictedFragments=function(t,i,n){var e=this;Object.keys(this.fragments).forEach((function(r){var s=e.fragments[r];if(s)if(s.buffered){var o=s.range[t];o&&o.time.some((function(t){var n=!e.isTimeBuffered(t.startPTS,t.endPTS,i);return n&&e.removeFragment(s.body),n}))}else s.body.type===n&&e.removeFragment(s.body)}))},i.detectPartialFragments=function(t){var i=this,n=this.timeRanges,e=t.frag,r=t.part;if(n&&"initSegment"!==e.sn){var s=u(e),o=this.fragments[s];o&&(Object.keys(n).forEach((function(t){var s=e.elementaryStreams[t];s&&(o.range[t]=i.getBufferedTimes(e,r,null!==r||!0===s.partial,n[t]))})),o.backtrack=o.loaded=null,Object.keys(o.range).length?o.buffered=!0:this.removeFragment(o.body))}},i.fragBuffered=function(t){var i=u(t),n=this.fragments[i];n&&(n.backtrack=n.loaded=null,n.buffered=!0)},i.getBufferedTimes=function(t,i,n,e){for(var r={time:[],partial:n},s=i?i.start:t.start,o=i?i.end:t.end,a=t.minEndPTS||o,u=t.maxStartPTS||s,c=0;c<e.length;c++){var l=e.start(c)-this.bufferPadding,h=e.end(c)+this.bufferPadding;if(u>=l&&a<=h){r.time.push({startPTS:Math.max(s,e.start(c)),endPTS:Math.min(o,e.end(c))});break}if(s<h&&o>l)r.partial=!0,r.time.push({startPTS:Math.max(s,e.start(c)),endPTS:Math.min(o,e.end(c))});else if(o<=l)break}return r},i.getPartialFragment=function(t){var i,n,e,r=null,s=0,o=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach((function(c){var l=u[c];l&&a(l)&&(e=l.body.end+o,t>=(n=l.body.start-o)&&t<=e&&(i=Math.min(t-n,e-t),s<=i&&(r=l.body,s=i)))})),r},i.getState=function(t){var i=u(t),n=this.fragments[i];return n?n.buffered?a(n)?e.PARTIAL:e.OK:n.backtrack?e.BACKTRACKED:e.APPENDING:e.NOT_LOADED},i.backtrack=function(t,i){var n=u(t),e=this.fragments[n];if(!e||e.backtrack)return null;var r=e.backtrack=i||e.loaded;return e.loaded=null,r},i.getBacktrackData=function(t){var i=u(t),n=this.fragments[i];if(n){var e,r=n.backtrack;if(null!=r&&null!==(e=r.payload)&&void 0!==e&&e.byteLength)return r;this.removeFragment(t)}return null},i.isTimeBuffered=function(t,i,n){for(var e,r,s=0;s<n.length;s++){if(e=n.start(s)-this.bufferPadding,r=n.end(s)+this.bufferPadding,t>=e&&i<=r)return!0;if(i<=e)return!1}return!1},i.onFragLoaded=function(t,i){var n=i.frag;if("initSegment"!==n.sn&&!n.bitrateTest&&!i.part){var e=u(n);this.fragments[e]={body:n,loaded:i,backtrack:null,buffered:!1,range:Object.create(null)}}},i.onBufferAppended=function(t,i){var n=this,e=i.frag,r=i.part,o=i.timeRanges;if(e.type===s.PlaylistLevelType.MAIN)if(this.activeFragment=e,r){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(r)}else this.activeParts=null;this.timeRanges=o,Object.keys(o).forEach((function(t){var i=o[t];if(n.detectEvictedFragments(t,i),!r)for(var s=0;s<i.length;s++)e.appendedPTS=Math.max(i.end(s),e.appendedPTS||0)}))},i.onFragBuffered=function(t,i){this.detectPartialFragments(i)},i.hasFragment=function(t){var i=u(t);return!!this.fragments[i]},i.removeFragmentsInRange=function(t,i,n){var e=this;Object.keys(this.fragments).forEach((function(r){var s=e.fragments[r];if(s&&s.buffered){var o=s.body;o.type===n&&o.start<i&&o.end>t&&e.removeFragment(o)}}))},i.removeFragment=function(t){var i=u(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[i]},i.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function a(t){var i,n;return t.buffered&&((null===(i=t.range.video)||void 0===i?void 0:i.partial)||(null===(n=t.range.audio)||void 0===n?void 0:n.partial))}function u(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/gap-controller.ts ***!
  \******************************************/
/*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */function(t,i,n){n.r(i),n.d(i,"STALL_MINIMUM_DURATION_MS",(function(){return a})),n.d(i,"MAX_START_GAP_JUMP",(function(){return u})),n.d(i,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return c})),n.d(i,"SKIP_BUFFER_RANGE_START",(function(){return l})),n.d(i,"default",(function(){return h}));var e=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),r=n(/*! ../errors */"./src/errors.ts"),s=n(/*! ../events */"./src/events.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=250,u=2,c=.1,l=.05,h=function(){function t(t,i,n,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=i,this.fragmentTracker=n,this.hls=e}var i=t.prototype;return i.destroy=function(){this.hls=this.fragmentTracker=this.media=null},i.poll=function(t){var i=this.config,n=this.media,r=this.stalled,s=n.currentTime,c=n.seeking,l=this.seeking&&!c,h=!this.seeking&&c;if(this.seeking=c,s===t){if((h||l)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&e.BufferHelper.getBuffered(n).length){var f=e.BufferHelper.bufferInfo(n,s,0),d=f.nextStart||0;if(f.len>0||d){if(c){var m=f.len>u,v=!d||d-s>u&&!this.fragmentTracker.getPartialFragment(s);if(m||v)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var p,g=Math.max(d,f.start||0)-s,w=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,b=null==w||null===(p=w.details)||void 0===p?void 0:p.live;if(g>0&&g<=(b?2*w.details.targetduration:u))return void this._trySkipBufferHole(null)}var y=self.performance.now();if(null!==r){var x=y-r;!c&&x>=a&&this._reportStall(f.len);var k=e.BufferHelper.bufferInfo(n,s,i.maxBufferHole);this._tryFixBufferStall(k,x)}else this.stalled=y}}}else if(this.moved=!0,null!==r){if(this.stallReported){var T=self.performance.now()-r;o.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(T)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},i._tryFixBufferStall=function(t,i){var n=this.config,e=this.fragmentTracker.getPartialFragment(this.media.currentTime);e&&this._trySkipBufferHole(e)||t.len>n.maxBufferHole&&i>1e3*n.highBufferWatchdogPeriod&&(o.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},i._reportStall=function(t){var i=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,o.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+t+")"),i.trigger(s.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},i._trySkipBufferHole=function(t){for(var i=this.config,n=this.hls,a=this.media,u=a.currentTime,h=0,f=e.BufferHelper.getBuffered(a),d=0;d<f.length;d++){var m=f.start(d);if(u+i.maxBufferHole>=h&&u<m){var v=Math.max(m+l,a.currentTime+c);return o.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,t&&n.trigger(s.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+v,frag:t}),v}h=f.end(d)}return 0},i._tryNudgeBuffer=function(){var t=this.config,i=this.hls,n=this.media,e=n.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<t.nudgeMaxRetry){var u=e+a*t.nudgeOffset;o.logger.warn("Nudging 'currentTime' from "+e+" to "+u),n.currentTime=u,i.trigger(s.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else o.logger.error("Playhead still not moving while enough data buffered @"+e+" after "+t.nudgeMaxRetry+" nudges"),i.trigger(s.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/id3-track-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),s=n(/*! ../demux/id3 */"./src/demux/id3.ts");i.default=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var i=t.prototype;return i.destroy=function(){this._unregisterListeners()},i._registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.onMediaAttached=function(t,i){this.media=i.media},i.onMediaDetaching=function(){this.id3Track&&(Object(r.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},i.getID3Track=function(t){if(this.media){for(var i=0;i<t.length;i++){var n=t[i];if("metadata"===n.kind&&"id3"===n.label)return Object(r.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},i.onFragParsingMetadata=function(t,i){if(this.media){var n=i.frag,e=i.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,o=0;o<e.length;o++){var a=s.getID3Frames(e[o].data);if(a){var u=e[o].pts,c=o<e.length-1?e[o+1].pts:n.end;c-u<=0&&(c=u+.25);for(var l=0;l<a.length;l++){var h=a[l];if(!s.isTimeStampFrame(h)){var f=new r(u,c,"");f.value=h,this.id3Track.addCue(f)}}}}}},i.onBufferFlushing=function(t,i){var n=i.startOffset,e=i.endOffset,s=i.type;if(!s||"audio"===s){var o=this.id3Track;o&&Object(r.removeCuesInRange)(o,n,e)}},t}()},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
  !*** ./src/controller/latency-controller.ts ***!
  \**********************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return a}));var e=n(/*! ../errors */"./src/errors.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts");function o(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var a=function(){function t(t){var i=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return i.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var i,n,a=t.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},a.registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(r.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(r.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(r.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(r.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(r.Events.ERROR,this.onError)},a.onMediaAttached=function(t,i){this.media=i.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},a.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},a.onLevelUpdated=function(t,i){var n=i.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},a.onError=function(t,i){i.details===e.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,s.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},a.timeupdate=function(){var t=this.media,i=this.levelDetails;if(t&&i){this.currentTime=t.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var e=this.config,r=e.maxLiveSyncPlaybackRate;if(e.lowLatencyMode&&1!==r){var s=this.targetLatency;if(null!==s){var o=n-s,a=Math.min(this.maxLatency,s+i.targetduration);if(i.live&&o<a&&o>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,r)),c=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(u,Math.max(1,c))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},a.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},a.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},i=t,(n=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,i=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:i?t.liveMaxLatencyDurationCount*i.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var i=t.targetduration,n=this.config,e=n.liveSyncDuration,r=this.hls.userConfig,s=n.lowLatencyMode&&t.partHoldBack||t.holdBack;return(r.liveSyncDuration||r.liveSyncDurationCount||0===s)&&(s=void 0!==e?e:n.liveSyncDurationCount*i),s+Math.min(1*this.stallCount,i)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),i=this.targetLatency,n=this.levelDetails;if(null===t||null===i||null===n)return null;var e=n.edge,r=e-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(e-n.totalduration,t-i-this.edgeStalled),r)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;return null===t?0:Math.max(t.age-3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration),0)}},{key:"forwardBufferLength",get:function(){var t=this.media,i=this.levelDetails;if(!t||!i)return 0;var n=t.buffered.length;return n?t.buffered.end(n-1):i.edge-this.currentTime}}])&&o(i.prototype,n),t}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
  !*** ./src/controller/level-controller.ts ***!
  \********************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return m}));var e=n(/*! ../types/level */"./src/types/level.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../errors */"./src/errors.ts"),o=n(/*! ../utils/codecs */"./src/utils/codecs.ts"),a=n(/*! ./level-helper */"./src/controller/level-helper.ts"),u=n(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),c=n(/*! ../types/loader */"./src/types/loader.ts");function l(){return(l=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function h(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function f(t,i){return(f=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),m=function(t){var i,n;function u(i){var n;return(n=t.call(this,i,"[level-controller]")||this)._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}n=t,(i=u).prototype=Object.create(n.prototype),i.prototype.constructor=i,f(i,n);var m,v,p=u.prototype;return p._registerListeners=function(){var t=this.hls;t.on(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(r.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(r.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(r.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var t=this.hls;t.off(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(r.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(r.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(r.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},p.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},p.onManifestLoaded=function(t,i){var n,u,c=[],l=[],h=[],f={},m=!1,v=!1,p=!1;if(i.levels.forEach((function(t){var i=t.attrs;m=m||!(!t.width||!t.height),v=v||!!t.videoCodec,p=p||!!t.audioCodec,d&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var n=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(u=f[n])?u.url.push(t.url):(u=new e.Level(t),f[n]=u,c.push(u)),i&&(i.AUDIO&&Object(a.addGroupId)(u,"audio",i.AUDIO),i.SUBTITLES&&Object(a.addGroupId)(u,"text",i.SUBTITLES))})),(m||v)&&p&&(c=c.filter((function(t){return!!t.videoCodec||!(!t.width||!t.height)}))),c=c.filter((function(t){var i=t.audioCodec,n=t.videoCodec;return(!i||Object(o.isCodecSupportedInMp4)(i,"audio"))&&(!n||Object(o.isCodecSupportedInMp4)(n,"video"))})),i.audioTracks&&(l=i.audioTracks.filter((function(t){return!t.audioCodec||Object(o.isCodecSupportedInMp4)(t.audioCodec,"audio")})),Object(a.assignTrackIdsByGroup)(l)),i.subtitles&&(h=i.subtitles,Object(a.assignTrackIdsByGroup)(h)),c.length>0){n=c[0].bitrate,c.sort((function(t,i){return t.bitrate-i.bitrate})),this._levels=c;for(var g=0;g<c.length;g++)if(c[g].bitrate===n){this._firstLevel=g,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+n);break}var w={levels:c,audioTracks:l,subtitleTracks:h,firstLevel:this._firstLevel,stats:i.stats,audio:p,video:v,altAudio:!(p&&!v)&&l.some((function(t){return!!t.url}))};this.hls.trigger(r.Events.MANIFEST_PARSED,w),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(r.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(i,n){if(t.prototype.onError.call(this,i,n),!n.fatal){var e=n.context,r=this._levels[this.currentLevelIndex];if(e&&(e.type===c.PlaylistContextType.AUDIO_TRACK&&r.audioGroupIds&&e.groupId===r.audioGroupIds[r.urlId]||e.type===c.PlaylistContextType.SUBTITLE_TRACK&&r.textGroupIds&&e.groupId===r.textGroupIds[r.urlId]))this.redundantFailover(this.currentLevelIndex);else{var o,a=!1,u=!0;switch(n.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var l=this._levels[n.frag.level];l?(l.fragmentError++,l.fragmentError>this.hls.config.fragLoadingMaxRetry&&(o=n.frag.level)):o=n.frag.level}break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:e&&(e.deliveryDirectives&&(u=!1),o=e.level),a=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:o=n.level,a=!0}void 0!==o&&this.recoverLevel(n,o,a,u)}}},p.recoverLevel=function(t,i,n,e){var r=t.details,s=this._levels[i];if(s.loadError++,n){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(e){var o=s.url.length;if(o>1&&s.loadError<o)t.levelRetry=!0,this.redundantFailover(i);else if(-1===this.manualLevelIndex){var a=0===i?this._levels.length-1:i-1;this.currentLevelIndex!==a&&0===this._levels[a].loadError&&(this.warn(r+": switch to "+a),t.levelRetry=!0,this.hls.nextAutoLevel=a)}}},p.redundantFailover=function(t){var i=this._levels[t],n=i.url.length;if(n>1){var e=(i.urlId+1)%n;this.warn("Switching to redundant URL-id "+e),this._levels.forEach((function(t){t.urlId=e})),this.level=t}},p.onFragLoaded=function(t,i){var n=i.frag;if(void 0!==n&&n.type===c.PlaylistLevelType.MAIN){var e=this._levels[n.level];void 0!==e&&(e.fragmentError=0,e.loadError=0)}},p.onLevelLoaded=function(t,i){var n,e,r=i.level,s=i.details,o=this._levels[r];if(!o)return this.warn("Invalid level index "+r),void(null!==(e=i.deliveryDirectives)&&void 0!==e&&e.skip&&(s.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(r,i,o.details)):null!==(n=i.deliveryDirectives)&&void 0!==n&&n.skip&&(s.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(t,i){var n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var e=-1,r=this.hls.audioTracks[i.id].groupId,s=0;s<n.audioGroupIds.length;s++)if(n.audioGroupIds[s]===r){e=s;break}e!==n.urlId&&(n.urlId=e,this.startLoad())}},p.loadPlaylist=function(t){var i=this.currentLevelIndex,n=this._levels[i];if(this.canLoad&&n&&n.url.length>0){var e=n.urlId,s=n.url[e];if(t)try{s=t.addDirectives(s)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+i+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+e+" "+s),this.clearTimer(),this.hls.trigger(r.Events.LEVEL_LOADING,{url:s,level:i,id:e,deliveryDirectives:t||null})}},p.removeLevel=function(t,i){var n=function(t,n){return n!==i},e=this._levels.filter((function(e,r){return r!==t||e.url.length>1&&void 0!==i&&(e.url=e.url.filter(n),e.audioGroupIds&&(e.audioGroupIds=e.audioGroupIds.filter(n)),e.textGroupIds&&(e.textGroupIds=e.textGroupIds.filter(n)),e.urlId=0,!0)})).map((function(t,i){var n=t.details;return null!=n&&n.fragments&&n.fragments.forEach((function(t){t.level=i})),t}));this._levels=e,this.hls.trigger(r.Events.LEVELS_UPDATED,{levels:e})},m=u,(v=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var i,n=this._levels;if(0!==n.length&&(this.currentLevelIndex!==t||null===(i=n[t])||void 0===i||!i.details)){if(t<0||t>=n.length){var e=t<0;if(this.hls.trigger(r.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:e,reason:"invalid level idx"}),e)return;t=Math.min(t,n.length-1)}this.clearTimer();var o=this.currentLevelIndex,a=n[o],u=n[t];this.log("switching to level "+t+" from "+o),this.currentLevelIndex=t;var c=l({},u,{level:t,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete c._urlId,this.hls.trigger(r.Events.LEVEL_SWITCHING,c);var h=u.details;if(!h||h.live){var f=this.switchParams(u.uri,null==a?void 0:a.details);this.loadPlaylist(f)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&h(m.prototype,v),u}(u.default)},"./src/controller/level-helper.ts":
/*!****************************************!*\
  !*** ./src/controller/level-helper.ts ***!
  \****************************************/
/*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */function(t,i,n){n.r(i),n.d(i,"addGroupId",(function(){return s})),n.d(i,"assignTrackIdsByGroup",(function(){return o})),n.d(i,"updatePTS",(function(){return a})),n.d(i,"updateFragPTSDTS",(function(){return c})),n.d(i,"mergeDetails",(function(){return l})),n.d(i,"mapPartIntersection",(function(){return h})),n.d(i,"mapFragmentIntersection",(function(){return f})),n.d(i,"adjustSliding",(function(){return d})),n.d(i,"addSliding",(function(){return m})),n.d(i,"computeReloadInterval",(function(){return v})),n.d(i,"getFragmentWithSN",(function(){return p})),n.d(i,"getPartWith",(function(){return g}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../utils/logger */"./src/utils/logger.ts");function s(t,i,n){switch(i){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function o(t){var i={};t.forEach((function(t){var n=t.groupId||"";t.id=i[n]=i[n]||0,i[n]++}))}function a(t,i,n){u(t[i],t[n])}function u(t,i){var n=i.startPTS;if(Object(e.isFiniteNumber)(n)){var r,s=0;i.sn>t.sn?(s=n-t.start,r=t):(s=t.start-n,r=i),r.duration!==s&&(r.duration=s)}else i.start=i.sn>t.sn?t.cc===i.cc&&t.minEndPTS?t.start+(t.minEndPTS-t.start):t.start+t.duration:Math.max(t.start-i.duration,0)}function c(t,i,n,s,o,a){s-n<=0&&(r.logger.warn("Fragment should have a positive duration",i),s=n+i.duration,a=o+i.duration);var c=n,l=s,h=i.startPTS,f=i.endPTS;if(Object(e.isFiniteNumber)(h)){var d=Math.abs(h-n);i.deltaPTS=Object(e.isFiniteNumber)(i.deltaPTS)?Math.max(d,i.deltaPTS):d,c=Math.max(n,h),n=Math.min(n,h),o=Math.min(o,i.startDTS),l=Math.min(s,f),s=Math.max(s,f),a=Math.max(a,i.endDTS)}i.duration=s-n;var m=n-i.start;i.appendedPTS=s,i.start=i.startPTS=n,i.maxStartPTS=c,i.startDTS=o,i.endPTS=s,i.minEndPTS=l,i.endDTS=a;var v,p=i.sn;if(!t||p<t.startSN||p>t.endSN)return 0;var g=p-t.startSN,w=t.fragments;for(w[g]=i,v=g;v>0;v--)u(w[v],w[v-1]);for(v=g;v<w.length-1;v++)u(w[v],w[v+1]);return t.fragmentHint&&u(w[w.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,m}function l(t,i){for(var n=null,s=t.fragments,o=s.length-1;o>=0;o--){var a=s[o].initSegment;if(a){n=a;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var u,l=0;if(f(t,i,(function(t,r){t.relurl&&(l=t.cc-r.cc),Object(e.isFiniteNumber)(t.startPTS)&&Object(e.isFiniteNumber)(t.endPTS)&&(r.start=r.startPTS=t.startPTS,r.startDTS=t.startDTS,r.appendedPTS=t.appendedPTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.duration=t.endPTS-t.startPTS,r.duration&&(u=r),i.PTSKnown=i.alignedSliding=!0),r.elementaryStreams=t.elementaryStreams,r.loader=t.loader,r.stats=t.stats,r.urlId=t.urlId,t.initSegment&&(r.initSegment=t.initSegment,n=t.initSegment)})),n&&(i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments).forEach((function(t){var i;t.initSegment&&t.initSegment.relurl!==(null===(i=n)||void 0===i?void 0:i.relurl)||(t.initSegment=n)})),i.skippedSegments&&(i.deltaUpdateFailed=i.fragments.some((function(t){return!t})),i.deltaUpdateFailed)){r.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var m=i.skippedSegments;m--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}var v=i.fragments;if(l){r.logger.warn("discontinuity sliding from playlist, take drift into account");for(var p=0;p<v.length;p++)v[p].cc+=l}i.skippedSegments&&(i.startCC=i.fragments[0].cc),h(t.partList,i.partList,(function(t,i){i.elementaryStreams=t.elementaryStreams,i.stats=t.stats})),u?c(i,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):d(t,i),v.length&&(i.totalduration=i.edge-v[0].start),i.driftStartTime=t.driftStartTime,i.driftStart=t.driftStart;var g=i.advancedDateTime;if(i.advanced&&g){var w=i.edge;i.driftStart||(i.driftStartTime=g,i.driftStart=w),i.driftEndTime=g,i.driftEnd=w}else i.driftEndTime=t.driftEndTime,i.driftEnd=t.driftEnd,i.advancedDateTime=t.advancedDateTime}function h(t,i,n){if(t&&i)for(var e=0,r=0,s=t.length;r<=s;r++){var o=t[r],a=i[r+e];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?n(o,a):e--}}function f(t,i,n){for(var e=i.skippedSegments,r=Math.max(t.startSN,i.startSN)-i.startSN,s=(t.fragmentHint?1:0)+(e?i.endSN:Math.min(t.endSN,i.endSN))-i.startSN,o=i.startSN-t.startSN,a=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,u=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,c=r;c<=s;c++){var l=u[o+c],h=a[c];e&&!h&&c<e&&(h=i.fragments[c]=l),l&&h&&n(l,h)}}function d(t,i){var n=i.startSN+i.skippedSegments-t.startSN,e=t.fragments;n<0||n>=e.length||m(i,e[n].start)}function m(t,i){if(i){for(var n=t.fragments,e=t.skippedSegments;e<n.length;e++)n[e].start+=i;t.fragmentHint&&(t.fragmentHint.start+=i)}}function v(t,i){var n,e=1e3*t.levelTargetDuration,r=e/2,s=t.age,o=s>0&&s<3*e,a=i.loading.end-i.loading.start,u=t.availabilityDelay;if(!1===t.updated)if(o){var c=333*t.misses;n=Math.max(Math.min(r,2*a),c),t.availabilityDelay=(t.availabilityDelay||0)+n}else n=r;else o?(u=Math.min(u||e/2,s),t.availabilityDelay=u,n=u+e-s):n=e-a;return Math.round(n)}function p(t,i,n){if(!t||!t.details)return null;var e=t.details,r=e.fragments[i-e.startSN];return r||((r=e.fragmentHint)&&r.sn===i?r:i<e.startSN&&n&&n.sn===i?n:null)}function g(t,i,n){if(!t||!t.details)return null;var e=t.details.partList;if(e)for(var r=e.length;r--;){var s=e[r];if(s.index===n&&s.fragment.sn===i)return s}return null}},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/stream-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return w}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),s=n(/*! ../is-supported */"./src/is-supported.ts"),o=n(/*! ../events */"./src/events.ts"),a=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=n(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),c=n(/*! ../types/loader */"./src/types/loader.ts"),l=n(/*! ../loader/fragment */"./src/loader/fragment.ts"),h=n(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),f=n(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),d=n(/*! ./gap-controller */"./src/controller/gap-controller.ts"),m=n(/*! ../errors */"./src/errors.ts"),v=n(/*! ../utils/logger */"./src/utils/logger.ts");function p(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function g(t,i){return(g=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var w=function(t){var i,n;function w(i,n){var e;return(e=t.call(this,i,n,"[stream-controller]")||this).audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.stalled=!1,e.couldBacktrack=!1,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}n=t,(i=w).prototype=Object.create(n.prototype),i.prototype.constructor=i,g(i,n);var b,y,x=w.prototype;return x._registerListeners=function(){var t=this.hls;t.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(o.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(o.Events.ERROR,this.onError,this),t.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x._unregisterListeners=function(){var t=this.hls;t.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(o.Events.ERROR,this.onError,this),t.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},x.startLoad=function(t){if(this.levels){var i=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var e=n.startLevel;-1===e&&(n.config.testBandwidth?(e=0,this.bitrateTest=!0):e=n.nextAutoLevel),this.level=n.nextLoadLevel=e,this.loadedmetadata=!1}i>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i),this.state=r.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=r.State.STOPPED},x.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},x.doTick=function(){switch(this.state){case r.State.IDLE:this.doTickIdle();break;case r.State.WAITING_LEVEL:var t,i=this.levels,n=null==i||null===(t=i[this.level])||void 0===t?void 0:t.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=r.State.IDLE;break}break;case r.State.FRAG_LOADING_WAITING_RETRY:var e,s=self.performance.now(),o=this.retryDate;(!o||s>=o||null!==(e=this.media)&&void 0!==e&&e.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=r.State.IDLE)}this.onTickEnd()},x.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},x.doTickIdle=function(){var t,i,n=this.hls,e=this.levels,s=this.media,a=n.nextLoadLevel;if(null!==this.levelLastLoaded&&(s||!this.startFragRequested&&n.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&e&&e[a]){var h=e[a];this.level=n.nextLoadLevel=a;var f=h.details;if(!f||this.state===r.State.WAITING_LEVEL||f.live&&this.levelLastLoaded!==a)this.state=r.State.WAITING_LEVEL;else{var d=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:s,c.PlaylistLevelType.MAIN);if(null!==d&&!(d.len>=this.getMaxBufferLength(h.maxBitrate))){if(this._streamEnded(d,f)){var m={};return this.altAudio&&(m.type="video"),this.hls.trigger(o.Events.BUFFER_EOS,m),void(this.state=r.State.ENDED)}var v=d.end,p=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&p&&"initSegment"!==p.sn){var g=p.sn-f.startSN;g>1&&this.fragmentTracker.removeFragment(p=f.fragments[g-1])}p&&this.fragmentTracker.getState(p)===u.FragmentState.OK&&this.nextLoadPosition>v&&(this.afterBufferFlushed(s,this.audioOnly&&!this.altAudio?l.ElementaryStreamTypes.AUDIO:l.ElementaryStreamTypes.VIDEO,c.PlaylistLevelType.MAIN),p=this.getNextFragment(this.nextLoadPosition,f)),p&&(!p.initSegment||p.initSegment.data||this.bitrateTest||(p=p.initSegment),"identity"!==(null===(t=p.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(i=p.decryptdata)&&void 0!==i&&i.key?this.loadFragment(p,f,v):this.loadKey(p,f))}}}},x.loadFragment=function(i,n,e){var r,s=this.fragmentTracker.getState(i);if(this.fragCurrent=i,s===u.FragmentState.BACKTRACKED){var o=this.fragmentTracker.getBacktrackData(i);if(o)return this._handleFragmentLoadProgress(o),void this._handleFragmentLoadComplete(o);s=u.FragmentState.NOT_LOADED}s===u.FragmentState.NOT_LOADED||s===u.FragmentState.PARTIAL?"initSegment"===i.sn?this._loadInitSegment(i):this.bitrateTest?(i.bitrateTest=!0,this.log("Fragment "+i.sn+" of level "+i.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(i)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,i,n,e)):s===u.FragmentState.APPENDING?this.reduceMaxBufferLength(i.duration)&&this.fragmentTracker.removeFragment(i):0===(null===(r=this.media)||void 0===r?void 0:r.buffered.length)&&this.fragmentTracker.removeAllFragments()},x.getAppendedFrag=function(t){var i=this.fragmentTracker.getAppendedFrag(t,c.PlaylistLevelType.MAIN);return i&&"fragment"in i?i.fragment:i},x.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,c.PlaylistLevelType.MAIN)},x.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},x.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},x.nextLevelSwitch=function(){var t=this.levels,i=this.media;if(null!=i&&i.readyState){var n,e=this.getAppendedFrag(i.currentTime);if(e&&e.start>1&&this.flushMainBuffer(0,e.start-1),!i.paused&&t){var r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*t[this.hls.nextLoadLevel].maxBitrate/(1e3*r)+1:0}else n=0;var s=this.getBufferedFrag(i.currentTime+n);if(s){var o=this.followingBufferedFrag(s);if(o){this.abortCurrentFrag();var a=o.duration,u=Math.max(s.end,(o.maxStartPTS?o.maxStartPTS:o.start)+Math.min(Math.max(a-this.config.maxFragLookUpTolerance,.5*a),.75*a));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},x.abortCurrentFrag=function(){var t=this.fragCurrent;this.fragCurrent=null,null!=t&&t.loader&&t.loader.abort(),this.state===r.State.KEY_LOADING&&(this.state=r.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},x.flushMainBuffer=function(i,n){t.prototype.flushMainBuffer.call(this,i,n,this.altAudio?"video":null)},x.onMediaAttached=function(i,n){t.prototype.onMediaAttached.call(this,i,n);var e=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new d.default(this.config,e,this.fragmentTracker,this.hls)},x.onMediaDetaching=function(){var i=this.media;i&&(i.removeEventListener("playing",this.onvplaying),i.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},x.onMediaPlaying=function(){this.tick()},x.onMediaSeeked=function(){var t=this.media,i=t?t.currentTime:null;Object(e.isFiniteNumber)(i)&&this.log("Media seeked to "+i.toFixed(3)),this.tick()},x.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(o.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},x.onManifestParsed=function(t,i){var n,e=!1,r=!1;i.levels.forEach((function(t){(n=t.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(e=!0),-1!==n.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=e&&r&&!Object(s.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},x.onLevelLoading=function(t,i){var n=this.levels;if(n&&this.state===r.State.IDLE){var e=n[i.level];(!e.details||e.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(e.details))&&(this.state=r.State.WAITING_LEVEL)}},x.onLevelLoaded=function(t,i){var n,e=this.levels,s=i.level,a=i.details;if(e){this.log("Level "+s+" loaded ["+a.startSN+","+a.endSN+"], cc ["+a.startCC+", "+a.endCC+"] duration:"+a.totalduration);var u=this.fragCurrent;!u||this.state!==r.State.FRAG_LOADING&&this.state!==r.State.FRAG_LOADING_WAITING_RETRY||u.level!==i.level&&u.loader&&(this.state=r.State.IDLE,u.loader.abort());var c=e[s],l=0;if(a.live||null!==(n=c.details)&&void 0!==n&&n.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;l=this.alignPlaylists(a,c.details)}if(c.details=a,this.levelLastLoaded=s,this.hls.trigger(o.Events.LEVEL_UPDATED,{details:a,level:s}),this.state===r.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=r.State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,l),this.tick()}else this.warn("Levels were reset while loading level "+s)},x._handleFragmentLoadProgress=function(t){var i,n=t.frag,e=t.part,r=t.payload,s=this.levels;if(s){var o=s[n.level],a=o.details;if(a){var u=o.videoCodec,l=a.PTSKnown||!a.live,d=null===(i=n.initSegment)||void 0===i?void 0:i.data,m=this._getAudioCodec(o),v=this.transmuxer=this.transmuxer||new h.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=e?e.index:-1,g=new f.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,r.byteLength,p,-1!==p);v.push(r,d,m,u,n,e,a.totalduration,l,g,this.initPTS[n.cc])}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},x.onAudioTrackSwitching=function(t,i){var n=this.altAudio,e=i.id;if(!i.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;null!=r&&r.loader&&(this.log("Switching to main audio track, cancel main fragment load"),r.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var s=this.hls;n&&s.trigger(o.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),s.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:e})}},x.onAudioTrackSwitched=function(t,i){var n=!!this.hls.audioTracks[i.id].url;if(n){var e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n,this.tick()},x.onBufferCreated=function(t,i){var n,e,r=i.tracks,s=!1;for(var o in r){var a=r[o];if("main"===a.id){if(e=o,n=a,"video"===o){var u=r[o];u&&(this.videoBuffer=u.buffer)}}else s=!0}s&&n?(this.log("Alternate track found, use "+e+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},x.onFragBuffered=function(t,i){var n=i.frag,e=i.part;if(!n||n.type===c.PlaylistLevelType.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(e?" p: "+e.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===r.State.PARSED&&(this.state=r.State.IDLE));var s=e?e.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,e)}},x.onError=function(t,i){switch(i.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,i);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==r.State.ERROR&&(i.fatal?(this.warn(""+i.details),this.state=r.State.ERROR):i.levelRetry||this.state!==r.State.WAITING_LEVEL||(this.state=r.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if("main"===i.parent&&(this.state===r.State.PARSING||this.state===r.State.PARSED)){var n=!0,e=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);e&&e.len>.5&&(n=!this.reduceMaxBufferLength(e.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},x.checkBuffer=function(){var t=this.media,i=this.gapController;if(t&&i&&t.readyState){var n=a.BufferHelper.getBuffered(t);!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this.seekToStartPos()):i.poll(this.lastCurrentTime),this.lastCurrentTime=t.currentTime}},x.onFragLoadEmergencyAborted=function(){this.state=r.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},x.onBufferFlushed=function(t,i){var n=i.type;(n!==l.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((n===l.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,n,c.PlaylistLevelType.MAIN)},x.onLevelsUpdated=function(t,i){this.levels=i.levels},x.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},x.seekToStartPos=function(){var t=this.media,i=t.currentTime,n=this.startPosition;if(n>=0&&i<n){if(t.seeking)return void v.logger.log("could not seek to "+n+", already seeking at "+i);var e=a.BufferHelper.getBuffered(t),r=(e.length?e.start(0):0)-n;r>0&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(v.logger.log("adjusting start position by "+r+" to match buffer start"),this.startPosition=n+=r),this.log("seek to target start position "+n+" from current time "+i),t.currentTime=n}},x._getAudioCodec=function(t){var i=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),i},x._loadBitrateTestFrag=function(t){var i=this;this._doFragLoad(t).then((function(n){var e=i.hls;if(n&&!e.nextLoadLevel&&!i.fragContextChanged(t)){i.fragLoadError=0,i.state=r.State.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var s=t.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),e.trigger(o.Events.FRAG_LOADED,n)}}))},x._handleTransmuxComplete=function(t){var i,n="main",s=this.hls,a=t.remuxResult,u=t.chunkMeta,c=this.getCurrentContext(u);if(!c)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var h=c.frag,f=c.part,d=c.level,m=a.video,v=a.text,p=a.id3,g=a.initSegment,w=this.altAudio?void 0:a.audio;if(!this.fragContextChanged(h)){if(this.state=r.State.PARSING,g){g.tracks&&(this._bufferInitSegment(d,g.tracks,h,u),s.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:n,tracks:g.tracks}));var b=g.initPTS,y=g.timescale;Object(e.isFiniteNumber)(b)&&(this.initPTS[h.cc]=b,s.trigger(o.Events.INIT_PTS_FOUND,{frag:h,id:n,initPTS:b,timescale:y}))}if(m&&!1!==a.independent){if(d.details){var x=m.startPTS,k=m.endPTS,T=m.startDTS,S=m.endDTS;if(f)f.elementaryStreams[m.type]={startPTS:x,endPTS:k,startDTS:T,endDTS:S};else if(m.firstKeyFrame&&m.independent&&(this.couldBacktrack=!0),m.dropped&&m.independent){if(this.getLoadPosition()+this.config.maxBufferHole<x)return void this.backtrack(h);h.setElementaryStreamInfo(m.type,h.start,k,h.start,S,!0)}h.setElementaryStreamInfo(m.type,x,k,T,S),this.bufferFragmentData(m,h,f,u)}}else if(!1===a.independent)return void this.backtrack(h);if(w){var E=w.startPTS,O=w.endPTS,j=w.startDTS,M=w.endDTS;f&&(f.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:E,endPTS:O,startDTS:j,endDTS:M}),h.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,E,O,j,M),this.bufferFragmentData(w,h,f,u)}null!=p&&null!==(i=p.samples)&&void 0!==i&&i.length&&s.trigger(o.Events.FRAG_PARSING_METADATA,{frag:h,id:n,samples:p.samples}),v&&s.trigger(o.Events.FRAG_PARSING_USERDATA,{frag:h,id:n,samples:v.samples})}},x._bufferInitSegment=function(t,i,n,e){var s=this;if(this.state===r.State.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var a=i.audio,u=i.video,c=i.audiovideo;if(a){var l=t.audioCodec,h=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===h.indexOf("firefox")&&(l="mp4a.40.5")),-1!==h.indexOf("android")&&"audio/mpeg"!==a.container&&this.log("Android: force audio codec to "+(l="mp4a.40.2")),t.audioCodec&&t.audioCodec!==l&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+l+'"'),a.levelCodec=l,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(t.audioCodec||"")+"/"+a.codec+"]")}u&&(u.levelCodec=t.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+u.codec+"]")),c&&this.log("Init audiovideo buffer, container:"+c.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+c.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,i),Object.keys(i).forEach((function(t){var r=i[t].initSegment;null!=r&&r.byteLength&&s.hls.trigger(o.Events.BUFFER_APPENDING,{type:t,data:r,frag:n,part:null,chunkMeta:e,parent:n.type})})),this.tick()}},x.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var i=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,i?this.resetFragmentLoading(t):this.state=r.State.BACKTRACKING},x.checkFragmentChanged=function(){var t=this.media,i=null;if(t&&t.readyState>1&&!1===t.seeking){var n=t.currentTime;if(a.BufferHelper.isBuffered(t,n)?i=this.getAppendedFrag(n):a.BufferHelper.isBuffered(t,n+.1)&&(i=this.getAppendedFrag(n+.1)),i){var e=this.fragPlaying,r=i.level;e&&i.sn===e.sn&&e.level===r&&i.urlId===e.urlId||(this.hls.trigger(o.Events.FRAG_CHANGED,{frag:i}),e&&e.level===r||this.hls.trigger(o.Events.LEVEL_SWITCHED,{level:r}),this.fragPlaying=i)}}},b=w,(y=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){var i=this.getAppendedFrag(t.currentTime);if(i)return i.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){var i=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(i)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&p(b.prototype,y),w}(r.default)},"./src/controller/subtitle-stream-controller.ts":
/*!******************************************************!*\
  !*** ./src/controller/subtitle-stream-controller.ts ***!
  \******************************************************/
/*! exports provided: SubtitleStreamController */function(t,i,n){n.r(i),n.d(i,"SubtitleStreamController",(function(){return m}));var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),s=n(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),o=n(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),a=n(/*! ./level-helper */"./src/controller/level-helper.ts"),u=n(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),c=n(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),l=n(/*! ../types/loader */"./src/types/loader.ts"),h=n(/*! ../types/level */"./src/types/level.ts");function f(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function d(t,i){return(d=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var m=function(t){var i,n;function m(i,n){var e;return(e=t.call(this,i,n,"[subtitle-stream-controller]")||this).levels=[],e.currentTrackId=-1,e.tracksBuffered=[],e.mainDetails=null,e._registerListeners(),e}n=t,(i=m).prototype=Object.create(n.prototype),i.prototype.constructor=i,d(i,n);var v,p,g=m.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(e.Events.ERROR,this.onError,this),t.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(e.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(e.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g._unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(e.Events.ERROR,this.onError,this),t.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(e.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(e.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(500),this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},g.onLevelLoaded=function(t,i){this.mainDetails=i.details},g.onSubtitleFragProcessed=function(t,i){var n=i.frag,e=i.success;if(this.fragPrevious=n,this.state=c.State.IDLE,e){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var s,o=n.start,a=0;a<r.length;a++)if(o>=r[a].start&&o<=r[a].end){s=r[a];break}var u=n.start+n.duration;s?s.end=u:r.push(s={start:o,end:u}),this.fragmentTracker.fragBuffered(n)}}},g.onBufferFlushing=function(t,i){var n=i.startOffset,e=i.endOffset;if(0===n&&e!==Number.POSITIVE_INFINITY){var r=this.currentTrackId,s=this.levels;if(!s.length||!s[r]||!s[r].details)return;var o=e-s[r].details.targetduration;if(o<=0)return;i.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach((function(t){for(var i=0;i<t.length;)if(t[i].end<=o)t.shift();else{if(!(t[i].start<o))break;t[i].start=o,i++}})),this.fragmentTracker.removeFragmentsInRange(n,o,l.PlaylistLevelType.SUBTITLE)}},g.onError=function(t,i){var n,e=i.frag;e&&e.type===l.PlaylistLevelType.SUBTITLE&&(null!==(n=this.fragCurrent)&&void 0!==n&&n.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},g.onSubtitleTracksUpdated=function(t,i){var n=this,e=i.subtitleTracks;this.tracksBuffered=[],this.levels=e.map((function(t){return new h.Level(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){n.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},g.onSubtitleTrackSwitch=function(t,i){if(this.currentTrackId=i.id,this.levels.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];this.mediaBuffer=null!=n&&n.details?this.mediaBufferTimeRanges:null,n&&this.setInterval(500)}else this.clearInterval()},g.onSubtitleTrackLoaded=function(t,i){var n,e=i.details,r=i.id,u=this.currentTrackId,l=this.levels;if(l.length){var h=l[u];if(!(r>=l.length||r!==u)&&h){if(this.mediaBuffer=this.mediaBufferTimeRanges,e.live||null!==(n=h.details)&&void 0!==n&&n.live){var f=this.mainDetails;if(e.deltaUpdateFailed||!f)return;var d=f.fragments[0];h.details?0===this.alignPlaylists(e,h.details)&&d&&Object(a.addSliding)(e,d.start):e.hasProgramDateTime&&f.hasProgramDateTime?Object(o.alignMediaPlaylistByPDT)(e,f):d&&Object(a.addSliding)(e,d.start)}h.details=e,this.levelLastLoaded=r,this.tick(),e.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE&&(Object(s.findFragmentByPTS)(null,e.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0))}}},g._handleFragmentLoadComplete=function(t){var i=t.frag,n=t.payload,r=i.decryptdata,s=this.hls;if(!this.fragContextChanged(i)&&n&&n.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){var o=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).then((function(t){var n=performance.now();s.trigger(e.Events.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:o,tdecrypt:n}})}))}},g.doTick=function(){if(this.media){if(this.state===c.State.IDLE){var t,i=this.currentTrackId,n=this.levels;if(!n.length||!n[i]||!n[i].details)return;var e=n[i].details,o=e.targetduration,a=this.config,l=r.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,this.media.currentTime-o,a.maxBufferHole),h=l.end;if(l.len>this.getMaxBufferLength()+o)return;console.assert(e,"Subtitle track details are defined on idle subtitle stream controller tick");var f,d=e.fragments,m=d.length,v=this.fragPrevious;if(h<e.edge){var p=a.maxFragLookUpTolerance;!(f=Object(s.findFragmentByPTS)(v,d,h,p))&&v&&v.start<d[0].start&&(f=d[0])}else f=d[m-1];null!==(t=f)&&void 0!==t&&t.encrypted?this.loadKey(f,e):f&&this.fragmentTracker.getState(f)===u.FragmentState.NOT_LOADED&&this.loadFragment(f,e,h)}}else this.state=c.State.IDLE},g.loadFragment=function(i,n,e){this.fragCurrent=i,t.prototype.loadFragment.call(this,i,n,e)},v=m,(p=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&f(v.prototype,p),m}(c.default)},"./src/controller/subtitle-track-controller.ts":
/*!*****************************************************!*\
  !*** ./src/controller/subtitle-track-controller.ts ***!
  \*****************************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),s=n(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),o=n(/*! ../types/loader */"./src/types/loader.ts");function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function u(t,i){return(u=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function c(t){for(var i=[],n=0;n<t.length;n++){var e=t[n];"subtitles"===e.kind&&e.label&&i.push(t[n])}return i}i.default=function(t){var i,n;function s(i){var n;return(n=t.call(this,i,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}n=t,(i=s).prototype=Object.create(n.prototype),i.prototype.constructor=i,u(i,n);var l,h,f=s.prototype;return f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},f.registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(e.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(e.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(e.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(e.Events.ERROR,this.onError,this)},f.onMediaAttached=function(t,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},f.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},f.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),c(this.media.textTracks).forEach((function(t){Object(r.clearCurrentCues)(t)})),this.subtitleTrack=-1,this.media=null)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},f.onManifestParsed=function(t,i){this.tracks=i.subtitleTracks},f.onSubtitleTrackLoaded=function(t,i){var n=i.id,e=i.details,r=this.tracksInGroup[this.trackId];if(r){var s=r.details;r.details=i.details,this.log("subtitle track "+n+" loaded ["+e.startSN+"-"+e.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,i,s))}else this.warn("Invalid subtitle track id "+n)},f.onLevelLoading=function(t,i){this.switchLevel(i.level)},f.onLevelSwitching=function(t,i){this.switchLevel(i.level)},f.switchLevel=function(t){var i=this.hls.levels[t];if(null!=i&&i.textGroupIds){var n=i.textGroupIds[i.urlId];if(this.groupId!==n){var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter((function(t){return!n||t.groupId===n}));this.tracksInGroup=s;var o=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=n;var a={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(e.Events.SUBTITLE_TRACKS_UPDATED,a),-1!==o&&this.setSubtitleTrack(o,r)}}},f.findTrackId=function(t){for(var i=this.tracksInGroup,n=0;n<i.length;n++){var e=i[n];if((!this.selectDefaultTrack||e.default)&&(!t||t===e.name))return e.id}return-1},f.onError=function(i,n){t.prototype.onError.call(this,i,n),!n.fatal&&n.context&&n.context.type===o.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},f.loadPlaylist=function(t){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var n=i.id,r=i.groupId,s=i.url;if(t)try{s=t.addDirectives(s)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+n),this.hls.trigger(e.Events.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null})}},f.toggleTrackModes=function(t){var i=this,n=this.media,e=this.subtitleDisplay,r=this.trackId;if(n){var s=c(n.textTracks),o=s.filter((function(t){return t.groupId===i.groupId}));if(-1===t)[].slice.call(s).forEach((function(t){t.mode="disabled"}));else{var a=o[r];a&&(a.mode="disabled")}var u=o[t];u&&(u.mode=e?"showing":"hidden")}},f.setSubtitleTrack=function(t,i){var n,r=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(n=r[t])&&void 0!==n&&n.details)||t<-1||t>=r.length)){this.clearTimer();var s=r[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,s){var o=s.groupId;this.hls.trigger(e.Events.SUBTITLE_TRACK_SWITCH,{id:s.id,groupId:void 0===o?"":o,name:s.name,type:s.type,url:s.url});var a=this.switchParams(s.url,null==i?void 0:i.details);this.loadPlaylist(a)}else this.hls.trigger(e.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},f.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,i=c(this.media.textTracks),n=0;n<i.length;n++)if("hidden"===i[n].mode)t=n;else if("showing"===i[n].mode){t=n;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},l=s,(h=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}])&&a(l.prototype,h),s}(s.default)},"./src/controller/timeline-controller.ts":
/*!***********************************************!*\
  !*** ./src/controller/timeline-controller.ts ***!
  \***********************************************/
/*! exports provided: TimelineController */function(t,i,n){n.r(i),n.d(i,"TimelineController",(function(){return f}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../utils/cea-608-parser */"./src/utils/cea-608-parser.ts"),o=n(/*! ../utils/output-filter */"./src/utils/output-filter.ts"),a=n(/*! ../utils/webvtt-parser */"./src/utils/webvtt-parser.ts"),u=n(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),c=n(/*! ../utils/imsc1-ttml-parser */"./src/utils/imsc1-ttml-parser.ts"),l=n(/*! ../types/loader */"./src/types/loader.ts"),h=n(/*! ../utils/logger */"./src/utils/logger.ts"),f=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new o.default(this,"textTrack1"),n=new o.default(this,"textTrack2"),e=new o.default(this,"textTrack3"),a=new o.default(this,"textTrack4");this.cea608Parser1=new s.default(1,i,n),this.cea608Parser2=new s.default(3,e,a)}t.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(r.Events.FRAG_LOADING,this.onFragLoading,this),t.on(r.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(r.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(r.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(r.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(r.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var i=t.prototype;return i.destroy=function(){var t=this.hls;t.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(r.Events.FRAG_LOADING,this.onFragLoading,this),t.off(r.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(r.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(r.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(r.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(r.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},i.addCues=function(t,i,n,e,s){for(var o,a,u=!1,c=s.length;c--;){var l=s[c],h=(o=l[0],a=i,Math.min(l[1],n)-Math.max(o,a));if(h>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],n),u=!0,h/(n-i)>.5))return}if(u||s.push([i,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],i,n,e);else{var f=this.Cues.newCue(null,i,n,e);this.hls.trigger(r.Events.CUES_PARSED,{type:"captions",cues:f,track:t})}},i.onInitPtsFound=function(t,i){var n=this,e=i.frag,s=i.timescale,o=this.unparsedVttFrags;"main"===i.id&&(this.initPTS[e.cc]=i.initPTS,this.timescale[e.cc]=s),o.length&&(this.unparsedVttFrags=[],o.forEach((function(t){n.onFragLoaded(r.Events.FRAG_LOADED,t)})))},i.getExistingTrack=function(t){var i=this.media;if(i)for(var n=0;n<i.textTracks.length;n++){var e=i.textTracks[n];if(e[t])return e}return null},i.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},i.createNativeTrack=function(t){if(!this.captionsTracks[t]){var i=this.captionsTracks,n=this.media,e=this.captionsProperties[t],r=e.label,s=e.languageCode,o=this.getExistingTrack(t);if(o)i[t]=o,Object(u.clearCurrentCues)(i[t]),Object(u.sendAddTrackEvent)(i[t],n);else{var a=this.createTextTrack("captions",r,s);a&&(a[t]=!0,i[t]=a)}}},i.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var i=this.captionsProperties[t];if(i){var n={_id:t,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(r.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(t,i,n){var e=this.media;if(e)return e.addTextTrack(t,i,n)},i.onMediaAttaching=function(t,i){this.media=i.media,this._cleanTracks()},i.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(i){Object(u.clearCurrentCues)(t[i]),delete t[i]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},i._cleanTracks=function(){var t=this.media;if(t){var i=t.textTracks;if(i)for(var n=0;n<i.length;n++)Object(u.clearCurrentCues)(i[n])}},i.onSubtitleTracksUpdated=function(t,i){var n=this;this.textTracks=[];var e=i.subtitleTracks||[],s=e.some((function(t){return t.textCodec===c.IMSC1_CODEC}));if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var o=this.tracks&&e&&this.tracks.length===e.length;if(this.tracks=e||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,i){var e;if(i<a.length){for(var r=null,s=0;s<a.length;s++)if(d(a[s],t)){r=a[s];break}r&&(e=r)}e?Object(u.clearCurrentCues)(e):(e=n.createTextTrack("subtitles",t.name,t.lang))&&(e.mode="disabled"),e&&(e.groupId=t.groupId,n.textTracks.push(e))}))}else if(!o&&this.tracks&&this.tracks.length){var l=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(r.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},i.onManifestLoaded=function(t,i){var n=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach((function(t){var i=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(i){var e=n.captionsProperties["textTrack"+i[1]];e&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t)}}))},i.onFragLoading=function(t,i){var n=this.cea608Parser1,e=this.cea608Parser2,r=this.lastSn;if(this.enabled&&n&&e&&i.frag.type===l.PlaylistLevelType.MAIN){var s,o,a=i.frag.sn,u=null!=(s=null==i||null===(o=i.part)||void 0===o?void 0:o.index)?s:-1;a===r+1||a===r&&u===this.lastPartIndex+1||(n.reset(),e.reset()),this.lastSn=a,this.lastPartIndex=u}},i.onFragLoaded=function(t,i){var n=i.frag,s=i.payload,o=this.initPTS,a=this.unparsedVttFrags;if(n.type===l.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(e.isFiniteNumber)(o[n.cc]))return a.push(i),void(o.length&&this.hls.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var u=n.decryptdata;if(null==u||null==u.key||"AES-128"!==u.method||"stats"in i){var h=this.tracks[n.level],f=this.vttCCs;f[n.cc]||(f[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),h&&h.textCodec===c.IMSC1_CODEC?this._parseIMSC1(n,s):this._parseVTTs(n,s,f)}}else this.hls.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},i._parseIMSC1=function(t,i){var n=this,e=this.hls;Object(c.parseIMSC1)(i,this.initPTS[t.cc],this.timescale[t.cc],(function(i){n._appendCues(i,t.level),e.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(i){h.logger.log("Failed to parse IMSC1: "+i),e.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:i})}))},i._parseVTTs=function(t,i,n){var e=this,s=this.hls;Object(a.parseWebVTT)(i,this.initPTS[t.cc],this.timescale[t.cc],n,t.cc,t.start,(function(i){e._appendCues(i,t.level),s.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(n){e._fallbackToIMSC1(t,i),h.logger.log("Failed to parse VTT cue: "+n),s.trigger(r.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})}))},i._fallbackToIMSC1=function(t,i){var n=this,e=this.tracks[t.level];e.textCodec||Object(c.parseIMSC1)(i,this.initPTS[t.cc],this.timescale[t.cc],(function(){e.textCodec=c.IMSC1_CODEC,n._parseIMSC1(t,i)}),(function(){e.textCodec="wvtt"}))},i._appendCues=function(t,i){var n=this.hls;if(this.config.renderTextTracksNatively){var e=this.textTracks[i];if("disabled"===e.mode)return;t.forEach((function(t){return Object(u.addCueToTrack)(e,t)}))}else n.trigger(r.Events.CUES_PARSED,{type:"subtitles",cues:t,track:this.tracks[i].default?"default":"subtitles"+i})},i.onFragDecrypted=function(t,i){var n=i.frag;if(n.type===l.PlaylistLevelType.SUBTITLE){if(!Object(e.isFiniteNumber)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(r.Events.FRAG_LOADED,i)}},i.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},i.onFragParsingUserdata=function(t,i){var n=this.cea608Parser1,e=this.cea608Parser2;if(this.enabled&&n&&e)for(var r=0;r<i.samples.length;r++){var s=i.samples[r].bytes;if(s){var o=this.extractCea608Data(s);n.addData(i.samples[r].pts,o[0]),e.addData(i.samples[r].pts,o[1])}}},i.onBufferFlushing=function(t,i){var n=i.startOffset,e=i.endOffset,r=i.endOffsetSubtitles,s=i.type,o=this.media;if(o&&!(o.currentTime<e)){if(!s||"video"===s){var a=this.captionsTracks;Object.keys(a).forEach((function(t){return Object(u.removeCuesInRange)(a[t],n,e)}))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==r){var c=this.textTracks;Object.keys(c).forEach((function(t){return Object(u.removeCuesInRange)(c[t],n,r)}))}}},i.extractCea608Data=function(t){for(var i=31&t[0],n=2,e=[[],[]],r=0;r<i;r++){var s=t[n++],o=127&t[n++],a=127&t[n++],u=3&s;0===o&&0===a||0!=(4&s)&&(0!==u&&1!==u||(e[u].push(o),e[u].push(a)))}return e},t}();function d(t,i){return t&&t.label===i.name&&!(t.textTrack1||t.textTrack2)}},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
  !*** ./src/crypt/aes-crypto.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return e}));var e=function(){function t(t,i){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=i}return t.prototype.decrypt=function(t,i){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},i,t)},t}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
  !*** ./src/crypt/aes-decryptor.ts ***!
  \************************************/
/*! exports provided: removePadding, default */function(t,i,n){n.r(i),n.d(i,"removePadding",(function(){return r})),n.d(i,"default",(function(){return s}));var e=n(/*! ../utils/typed-array */"./src/utils/typed-array.ts");function r(t){var i=t.byteLength,n=i&&new DataView(t.buffer).getUint8(i-1);return n?Object(e.sliceUint8)(t,0,i-n):t}var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var i=t.prototype;return i.uint8ArrayToUint32Array_=function(t){for(var i=new DataView(t),n=new Uint32Array(4),e=0;e<4;e++)n[e]=i.getUint32(4*e);return n},i.initTable=function(){var t=this.sBox,i=this.invSBox,n=this.subMix,e=n[0],r=n[1],s=n[2],o=n[3],a=this.invSubMix,u=a[0],c=a[1],l=a[2],h=a[3],f=new Uint32Array(256),d=0,m=0,v=0;for(v=0;v<256;v++)f[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=m^m<<1^m<<2^m<<3^m<<4;t[d]=p=p>>>8^255&p^99,i[p]=d;var g=f[d],w=f[g],b=f[w],y=257*f[p]^16843008*p;e[d]=y<<24|y>>>8,r[d]=y<<16|y>>>16,s[d]=y<<8|y>>>24,o[d]=y,u[p]=(y=16843009*b^65537*w^257*g^16843008*d)<<24|y>>>8,c[p]=y<<16|y>>>16,l[p]=y<<8|y>>>24,h[p]=y,d?(d=g^f[f[f[b^g]]],m^=f[f[m]]):d=m=1}},i.expandKey=function(t){for(var i=this.uint8ArrayToUint32Array_(t),n=!0,e=0;e<i.length&&n;)n=i[e]===this.key[e],e++;if(!n){this.key=i;var r=this.keySize=i.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var s,o,a,u,c=this.ksRows=4*(r+6+1),l=this.keySchedule=new Uint32Array(c),h=this.invKeySchedule=new Uint32Array(c),f=this.sBox,d=this.rcon,m=this.invSubMix,v=m[0],p=m[1],g=m[2],w=m[3];for(s=0;s<c;s++)s<r?a=l[s]=i[s]:(u=a,s%r==0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=d[s/r|0]<<24):r>6&&s%r==4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),l[s]=a=(l[s-r]^u)>>>0);for(o=0;o<c;o++)s=c-o,u=3&o?l[s]:l[s-4],h[o]=o<4||s<=4?u:v[f[u>>>24]]^p[f[u>>>16&255]]^g[f[u>>>8&255]]^w[f[255&u]],h[o]=h[o]>>>0}},i.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},i.decrypt=function(t,i,n){for(var e,r,s,o,a,u,c,l,h,f,d,m,v,p=this.keySize+6,g=this.invKeySchedule,w=this.invSBox,b=this.invSubMix,y=b[0],x=b[1],k=b[2],T=b[3],S=this.uint8ArrayToUint32Array_(n),E=S[0],O=S[1],j=S[2],M=S[3],A=new Int32Array(t),I=new Int32Array(A.length),D=this.networkToHostOrderSwap;i<A.length;){for(l=D(A[i]),h=D(A[i+1]),f=D(A[i+2]),d=D(A[i+3]),o=l^g[0],a=d^g[1],u=f^g[2],c=h^g[3],m=4,v=1;v<p;v++)e=y[a>>>24]^x[u>>16&255]^k[c>>8&255]^T[255&o]^g[m+1],r=y[u>>>24]^x[c>>16&255]^k[o>>8&255]^T[255&a]^g[m+2],s=y[c>>>24]^x[o>>16&255]^k[a>>8&255]^T[255&u]^g[m+3],o=y[o>>>24]^x[a>>16&255]^k[u>>8&255]^T[255&c]^g[m],a=e,u=r,c=s,m+=4;e=w[a>>>24]<<24^w[u>>16&255]<<16^w[c>>8&255]<<8^w[255&o]^g[m+1],r=w[u>>>24]<<24^w[c>>16&255]<<16^w[o>>8&255]<<8^w[255&a]^g[m+2],s=w[c>>>24]<<24^w[o>>16&255]<<16^w[a>>8&255]<<8^w[255&u]^g[m+3],I[i]=D(w[o>>>24]<<24^w[a>>16&255]<<16^w[u>>8&255]<<8^w[255&c]^g[m]^E),I[i+1]=D(s^O),I[i+2]=D(r^j),I[i+3]=D(e^M),E=l,O=h,j=f,M=d,i+=4}return I.buffer},t}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
  !*** ./src/crypt/decrypter.ts ***!
  \********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return c}));var e=n(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts"),r=n(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts"),s=n(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),u=n(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),c=function(){function t(t,i,n){var e=(void 0===n?{}:n).removePKCS7Padding,r=void 0===e||e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=i,this.removePKCS7Padding=r,r)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var i=t.prototype;return i.destroy=function(){this.observer=null},i.isSync=function(){return this.config.enableSoftwareAES},i.flush=function(){var t=this.currentResult;if(t){var i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(s.removePadding)(i):i}this.reset()},i.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},i.decrypt=function(t,i,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),i,n);var r=this.flush();r&&e(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),i,n).then(e)},i.softwareDecrypt=function(t,i,n){var e=this.currentIV,r=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=Object(a.appendUint8Array)(o,t),this.remainderData=null);var c=this.getValidChunk(t);if(!c.length)return null;e&&(n=e);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new s.default),l.expandKey(i);var h=r;return this.currentResult=l.decrypt(c.buffer,0,n),this.currentIV=Object(u.sliceUint8)(c,-16).buffer,h||null},i.webCryptoDecrypt=function(t,i,n){var s=this,o=this.subtle;return this.key===i&&this.fastAesKey||(this.key=i,this.fastAesKey=new r.default(o,i)),this.fastAesKey.expandKey().then((function(i){return o?new e.default(o,n).decrypt(t.buffer,i):Promise.reject(new Error("web crypto not initialized"))})).catch((function(e){return s.onWebCryptoError(e,t,i,n)}))},i.onWebCryptoError=function(t,i,n,e){return o.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(i,n,e)},i.getValidChunk=function(t){var i=t,n=t.length-t.length%16;return n!==t.length&&(i=Object(u.sliceUint8)(t,0,n),this.remainderData=Object(u.sliceUint8)(t,n)),i},i.logOnce=function(t){this.logEnabled&&(o.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
  !*** ./src/crypt/fast-aes-key.ts ***!
  \***********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return e}));var e=function(){function t(t,i){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=i}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/aacdemuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),r=n(/*! ./adts */"./src/demux/adts.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=n(/*! ../demux/id3 */"./src/demux/id3.ts");function a(t,i){return(a=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var u=function(t){var i,n;function e(i,n){var e;return(e=t.call(this)||this).observer=void 0,e.config=void 0,e.observer=i,e.config=n,e}n=t,(i=e).prototype=Object.create(n.prototype),i.prototype.constructor=i,a(i,n);var u=e.prototype;return u.resetInitSegment=function(i,n,e){t.prototype.resetInitSegment.call(this,i,n,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:i,duration:e,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var i=(o.getID3Data(t,0)||[]).length,n=t.length;i<n;i++)if(r.probe(t,i))return s.logger.log("ADTS sync word found !"),!0;return!1},u.canParse=function(t,i){return r.canParse(t,i)},u.appendFrame=function(t,i,n){r.initTrackConfig(t,this.observer,i,n,t.manifestCodec);var e=r.appendFrame(t,i,n,this.initPTS,this.frameIndex);if(e&&0===e.missing)return e},e}(e.default);u.minProbeByteLength=9,i.default=u},"./src/demux/adts.ts":
/*!***************************!*\
  !*** ./src/demux/adts.ts ***!
  \***************************/
/*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */function(t,i,n){n.r(i),n.d(i,"getAudioConfig",(function(){return o})),n.d(i,"isHeaderPattern",(function(){return a})),n.d(i,"getHeaderLength",(function(){return u})),n.d(i,"getFullFrameLength",(function(){return c})),n.d(i,"canGetFrameLength",(function(){return l})),n.d(i,"isHeader",(function(){return h})),n.d(i,"canParse",(function(){return f})),n.d(i,"probe",(function(){return d})),n.d(i,"initTrackConfig",(function(){return m})),n.d(i,"getFrameDuration",(function(){return v})),n.d(i,"parseFrameHeader",(function(){return p})),n.d(i,"appendFrame",(function(){return g}));var e=n(/*! ../utils/logger */"./src/utils/logger.ts"),r=n(/*! ../errors */"./src/errors.ts"),s=n(/*! ../events */"./src/events.ts");function o(t,i,n,o){var a,u,c,l,h=navigator.userAgent.toLowerCase(),f=o,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=1+((192&i[n+2])>>>6);var m=(60&i[n+2])>>>2;if(!(m>d.length-1))return c=(1&i[n+2])<<2,c|=(192&i[n+3])>>>6,e.logger.log("manifest codec:"+o+", ADTS type:"+a+", samplingIndex:"+m),/firefox/i.test(h)?m>=6?(a=5,l=new Array(4),u=m-3):(a=2,l=new Array(2),u=m):-1!==h.indexOf("android")?(a=2,l=new Array(2),u=m):(a=5,l=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&m>=6?u=m-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(m>=6&&1===c||/vivaldi/i.test(h))||!o&&1===c)&&(a=2,l=new Array(2)),u=m)),l[0]=a<<3,l[0]|=(14&m)>>1,l[1]|=(1&m)<<7,l[1]|=c<<3,5===a&&(l[1]|=(14&u)>>1,l[2]=(1&u)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:d[m],channelCount:c,codec:"mp4a.40."+a,manifestCodec:f};t.trigger(s.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+m})}function a(t,i){return 255===t[i]&&240==(246&t[i+1])}function u(t,i){return 1&t[i+1]?7:9}function c(t,i){return(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>>5}function l(t,i){return i+5<t.length}function h(t,i){return i+1<t.length&&a(t,i)}function f(t,i){return l(t,i)&&a(t,i)&&c(t,i)<=t.length-i}function d(t,i){if(h(t,i)){var n=u(t,i);if(i+n>=t.length)return!1;var e=c(t,i);if(e<=n)return!1;var r=i+e;return r===t.length||h(t,r)}return!1}function m(t,i,n,r,s){if(!t.samplerate){var a=o(i,n,r,s);if(!a)return;t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,e.logger.log("parsed codec:"+t.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function v(t){return 9216e4/t}function p(t,i,n,e,r){var s=u(t,i),o=c(t,i);if((o-=s)>0)return{headerLength:s,frameLength:o,stamp:n+e*r}}function g(t,i,n,e,r){var s=p(i,n,e,r,v(t.samplerate));if(s){var o,a=s.headerLength,u=s.stamp,c=a+s.frameLength,l=Math.max(0,n+c-i.length);l?(o=new Uint8Array(c-a)).set(i.subarray(n+a,i.length),0):o=i.subarray(n+a,n+c);var h={unit:o,pts:u};return l||t.samples.push(h),{sample:h,length:c,missing:l}}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
  !*** ./src/demux/base-audio-demuxer.ts ***!
  \*****************************************/
/*! exports provided: initPTSFn, default */function(t,i,n){n.r(i),n.d(i,"initPTSFn",(function(){return c}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../demux/id3 */"./src/demux/id3.ts"),s=n(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),o=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),a=n(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),u=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var i=t.prototype;return i.resetInitSegment=function(){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},i.resetTimeStamp=function(){},i.resetContiguity=function(){},i.canParse=function(){return!1},i.appendFrame=function(){},i.demux=function(t,i){this.cachedData&&(t=Object(o.appendUint8Array)(this.cachedData,t),this.cachedData=null);var n,e,u=r.getID3Data(t,0),l=u?u.length:0,h=this._audioTrack,f=this._id3Track,d=u?r.getTimeStamp(u):void 0,m=t.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=c(d,i)),u&&u.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:u}),e=this.initPTS;l<m;){if(this.canParse(t,l)){var v=this.appendFrame(h,t,l);v?(this.frameIndex++,e=v.sample.pts,n=l+=v.length):l=m}else r.canParse(t,l)?(u=r.getID3Data(t,l),f.samples.push({pts:e,dts:e,data:u}),n=l+=u.length):l++;if(l===m&&n!==m){var p=Object(a.sliceUint8)(t,n);this.cachedData=this.cachedData?Object(o.appendUint8Array)(this.cachedData,p):p}}return{audioTrack:h,avcTrack:Object(s.dummyTrack)(),id3Track:f,textTrack:Object(s.dummyTrack)()}},i.demuxSampleAes=function(){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},i.flush=function(){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(s.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(s.dummyTrack)()}},i.destroy=function(){},t}(),c=function(t,i){return Object(e.isFiniteNumber)(t)?90*t:9e4*i};i.default=u},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
  !*** ./src/demux/chunk-cache.ts ***!
  \**********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return e}));var e=function(){function t(){this.chunks=[],this.dataLength=0}var i=t.prototype;return i.push=function(t){this.chunks.push(t),this.dataLength+=t.length},i.flush=function(){var t,i=this.chunks;return i.length?(t=1===i.length?i[0]:function(t,i){for(var n=new Uint8Array(i),e=0,r=0;r<t.length;r++){var s=t[r];n.set(s,e),e+=s.length}return n}(i,this.dataLength),this.reset(),t):new Uint8Array(0)},i.reset=function(){this.chunks.length=0,this.dataLength=0},t}()},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
  !*** ./src/demux/dummy-demuxed-track.ts ***!
  \******************************************/
/*! exports provided: dummyTrack */function(t,i,n){function e(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}n.r(i),n.d(i,"dummyTrack",(function(){return e}))},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../utils/logger */"./src/utils/logger.ts");i.default=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var i=t.prototype;return i.loadWord=function(){var t=this.data,i=this.bytesAvailable,n=t.byteLength-i,e=new Uint8Array(4),r=Math.min(4,i);if(0===r)throw new Error("no bytes available");e.set(t.subarray(n,n+r)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},i.skipBits=function(t){var i;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(i=t>>3)>>3,this.bytesAvailable-=i,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},i.readBits=function(t){var i=Math.min(this.bitsAvailable,t),n=this.word>>>32-i;return t>32&&e.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),(i=t-i)>0&&this.bitsAvailable?n<<i|this.readBits(i):n},i.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},i.skipUEG=function(){this.skipBits(1+this.skipLZ())},i.skipEG=function(){this.skipBits(1+this.skipLZ())},i.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},i.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},i.readBoolean=function(){return 1===this.readBits(1)},i.readUByte=function(){return this.readBits(8)},i.readUShort=function(){return this.readBits(16)},i.readUInt=function(){return this.readBits(32)},i.skipScalingList=function(t){for(var i=8,n=8,e=0;e<t;e++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},i.readSPS=function(){var t,i,n,e=0,r=0,s=0,o=0,a=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),l=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),d=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);a();var v=a();if(u(5),h(3),a(),d(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var p=c();if(3===p&&h(1),d(),d(),h(1),l())for(i=3!==p?8:12,n=0;n<i;n++)l()&&m(n<6?16:64)}d();var g=c();if(0===g)c();else if(1===g)for(h(1),f(),f(),t=c(),n=0;n<t;n++)f();d(),h(1);var w=c(),b=c(),y=u(1);0===y&&h(1),h(1),l()&&(e=c(),r=c(),s=c(),o=c());var x=[1,1];if(l()&&l())switch(a()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[a()<<8|a(),a()<<8|a()]}return{width:Math.ceil(16*(w+1)-2*e-2*r),height:(2-y)*(b+1)*16-(y?2:4)*(s+o),pixelRatio:x}},i.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}()},"./src/demux/id3.ts":
/*!**************************!*\
  !*** ./src/demux/id3.ts ***!
  \**************************/
/*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */function(t,i,n){n.r(i),n.d(i,"isHeader",(function(){return r})),n.d(i,"isFooter",(function(){return s})),n.d(i,"getID3Data",(function(){return o})),n.d(i,"canParse",(function(){return u})),n.d(i,"getTimeStamp",(function(){return c})),n.d(i,"isTimeStampFrame",(function(){return l})),n.d(i,"getID3Frames",(function(){return f})),n.d(i,"decodeFrame",(function(){return d})),n.d(i,"utf8ArrayToStr",(function(){return w})),n.d(i,"testables",(function(){return b}));var e,r=function(t,i){return i+10<=t.length&&73===t[i]&&68===t[i+1]&&51===t[i+2]&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},s=function(t,i){return i+10<=t.length&&51===t[i]&&68===t[i+1]&&73===t[i+2]&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},o=function(t,i){for(var n=i,e=0;r(t,i);)e+=10,e+=a(t,i+6),s(t,i+10)&&(e+=10),i+=e;if(e>0)return t.subarray(n,n+e)},a=function(t,i){var n=0;return n=(127&t[i])<<21,n|=(127&t[i+1])<<14,(n|=(127&t[i+2])<<7)|127&t[i+3]},u=function(t,i){return r(t,i)&&a(t,i+6)+10<=t.length-i},c=function(t){for(var i=f(t),n=0;n<i.length;n++){var e=i[n];if(l(e))return g(e)}},l=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},h=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),n=a(t,4);return{type:i,size:n,data:t.subarray(10,10+n)}},f=function(t){for(var i=0,n=[];r(t,i);){for(var e=a(t,i+6),o=(i+=10)+e;i+8<o;){var u=h(t.subarray(i)),c=d(u);c&&n.push(c),i+=u.size+10}s(t,i)&&(i+=10)}return n},d=function(t){return"PRIV"===t.type?m(t):"W"===t.type[0]?p(t):v(t)},m=function(t){if(!(t.size<2)){var i=w(t.data,!0),n=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:n.buffer}}},v=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,n=w(t.data.subarray(i),!0),e=w(t.data.subarray(i+=n.length+1));return{key:t.type,info:n,data:e}}var r=w(t.data.subarray(1));return{key:t.type,data:r}}},p=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,n=w(t.data.subarray(i),!0),e=w(t.data.subarray(i+=n.length+1));return{key:t.type,info:n,data:e}}var r=w(t.data);return{key:t.type,data:r}},g=function(t){if(8===t.data.byteLength){var i=new Uint8Array(t.data),n=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return n/=45,1&i[3]&&(n+=47721858.84),Math.round(n)}},w=function(t,i){void 0===i&&(i=!1);var n=y();if(n){var e=n.decode(t);if(i){var r=e.indexOf("\0");return-1!==r?e.substring(0,r):e}return e.replace(/\0/g,"")}for(var s,o,a,u=t.length,c="",l=0;l<u;){if(0===(s=t[l++])&&i)return c;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(s);break;case 12:case 13:o=t[l++],c+=String.fromCharCode((31&s)<<6|63&o);break;case 14:o=t[l++],a=t[l++],c+=String.fromCharCode((15&s)<<12|(63&o)<<6|(63&a)<<0)}}return c},b={decodeTextFrame:v};function y(){return e||void 0===self.TextDecoder||(e=new self.TextDecoder("utf-8")),e}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp3demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),r=n(/*! ../demux/id3 */"./src/demux/id3.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=n(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");function a(t,i){return(a=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var u=function(t){var i,n;function e(){return t.apply(this,arguments)||this}n=t,(i=e).prototype=Object.create(n.prototype),i.prototype.constructor=i,a(i,n);var u=e.prototype;return u.resetInitSegment=function(i,n,e){t.prototype.resetInitSegment.call(this,i,n,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:i,duration:e,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var i=(r.getID3Data(t,0)||[]).length,n=t.length;i<n;i++)if(o.probe(t,i))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},u.canParse=function(t,i){return o.canParse(t,i)},u.appendFrame=function(t,i,n){if(null!==this.initPTS)return o.appendFrame(t,i,n,this.initPTS,this.frameIndex)},e}(e.default);u.minProbeByteLength=4,i.default=u},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),r=n(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),s=function(){function t(t,i){this.remainderData=null,this.config=void 0,this.config=i}var i=t.prototype;return i.resetTimeStamp=function(){},i.resetInitSegment=function(){},i.resetContiguity=function(){},t.probe=function(t){return Object(e.findBox)({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},i.demux=function(t){var i=t,n=Object(r.dummyTrack)();if(this.config.progressive){this.remainderData&&(i=Object(e.appendUint8Array)(this.remainderData,t));var s=Object(e.segmentValidRange)(i);this.remainderData=s.remainder,n.samples=s.valid||new Uint8Array}else n.samples=i;return{audioTrack:Object(r.dummyTrack)(),avcTrack:n,id3Track:Object(r.dummyTrack)(),textTrack:Object(r.dummyTrack)()}},i.flush=function(){var t=Object(r.dummyTrack)();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(r.dummyTrack)(),avcTrack:t,id3Track:Object(r.dummyTrack)(),textTrack:Object(r.dummyTrack)()}},i.demuxSampleAes=function(){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},i.destroy=function(){},t}();s.minProbeByteLength=1024,i.default=s},"./src/demux/mpegaudio.ts":
/*!********************************!*\
  !*** ./src/demux/mpegaudio.ts ***!
  \********************************/
/*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */function(t,i,n){n.r(i),n.d(i,"appendFrame",(function(){return u})),n.d(i,"parseHeader",(function(){return c})),n.d(i,"isHeaderPattern",(function(){return l})),n.d(i,"isHeader",(function(){return h})),n.d(i,"canParse",(function(){return f})),n.d(i,"probe",(function(){return d}));var e=null,r=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],o=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],a=[0,1,1,4];function u(t,i,n,e,r){if(!(n+24>i.length)){var s=c(i,n);if(s&&n+s.frameLength<=i.length){var o=e+r*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:i.subarray(n,n+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}}function c(t,i){var n=t[i+1]>>3&3,u=t[i+1]>>1&3,c=t[i+2]>>4&15,l=t[i+2]>>2&3;if(1!==n&&0!==c&&15!==c&&3!==l){var h=t[i+3]>>6,f=1e3*r[14*(3===n?3-u:3===u?3:4)+c-1],d=s[3*(3===n?0:2===n?1:2)+l],m=3===h?1:2,v=o[n][u],p=a[u],g=8*v*p,w=Math.floor(v*f/d+(t[i+2]>>1&1))*p;if(null===e){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);e=b?parseInt(b[1]):0}return!!e&&e<=87&&2===u&&f>=224e3&&0===h&&(t[i+3]=128|t[i+3]),{sampleRate:d,channelCount:m,frameLength:w,samplesPerFrame:g}}}function l(t,i){return 255===t[i]&&224==(224&t[i+1])&&0!=(6&t[i+1])}function h(t,i){return i+1<t.length&&l(t,i)}function f(t,i){return l(t,i)&&4<=t.length-i}function d(t,i){if(i+1<t.length&&l(t,i)){var n=c(t,i),e=4;null!=n&&n.frameLength&&(e=n.frameLength);var r=i+e;return r===t.length||h(t,r)}return!1}},"./src/demux/sample-aes.ts":
/*!*********************************!*\
  !*** ./src/demux/sample-aes.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),r=n(/*! ./tsdemuxer */"./src/demux/tsdemuxer.ts");i.default=function(){function t(t,i,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new e.default(t,i,{removePKCS7Padding:!1})}var i=t.prototype;return i.decryptBuffer=function(t,i){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,i)},i.decryptAacSample=function(t,i,n,e){var r=t[i].unit,s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this.decryptBuffer(o,(function(s){var o=new Uint8Array(s);r.set(o,16),e||a.decryptAacSamples(t,i+1,n)}))},i.decryptAacSamples=function(t,i,n){for(;;i++){if(i>=t.length)return void n();if(!(t[i].unit.length<32)){var e=this.decrypter.isSync();if(this.decryptAacSample(t,i,n,e),!e)return}}},i.getAvcEncryptedData=function(t){for(var i=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(i),e=0,r=32;r<t.length-16;r+=160,e+=16)n.set(t.subarray(r,r+16),e);return n},i.getAvcDecryptedUnit=function(t,i){for(var n=new Uint8Array(i),e=0,r=32;r<t.length-16;r+=160,e+=16)t.set(n.subarray(e,e+16),r);return t},i.decryptAvcSample=function(t,i,n,e,s,o){var a=Object(r.discardEPB)(s.data),u=this.getAvcEncryptedData(a),c=this;this.decryptBuffer(u.buffer,(function(r){s.data=c.getAvcDecryptedUnit(a,r),o||c.decryptAvcSamples(t,i,n+1,e)}))},i.decryptAvcSamples=function(t,i,n,e){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,n=0){if(i>=t.length)return void e();for(var r=t[i].units;!(n>=r.length);n++){var s=r[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,i,n,e,s,o),!o)return}}}},t}()},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
  !*** ./src/demux/transmuxer-interface.ts ***!
  \*******************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return h}));var e=n(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=n(/*! ../errors */"./src/errors.ts"),u=n(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),c=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),l=Object(u.getMediaSource)()||{isTypeSupported:function(){return!1}},h=function(){function t(t,i,n,u){var h=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=i,this.onTransmuxComplete=n,this.onFlush=u;var f=t.config,d=function(i,n){(n=n||{}).frag=h.frag,n.id=h.id,t.trigger(i,n)};this.observer=new c.EventEmitter,this.observer.on(r.Events.FRAG_DECRYPTED,d),this.observer.on(r.Events.ERROR,d);var m={mp4:l.isTypeSupported("video/mp4"),mpeg:l.isTypeSupported("audio/mpeg"),mp3:l.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(f.enableWorker&&"undefined"!=typeof Worker){var p;o.logger.log("demuxing in webworker");try{p=this.worker=e(/*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(i){t.trigger(r.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(i.message+"  ("+i.filename+":"+i.lineno+")")})},p.postMessage({cmd:"init",typeSupported:m,vendor:v,id:i,config:JSON.stringify(f)})}catch(t){o.logger.warn("Error in worker:",t),o.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new s.default(this.observer,m,f,v,i),this.worker=null}}else this.transmuxer=new s.default(this.observer,m,f,v,i)}var i=t.prototype;return i.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.observer=null},i.push=function(t,i,n,e,r,a,u,c,l,h){var f,d,m=this;l.transmuxing.start=self.performance.now();var v=this.transmuxer,p=this.worker,g=a?a.start:r.start,w=r.decryptdata,b=this.frag,y=!(b&&r.cc===b.cc),x=!(b&&l.level===b.level),k=b?l.sn-b.sn:-1,T=this.part?l.part-this.part.index:1,S=!x&&(1===k||0===k&&1===T),E=self.performance.now();(x||k||0===r.stats.parsing.start)&&(r.stats.parsing.start=E),!a||!T&&S||(a.stats.parsing.start=E);var O=!(b&&(null===(f=r.initSegment)||void 0===f?void 0:f.url)===(null===(d=b.initSegment)||void 0===d?void 0:d.url)),j=new s.TransmuxState(y,S,c,x,g,O);if(!S||y||O){o.logger.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+y+"\n        trackSwitch: "+x+"\n        contiguous: "+S+"\n        accurateTimeOffset: "+c+"\n        timeOffset: "+g+"\n        initSegmentChange: "+O);var M=new s.TransmuxConfig(n,e,i,u,h);this.configureTransmuxer(M)}if(this.frag=r,this.part=a,p)p.postMessage({cmd:"demux",data:t,decryptdata:w,chunkMeta:l,state:j},t instanceof ArrayBuffer?[t]:[]);else if(v){var A=v.push(t,w,l,j);Object(s.isPromise)(A)?A.then((function(t){m.handleTransmuxComplete(t)})):this.handleTransmuxComplete(A)}},i.flush=function(t){var i=this;t.transmuxing.start=self.performance.now();var n=this.transmuxer,e=this.worker;if(e)e.postMessage({cmd:"flush",chunkMeta:t});else if(n){var r=n.flush(t);Object(s.isPromise)(r)?r.then((function(n){i.handleFlushResult(n,t)})):this.handleFlushResult(r,t)}},i.handleFlushResult=function(t,i){var n=this;t.forEach((function(t){n.handleTransmuxComplete(t)})),this.onFlush(i)},i.onWorkerMessage=function(t){var i=t.data,n=this.hls;switch(i.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(i.data);break;case"flush":this.onFlush(i.data);break;default:i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,n.trigger(i.event,i.data)}},i.configureTransmuxer=function(t){var i=this.worker,n=this.transmuxer;i?i.postMessage({cmd:"configure",config:t}):n&&n.configure(t)},i.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
  !*** ./src/demux/transmuxer-worker.ts ***!
  \****************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return a}));var e=n(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function a(t){var i=new o.EventEmitter,n=function(i,n){t.postMessage({event:i,data:n})};i.on(r.Events.FRAG_DECRYPTED,n),i.on(r.Events.ERROR,n),t.addEventListener("message",(function(r){var o=r.data;switch(o.cmd){case"init":var a=JSON.parse(o.config);t.transmuxer=new e.default(i,o.typeSupported,a,o.vendor,o.id),Object(s.enableLogs)(a.debug),n("init",null);break;case"configure":t.transmuxer.configure(o.config);break;case"demux":var c=t.transmuxer.push(o.data,o.decryptdata,o.chunkMeta,o.state);Object(e.isPromise)(c)?c.then((function(i){u(t,i)})):u(t,c);break;case"flush":var h=o.chunkMeta,f=t.transmuxer.flush(h);Object(e.isPromise)(f)?f.then((function(i){l(t,i,h)})):l(t,f,h)}}))}function u(t,i){if((n=i.remuxResult).audio||n.video||n.text||n.id3||n.initSegment){var n,e=[],r=i.remuxResult,s=r.audio,o=r.video;s&&c(e,s),o&&c(e,o),t.postMessage({event:"transmuxComplete",data:i},e)}}function c(t,i){i.data1&&t.push(i.data1.buffer),i.data2&&t.push(i.data2.buffer)}function l(t,i,n){i.forEach((function(i){u(t,i)})),t.postMessage({event:"flush",data:n})}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/transmuxer.ts ***!
  \*********************************/
/*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */function(t,i,n){n.r(i),n.d(i,"default",(function(){return w})),n.d(i,"isPromise",(function(){return y})),n.d(i,"TransmuxConfig",(function(){return x})),n.d(i,"TransmuxState",(function(){return k}));var e,r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../errors */"./src/errors.ts"),o=n(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),a=n(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts"),u=n(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts"),c=n(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts"),l=n(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts"),h=n(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),f=n(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts"),d=n(/*! ./chunk-cache */"./src/demux/chunk-cache.ts"),m=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),v=n(/*! ../utils/logger */"./src/utils/logger.ts");try{e=self.performance.now.bind(self.performance)}catch(t){v.logger.debug("Unable to use Performance API on this environment"),e=self.Date.now}var p=[{demux:c.default,remux:h.default},{demux:u.default,remux:f.default},{demux:a.default,remux:h.default},{demux:l.default,remux:h.default}],g=1024;p.forEach((function(t){g=Math.max(g,t.demux.minProbeByteLength)}));var w=function(){function t(t,i,n,e,r){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new d.default,this.observer=t,this.typeSupported=i,this.config=n,this.vendor=e,this.id=r}var i=t.prototype;return i.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},i.push=function(t,i,n,r){var s=this,o=n.transmuxing;o.executeStart=e();var a=new Uint8Array(t),u=this.cache,c=this.config,l=this.currentTransmuxState,h=this.transmuxConfig;r&&(this.currentTransmuxState=r);var f=function(t,i){var n=null;return t.byteLength>0&&null!=i&&null!=i.key&&null!==i.iv&&null!=i.method&&(n=i),n}(a,i);if(f&&"AES-128"===f.method){var d=this.getDecrypter();if(!c.enableSoftwareAES)return this.decryptionPromise=d.webCryptoDecrypt(a,f.key.buffer,f.iv.buffer).then((function(t){var i=s.push(t,null,n);return s.decryptionPromise=null,i})),this.decryptionPromise;var v=d.softwareDecrypt(a,f.key.buffer,f.iv.buffer);if(!v)return o.executeEnd=e(),b(n);a=new Uint8Array(v)}var p=r||l,g=p.contiguous,w=p.discontinuity,y=p.trackSwitch,x=p.accurateTimeOffset,k=p.timeOffset,T=p.initSegmentChange,S=h.defaultInitPts;if((w||y||T)&&this.resetInitSegment(h.initSegmentData,h.audioCodec,h.videoCodec,h.duration),(w||T)&&this.resetInitialTimestamp(S),g||this.resetContiguity(),this.needsProbing(a,w,y)){if(u.dataLength){var E=u.flush();a=Object(m.appendUint8Array)(E,a)}this.configureTransmuxer(a,h)}var O=this.transmux(a,f,k,x,n),j=this.currentTransmuxState;return j.contiguous=!0,j.discontinuity=!1,j.trackSwitch=!1,o.executeEnd=e(),O},i.flush=function(t){var i=this,n=t.transmuxing;n.executeStart=e();var o=this.decrypter,a=this.cache,u=this.currentTransmuxState,c=this.decryptionPromise;if(c)return c.then((function(){return i.flush(t)}));var l=[],h=u.timeOffset;if(o){var f=o.flush();f&&l.push(this.push(f,null,t))}var d=a.dataLength;a.reset();var m=this.demuxer;if(!m||!this.remuxer)return d>=g&&this.observer.emit(r.Events.ERROR,r.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=e(),[b(t)];var v=m.flush(h);return y(v)?v.then((function(n){return i.flushRemux(l,n,t),l})):(this.flushRemux(l,v,t),l)},i.flushRemux=function(t,i,n){var r=i.audioTrack,s=i.avcTrack,o=i.id3Track,a=i.textTrack,u=this.currentTransmuxState,c=u.accurateTimeOffset,l=u.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var h=this.remuxer.remux(r,s,o,a,l,c,!0,this.id);t.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=e()},i.resetInitialTimestamp=function(t){var i=this.demuxer,n=this.remuxer;i&&n&&(i.resetTimeStamp(t),n.resetTimeStamp(t))},i.resetContiguity=function(){var t=this.demuxer,i=this.remuxer;t&&i&&(t.resetContiguity(),i.resetNextTimestamp())},i.resetInitSegment=function(t,i,n,e){var r=this.demuxer,s=this.remuxer;r&&s&&(r.resetInitSegment(i,n,e),s.resetInitSegment(t,i,n))},i.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},i.transmux=function(t,i,n,e,r){return i&&"SAMPLE-AES"===i.method?this.transmuxSampleAes(t,i,n,e,r):this.transmuxUnencrypted(t,n,e,r)},i.transmuxUnencrypted=function(t,i,n,e){var r=this.demuxer.demux(t,i,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r.audioTrack,r.avcTrack,r.id3Track,r.textTrack,i,n,!1,this.id),chunkMeta:e}},i.transmuxSampleAes=function(t,i,n,e,r){var s=this;return this.demuxer.demuxSampleAes(t,i,n).then((function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,n,e,!1,s.id),chunkMeta:r}}))},i.configureTransmuxer=function(t,i){for(var n,e=this.config,r=this.observer,s=this.typeSupported,o=this.vendor,a=i.audioCodec,c=i.defaultInitPts,l=i.duration,h=i.initSegmentData,d=i.videoCodec,m=0,g=p.length;m<g;m++)if(p[m].demux.probe(t)){n=p[m];break}n||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:u.default,remux:f.default});var w=this.demuxer,b=this.remuxer,y=n.remux,x=n.demux;b&&b instanceof y||(this.remuxer=new y(r,e,s,o)),w&&w instanceof x||(this.demuxer=new x(r,e,s),this.probe=x.probe),this.resetInitSegment(h,a,d,l),this.resetInitialTimestamp(c)},i.needsProbing=function(t,i,n){return!this.demuxer||!this.remuxer||i||n},i.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new o.default(this.observer,this.config)),t},t}(),b=function(t){return{remuxResult:{},chunkMeta:t}};function y(t){return"then"in t&&t.then instanceof Function}var x=function(t,i,n,e,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=i,this.initSegmentData=n,this.duration=e,this.defaultInitPts=r},k=function(t,i,n,e,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=i,this.accurateTimeOffset=n,this.trackSwitch=e,this.timeOffset=r,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
  !*** ./src/demux/tsdemuxer.ts ***!
  \********************************/
/*! exports provided: discardEPB, default */function(t,i,n){n.r(i),n.d(i,"discardEPB",(function(){return y}));var e=n(/*! ./adts */"./src/demux/adts.ts"),r=n(/*! ./mpegaudio */"./src/demux/mpegaudio.ts"),s=n(/*! ./exp-golomb */"./src/demux/exp-golomb.ts"),o=n(/*! ./id3 */"./src/demux/id3.ts"),a=n(/*! ./sample-aes */"./src/demux/sample-aes.ts"),u=n(/*! ../events */"./src/events.ts"),c=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),l=n(/*! ../utils/logger */"./src/utils/logger.ts"),h=n(/*! ../errors */"./src/errors.ts"),f={video:1,audio:2,id3:3,text:4},d=function(){function t(t,i,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=i,this.typeSupported=n}t.probe=function(i){var n=t.syncOffset(i);return!(n<0||(n&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),0))},t.syncOffset=function(t){for(var i=Math.min(1e3,t.length-564),n=0;n<i;){if(71===t[n]&&71===t[n+188]&&71===t[n+376])return n;n++}return-1},t.createTrack=function(t,i){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:f[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?i:void 0}};var i=t.prototype;return i.resetInitSegment=function(i,n,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",e),this._audioTrack=t.createTrack("audio",e),this._id3Track=t.createTrack("id3",e),this._txtTrack=t.createTrack("text",e),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=e},i.resetTimeStamp=function(){},i.resetContiguity=function(){var t=this._audioTrack,i=this._avcTrack,n=this._id3Track;t&&(t.pesData=null),i&&(i.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},i.demux=function(i,n,e,r){var s;void 0===e&&(e=!1),void 0===r&&(r=!1),e||(this.sampleAes=null);var o=this._avcTrack,a=this._audioTrack,f=this._id3Track,d=o.pid,m=o.pesData,w=a.pid,b=f.pid,y=a.pesData,x=f.pesData,k=!1,T=this.pmtParsed,S=this._pmtId,E=i.length;if(this.remainderData&&(E=(i=Object(c.appendUint8Array)(this.remainderData,i)).length,this.remainderData=null),E<188&&!r)return this.remainderData=i,{audioTrack:a,avcTrack:o,id3Track:f,textTrack:this._txtTrack};var O=Math.max(0,t.syncOffset(i));(E-=(E+O)%188)<i.byteLength&&!r&&(this.remainderData=new Uint8Array(i.buffer,E,i.buffer.byteLength-E));for(var j=0,M=O;M<E;M+=188)if(71===i[M]){var A=!!(64&i[M+1]),I=((31&i[M+1])<<8)+i[M+2],D=void 0;if((48&i[M+3])>>4>1){if((D=M+5+i[M+4])===M+188)continue}else D=M+4;switch(I){case d:A&&(m&&(s=g(m))&&this.parseAVCPES(s,!1),m={data:[],size:0}),m&&(m.data.push(i.subarray(D,M+188)),m.size+=M+188-D);break;case w:A&&(y&&(s=g(y))&&(a.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),y={data:[],size:0}),y&&(y.data.push(i.subarray(D,M+188)),y.size+=M+188-D);break;case b:A&&(x&&(s=g(x))&&this.parseID3PES(s),x={data:[],size:0}),x&&(x.data.push(i.subarray(D,M+188)),x.size+=M+188-D);break;case 0:A&&(D+=i[D]+1),S=this._pmtId=v(i,D);break;case S:A&&(D+=i[D]+1);var C=p(i,D,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,e);(d=C.avc)>0&&(o.pid=d),(w=C.audio)>0&&(a.pid=w,a.isAAC=C.isAAC),(b=C.id3)>0&&(f.pid=b),k&&!T&&(l.logger.log("reparse from beginning"),k=!1,M=O-188),T=this.pmtParsed=!0;break;case 17:case 8191:break;default:k=!0}}else j++;j>0&&this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+j+" TS packet/s that do not start with 0x47"}),o.pesData=m,a.pesData=y,f.pesData=x;var R={audioTrack:a,avcTrack:o,id3Track:f,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(R),R},i.flush=function(){var t,i=this.remainderData;return this.remainderData=null,t=i?this.demux(i,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},i.extractRemainingSamples=function(t){var i,n=t.audioTrack,e=t.avcTrack,r=t.id3Track,s=e.pesData,o=n.pesData,a=r.pesData;s&&(i=g(s))?(this.parseAVCPES(i,!0),e.pesData=null):e.pesData=s,o&&(i=g(o))?(n.isAAC?this.parseAACPES(i):this.parseMPEGPES(i),n.pesData=null):(null!=o&&o.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=o),a&&(i=g(a))?(this.parseID3PES(i),r.pesData=null):r.pesData=a},i.demuxSampleAes=function(t,i,n){var e=this.demux(t,n,!0,!this.config.progressive),r=this.sampleAes=new a.default(this.observer,this.config,i);return this.decrypt(e,r)},i.decrypt=function(t,i){return new Promise((function(n){var e=t.audioTrack,r=t.avcTrack;e.samples&&e.isAAC?i.decryptAacSamples(e.samples,0,(function(){r.samples?i.decryptAvcSamples(r.samples,0,0,(function(){n(t)})):n(t)})):r.samples&&i.decryptAvcSamples(r.samples,0,0,(function(){n(t)}))}))},i.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},i.parseAVCPES=function(t,i){var n,e=this,r=this._avcTrack,a=this.parseAVCNALu(t.data),u=this.avcSample,c=!1;t.data=null,u&&a.length&&!r.audFound&&(w(u,r),u=this.avcSample=m(!1,t.pts,t.dts,"")),a.forEach((function(i){switch(i.type){case 1:n=!0,u||(u=e.avcSample=m(!0,t.pts,t.dts,"")),u.frame=!0;var a=i.data;if(c&&a.length>4){var l=new s.default(a).readSliceType();2!==l&&4!==l&&7!==l&&9!==l||(u.key=!0)}break;case 5:n=!0,u||(u=e.avcSample=m(!0,t.pts,t.dts,"")),u.key=!0,u.frame=!0;break;case 6:n=!0;var h=new s.default(y(i.data));h.readUByte();for(var f=0,d=0,v=!1,p=0;!v&&h.bytesAvailable>1;){f=0;do{f+=p=h.readUByte()}while(255===p);d=0;do{d+=p=h.readUByte()}while(255===p);if(4===f&&0!==h.bytesAvailable){if(v=!0,181===h.readUByte()&&49===h.readUShort()&&1195456820===h.readUInt()&&3===h.readUByte()){for(var g=h.readUByte(),x=31&g,k=[g,h.readUByte()],T=0;T<x;T++)k.push(h.readUByte()),k.push(h.readUByte()),k.push(h.readUByte());b(e._txtTrack.samples,{type:3,pts:t.pts,bytes:k})}}else if(5===f&&0!==h.bytesAvailable){if(v=!0,d>16){for(var S=[],E=0;E<16;E++)S.push(h.readUByte().toString(16)),3!==E&&5!==E&&7!==E&&9!==E||S.push("-");for(var O=d-16,j=new Uint8Array(O),M=0;M<O;M++)j[M]=h.readUByte();b(e._txtTrack.samples,{pts:t.pts,payloadType:f,uuid:S.join(""),userData:Object(o.utf8ArrayToStr)(j),userDataBytes:j})}}else if(d<h.bytesAvailable)for(var A=0;A<d;A++)h.readUByte()}break;case 7:if(n=!0,c=!0,!r.sps){var I=new s.default(i.data).readSPS();r.width=I.width,r.height=I.height,r.pixelRatio=I.pixelRatio,r.sps=[i.data],r.duration=e._duration;for(var D=i.data.subarray(1,4),C="avc1.",R=0;R<3;R++){var P=D[R].toString(16);P.length<2&&(P="0"+P),C+=P}r.codec=C}break;case 8:n=!0,r.pps||(r.pps=[i.data]);break;case 9:n=!1,r.audFound=!0,u&&w(u,r),u=e.avcSample=m(!1,t.pts,t.dts,"");break;case 12:n=!1;break;default:n=!1,u&&(u.debug+="unknown NAL "+i.type+" ")}u&&n&&u.units.push(i)})),i&&u&&(w(u,r),this.avcSample=null)},i.getLastNalUnit=function(){var t,i,n=this.avcSample;if(!n||0===n.units.length){var e=this._avcTrack.samples;n=e[e.length-1]}if(null!==(t=n)&&void 0!==t&&t.units){var r=n.units;i=r[r.length-1]}return i},i.parseAVCNALu=function(t){var i,n,e=t.byteLength,r=this._avcTrack,s=r.naluState||0,o=s,a=[],u=0,c=-1,l=0;for(-1===s&&(c=0,l=31&t[0],s=0,u=1);u<e;)if(i=t[u++],s)if(1!==s)if(i)if(1===i){if(c>=0){var h={data:t.subarray(c,u-s-1),type:l};a.push(h)}else{var f=this.getLastNalUnit();if(f&&(o&&u<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),(n=u-s-1)>0)){var d=new Uint8Array(f.data.byteLength+n);d.set(f.data,0),d.set(t.subarray(0,n),f.data.byteLength),f.data=d,f.state=0}}u<e?(c=u,l=31&t[u],s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(c>=0&&s>=0){var m={data:t.subarray(c,e),type:l,state:s};a.push(m)}if(0===a.length){var v=this.getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+t.byteLength);p.set(v.data,0),p.set(t,v.data.byteLength),v.data=p}}return r.naluState=s,a},i.parseAACPES=function(t){var i,n,r,s,o,a=0,c=this._audioTrack,f=this.aacOverFlow,d=t.data;if(f){this.aacOverFlow=null;var m=f.sample.unit.byteLength,v=Math.min(f.missing,m),p=m-v;f.sample.unit.set(d.subarray(0,v),p),c.samples.push(f.sample),a=f.missing}for(i=a,n=d.length;i<n-1&&!e.isHeader(d,i);i++);if(i===a||(i<n-1?(r="AAC PES did not start with ADTS header,offset:"+i,s=!1):(r="no ADTS header found in AAC PES",s=!0),l.logger.warn("parsing error:"+r),this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),!s)){if(e.initTrackConfig(c,this.observer,d,i,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!f)return void l.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var g=e.getFrameDuration(c.samplerate);o=f.sample.pts+g}for(var w=0;i<n;){if(e.isHeader(d,i)){if(i+5<n){var b=e.appendFrame(c,d,i,o,w);if(b){if(!b.missing){i+=b.length,w++;continue}this.aacOverFlow=b}}break}i++}}},i.parseMPEGPES=function(t){var i=t.data,n=i.length,e=0,s=0,o=t.pts;if(void 0!==o)for(;s<n;)if(r.isHeader(i,s)){var a=r.appendFrame(this._audioTrack,i,s,o,e);if(!a)break;s+=a.length,e++}else s++;else l.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},i.parseID3PES=function(t){void 0!==t.pts?this._id3Track.samples.push(t):l.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function m(t,i,n,e){return{key:t,frame:!1,pts:i,dts:n,units:[],debug:e,length:0}}function v(t,i){return(31&t[i+10])<<8|t[i+11]}function p(t,i,n,e){var r={audio:-1,avc:-1,id3:-1,isAAC:!0},s=i+3+((15&t[i+1])<<8|t[i+2])-4;for(i+=12+((15&t[i+10])<<8|t[i+11]);i<s;){var o=(31&t[i+1])<<8|t[i+2];switch(t[i]){case 207:if(!e){l.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===r.audio&&(r.audio=o);break;case 21:-1===r.id3&&(r.id3=o);break;case 219:if(!e){l.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===r.avc&&(r.avc=o);break;case 3:case 4:n?-1===r.audio&&(r.audio=o,r.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser");break;case 36:l.logger.warn("Unsupported HEVC stream type found")}i+=5+((15&t[i+3])<<8|t[i+4])}return r}function g(t){var i,n,e,r,s,o=0,a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&a.length>1;){var u=new Uint8Array(a[0].length+a[1].length);u.set(a[0]),u.set(a[1],a[0].length),a[0]=u,a.splice(1,1)}if(1===((i=a[0])[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>t.size-6)return null;var c=i[7];192&c&&(r=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,64&c?r-(s=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>54e5&&(l.logger.warn(Math.round((r-s)/9e4)+"s delta between PTS and DTS, align them"),r=s):s=r);var h=(e=i[8])+9;if(t.size<=h)return null;t.size-=h;for(var f=new Uint8Array(t.size),d=0,m=a.length;d<m;d++){var v=(i=a[d]).byteLength;if(h){if(h>v){h-=v;continue}i=i.subarray(h),v-=h,h=0}f.set(i,o),o+=v}return n&&(n-=e+3),{data:f,pts:r,dts:s,len:n}}return null}function w(t,i){if(t.units.length&&t.frame){if(void 0===t.pts){var n=i.samples,e=n.length;if(!e)return void i.dropped++;var r=n[e-1];t.pts=r.pts,t.dts=r.dts}i.samples.push(t)}t.debug.length&&l.logger.log(t.pts+"/"+t.dts+":"+t.debug)}function b(t,i){var n=t.length;if(n>0){if(i.pts>=t[n-1].pts)t.push(i);else for(var e=n-1;e>=0;e--)if(i.pts<t[e].pts){t.splice(e,0,i);break}}else t.push(i)}function y(t){for(var i=t.byteLength,n=[],e=1;e<i-2;)0===t[e]&&0===t[e+1]&&3===t[e+2]?(n.push(e+2),e+=2):e++;if(0===n.length)return t;var r=i-n.length,s=new Uint8Array(r),o=0;for(e=0;e<r;o++,e++)o===n[0]&&(o++,n.shift()),s[e]=t[o];return s}d.minProbeByteLength=188,i.default=d},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(t,i,n){var e,r;n.r(i),n.d(i,"ErrorTypes",(function(){return e})),n.d(i,"ErrorDetails",(function(){return r})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(e||(e={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown"}(r||(r={}))},"./src/events.ts":
/*!***********************!*\
  !*** ./src/events.ts ***!
  \***********************/
/*! exports provided: Events */function(t,i,n){var e;n.r(i),n.d(i,"Events",(function(){return e})),function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"}(e||(e={}))},"./src/hls.ts":
/*!********************!*\
  !*** ./src/hls.ts ***!
  \********************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return w}));var e=n(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),r=n(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts"),s=n(/*! ./loader/key-loader */"./src/loader/key-loader.ts"),o=n(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts"),a=n(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts"),u=n(/*! ./controller/level-controller */"./src/controller/level-controller.ts"),c=n(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts"),l=n(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts"),h=n(/*! ./is-supported */"./src/is-supported.ts"),f=n(/*! ./utils/logger */"./src/utils/logger.ts"),d=n(/*! ./config */"./src/config.ts"),m=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),v=n(/*! ./events */"./src/events.ts"),p=n(/*! ./errors */"./src/errors.ts");function g(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var w=function(){function t(i){void 0===i&&(i={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=Object(d.mergeConfig)(t.DefaultConfig,i);this.userConfig=i,Object(f.enableLogs)(n.debug),this._autoLevelCapping=-1,n.progressive&&Object(d.enableStreamingMode)(n);var e=n.bufferController,h=n.capLevelController,v=n.fpsController,p=this.abrController=new(0,n.abrController)(this),g=this.bufferController=new e(this),w=this.capLevelController=new h(this),b=new v(this),y=new r.default(this),x=new s.default(this),k=new o.default(this),T=this.levelController=new u.default(this),S=new c.FragmentTracker(this),E=this.streamController=new l.default(this,S);w.setStreamController(E),b.setStreamController(E);var O=[T,E];this.networkControllers=O;var j=[y,x,p,g,w,b,k,S];this.audioTrackController=this.createController(n.audioTrackController,null,O),this.createController(n.audioStreamController,S,O),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,O),this.createController(n.subtitleStreamController,S,O),this.createController(n.timelineController,null,j),this.emeController=this.createController(n.emeController,null,j),this.cmcdController=this.createController(n.cmcdController,null,j),this.latencyController=this.createController(a.default,null,j),this.coreComponents=j}t.isSupported=function(){return Object(h.isSupported)()};var i,n,w,b=t.prototype;return b.createController=function(t,i,n){if(t){var e=i?new t(this,i):new t(this);return n&&n.push(e),e}return null},b.on=function(t,i,n){void 0===n&&(n=this),this._emitter.on(t,i,n)},b.once=function(t,i,n){void 0===n&&(n=this),this._emitter.once(t,i,n)},b.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},b.off=function(t,i,n,e){void 0===n&&(n=this),this._emitter.off(t,i,n,e)},b.listeners=function(t){return this._emitter.listeners(t)},b.emit=function(t,i,n){return this._emitter.emit(t,i,n)},b.trigger=function(t,i){if(this.config.debug)return this.emit(t,t,i);try{return this.emit(t,t,i)}catch(i){f.logger.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(v.Events.ERROR,{type:p.ErrorTypes.OTHER_ERROR,details:p.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1},b.listenerCount=function(t){return this._emitter.listenerCount(t)},b.destroy=function(){f.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},b.attachMedia=function(t){f.logger.log("attachMedia"),this._media=t,this.trigger(v.Events.MEDIA_ATTACHING,{media:t})},b.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},b.loadSource=function(t){this.stopLoad();var i=this.media,n=this.url,r=this.url=e.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});f.logger.log("loadSource:"+r),i&&n&&n!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(i)),this.trigger(v.Events.MANIFEST_LOADING,{url:t})},b.startLoad=function(t){void 0===t&&(t=-1),f.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(i){i.startLoad(t)}))},b.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},b.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.recoverMediaError=function(){f.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},b.removeLevel=function(t,i){void 0===i&&(i=0),this.levelController.removeLevel(t,i)},i=t,w=[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return p.ErrorTypes}},{key:"ErrorDetails",get:function(){return p.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:d.hlsDefaultConfig},set:function(i){t.defaultConfig=i}}],(n=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){f.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){f.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){f.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){f.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){f.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var i=!!t;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(f.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,i=this.config.minAutoBitrate;if(!t)return 0;for(var n=t.length,e=0;e<n;e++)if(t[e].maxBitrate>i)return e;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,i=this.autoLevelCapping;return-1===i&&t&&t.length?t.length-1:i}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var i=this.audioTrackController;i&&(i.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var i=this.subtitleTrackController;i&&(i.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var i=this.subtitleTrackController;i&&(i.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&g(i.prototype,n),w&&g(i,w),t}();w.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
  !*** ./src/is-supported.ts ***!
  \*****************************/
/*! exports provided: isSupported, changeTypeSupported */function(t,i,n){n.r(i),n.d(i,"isSupported",(function(){return s})),n.d(i,"changeTypeSupported",(function(){return o}));var e=n(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function r(){return self.SourceBuffer||self.WebKitSourceBuffer}function s(){var t=Object(e.getMediaSource)();if(!t)return!1;var i=r();return!(!t||"function"!=typeof t.isTypeSupported||!t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||i&&(!i.prototype||"function"!=typeof i.prototype.appendBuffer||"function"!=typeof i.prototype.remove))}function o(){var t,i=r();return"function"==typeof(null==i||null===(t=i.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/fragment-loader.ts ***!
  \***************************************/
/*! exports provided: default, LoadError */function(t,i,n){n.r(i),n.d(i,"default",(function(){return h})),n.d(i,"LoadError",(function(){return d}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../errors */"./src/errors.ts");function s(t){var i="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,n)}function n(){return o(t,arguments,c(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,t)})(t)}function o(t,i,n){return(o=a()?Reflect.construct:function(t,i,n){var e=[null];e.push.apply(e,i);var r=new(Function.bind.apply(t,e));return n&&u(r,n.prototype),r}).apply(null,arguments)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function u(t,i){return(u=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=Math.pow(2,17),h=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var i=t.prototype;return i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i.abort=function(){this.loader&&this.loader.abort()},i.load=function(t,i){var n=this,e=t.url;if(!e)return Promise.reject(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(e?"part list":"url")));this.abort();var s=this.config,o=s.fLoader,a=s.loader;return new Promise((function(e,u){n.loader&&n.loader.destroy();var c=n.loader=t.loader=o?new o(s):new a(s),h=f(t),m={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:l};t.stats=c.stats,c.load(h,m,{onSuccess:function(i,r,s,o){n.resetLoader(t,c),e({frag:t,part:null,payload:i.data,networkDetails:o})},onError:function(i,e,s){n.resetLoader(t,c),u(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:i,networkDetails:s}))},onAbort:function(i,e,s){n.resetLoader(t,c),u(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:s}))},onTimeout:function(i,e,s){n.resetLoader(t,c),u(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:s}))},onProgress:function(n,e,r,s){i&&i({frag:t,part:null,payload:r,networkDetails:s})}})}))},i.loadPart=function(t,i,n){var e=this;this.abort();var s=this.config,o=s.fLoader,a=s.loader;return new Promise((function(u,c){e.loader&&e.loader.destroy();var h=e.loader=t.loader=o?new o(s):new a(s),m=f(t,i),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:l};i.stats=h.stats,h.load(m,v,{onSuccess:function(r,s,o,a){e.resetLoader(t,h),e.updateStatsFromPart(t,i);var c={frag:t,part:i,payload:r.data,networkDetails:a};n(c),u(c)},onError:function(n,s,o){e.resetLoader(t,h),c(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:i,response:n,networkDetails:o}))},onAbort:function(n,s,o){t.stats.aborted=i.stats.aborted,e.resetLoader(t,h),c(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:i,networkDetails:o}))},onTimeout:function(n,s,o){e.resetLoader(t,h),c(new d({type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:i,networkDetails:o}))}})}))},i.updateStatsFromPart=function(t,i){var n=t.stats,e=i.stats,r=e.total;if(n.loaded+=e.loaded,r){var s=Math.round(t.duration/i.duration),o=Math.min(Math.round(n.loaded/r),s),a=(s-o)*Math.round(n.loaded/o);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);var u=n.loading,c=e.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end},i.resetLoader=function(t,i){t.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},t}();function f(t,i){void 0===i&&(i=null);var n=i||t,r={frag:t,part:i,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,o=n.byteRangeEndOffset;return Object(e.isFiniteNumber)(s)&&Object(e.isFiniteNumber)(o)&&(r.rangeStart=s,r.rangeEnd=o),r}var d=function(t){var i,n;function e(i){for(var n,e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];return(n=t.call.apply(t,[this].concat(r))||this).data=void 0,n.data=i,n}return n=t,(i=e).prototype=Object.create(n.prototype),i.prototype.constructor=i,u(i,n),e}(s(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
  !*** ./src/loader/fragment.ts ***!
  \********************************/
/*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */function(t,i,n){n.r(i),n.d(i,"ElementaryStreamTypes",(function(){return e})),n.d(i,"BaseSegment",(function(){return d})),n.d(i,"Fragment",(function(){return m})),n.d(i,"Part",(function(){return v}));var e,r=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),s=n(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=n(/*! ./level-key */"./src/loader/level-key.ts"),u=n(/*! ./load-stats */"./src/loader/load-stats.ts");function c(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,l(t,i)}function l(t,i){return(l=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function h(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function f(t,i,n){return i&&h(t.prototype,i),n&&h(t,n),t}!function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"}(e||(e={}));var d=function(){function t(t){var i;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((i={})[e.AUDIO]=null,i[e.VIDEO]=null,i[e.AUDIOVIDEO]=null,i),this.baseurl=t}return t.prototype.setByteRange=function(t,i){var n=t.split("@",2),e=[];e[0]=1===n.length?i?i.byteRangeEndOffset:0:parseInt(n[1]),e[1]=parseInt(n[0])+e[0],this._byteRange=e},f(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),m=function(t){function i(i,n){var e;return(e=t.call(this,n)||this)._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new u.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=i,e}c(i,t);var n=i.prototype;return n.createInitializationVector=function(t){for(var i=new Uint8Array(16),n=12;n<16;n++)i[n]=t>>8*(15-n)&255;return i},n.setDecryptDataFromLevelKey=function(t,i){var n=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((n=a.LevelKey.fromURI(t.uri)).method=t.method,n.iv=this.createInitializationVector(i),n.keyFormat="identity"),n},n.setElementaryStreamInfo=function(t,i,n,e,r,s){void 0===s&&(s=!1);var o=this.elementaryStreams,a=o[t];a?(a.startPTS=Math.min(a.startPTS,i),a.endPTS=Math.max(a.endPTS,n),a.startDTS=Math.min(a.startDTS,e),a.endDTS=Math.max(a.endDTS,r)):o[t]={startPTS:i,endPTS:n,startDTS:e,endDTS:r,partial:s}},n.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[e.AUDIO]=null,t[e.VIDEO]=null,t[e.AUDIOVIDEO]=null},f(i,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&o.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(r.isFiniteNumber)(this.programDateTime))return null;var t=Object(r.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),i}(d),v=function(t){function i(i,n,e,r,s){var o;(o=t.call(this,e)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new u.LoadStats,o.duration=i.decimalFloatingPoint("DURATION"),o.gap=i.bool("GAP"),o.independent=i.bool("INDEPENDENT"),o.relurl=i.enumeratedString("URI"),o.fragment=n,o.index=r;var a=i.enumeratedString("BYTERANGE");return a&&o.setByteRange(a,s),s&&(o.fragOffset=s.fragOffset+s.duration),o}return c(i,t),f(i,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),i}(d)},"./src/loader/key-loader.ts":
/*!**********************************!*\
  !*** ./src/loader/key-loader.ts ***!
  \**********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return o}));var e=n(/*! ../events */"./src/events.ts"),r=n(/*! ../errors */"./src/errors.ts"),s=n(/*! ../utils/logger */"./src/utils/logger.ts"),o=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var i=t.prototype;return i._registerListeners=function(){this.hls.on(e.Events.KEY_LOADING,this.onKeyLoading,this)},i._unregisterListeners=function(){this.hls.off(e.Events.KEY_LOADING,this.onKeyLoading)},i.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var i=this.loaders[t];i&&i.destroy()}this.loaders={}},i.onKeyLoading=function(t,i){var n=i.frag,r=n.type,o=this.loaders[r];if(n.decryptdata){var a=n.decryptdata.uri;if(a!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;if(o&&(s.logger.warn("abort previous key loader for type:"+r),o.abort()),!a)return void s.logger.warn("key uri is falsy");var c=n.loader=this.loaders[r]=new(0,u.loader)(u);this.decrypturl=a,this.decryptkey=null;var l={url:a,frag:n,responseType:"arraybuffer"},h={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(l,h,f)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(e.Events.KEY_LOADED,{frag:n}))}else s.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(t,i,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(e.Events.KEY_LOADED,{frag:r})):s.logger.error("after key load, decryptdata unset")},i.loaderror=function(t,i){var n=i.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},i.loadtimeout=function(t,i){var n=i.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(e.Events.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},t}()},"./src/loader/level-details.ts":
/*!*************************************!*\
  !*** ./src/loader/level-details.ts ***!
  \*************************************/
/*! exports provided: LevelDetails */function(t,i,n){n.r(i),n.d(i,"LevelDetails",(function(){return s}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts");function r(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var s=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}var i,n;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||0===i&&n>0,this.misses=this.updated||this.advanced?Math.floor(.6*t.misses):t.misses+1,this.availabilityDelay=t.availabilityDelay},i=t,(n=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(e.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&r(i.prototype,n),t}()},"./src/loader/level-key.ts":
/*!*********************************!*\
  !*** ./src/loader/level-key.ts ***!
  \*********************************/
/*! exports provided: LevelKey */function(t,i,n){n.r(i),n.d(i,"LevelKey",(function(){return s}));var e=n(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");function r(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var s=function(){function t(t,i){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=i?Object(e.buildAbsoluteURL)(t,i,{alwaysNormalize:!0}):t}var i,n;return t.fromURL=function(i,n){return new t(i,n)},t.fromURI=function(i){return new t(i)},i=t,(n=[{key:"uri",get:function(){return this._uri}}])&&r(i.prototype,n),t}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
  !*** ./src/loader/load-stats.ts ***!
  \**********************************/
/*! exports provided: LoadStats */function(t,i,n){n.r(i),n.d(i,"LoadStats",(function(){return e}));var e=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
  !*** ./src/loader/m3u8-parser.ts ***!
  \***********************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return p}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),s=n(/*! ./fragment */"./src/loader/fragment.ts"),o=n(/*! ./level-details */"./src/loader/level-details.ts"),a=n(/*! ./level-key */"./src/loader/level-key.ts"),u=n(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),c=n(/*! ../utils/logger */"./src/utils/logger.ts"),l=n(/*! ../utils/codecs */"./src/utils/codecs.ts"),h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,f=/#EXT-X-MEDIA:(.*)/g,d=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i,p=function(){function t(){}return t.findGroup=function(t,i){for(var n=0;n<t.length;n++){var e=t[n];if(e.id===i)return e}},t.convertAVC1ToAVCOTI=function(t){var i=t.split(".");if(i.length>2){var n=i.shift()+".";return(n+=parseInt(i.shift()).toString(16))+("000"+parseInt(i.shift()).toString(16)).substr(-4)}return t},t.resolve=function(t,i){return r.buildAbsoluteURL(i,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(i,n){var e,r=[],s={},o=!1;for(h.lastIndex=0;null!=(e=h.exec(i));)if(e[1]){var a=new u.AttrList(e[1]),c={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:t.resolve(e[2],n)},l=a.decimalResolution("RESOLUTION");l&&(c.width=l.width,c.height=l.height),g((a.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=t.convertAVC1ToAVCOTI(c.videoCodec)),r.push(c)}else if(e[3]){var f=new u.AttrList(e[3]);f["DATA-ID"]&&(o=!0,s[f["DATA-ID"]]=f)}return{levels:r,sessionData:o?s:null}},t.parseMasterPlaylistMedia=function(i,n,e,r){var s;void 0===r&&(r=[]);var o=[],a=0;for(f.lastIndex=0;null!==(s=f.exec(i));){var c=new u.AttrList(s[1]);if(c.TYPE===e){var l={attrs:c,bitrate:0,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:e,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?t.resolve(c.URI,n):""};if(r.length){var h=t.findGroup(r,l.groupId)||r[0];w(l,h,"audioCodec"),w(l,h,"textCodec")}o.push(l)}}return o},t.parseLevelPlaylist=function(t,i,n,l,h){var f,p,g,w=new o.LevelDetails(i),y=w.fragments,x=null,k=0,T=0,S=0,E=0,O=null,j=new s.Fragment(l,i),M=-1,A=!1;for(d.lastIndex=0,w.m3u8=t;null!==(f=d.exec(t));){A&&(A=!1,(j=new s.Fragment(l,i)).start=S,j.sn=k,j.cc=E,j.level=n,x&&(j.initSegment=x,j.rawProgramDateTime=x.rawProgramDateTime));var I=f[1];if(I){j.duration=parseFloat(I);var D=(" "+f[2]).slice(1);j.title=D||null,j.tagList.push(D?["INF",I,D]:["INF",I])}else if(f[3])Object(e.isFiniteNumber)(j.duration)&&(j.start=S,g&&(j.levelkey=g),j.sn=k,j.level=n,j.cc=E,j.urlId=h,y.push(j),j.relurl=(" "+f[3]).slice(1),b(j,O),O=j,S+=j.duration,k++,T=0,A=!0);else if(f[4]){var C=(" "+f[4]).slice(1);O?j.setByteRange(C,O):j.setByteRange(C)}else if(f[5])j.rawProgramDateTime=(" "+f[5]).slice(1),j.tagList.push(["PROGRAM-DATE-TIME",j.rawProgramDateTime]),-1===M&&(M=y.length);else{if(!(f=f[0].match(m))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(p=1;p<f.length&&void 0===f[p];p++);var R=(" "+f[p]).slice(1),P=(" "+f[p+1]).slice(1),L=f[p+2]?(" "+f[p+2]).slice(1):"";switch(R){case"PLAYLIST-TYPE":w.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":k=w.startSN=parseInt(P);break;case"SKIP":var N=new u.AttrList(P),U=N.decimalInteger("SKIPPED-SEGMENTS");if(Object(e.isFiniteNumber)(U)){w.skippedSegments=U;for(var F=U;F--;)y.unshift(null);k+=U}var G=N.enumeratedString("RECENTLY-REMOVED-DATERANGES");G&&(w.recentlyRemovedDateranges=G.split("\t"));break;case"TARGETDURATION":w.targetduration=parseFloat(P);break;case"VERSION":w.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":w.live=!1;break;case"#":(P||L)&&j.tagList.push(L?[P,L]:[P]);break;case"DIS":E++;case"GAP":j.tagList.push([R]);break;case"BITRATE":j.tagList.push([R,P]);break;case"DISCONTINUITY-SEQ":E=parseInt(P);break;case"KEY":var _,B=new u.AttrList(P),q=B.enumeratedString("METHOD"),X=B.URI,W=B.hexadecimalInteger("IV"),z=B.enumeratedString("KEYFORMATVERSIONS"),V=B.enumeratedString("KEYID"),H=null!=(_=B.enumeratedString("KEYFORMAT"))?_:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(H)>-1){c.logger.warn("Keyformat "+H+" is not supported from the manifest");continue}if("identity"!==H)continue;q&&(g=a.LevelKey.fromURL(i,X),X&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(q)>=0&&(g.method=q,g.keyFormat=H,V&&(g.keyID=V),z&&(g.keyFormatVersions=z),g.iv=W));break;case"START":var J=new u.AttrList(P).decimalFloatingPoint("TIME-OFFSET");Object(e.isFiniteNumber)(J)&&(w.startTimeOffset=J);break;case"MAP":var K=new u.AttrList(P);j.relurl=K.URI,K.BYTERANGE&&j.setByteRange(K.BYTERANGE),j.level=n,j.sn="initSegment",g&&(j.levelkey=g),j.initSegment=null,x=j,A=!0;break;case"SERVER-CONTROL":var $=new u.AttrList(P);w.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),w.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),w.canSkipDateRanges=w.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),w.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),w.holdBack=$.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Y=new u.AttrList(P);w.partTarget=Y.decimalFloatingPoint("PART-TARGET");break;case"PART":var Q=w.partList;Q||(Q=w.partList=[]);var Z=T>0?Q[Q.length-1]:void 0,tt=T++,it=new s.Part(new u.AttrList(P),j,i,tt,Z);Q.push(it),j.duration+=it.duration;break;case"PRELOAD-HINT":var nt=new u.AttrList(P);w.preloadHint=nt;break;case"RENDITION-REPORT":var et=new u.AttrList(P);w.renditionReports=w.renditionReports||[],w.renditionReports.push(et);break;default:c.logger.warn("line parsed but not handled: "+f)}}}O&&!O.relurl?(y.pop(),S-=O.duration,w.partList&&(w.fragmentHint=O)):w.partList&&(b(j,O),j.cc=E,w.fragmentHint=j);var rt=y.length,st=y[0],ot=y[rt-1];if((S+=w.skippedSegments*w.targetduration)>0&&rt&&ot){w.averagetargetduration=S/rt;var at=ot.sn;w.endSN="initSegment"!==at?at:0,st&&(w.startCC=st.cc,st.initSegment||w.fragments.every((function(t){return t.relurl&&v.test(null!=(i=null===(n=r.parseURL(t.relurl))||void 0===n?void 0:n.path)?i:"");var i,n}))&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(j=new s.Fragment(l,i)).relurl=ot.relurl,j.level=n,j.sn="initSegment",st.initSegment=j,w.needSidxRanges=!0))}else w.endSN=0,w.startCC=0;return w.fragmentHint&&(S+=w.fragmentHint.duration),w.totalduration=S,w.endCC=E,M>0&&function(t,i){for(var n=t[i],e=i;e--;){var r=t[e];if(!r)return;r.programDateTime=n.programDateTime-1e3*r.duration,n=r}}(y,M),w},t}();function g(t,i){["video","audio","text"].forEach((function(n){var e=t.filter((function(t){return Object(l.isCodecType)(t,n)}));if(e.length){var r=e.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));i[n+"Codec"]=r.length>0?r[0]:e[0],t=t.filter((function(t){return-1===e.indexOf(t)}))}})),i.unknownCodecs=t}function w(t,i,n){var e=i[n];e&&(t[n]=e)}function b(t,i){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=i&&i.programDateTime&&(t.programDateTime=i.endProgramDateTime),Object(e.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/playlist-loader.ts ***!
  \***************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../events */"./src/events.ts"),s=n(/*! ../errors */"./src/errors.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),u=n(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts"),c=n(/*! ../types/loader */"./src/types/loader.ts"),l=n(/*! ../utils/attr-list */"./src/utils/attr-list.ts");function h(t,i){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=i.url),n}i.default=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var i=t.prototype;return i.registerListeners=function(){var t=this.hls;t.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(r.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(r.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},i.unregisterListeners=function(){var t=this.hls;t.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(r.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(r.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},i.createInternalLoader=function(t){var i=this.hls.config,n=new(i.pLoader||i.loader)(i);return t.loader=n,this.loaders[t.type]=n,n},i.getInternalLoader=function(t){return this.loaders[t.type]},i.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},i.destroyInternalLoaders=function(){for(var t in this.loaders){var i=this.loaders[t];i&&i.destroy(),this.resetInternalLoader(t)}},i.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},i.onManifestLoading=function(t,i){this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:i.url,deliveryDirectives:null})},i.onLevelLoading=function(t,i){this.load({id:i.id,groupId:null,level:i.level,responseType:"text",type:c.PlaylistContextType.LEVEL,url:i.url,deliveryDirectives:i.deliveryDirectives})},i.onAudioTrackLoading=function(t,i){this.load({id:i.id,groupId:i.groupId,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:i.url,deliveryDirectives:i.deliveryDirectives})},i.onSubtitleTrackLoading=function(t,i){this.load({id:i.id,groupId:i.groupId,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:i.url,deliveryDirectives:i.deliveryDirectives})},i.load=function(t){var i,n,e,r,s,a,u=this.hls.config,l=this.getInternalLoader(t);if(l){var h=l.context;if(h&&h.url===t.url)return void o.logger.trace("[playlist-loader]: playlist request ongoing");o.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),l.abort()}switch(t.type){case c.PlaylistContextType.MANIFEST:n=u.manifestLoadingMaxRetry,e=u.manifestLoadingTimeOut,r=u.manifestLoadingRetryDelay,s=u.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:n=0,e=u.levelLoadingTimeOut;break;default:n=u.levelLoadingMaxRetry,e=u.levelLoadingTimeOut,r=u.levelLoadingRetryDelay,s=u.levelLoadingMaxRetryTimeout}if(l=this.createInternalLoader(t),null!==(i=t.deliveryDirectives)&&void 0!==i&&i.part&&(t.type===c.PlaylistContextType.LEVEL&&null!==t.level?a=this.hls.levels[t.level].details:t.type===c.PlaylistContextType.AUDIO_TRACK&&null!==t.id?a=this.hls.audioTracks[t.id].details:t.type===c.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(a=this.hls.subtitleTracks[t.id].details),a)){var f=a.partTarget,d=a.targetduration;f&&d&&(e=Math.min(1e3*Math.max(3*f,.8*d),e))}var m={timeout:e,maxRetry:n,retryDelay:r,maxRetryDelay:s,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(t,m,v)},i.loadsuccess=function(t,i,n,e){if(void 0===e&&(e=null),n.isSidxRequest)return this.handleSidxRequest(t,n),void this.handlePlaylistLoaded(t,i,n,e);this.resetInternalLoader(n.type);var r=t.data;0===r.indexOf("#EXTM3U")?(i.parsing.start=performance.now(),r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,i,n,e):this.handleMasterPlaylist(t,i,n,e)):this.handleManifestParsingError(t,n,"no EXTM3U delimiter",e)},i.loaderror=function(t,i,n){void 0===n&&(n=null),this.handleNetworkError(i,n,!1,t)},i.loadtimeout=function(t,i,n){void 0===n&&(n=null),this.handleNetworkError(i,n,!0)},i.handleMasterPlaylist=function(t,i,n,e){var s=this.hls,a=t.data,c=h(t,n),f=u.default.parseMasterPlaylist(a,c),d=f.levels,m=f.sessionData;if(d.length){var v=d.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),p=d.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),g=u.default.parseMasterPlaylistMedia(a,c,"AUDIO",v),w=u.default.parseMasterPlaylistMedia(a,c,"SUBTITLES",p),b=u.default.parseMasterPlaylistMedia(a,c,"CLOSED-CAPTIONS");g.length&&(g.some((function(t){return!t.url}))||!d[0].audioCodec||d[0].attrs.AUDIO||(o.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new l.AttrList({}),bitrate:0,url:""}))),s.trigger(r.Events.MANIFEST_LOADED,{levels:d,audioTracks:g,subtitles:w,captions:b,url:c,stats:i,networkDetails:e,sessionData:m})}else this.handleManifestParsingError(t,n,"no level found in manifest",e)},i.handleTrackOrLevelPlaylist=function(t,i,n,o){var a=this.hls,f=n.id,d=n.level,m=n.type,v=h(t,n),p=Object(e.isFiniteNumber)(f)?f:0,g=Object(e.isFiniteNumber)(d)?d:p,w=function(t){switch(t.type){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}(n),b=u.default.parseLevelPlaylist(t.data,v,g,w,p);if(b.fragments.length){if(m===c.PlaylistContextType.MANIFEST){var y={attrs:new l.AttrList({}),bitrate:0,details:b,name:"",url:v};a.trigger(r.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:v,stats:i,networkDetails:o,sessionData:null})}if(i.parsing.end=performance.now(),b.needSidxRanges){var x,k=null===(x=b.fragments[0].initSegment)||void 0===x?void 0:x.url;this.load({url:k,isSidxRequest:!0,type:m,level:d,levelDetails:b,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=b,this.handlePlaylistLoaded(t,i,n,o)}else a.trigger(r.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},i.handleSidxRequest=function(t,i){var n=Object(a.parseSegmentIndex)(new Uint8Array(t.data));if(n){var e=i.levelDetails;n.references.forEach((function(t,i){var r=t.info,s=e.fragments[i];0===s.byteRange.length&&s.setByteRange(String(1+r.end-r.start)+"@"+String(r.start)),s.initSegment&&s.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}))}},i.handleManifestParsingError=function(t,i,n,e){this.hls.trigger(r.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:i.type===c.PlaylistContextType.MANIFEST,url:t.url,reason:n,response:t,context:i,networkDetails:e})},i.handleNetworkError=function(t,i,n,e){void 0===n&&(n=!1),o.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var a=s.ErrorDetails.UNKNOWN,u=!1,l=this.getInternalLoader(t);switch(t.type){case c.PlaylistContextType.MANIFEST:a=n?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case c.PlaylistContextType.LEVEL:a=n?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case c.PlaylistContextType.AUDIO_TRACK:a=n?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:a=n?s.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:s.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}l&&this.resetInternalLoader(t.type);var h={type:s.ErrorTypes.NETWORK_ERROR,details:a,fatal:u,url:t.url,loader:l,context:t,networkDetails:i};e&&(h.response=e),this.hls.trigger(r.Events.ERROR,h)},i.handlePlaylistLoaded=function(t,i,n,e){var s=n.type,o=n.level,a=n.id,u=n.groupId,l=n.loader,h=n.levelDetails,f=n.deliveryDirectives;if(null!=h&&h.targetduration){if(l)switch(h.live&&(l.getCacheAge&&(h.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(h.ageHeader)||(h.ageHeader=0)),s){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(r.Events.LEVEL_LOADED,{details:h,level:o||0,id:a||0,stats:i,networkDetails:e,deliveryDirectives:f});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(r.Events.AUDIO_TRACK_LOADED,{details:h,id:a||0,groupId:u||"",stats:i,networkDetails:e,deliveryDirectives:f});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(r.Events.SUBTITLE_TRACK_LOADED,{details:h,id:a||0,groupId:u||"",stats:i,networkDetails:e,deliveryDirectives:f})}}else this.handleManifestParsingError(t,n,"invalid target duration",e)},t}()},"./src/polyfills/number.ts":
/*!*********************************!*\
  !*** ./src/polyfills/number.ts ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(t,i,n){n.r(i),n.d(i,"isFiniteNumber",(function(){return e})),n.d(i,"MAX_SAFE_INTEGER",(function(){return r}));var e=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},r=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
  !*** ./src/remux/aac-helper.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i),i.default=function(){function t(){}return t.getSilentFrame=function(t,i){switch(t){case"mp4a.40.2":if(1===i)return new Uint8Array([0,200,0,128,35,128]);if(2===i)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===i)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===i)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===i)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}()},"./src/remux/mp4-generator.ts":
/*!************************************!*\
  !*** ./src/remux/mp4-generator.ts ***!
  \************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=Math.pow(2,32)-1,r=function(){function t(){}return t.init=function(){var i;for(i in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})t.types.hasOwnProperty(i)&&(t.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:e};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,u,o,a),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,r))},t.box=function(t){for(var i=8,n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];for(var s=e.length,o=s;s--;)i+=e[s].byteLength;var a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(t,4),s=0,i=8;s<o;s++)a.set(e[s],i),i+=e[s].byteLength;return a},t.hdlr=function(i){return t.box(t.types.hdlr,t.HDLR_TYPES[i])},t.mdat=function(i){return t.box(t.types.mdat,i)},t.mdhd=function(i,n){n*=i;var r=Math.floor(n/(e+1)),s=Math.floor(n%(e+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},t.mdia=function(i){return t.box(t.types.mdia,t.mdhd(i.timescale,i.duration),t.hdlr(i.type),t.minf(i))},t.mfhd=function(i){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]))},t.minf=function(i){return t.box(t.types.minf,"audio"===i.type?t.box(t.types.smhd,t.SMHD):t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(i))},t.moof=function(i,n,e){return t.box(t.types.moof,t.mfhd(i),t.traf(e,n))},t.moov=function(i){for(var n=i.length,e=[];n--;)e[n]=t.trak(i[n]);return t.box.apply(null,[t.types.moov,t.mvhd(i[0].timescale,i[0].duration)].concat(e).concat(t.mvex(i)))},t.mvex=function(i){for(var n=i.length,e=[];n--;)e[n]=t.trex(i[n]);return t.box.apply(null,[t.types.mvex].concat(e))},t.mvhd=function(i,n){n*=i;var r=Math.floor(n/(e+1)),s=Math.floor(n%(e+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(i){var n,e,r=i.samples||[],s=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)s[n+4]=(e=r[n].flags).dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(i){return t.box(t.types.stbl,t.stsd(i),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(i){var n,e,r,s=[],o=[];for(n=0;n<i.sps.length;n++)s.push((r=(e=i.sps[n]).byteLength)>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(e));for(n=0;n<i.pps.length;n++)o.push((r=(e=i.pps[n]).byteLength)>>>8&255),o.push(255&r),o=o.concat(Array.prototype.slice.call(e));var a=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|i.sps.length].concat(s).concat([i.pps.length]).concat(o))),u=i.width,c=i.height,l=i.pixelRatio[0],h=i.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var i=t.config.length;return new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t.config).concat([6,1,2]))},t.mp4a=function(i){var n=i.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(i)))},t.mp3=function(i){var n=i.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(i){return t.box(t.types.stsd,t.STSD,"audio"===i.type?i.isAAC||"mp3"!==i.codec?t.mp4a(i):t.mp3(i):t.avc1(i))},t.tkhd=function(i){var n=i.id,r=i.duration*i.timescale,s=i.width,o=i.height,a=Math.floor(r/(e+1)),u=Math.floor(r%(e+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,o>>8&255,255&o,0,0]))},t.traf=function(i,n){var r=t.sdtp(i),s=i.id,o=Math.floor(n/(e+1)),a=Math.floor(n%(e+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(i,r.length+16+20+8+16+8+8),r)},t.trak=function(i){return i.duration=i.duration||4294967295,t.box(t.types.trak,t.tkhd(i),t.mdia(i))},t.trex=function(i){var n=i.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(i,n){var e,r,s,o,a,u,c=i.samples||[],l=c.length,h=12+16*l,f=new Uint8Array(h);for(f.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,(n+=8+h)>>>24&255,n>>>16&255,n>>>8&255,255&n],0),e=0;e<l;e++)f.set([(s=(r=c[e]).duration)>>>24&255,s>>>16&255,s>>>8&255,255&s,(o=r.size)>>>24&255,o>>>16&255,o>>>8&255,255&o,(a=r.flags).isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,(u=r.cts)>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*e);return t.box(t.types.trun,f)},t.initSegment=function(i){t.types||t.init();var n=t.moov(i),e=new Uint8Array(t.FTYP.byteLength+n.byteLength);return e.set(t.FTYP),e.set(n,t.FTYP.byteLength),e},t}();r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP=void 0,r.DINF=void 0,i.default=r},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
  !*** ./src/remux/mp4-remuxer.ts ***!
  \**********************************/
/*! exports provided: default, normalizePts */function(t,i,n){n.r(i),n.d(i,"default",(function(){return v})),n.d(i,"normalizePts",(function(){return p}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ./aac-helper */"./src/remux/aac-helper.ts"),s=n(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),o=n(/*! ../events */"./src/events.ts"),a=n(/*! ../errors */"./src/errors.ts"),u=n(/*! ../utils/logger */"./src/utils/logger.ts"),c=n(/*! ../types/loader */"./src/types/loader.ts"),l=n(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function h(){return(h=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}var f=null,d=null,m=!1,v=function(){function t(t,i,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=i,this.typeSupported=n,this.ISGenerated=!1,null===f){var e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);f=e?parseInt(e[1]):0}if(null===d){var r=navigator.userAgent.match(/Safari\/(\d+)/i);d=r?parseInt(r[1]):0}m=!!f&&f<75||!!d&&d<600}var i=t.prototype;return i.destroy=function(){},i.resetTimeStamp=function(t){u.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},i.resetNextTimestamp=function(){u.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},i.resetInitSegment=function(){u.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},i.getVideoStartPts=function(t){var i=!1,n=t.reduce((function(t,n){var e=n.pts-t;return e<-4294967296?(i=!0,p(t,n.pts)):e>0?t:n.pts}),t[0].pts);return i&&u.logger.debug("PTS rollover detected"),n},i.remux=function(t,i,n,e,r,s,o,a){var l,h,f,d,m,v,g=r,w=r,b=i.pid>-1,y=i.samples.length,x=t.samples.length>0,k=y>1;if((!(t.pid>-1)||x)&&(!b||k)||this.ISGenerated||o){this.ISGenerated||(f=this.generateIS(t,i,r));var T=this.isVideoContiguous,S=-1;if(k&&(S=function(t){for(var i=0;i<t.length;i++)if(t[i].key)return i;return-1}(i.samples),!T&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,S>0){u.logger.warn("[mp4-remuxer]: Dropped "+S+" out of "+y+" video samples due to a missing keyframe");var E=this.getVideoStartPts(i.samples);i.samples=i.samples.slice(S),i.dropped+=S,w+=(i.samples[0].pts-E)/(i.timescale||9e4)}else-1===S&&(u.logger.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),v=!1);if(this.ISGenerated){if(x&&k){var O=this.getVideoStartPts(i.samples),j=(p(t.samples[0].pts,O)-O)/i.inputTimeScale;g+=Math.max(0,j),w+=Math.max(0,-j)}if(x){if(t.samplerate||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(t,i,r)),h=this.remuxAudio(t,g,this.isAudioContiguous,s,b||k||a===c.PlaylistLevelType.AUDIO?w:void 0),k){var M=h?h.endPTS-h.startPTS:0;i.inputTimeScale||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(t,i,r)),l=this.remuxVideo(i,w,T,M)}}else k&&(l=this.remuxVideo(i,w,T,0));l&&(l.firstKeyFrame=S,l.independent=-1!==S)}}return this.ISGenerated&&(n.samples.length&&(m=this.remuxID3(n,r)),e.samples.length&&(d=this.remuxText(e,r))),{audio:h,video:l,initSegment:f,independent:v,text:d,id3:m}},i.generateIS=function(t,i,n){var r,o,a,u=t.samples,c=i.samples,l=this.typeSupported,h={},f=!Object(e.isFiniteNumber)(this._initPTS),d="audio/mp4";if(f&&(r=o=1/0),t.config&&u.length&&(t.timescale=t.samplerate,t.isAAC||(l.mpeg?(d="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),h.audio={id:"audio",container:d,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array(0):s.default.initSegment([t]),metadata:{channelCount:t.channelCount}},f&&(a=t.inputTimeScale,r=o=u[0].pts-Math.round(a*n))),i.sps&&i.pps&&c.length&&(i.timescale=i.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:i.codec,initSegment:s.default.initSegment([i]),metadata:{width:i.width,height:i.height}},f)){a=i.inputTimeScale;var m=this.getVideoStartPts(c),v=Math.round(a*n);o=Math.min(o,p(c[0].dts,m)-v),r=Math.min(r,m-v)}if(Object.keys(h).length)return this.ISGenerated=!0,f&&(this._initPTS=r,this._initDTS=o),{tracks:h,initPTS:r,timescale:a}},i.remuxVideo=function(t,i,n,e){var r,c,d,v=t.inputTimeScale,w=t.samples,b=[],y=w.length,x=this._initPTS,k=this.nextAvcDts,T=8,S=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,O=0,j=!1;n&&null!==k||(k=i*v-(w[0].pts-p(w[0].dts,w[0].pts)));for(var M=0;M<y;M++){var A=w[M];A.pts=p(A.pts-x,k),A.dts=p(A.dts-x,k),A.dts>A.pts&&(O=Math.max(Math.min(O,A.pts-A.dts),-18e3)),A.dts<w[M>0?M-1:M].dts&&(j=!0)}j&&w.sort((function(t,i){return t.dts-i.dts||t.pts-i.pts})),c=w[0].dts,d=w[w.length-1].dts;var I=Math.round((d-c)/(y-1));if(O<0){if(O<-2*I){u.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(l.toMsFromMpegTsClock)(-I,!0)+" ms");for(var D=O,C=0;C<y;C++)w[C].dts=D=Math.max(D,w[C].pts-I),w[C].pts=Math.max(D,w[C].pts)}else{u.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(l.toMsFromMpegTsClock)(O,!0)+" ms to overcome this issue");for(var R=0;R<y;R++)w[R].dts=w[R].dts+O}c=w[0].dts}if(n){var P=c-k,L=P>I;if(L||P<-1){u.logger.warn(L?"AVC: "+Object(l.toMsFromMpegTsClock)(P,!0)+" ms ("+P+"dts) hole between fragments detected, filling it":"AVC: "+Object(l.toMsFromMpegTsClock)(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected");var N=w[0].pts-P;w[0].dts=c=k,w[0].pts=N,u.logger.log("Video: First PTS/DTS adjusted: "+Object(l.toMsFromMpegTsClock)(N,!0)+"/"+Object(l.toMsFromMpegTsClock)(c,!0)+", delta: "+Object(l.toMsFromMpegTsClock)(P,!0)+" ms")}}m&&(c=Math.max(0,c));for(var U=0,F=0,G=0;G<y;G++){for(var _=w[G],B=_.units,q=B.length,X=0,W=0;W<q;W++)X+=B[W].data.length;F+=X,U+=q,_.length=X,_.dts=Math.max(_.dts,c),_.pts=Math.max(_.pts,_.dts,0),S=Math.min(_.pts,S),E=Math.max(_.pts,E)}d=w[y-1].dts;var z,V=F+4*U+8;try{z=new Uint8Array(V)}catch(t){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating video mdat "+V})}var H=new DataView(z.buffer);H.setUint32(0,V),z.set(s.default.types.mdat,4);for(var J=0;J<y;J++){for(var K=w[J],$=K.units,Y=0,Q=0,Z=$.length;Q<Z;Q++){var tt=$[Q],it=tt.data,nt=tt.data.byteLength;H.setUint32(T,nt),z.set(it,T+=4),T+=nt,Y+=4+nt}if(J<y-1)r=w[J+1].dts-K.dts;else{var et=this.config,rt=K.dts-w[J>0?J-1:J].dts;if(et.stretchShortVideoTrack&&null!==this.nextAudioPts){var st=Math.floor(et.maxBufferHole*v),ot=(e?S+e*v:this.nextAudioPts)-K.pts;ot>st?((r=ot-rt)<0&&(r=rt),u.logger.log("[mp4-remuxer]: It is approximately "+ot/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=rt}else r=rt}var at=Math.round(K.pts-K.dts);b.push(new g(K.key,r,Y,at))}if(b.length&&f&&f<70){var ut=b[0].flags;ut.dependsOn=2,ut.isNonSync=0}console.assert(void 0!==r,"mp4SampleDuration must be computed"),this.nextAvcDts=k=d+r,this.isVideoContiguous=!0;var ct={data1:s.default.moof(t.sequenceNumber++,c,h({},t,{samples:b})),data2:z,startPTS:S/v,endPTS:(E+r)/v,startDTS:c/v,endDTS:k/v,type:"video",hasAudio:!1,hasVideo:!0,nb:b.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(z.length,"MDAT length must not be zero"),ct},i.remuxAudio=function(t,i,n,e,c){var l=t.inputTimeScale,f=l/(t.samplerate?t.samplerate:l),d=t.isAAC?1024:1152,m=d*f,v=this._initPTS,w=!t.isAAC&&this.typeSupported.mpeg,b=[],y=t.samples,x=w?0:8,k=this.nextAudioPts||-1,T=i*l;if(this.isAudioContiguous=n=n||y.length&&k>0&&(e&&Math.abs(T-k)<9e3||Math.abs(p(y[0].pts-v,T)-k)<20*m),y.forEach((function(t){t.pts=p(t.pts-v,T)})),!n||k<0){if(!(y=y.filter((function(t){return t.pts>=0}))).length)return;k=0===c?0:e?Math.max(0,T):y[0].pts}if(t.isAAC)for(var S=void 0!==c,E=this.config.maxAudioFramesDrift,O=0,j=k;O<y.length;O++){var M=y[O],A=M.pts,I=A-j,D=Math.abs(1e3*I/l);if(I<=-E*m&&S)0===O&&(u.logger.warn("Audio frame @ "+(A/l).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*I/l)+" ms."),this.nextAudioPts=k=j=A);else if(I>=E*m&&D<1e4&&S){var C=Math.round(I/m);(j=A-C*m)<0&&(C--,j+=m),0===O&&(this.nextAudioPts=k=j),u.logger.warn("[mp4-remuxer]: Injecting "+C+" audio frame @ "+(j/l).toFixed(3)+"s due to "+Math.round(1e3*I/l)+" ms gap.");for(var R=0;R<C;R++){var P=Math.max(j,0),L=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);L||(u.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),L=M.unit.subarray()),y.splice(O,0,{unit:L,pts:P}),j+=m,O++}}M.pts=j,j+=m}for(var N,U=null,F=null,G=0,_=y.length;_--;)G+=y[_].unit.byteLength;for(var B=0,q=y.length;B<q;B++){var X=y[B],W=X.unit,z=X.pts;if(null!==F)b[B-1].duration=Math.round((z-F)/f);else{if(n&&t.isAAC&&(z=k),U=z,!(G>0))return;G+=x;try{N=new Uint8Array(G)}catch(t){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}w||(new DataView(N.buffer).setUint32(0,G),N.set(s.default.types.mdat,4))}N.set(W,x);var V=W.byteLength;x+=V,b.push(new g(!0,d,V,0)),F=z}var H=b.length;if(H){this.nextAudioPts=k=F+f*b[b.length-1].duration;var J=w?new Uint8Array(0):s.default.moof(t.sequenceNumber++,U/f,h({},t,{samples:b}));t.samples=[];var K=U/l,$=k/l,Y={data1:J,data2:N,startPTS:K,endPTS:$,startDTS:K,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:H};return this.isAudioContiguous=!0,console.assert(N.length,"MDAT length must not be zero"),Y}},i.remuxEmptyAudio=function(t,i,n,e){var s=t.inputTimeScale,o=this.nextAudioPts,a=(null!==o?o:e.startDTS*s)+this._initDTS,c=s/(t.samplerate?t.samplerate:s)*1024,l=Math.ceil((e.endDTS*s+this._initDTS-a)/c),h=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(u.logger.warn("[mp4-remuxer]: remux empty Audio"),h){for(var f=[],d=0;d<l;d++){var m=a+d*c;f.push({unit:h,pts:m,dts:m})}return t.samples=f,this.remuxAudio(t,i,n,!1)}u.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},i.remuxID3=function(t,i){var n=t.samples.length;if(n){for(var e=t.inputTimeScale,r=this._initPTS,s=this._initDTS,o=0;o<n;o++){var a=t.samples[o];a.pts=p(a.pts-r,i*e)/e,a.dts=p(a.dts-s,i*e)/e}var u=t.samples;return t.samples=[],{samples:u}}},i.remuxText=function(t,i){var n=t.samples.length;if(n){for(var e=t.inputTimeScale,r=this._initPTS,s=0;s<n;s++){var o=t.samples[s];o.pts=p(o.pts-r,i*e)/e}t.samples.sort((function(t,i){return t.pts-i.pts}));var a=t.samples;return t.samples=[],{samples:a}}},t}();function p(t,i){var n;if(null===i)return t;for(n=i<t?-8589934592:8589934592;Math.abs(t-i)>4294967296;)t+=n;return t}var g=function(t,i,n,e){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=i,this.size=n,this.cts=e,this.flags=new w(t)},w=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
  !*** ./src/remux/passthrough-remuxer.ts ***!
  \******************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),s=n(/*! ../loader/fragment */"./src/loader/fragment.ts"),o=n(/*! ../utils/logger */"./src/utils/logger.ts"),a=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var i=t.prototype;return i.destroy=function(){},i.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},i.resetNextTimestamp=function(){this.lastEndDTS=null},i.resetInitSegment=function(t,i,n){this.audioCodec=i,this.videoCodec=n,this.generateInitSegment(t),this.emitInitSegment=!0},i.generateInitSegment=function(t){var i=this.audioCodec,n=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var e=this.initData=Object(r.parseInitSegment)(t);i||(i=c(e.audio,s.ElementaryStreamTypes.AUDIO)),n||(n=c(e.video,s.ElementaryStreamTypes.VIDEO));var a={};e.audio&&e.video?a.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:t,id:"main"}:e.audio?a.audio={container:"audio/mp4",codec:i,initSegment:t,id:"audio"}:e.video?a.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},i.remux=function(t,i,n,s,a){var c=this.initPTS,l=this.lastEndDTS,h={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};Object(e.isFiniteNumber)(l)||(l=this.lastEndDTS=a||0);var f=i.samples;if(!f||!f.length)return h;var d={initPTS:void 0,timescale:1},m=this.initData;if(m&&m.length||(this.generateInitSegment(f),m=this.initData),!m||!m.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1),Object(e.isFiniteNumber)(c)||(this.initPTS=d.initPTS=c=u(m,f,l));var v=Object(r.getDuration)(f,m),p=l,g=v+p;Object(r.offsetStartDTS)(m,f,c),v>0?this.lastEndDTS=g:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var w=!!m.audio,b=!!m.video,y="";w&&(y+="audio"),b&&(y+="video");var x={data1:f,startPTS:p,startDTS:p,endPTS:g,endDTS:g,type:y,hasAudio:w,hasVideo:b,nb:1,dropped:0};return h.audio="audio"===x.type?x:void 0,h.video="audio"!==x.type?x:void 0,h.text=s,h.id3=n,h.initSegment=d,h},t}(),u=function(t,i,n){return Object(r.getStartDTS)(t,i)-n};function c(t,i){var n=null==t?void 0:t.codec;return n&&n.length>4?n:"hvc1"===n?"hvc1.1.c.L120.90":"av01"===n?"av01.0.04M.08":"avc1"===n||i===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}i.default=a},"./src/task-loop.ts":
/*!**************************!*\
  !*** ./src/task-loop.ts ***!
  \**************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return e}));var e=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var i=t.prototype;return i.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.onHandlerDestroyed=function(){},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},i.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},i.doTick=function(){},t}()},"./src/types/cmcd.ts":
/*!***************************!*\
  !*** ./src/types/cmcd.ts ***!
  \***************************/
/*! exports provided: CMCDVersion, CMCDObjectType, CMCDStreamingFormat, CMCDStreamType */function(t,i,n){n.r(i),n.d(i,"CMCDVersion",(function(){return o})),n.d(i,"CMCDObjectType",(function(){return e})),n.d(i,"CMCDStreamingFormat",(function(){return r})),n.d(i,"CMCDStreamType",(function(){return s}));var e,r,s,o=1;!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(e||(e={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(r||(r={})),function(t){t.VOD="v",t.LIVE="l"}(s||(s={}))},"./src/types/level.ts":
/*!****************************!*\
  !*** ./src/types/level.ts ***!
  \****************************/
/*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */function(t,i,n){function e(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var r;function s(t,i){var n=t.canSkipUntil;return n&&(void 0!==i?i-t.endSN:0)<n?t.canSkipDateRanges?r.v2:r.Yes:r.No}n.r(i),n.d(i,"HlsSkip",(function(){return r})),n.d(i,"getSkipValue",(function(){return s})),n.d(i,"HlsUrlParameters",(function(){return o})),n.d(i,"Level",(function(){return a})),function(t){t.No="",t.Yes="YES",t.v2="v2"}(r||(r={}));var o=function(){function t(t,i,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=i,this.skip=n}return t.prototype.addDirectives=function(t){var i=new self.URL(t);return void 0!==this.msn&&i.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&i.searchParams.set("_HLS_part",this.part.toString()),this.skip&&i.searchParams.set("_HLS_skip",this.skip),i.toString()},t}(),a=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var i,n;return i=t,(n=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&e(i.prototype,n),t}()},"./src/types/loader.ts":
/*!*****************************!*\
  !*** ./src/types/loader.ts ***!
  \*****************************/
/*! exports provided: PlaylistContextType, PlaylistLevelType */function(t,i,n){var e,r;n.r(i),n.d(i,"PlaylistContextType",(function(){return e})),n.d(i,"PlaylistLevelType",(function(){return r})),function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(e||(e={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(r||(r={}))},"./src/types/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/types/transmuxer.ts ***!
  \*********************************/
/*! exports provided: ChunkMetadata */function(t,i,n){n.r(i),n.d(i,"ChunkMetadata",(function(){return e}));var e=function(t,i,n,e,r,s){void 0===e&&(e=0),void 0===r&&(r=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=i,this.id=n,this.size=e,this.part=r,this.partial=s}},"./src/utils/attr-list.ts":
/*!********************************!*\
  !*** ./src/utils/attr-list.ts ***!
  \********************************/
/*! exports provided: AttrList */function(t,i,n){n.r(i),n.d(i,"AttrList",(function(){return s}));var e=/^(\d+)x(\d+)$/,r=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function t(i){for(var n in"string"==typeof i&&(i=t.parseAttrList(i)),i)i.hasOwnProperty(n)&&(this[n]=i[n])}var i=t.prototype;return i.decimalInteger=function(t){var i=parseInt(this[t],10);return i>Number.MAX_SAFE_INTEGER?1/0:i},i.hexadecimalInteger=function(t){if(this[t]){var i=(this[t]||"0x").slice(2);i=(1&i.length?"0":"")+i;for(var n=new Uint8Array(i.length/2),e=0;e<i.length/2;e++)n[e]=parseInt(i.slice(2*e,2*e+2),16);return n}return null},i.hexadecimalIntegerAsNumber=function(t){var i=parseInt(this[t],16);return i>Number.MAX_SAFE_INTEGER?1/0:i},i.decimalFloatingPoint=function(t){return parseFloat(this[t])},i.optionalFloat=function(t,i){var n=this[t];return n?parseFloat(n):i},i.enumeratedString=function(t){return this[t]},i.bool=function(t){return"YES"===this[t]},i.decimalResolution=function(t){var i=e.exec(this[t]);if(null!==i)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}},t.parseAttrList=function(t){var i,n={};for(r.lastIndex=0;null!==(i=r.exec(t));){var e=i[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),n[i[1]]=e}return n},t}()},"./src/utils/binary-search.ts":
/*!************************************!*\
  !*** ./src/utils/binary-search.ts ***!
  \************************************/
/*! exports provided: default */function(t,i,n){n.r(i),i.default={search:function(t,i){for(var n=0,e=t.length-1,r=null,s=null;n<=e;){var o=i(s=t[r=(n+e)/2|0]);if(o>0)n=r+1;else{if(!(o<0))return s;e=r-1}}return null}}},"./src/utils/buffer-helper.ts":
/*!************************************!*\
  !*** ./src/utils/buffer-helper.ts ***!
  \************************************/
/*! exports provided: BufferHelper */function(t,i,n){n.r(i),n.d(i,"BufferHelper",(function(){return s}));var e=n(/*! ./logger */"./src/utils/logger.ts"),r={length:0,start:function(){return 0},end:function(){return 0}},s=function(){function t(){}return t.isBuffered=function(i,n){try{if(i)for(var e=t.getBuffered(i),r=0;r<e.length;r++)if(n>=e.start(r)&&n<=e.end(r))return!0}catch(t){}return!1},t.bufferInfo=function(i,n,e){try{if(i){var r,s=t.getBuffered(i),o=[];for(r=0;r<s.length;r++)o.push({start:s.start(r),end:s.end(r)});return this.bufferedInfo(o,n,e)}}catch(t){}return{len:0,start:n,end:n,nextStart:void 0}},t.bufferedInfo=function(t,i,n){i=Math.max(0,i),t.sort((function(t,i){return t.start-i.start||i.end-t.end}));var e=[];if(n)for(var r=0;r<t.length;r++){var s=e.length;if(s){var o=e[s-1].end;t[r].start-o<n?t[r].end>o&&(e[s-1].end=t[r].end):e.push(t[r])}else e.push(t[r])}else e=t;for(var a,u=0,c=i,l=i,h=0;h<e.length;h++){var f=e[h].start,d=e[h].end;if(i+n>=f&&i<d)c=f,u=(l=d)-i;else if(i+n<f){a=f;break}}return{len:u,start:c||0,end:l||0,nextStart:a}},t.getBuffered=function(t){try{return t.buffered}catch(t){return e.logger.log("failed to get media.buffered",t),r}},t}()},"./src/utils/cea-608-parser.ts":
/*!*************************************!*\
  !*** ./src/utils/cea-608-parser.ts ***!
  \*************************************/
/*! exports provided: Row, CaptionScreen, default */function(t,i,n){n.r(i),n.d(i,"Row",(function(){return w})),n.d(i,"CaptionScreen",(function(){return b}));var e,r=n(/*! ../utils/logger */"./src/utils/logger.ts"),s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(t){var i=t;return s.hasOwnProperty(t)&&(i=s[t]),String.fromCharCode(i)},a=15,u=100,c={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(e||(e={}));var m=function(){function t(){this.time=null,this.verboseLevel=e.ERROR}return t.prototype.log=function(t,i){this.verboseLevel>=t&&r.logger.log(this.time+" ["+t+"] "+i)},t}(),v=function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].toString(16));return i},p=function(){function t(t,i,n,e,r){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=i||!1,this.italics=n||!1,this.background=e||"black",this.flash=r||!1}var i=t.prototype;return i.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},i.setStyles=function(t){for(var i=["foreground","underline","italics","background","flash"],n=0;n<i.length;n++){var e=i[n];t.hasOwnProperty(e)&&(this[e]=t[e])}},i.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},i.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},i.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},i.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),g=function(){function t(t,i,n,e,r,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new p(i,n,e,r,s)}var i=t.prototype;return i.reset=function(){this.uchar=" ",this.penState.reset()},i.setChar=function(t,i){this.uchar=t,this.penState.copy(i)},i.setPenState=function(t){this.penState.copy(t)},i.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},i.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},i.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),w=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<u;i++)this.chars.push(new g);this.logger=t,this.pos=0,this.currPenState=new p}var i=t.prototype;return i.equals=function(t){for(var i=!0,n=0;n<u;n++)if(!this.chars[n].equals(t.chars[n])){i=!1;break}return i},i.copy=function(t){for(var i=0;i<u;i++)this.chars[i].copy(t.chars[i])},i.isEmpty=function(){for(var t=!0,i=0;i<u;i++)if(!this.chars[i].isEmpty()){t=!1;break}return t},i.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(e.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(this.logger.log(e.DEBUG,"Too large cursor position "+this.pos),this.pos=u)},i.moveCursor=function(t){var i=this.pos+t;if(t>1)for(var n=this.pos+1;n<i+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(i)},i.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},i.insertChar=function(t){t>=144&&this.backSpace();var i=o(t);this.pos>=u?this.logger.log(e.ERROR,"Cannot insert "+t.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1))},i.clearFromPos=function(t){var i;for(i=t;i<u;i++)this.chars[i].reset()},i.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},i.clearToEndOfRow=function(){this.clearFromPos(this.pos)},i.getTextString=function(){for(var t=[],i=!0,n=0;n<u;n++){var e=this.chars[n].uchar;" "!==e&&(i=!1),t.push(e)}return i?"":t.join("")},i.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),b=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<a;i++)this.rows.push(new w(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var i=t.prototype;return i.reset=function(){for(var t=0;t<a;t++)this.rows[t].clear();this.currRow=14},i.equals=function(t){for(var i=!0,n=0;n<a;n++)if(!this.rows[n].equals(t.rows[n])){i=!1;break}return i},i.copy=function(t){for(var i=0;i<a;i++)this.rows[i].copy(t.rows[i])},i.isEmpty=function(){for(var t=!0,i=0;i<a;i++)if(!this.rows[i].isEmpty()){t=!1;break}return t},i.backSpace=function(){this.rows[this.currRow].backSpace()},i.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},i.insertChar=function(t){this.rows[this.currRow].insertChar(t)},i.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},i.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},i.setCursor=function(t){this.logger.log(e.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},i.setPAC=function(t){this.logger.log(e.INFO,"pacData = "+JSON.stringify(t));var i=t.row-1;if(this.nrRollUpRows&&i<this.nrRollUpRows-1&&(i=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==i){for(var n=0;n<a;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var o=s.rows[r].cueStartTime,u=this.logger.time;if(o&&null!==u&&o<u)for(var c=0;c<this.nrRollUpRows;c++)this.rows[i-this.nrRollUpRows+c+1].copy(s.rows[r+c])}}this.currRow=i;var l=this.rows[this.currRow];if(null!==t.indent){var h=Math.max(t.indent-1,0);l.setCursor(t.indent),t.color=l.chars[h].penState.foreground}this.setPen({foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1})},i.setBkgData=function(t){this.logger.log(e.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},i.setRollUpRows=function(t){this.nrRollUpRows=t},i.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(e.TEXT,this.getDisplayText());var t=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(e.INFO,"Rolling up")}else this.logger.log(e.DEBUG,"roll_up but nrRollUpRows not set yet")},i.getDisplayText=function(t){t=t||!1;for(var i=[],n="",e=0;e<a;e++){var r=this.rows[e].getTextString();r&&i.push(t?"Row "+(e+1)+": '"+r+"'":r.trim())}return i.length>0&&(n=t?"["+i.join(" | ")+"]":i.join("\n")),n},i.getTextAndFormat=function(){return this.rows},t}(),y=function(){function t(t,i,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new b(n),this.nonDisplayedMemory=new b(n),this.lastOutputScreen=new b(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var i=t.prototype;return i.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},i.getHandler=function(){return this.outputFilter},i.setHandler=function(t){this.outputFilter=t},i.setPAC=function(t){this.writeScreen.setPAC(t)},i.setBkgData=function(t){this.writeScreen.setBkgData(t)},i.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(e.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},i.insertChars=function(t){for(var i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);this.logger.log(e.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(e.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},i.ccRCL=function(){this.logger.log(e.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},i.ccBS=function(){this.logger.log(e.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},i.ccAOF=function(){},i.ccAON=function(){},i.ccDER=function(){this.logger.log(e.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},i.ccRU=function(t){this.logger.log(e.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},i.ccFON=function(){this.logger.log(e.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},i.ccRDC=function(){this.logger.log(e.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},i.ccTR=function(){this.logger.log(e.INFO,"TR"),this.setMode("MODE_TEXT")},i.ccRTD=function(){this.logger.log(e.INFO,"RTD"),this.setMode("MODE_TEXT")},i.ccEDM=function(){this.logger.log(e.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},i.ccCR=function(){this.logger.log(e.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},i.ccENM=function(){this.logger.log(e.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},i.ccEOC=function(){if(this.logger.log(e.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(e.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},i.ccTO=function(t){this.logger.log(e.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},i.ccMIDROW=function(t){var i={flash:!1};if(i.underline=t%2==1,i.italics=t>=46,i.italics)i.foreground="white";else{var n=Math.floor(t/2)-16;i.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(e.INFO,"MIDROW: "+JSON.stringify(i)),this.writeScreen.setPen(i)},i.outputDataUpdate=function(t){void 0===t&&(t=!1);var i=this.logger.time;null!==i&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,i,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:i):this.cueStartTime=i,this.lastOutputScreen.copy(this.displayedMemory))},i.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}();function x(t,i,n){n.a=t,n.b=i}function k(t,i,n){return n.a===t&&n.b===i}i.default=function(){function t(t,i,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var e=new m;this.channels=[null,new y(t,i,e),new y(t+1,n,e)],this.cmdHistory={a:null,b:null},this.logger=e}var i=t.prototype;return i.getHandler=function(t){return this.channels[t].getHandler()},i.setHandler=function(t,i){this.channels[t].setHandler(i)},i.addData=function(t,i){var n,r,s,o=!1;this.logger.time=t;for(var a=0;a<i.length;a+=2)if(s=127&i[a+1],0!=(r=127&i[a])||0!==s){if(this.logger.log(e.DATA,"["+v([i[a],i[a+1]])+"] -> ("+v([r,s])+")"),(n=this.parseCmd(r,s))||(n=this.parseMidrow(r,s)),n||(n=this.parsePAC(r,s)),n||(n=this.parseBackgroundAttributes(r,s)),!n&&(o=this.parseChars(r,s))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(e.WARNING,"No channel found yet. TEXT-MODE?")}n||o||this.logger.log(e.WARNING,"Couldn't parse cleaned data "+v([r,s])+" orig: "+v([i[a],i[a+1]]))}},i.parseCmd=function(t,i){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&i>=32&&i<=47||(23===t||31===t)&&i>=33&&i<=35))return!1;if(k(t,i,n))return x(null,null,n),this.logger.log(e.DEBUG,"Repeated command ("+v([t,i])+") is dropped"),!0;var r=20===t||21===t||23===t?1:2,s=this.channels[r];return 20===t||21===t||28===t||29===t?32===i?s.ccRCL():33===i?s.ccBS():34===i?s.ccAOF():35===i?s.ccAON():36===i?s.ccDER():37===i?s.ccRU(2):38===i?s.ccRU(3):39===i?s.ccRU(4):40===i?s.ccFON():41===i?s.ccRDC():42===i?s.ccTR():43===i?s.ccRTD():44===i?s.ccEDM():45===i?s.ccCR():46===i?s.ccENM():47===i&&s.ccEOC():s.ccTO(i-32),x(t,i,n),this.currentChannel=r,!0},i.parseMidrow=function(t,i){var n=0;if((17===t||25===t)&&i>=32&&i<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(e.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(i),this.logger.log(e.DEBUG,"MIDROW ("+v([t,i])+")"),!0)}return!1},i.parsePAC=function(t,i){var n=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&i>=64&&i<=127||(16===t||24===t)&&i>=64&&i<=95))return!1;if(k(t,i,n))return x(null,null,n),!0;var e=t<=23?1:2,r=this.channels[e];return!!r&&(r.setPAC(this.interpretPAC(i>=64&&i<=95?1===e?c[t]:h[t]:1===e?l[t]:f[t],i)),x(t,i,n),this.currentChannel=e,!0)},i.interpretPAC=function(t,i){var n,e={color:null,italics:!1,indent:null,underline:!1,row:t};return e.underline=1==(1&(n=i>95?i-96:i-64)),n<=13?e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(e.italics=!0,e.color="white"):e.indent=4*Math.floor((n-16)/2),e},i.parseChars=function(t,i){var n,r,s=null,a=null;if(t>=25?(n=2,a=t-8):(n=1,a=t),a>=17&&a<=19?(this.logger.log(e.INFO,"Special char '"+o(r=17===a?i+80:18===a?i+112:i+144)+"' in channel "+n),s=[r]):t>=32&&t<=127&&(s=0===i?[t]:[t,i]),s){var u=v(s);this.logger.log(e.DEBUG,"Char codes =  "+u.join(",")),x(t,i,this.cmdHistory)}return s},i.parseBackgroundAttributes=function(t,i){var n;if(!((16===t||24===t)&&i>=32&&i<=47||(23===t||31===t)&&i>=45&&i<=47))return!1;var e={};return 16===t||24===t?(n=Math.floor((i-32)/2),e.background=d[n],i%2==1&&(e.background=e.background+"_semi")):45===i?e.background="transparent":(e.foreground="black",47===i&&(e.underline=!0)),this.channels[t<=23?1:2].setBkgData(e),x(t,i,this.cmdHistory),!0},i.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var i=this.channels[t];i&&i.reset()}this.cmdHistory={a:null,b:null}},i.cueSplitAtTime=function(t){for(var i=0;i<this.channels.length;i++){var n=this.channels[i];n&&n.cueSplitAtTime(t)}},t}()},"./src/utils/codecs.ts":
/*!*****************************!*\
  !*** ./src/utils/codecs.ts ***!
  \*****************************/
/*! exports provided: isCodecType, isCodecSupportedInMp4 */function(t,i,n){n.r(i),n.d(i,"isCodecType",(function(){return r})),n.d(i,"isCodecSupportedInMp4",(function(){return s}));var e={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function r(t,i){var n=e[i];return!!n&&!0===n[t.slice(0,4)]}function s(t,i){return MediaSource.isTypeSupported((i||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":
/*!***************************!*\
  !*** ./src/utils/cues.ts ***!
  \***************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ./vttparser */"./src/utils/vttparser.ts"),r=n(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts"),s=n(/*! ./texttrack-utils */"./src/utils/texttrack-utils.ts"),o=/\s/;i.default={newCue:function(t,i,n,a){for(var u,c,l,h,f,d=[],m=self.VTTCue||self.TextTrackCue,v=0;v<a.rows.length;v++)if(l=!0,h=0,f="",!(u=a.rows[v]).isEmpty()){for(var p=0;p<u.chars.length;p++)o.test(u.chars[p].uchar)&&l?h++:(f+=u.chars[p].uchar,l=!1);u.cueStartTime=i,i===n&&(n+=1e-4),h>=16?h--:h++;var g=Object(e.fixLineBreaks)(f.trim()),w=Object(r.generateCueId)(i,n,g);t&&t.cues&&t.cues.getCueById(w)||((c=new m(i,n,g)).id=w,c.line=v+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*h/32)),d.push(c))}return t&&d.length&&(d.sort((function(t,i){return"auto"===t.line||"auto"===i.line?0:t.line>8&&i.line>8?i.line-t.line:t.line-i.line})),d.forEach((function(i){return Object(s.addCueToTrack)(t,i)}))),d}}},"./src/utils/discontinuities.ts":
/*!**************************************!*\
  !*** ./src/utils/discontinuities.ts ***!
  \**************************************/
/*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT, alignFragmentByPDTDelta, alignMediaPlaylistByPDT */function(t,i,n){n.r(i),n.d(i,"findFirstFragWithCC",(function(){return o})),n.d(i,"shouldAlignOnDiscontinuities",(function(){return a})),n.d(i,"findDiscontinuousReferenceFrag",(function(){return u})),n.d(i,"adjustSlidingStart",(function(){return l})),n.d(i,"alignStream",(function(){return h})),n.d(i,"alignPDT",(function(){return f})),n.d(i,"alignFragmentByPDTDelta",(function(){return d})),n.d(i,"alignMediaPlaylistByPDT",(function(){return m}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ./logger */"./src/utils/logger.ts"),s=n(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function o(t,i){for(var n=null,e=0,r=t.length;e<r;e++){var s=t[e];if(s&&s.cc===i){n=s;break}}return n}function a(t,i,n){return!(!i.details||!(n.endCC>n.startCC||t&&t.cc<n.startCC))}function u(t,i){var n=t.fragments,e=i.fragments;if(e.length&&n.length){var s=o(n,e[0].cc);if(s&&(!s||s.startPTS))return s;r.logger.log("No frag in previous level to align on")}else r.logger.log("No fragments to align")}function c(t,i){if(t){var n=t.start+i;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function l(t,i){for(var n=i.fragments,e=0,r=n.length;e<r;e++)c(n[e],t);i.fragmentHint&&c(i.fragmentHint,t),i.alignedSliding=!0}function h(t,i,n){i&&(function(t,i,n){if(a(t,n,i)){var s=u(n.details,i);s&&Object(e.isFiniteNumber)(s.start)&&(r.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),l(s.start,i))}}(t,n,i),!n.alignedSliding&&i.details&&f(n,i.details),n.alignedSliding||!i.details||n.skippedSegments||Object(s.adjustSliding)(i.details,n))}function f(t,i){if(i.fragments.length&&t.hasProgramDateTime&&i.hasProgramDateTime){var n=i.fragments[0].programDateTime,s=t.fragments[0].programDateTime,o=(s-n)/1e3+i.fragments[0].start;o&&Object(e.isFiniteNumber)(o)&&(r.logger.log("Adjusting PTS using programDateTime delta "+(s-n)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),l(o,t))}}function d(t,i){var n=t.programDateTime;if(n){var e=(n-i)/1e3;t.start=t.startPTS=e,t.endPTS=e+t.duration}}function m(t,i){if(i.fragments.length&&t.hasProgramDateTime&&i.hasProgramDateTime){var n=i.fragments[0].programDateTime-1e3*i.fragments[0].start;t.fragments.forEach((function(t){d(t,n)})),t.fragmentHint&&d(t.fragmentHint,n),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
  !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
  \***********************************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../utils/ewma */"./src/utils/ewma.ts");i.default=function(){function t(t,i,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new e.default(t),this.fast_=new e.default(i)}var i=t.prototype;return i.update=function(t,i){var n=this.slow_,r=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new e.default(t,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==i&&(this.fast_=new e.default(i,r.getEstimate(),r.getTotalWeight()))},i.sample=function(t,i){var n=(t=Math.max(t,this.minDelayMs_))/1e3,e=8*i/n;this.fast_.sample(n,e),this.slow_.sample(n,e)},i.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},i.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},i.destroy=function(){},t}()},"./src/utils/ewma.ts":
/*!***************************!*\
  !*** ./src/utils/ewma.ts ***!
  \***************************/
/*! exports provided: default */function(t,i,n){n.r(i),i.default=function(){function t(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=i,this.totalWeight_=n}var i=t.prototype;return i.sample=function(t,i){var n=Math.pow(this.alpha_,t);this.estimate_=i*(1-n)+n*this.estimate_,this.totalWeight_+=t},i.getTotalWeight=function(){return this.totalWeight_},i.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}()},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
  !*** ./src/utils/fetch-loader.ts ***!
  \***********************************/
/*! exports provided: fetchSupported, default */function(t,i,n){n.r(i),n.d(i,"fetchSupported",(function(){return f}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),s=n(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function o(t){var i="function"==typeof Map?new Map:void 0;return(o=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,n)}function n(){return a(t,arguments,l(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)})(t)}function a(t,i,n){return(a=u()?Reflect.construct:function(t,i,n){var e=[null];e.push.apply(e,i);var r=new(Function.bind.apply(t,e));return n&&c(r,n.prototype),r}).apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t,i){return(c=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(){return(h=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var d=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||m,this.controller=new self.AbortController,this.stats=new r.LoadStats}var i=t.prototype;return i.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},i.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},i.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},i.load=function(t,i,n){var r=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var o=function(t,i){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:i,headers:new self.Headers(h({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}(t,this.controller.signal),a=n.onProgress,u="arraybuffer"===t.responseType,c=u?"byteLength":"length";this.context=t,this.config=i,this.callbacks=n,this.request=this.fetchSetup(t,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){r.abortInternal(),n.onTimeout(s,t,r.response)}),i.timeout),self.fetch(this.request).then((function(n){if(r.response=r.loader=n,!n.ok)throw new v(n.statusText||"fetch, bad network response",n.status,n);return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(n.headers.get("Content-Length")||"0"),a&&Object(e.isFiniteNumber)(i.highWaterMark)?r.loadProgressively(n,s,t,i.highWaterMark,a):u?n.arrayBuffer():n.text()})).then((function(o){var u=r.response;self.clearTimeout(r.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=o[c];var l={url:u.url,data:o};a&&!Object(e.isFiniteNumber)(i.highWaterMark)&&a(s,t,o,u),n.onSuccess(l,s,t,u)})).catch((function(i){self.clearTimeout(r.requestTimeout),s.aborted||n.onError({code:i.code||0,text:i.message},t,i.details)}))},i.getCacheAge=function(){var t=null;if(this.response){var i=this.response.headers.get("age");t=i?parseFloat(i):null}return t},i.loadProgressively=function(t,i,n,e,r){void 0===e&&(e=0);var o=new s.default,a=t.body.getReader();return function s(){return a.read().then((function(a){if(a.done)return o.dataLength&&r(i,n,o.flush(),t),Promise.resolve(new ArrayBuffer(0));var u=a.value,c=u.length;return i.loaded+=c,c<e||o.dataLength?(o.push(u),o.dataLength>=e&&r(i,n,o.flush(),t)):r(i,n,u,t),s()})).catch((function(){return Promise.reject()}))}()},t}();function m(t,i){return new self.Request(t.url,i)}var v=function(t){var i,n;function e(i,n,e){var r;return(r=t.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=e,r}return n=t,(i=e).prototype=Object.create(n.prototype),i.prototype.constructor=i,c(i,n),e}(o(Error));i.default=d},"./src/utils/imsc1-ttml-parser.ts":
/*!****************************************!*\
  !*** ./src/utils/imsc1-ttml-parser.ts ***!
  \****************************************/
/*! exports provided: IMSC1_CODEC, parseIMSC1 */function(t,i,n){n.r(i),n.d(i,"IMSC1_CODEC",(function(){return l})),n.d(i,"parseIMSC1",(function(){return m}));var e=n(/*! ./mp4-tools */"./src/utils/mp4-tools.ts"),r=n(/*! ./vttparser */"./src/utils/vttparser.ts"),s=n(/*! ./vttcue */"./src/utils/vttcue.ts"),o=n(/*! ../demux/id3 */"./src/demux/id3.ts"),a=n(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),u=n(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");function c(){return(c=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}var l="stpp.ttml.im1t",h=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,f=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,d={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(t,i,n,r,l){var h=Object(e.findBox)(new Uint8Array(t),["mdat"]);if(0!==h.length){var f=h[0],m=Object(o.utf8ArrayToStr)(new Uint8Array(t,f.start,f.end-f.start)),x=Object(a.toTimescaleFromScale)(i,1,n);try{r(function(t,i){var n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var e={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(e).reduce((function(t,i){return t[i]=n.getAttribute("ttp:"+i)||e[i],t}),{}),o="preserve"!==n.getAttribute("xml:space"),a=p(v(n,"styling","style")),l=p(v(n,"layout","region")),h=v(n,"body","[begin]");return[].map.call(h,(function(t){var n=g(t,o);if(!n||!t.hasAttribute("begin"))return null;var e=y(t.getAttribute("begin"),r),h=y(t.getAttribute("dur"),r),f=y(t.getAttribute("end"),r);if(null===e)throw b(t);if(null===f){if(null===h)throw b(t);f=e+h}var m=new s.default(e-i,f-i,n);m.id=Object(u.generateCueId)(m.startTime,m.endTime,m.text);var v=l[t.getAttribute("region")],p=a[t.getAttribute("style")];m.position=10,m.size=80;var x=function(t,i){var n="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(e,r){var s=w(i,n,r)||w(t,n,r);return s&&(e[r]=s),e}),{})}(v,p),k=x.textAlign;if(k){var T=d[k];T&&(m.lineAlign=T),m.align=k}return c(m,x),m})).filter((function(t){return null!==t}))}(m,x))}catch(t){l(t)}}else l(new Error("Could not parse IMSC1 mdat"))}function v(t,i,n){var e=t.getElementsByTagName(i)[0];return e?[].slice.call(e.querySelectorAll(n)):[]}function p(t){return t.reduce((function(t,i){var n=i.getAttribute("xml:id");return n&&(t[n]=i),t}),{})}function g(t,i){return[].slice.call(t.childNodes).reduce((function(t,n,e){var r;return"br"===n.nodeName&&e?t+"\n":null!==(r=n.childNodes)&&void 0!==r&&r.length?g(n,i):i?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent}),"")}function w(t,i,n){return t.hasAttributeNS(i,n)?t.getAttributeNS(i,n):null}function b(t){return new Error("Could not parse ttml timestamp "+t)}function y(t,i){if(!t)return null;var n=Object(r.parseTimeStamp)(t);return null===n&&(h.test(t)?n=function(t,i){var n=h.exec(t);return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+((0|n[4])+(0|n[5])/i.subFrameRate)/i.frameRate}(t,i):f.test(t)&&(n=function(t,i){var n=f.exec(t),e=Number(n[1]);switch(n[2]){case"h":return 3600*e;case"m":return 60*e;case"ms":return 1e3*e;case"f":return e/i.frameRate;case"t":return e/i.tickRate}return e}(t,i))),n}},"./src/utils/logger.ts":
/*!*****************************!*\
  !*** ./src/utils/logger.ts ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(t,i,n){n.r(i),n.d(i,"enableLogs",(function(){return a})),n.d(i,"logger",(function(){return u}));var e=function(){},r={trace:e,debug:e,log:e,warn:e,info:e,error:e},s=r;function o(t){var i=self.console[t];return i?i.bind(self.console,"["+t+"] >"):e}function a(t){if(self.console&&!0===t||"object"==typeof t){!function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];n.forEach((function(i){s[i]=t[i]?t[i].bind(t):o(i)}))}(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=r}}else s=r}var u=r},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
  !*** ./src/utils/mediakeys-helper.ts ***!
  \***************************************/
/*! exports provided: KeySystems, requestMediaKeySystemAccess */function(t,i,n){var e;n.r(i),n.d(i,"KeySystems",(function(){return e})),n.d(i,"requestMediaKeySystemAccess",(function(){return r})),function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(e||(e={}));var r="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
  !*** ./src/utils/mediasource-helper.ts ***!
  \*****************************************/
/*! exports provided: getMediaSource */function(t,i,n){function e(){return self.MediaSource||self.WebKitMediaSource}n.r(i),n.d(i,"getMediaSource",(function(){return e}))},"./src/utils/mp4-tools.ts":
/*!********************************!*\
  !*** ./src/utils/mp4-tools.ts ***!
  \********************************/
/*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */function(t,i,n){n.r(i),n.d(i,"bin2str",(function(){return a})),n.d(i,"readUint16",(function(){return u})),n.d(i,"readUint32",(function(){return c})),n.d(i,"writeUint32",(function(){return l})),n.d(i,"findBox",(function(){return h})),n.d(i,"parseSegmentIndex",(function(){return f})),n.d(i,"parseInitSegment",(function(){return d})),n.d(i,"getStartDTS",(function(){return m})),n.d(i,"getDuration",(function(){return v})),n.d(i,"computeRawDurationFromSamples",(function(){return p})),n.d(i,"offsetStartDTS",(function(){return g})),n.d(i,"segmentValidRange",(function(){return w})),n.d(i,"appendUint8Array",(function(){return b}));var e=n(/*! ./typed-array */"./src/utils/typed-array.ts"),r=n(/*! ../loader/fragment */"./src/loader/fragment.ts"),s=Math.pow(2,32)-1,o=[].push;function a(t){return String.fromCharCode.apply(null,t)}function u(t,i){"data"in t&&(i+=t.start,t=t.data);var n=t[i]<<8|t[i+1];return n<0?65536+n:n}function c(t,i){"data"in t&&(i+=t.start,t=t.data);var n=t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3];return n<0?4294967296+n:n}function l(t,i,n){"data"in t&&(i+=t.start,t=t.data),t[i]=n>>24,t[i+1]=n>>16&255,t[i+2]=n>>8&255,t[i+3]=255&n}function h(t,i){var n,e,r,s=[];if(!i.length)return s;"data"in t?(n=t.data,e=t.start,r=t.end):(e=0,r=(n=t).byteLength);for(var u=e;u<r;){var l=c(n,u),f=l>1?u+l:r;if(a(n.subarray(u+4,u+8))===i[0])if(1===i.length)s.push({data:n,start:u+8,end:f});else{var d=h({data:n,start:u+8,end:f},i.slice(1));d.length&&o.apply(s,d)}u=f}return s}function f(t){var i=h(t,["moov"])[0],n=i?i.end:null,e=h(t,["sidx"]);if(!e||!e[0])return null;var r=[],s=e[0],o=s.data[0],a=0===o?8:16,l=c(s,a);a+=4,a+=0===o?8:16;var f=s.end+0,d=u(s,a+=2);a+=2;for(var m=0;m<d;m++){var v=a,p=c(s,v);v+=4;var g=2147483647&p;if(1==(2147483648&p)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var w=c(s,v);v+=4,r.push({referenceSize:g,subsegmentDuration:w,info:{duration:w/l,start:f,end:f+g-1}}),f+=g,a=v+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:d,references:r,moovEndOffset:n}}function d(t){for(var i=[],n=h(t,["moov","trak"]),e=0;e<n.length;e++){var s=n[e],o=h(s,["tkhd"])[0];if(o){var u=o.data[o.start],l=0===u?12:20,f=c(o,l),d=h(s,["mdia","mdhd"])[0];if(d){var m=c(d,l=0===(u=d.data[d.start])?12:20),v=h(s,["mdia","hdlr"])[0];if(v){var p=a(v.data.subarray(v.start+8,v.start+12)),g={soun:r.ElementaryStreamTypes.AUDIO,vide:r.ElementaryStreamTypes.VIDEO}[p];if(g){var w=h(s,["mdia","minf","stbl","stsd"])[0],b=void 0;w&&(b=a(w.data.subarray(w.start+12,w.start+16))),i[f]={timescale:m,type:g},i[g]={timescale:m,id:f,codec:b}}}}}}return h(t,["moov","mvex","trex"]).forEach((function(t){var n=c(t,4),e=i[n];e&&(e.default={duration:c(t,12),flags:c(t,20)})})),i}function m(t,i){return h(i,["moof","traf"]).reduce((function(i,n){var e=h(n,["tfdt"])[0],r=e.data[e.start],s=h(n,["tfhd"]).reduce((function(i,n){var s=c(n,4),o=t[s];if(o){var a=c(e,4);1===r&&(a*=Math.pow(2,32),a+=c(e,8));var u=a/(o.timescale||9e4);if(isFinite(u)&&(null===i||u<i))return u}return i}),null);return null!==s&&isFinite(s)&&(null===i||s<i)?s:i}),null)||0}function v(t,i){for(var n=0,e=0,s=0,o=h(t,["moof","traf"]),a=0;a<o.length;a++){var u=o[a],l=h(u,["tfhd"])[0],d=i[c(l,4)];if(d){var m=d.default,v=c(l,0)|(null==m?void 0:m.flags),g=null==m?void 0:m.duration;8&v&&(g=c(l,2&v?12:8));for(var w=d.timescale||9e4,b=h(u,["trun"]),y=0;y<b.length;y++)!(n=p(b[y]))&&g&&(n=g*c(b[y],4)),d.type===r.ElementaryStreamTypes.VIDEO?e+=n/w:d.type===r.ElementaryStreamTypes.AUDIO&&(s+=n/w)}}if(0===e&&0===s){var x=f(t);if(null!=x&&x.references)return x.references.reduce((function(t,i){return t+i.info.duration||0}),0)}return e||s}function p(t){var i=c(t,0),n=8;1&i&&(n+=4),4&i&&(n+=4);for(var e=0,r=c(t,4),s=0;s<r;s++)256&i&&(e+=c(t,n),n+=4),512&i&&(n+=4),1024&i&&(n+=4),2048&i&&(n+=4);return e}function g(t,i,n){h(i,["moof","traf"]).forEach((function(i){h(i,["tfhd"]).forEach((function(e){var r=c(e,4),o=t[r];if(o){var a=o.timescale||9e4;h(i,["tfdt"]).forEach((function(t){var i=t.data[t.start],e=c(t,4);if(0===i)l(t,4,e-n*a);else{e*=Math.pow(2,32),e+=c(t,8),e-=n*a,e=Math.max(e,0);var r=Math.floor(e/(s+1)),o=Math.floor(e%(s+1));l(t,4,r),l(t,8,o)}}))}}))}))}function w(t){var i={valid:null,remainder:null},n=h(t,["moof"]);if(!n)return i;if(n.length<2)return i.remainder=t,i;var r=n[n.length-1];return i.valid=Object(e.sliceUint8)(t,0,r.start-8),i.remainder=Object(e.sliceUint8)(t,r.start-8),i}function b(t,i){var n=new Uint8Array(t.length+i.length);return n.set(t),n.set(i,t.length),n}},"./src/utils/output-filter.ts":
/*!************************************!*\
  !*** ./src/utils/output-filter.ts ***!
  \************************************/
/*! exports provided: default */function(t,i,n){n.r(i),n.d(i,"default",(function(){return e}));var e=function(){function t(t,i){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=i}var i=t.prototype;return i.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},i.newCue=function(t,i,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=i,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},i.reset=function(){this.cueRanges=[],this.startTime=null},t}()},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
  !*** ./src/utils/texttrack-utils.ts ***!
  \**************************************/
/*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */function(t,i,n){n.r(i),n.d(i,"sendAddTrackEvent",(function(){return r})),n.d(i,"addCueToTrack",(function(){return s})),n.d(i,"clearCurrentCues",(function(){return o})),n.d(i,"removeCuesInRange",(function(){return a})),n.d(i,"getCuesInRange",(function(){return u}));var e=n(/*! ./logger */"./src/utils/logger.ts");function r(t,i){var n;try{n=new Event("addtrack")}catch(t){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,i.dispatchEvent(n)}function s(t,i){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(i.id))try{if(t.addCue(i),!t.cues.getCueById(i.id))throw new Error("addCue is failed for: "+i)}catch(n){e.logger.debug("[texttrack-utils]: "+n);var r=new self.TextTrackCue(i.startTime,i.endTime,i.text);r.id=i.id,t.addCue(r)}"disabled"===n&&(t.mode=n)}function o(t){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues)for(var n=t.cues.length;n--;)t.removeCue(t.cues[n]);"disabled"===i&&(t.mode=i)}function a(t,i,n){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var r=u(t.cues,i,n),s=0;s<r.length;s++)t.removeCue(r[s]);"disabled"===e&&(t.mode=e)}function u(t,i,n){var e=[],r=function(t,i){if(i<t[0].startTime)return 0;var n=t.length-1;if(i>t[n].endTime)return-1;for(var e=0,r=n;e<=r;){var s=Math.floor((r+e)/2);if(i<t[s].startTime)r=s-1;else{if(!(i>t[s].startTime&&e<n))return s;e=s+1}}return t[e].startTime-i<i-t[r].startTime?e:r}(t,i);if(r>-1)for(var s=r,o=t.length;s<o;s++){var a=t[s];if(a.startTime>=i&&a.endTime<=n)e.push(a);else if(a.startTime>n)return e}return e}},"./src/utils/time-ranges.ts":
/*!**********************************!*\
  !*** ./src/utils/time-ranges.ts ***!
  \**********************************/
/*! exports provided: default */function(t,i,n){n.r(i),i.default={toString:function(t){for(var i="",n=t.length,e=0;e<n;e++)i+="["+t.start(e).toFixed(3)+","+t.end(e).toFixed(3)+"]";return i}}},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
  !*** ./src/utils/timescale-conversion.ts ***!
  \*******************************************/
/*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */function(t,i,n){function e(t,i,n,e){void 0===n&&(n=1),void 0===e&&(e=!1);var r=t*i*n;return e?Math.round(r):r}function r(t,i,n,r){return void 0===n&&(n=1),void 0===r&&(r=!1),e(t,i,1/n,r)}function s(t,i){return void 0===i&&(i=!1),e(t,1e3,1/9e4,i)}function o(t,i){return void 0===i&&(i=1),e(t,9e4,1/i)}n.r(i),n.d(i,"toTimescaleFromBase",(function(){return e})),n.d(i,"toTimescaleFromScale",(function(){return r})),n.d(i,"toMsFromMpegTsClock",(function(){return s})),n.d(i,"toMpegTsClockFromTimescale",(function(){return o}))},"./src/utils/typed-array.ts":
/*!**********************************!*\
  !*** ./src/utils/typed-array.ts ***!
  \**********************************/
/*! exports provided: sliceUint8 */function(t,i,n){function e(t,i,n){return Uint8Array.prototype.slice?t.slice(i,n):new Uint8Array(Array.prototype.slice.call(t,i,n))}n.r(i),n.d(i,"sliceUint8",(function(){return e}))},"./src/utils/vttcue.ts":
/*!*****************************!*\
  !*** ./src/utils/vttcue.ts ***!
  \*****************************/
/*! exports provided: default */function(t,i,n){n.r(i),i.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],i=["start","middle","end","left","right"];function n(t,i){if("string"!=typeof i)return!1;if(!Array.isArray(t))return!1;var n=i.toLowerCase();return!!~t.indexOf(n)&&n}function e(t){return n(i,t)}function r(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var o in s)t[o]=s[o]}return t}function s(i,s,o){var a=this,u={enumerable:!0};a.hasBeenReset=!1;var c="",l=!1,h=i,f=s,d=o,m=null,v="",p=!0,g="auto",w="start",b=50,y="middle",x=50,k="middle";Object.defineProperty(a,"id",r({},u,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(a,"pauseOnExit",r({},u,{get:function(){return l},set:function(t){l=!!t}})),Object.defineProperty(a,"startTime",r({},u,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",r({},u,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",r({},u,{get:function(){return d},set:function(t){d=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",r({},u,{get:function(){return m},set:function(t){m=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",r({},u,{get:function(){return v},set:function(i){var e=function(i){return n(t,i)}(i);if(!1===e)throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",r({},u,{get:function(){return p},set:function(t){p=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",r({},u,{get:function(){return g},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",r({},u,{get:function(){return w},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");w=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",r({},u,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",r({},u,{get:function(){return y},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");y=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",r({},u,{get:function(){return x},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");x=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",r({},u,{get:function(){return k},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");k=i,this.hasBeenReset=!0}})),a.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":
/*!********************************!*\
  !*** ./src/utils/vttparser.ts ***!
  \********************************/
/*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */function(t,i,n){n.r(i),n.d(i,"parseTimeStamp",(function(){return s})),n.d(i,"fixLineBreaks",(function(){return h})),n.d(i,"VTTParser",(function(){return f}));var e=n(/*! ./vttcue */"./src/utils/vttcue.ts"),r=function(){function t(){}return t.prototype.decode=function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function s(t){function i(t,i,n,e){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(e||0)}var n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?i(n[2],n[3],0,n[4]):i(n[1],n[2],n[3],n[4]):null}var o=function(){function t(){this.values=Object.create(null)}var i=t.prototype;return i.set=function(t,i){this.get(t)||""===i||(this.values[t]=i)},i.get=function(t,i,n){return n?this.has(t)?this.values[t]:i[n]:this.has(t)?this.values[t]:i},i.has=function(t){return t in this.values},i.alt=function(t,i,n){for(var e=0;e<n.length;++e)if(i===n[e]){this.set(t,i);break}},i.integer=function(t,i){/^-?\d+$/.test(i)&&this.set(t,parseInt(i,10))},i.percent=function(t,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){var n=parseFloat(i);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},t}();function a(t,i,n,e){var r=e?t.split(e):[t];for(var s in r)if("string"==typeof r[s]){var o=r[s].split(n);2===o.length&&i(o[0],o[1])}}var u=new e.default(0,0,""),c="middle"===u.align?"middle":"center";function l(t,i,n){var e=t;function r(){var i=s(t);if(null===i)throw new Error("Malformed timestamp: "+e);return t=t.replace(/^[^\sa-zA-Z-]+/,""),i}function l(){t=t.replace(/^\s+/,"")}if(l(),i.startTime=r(),l(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+e);t=t.substr(3),l(),i.endTime=r(),l(),function(t,i){var e=new o;a(t,(function(t,i){var r;switch(t){case"region":for(var s=n.length-1;s>=0;s--)if(n[s].id===i){e.set(t,n[s].region);break}break;case"vertical":e.alt(t,i,["rl","lr"]);break;case"line":r=i.split(","),e.integer(t,r[0]),e.percent(t,r[0])&&e.set("snapToLines",!1),e.alt(t,r[0],["auto"]),2===r.length&&e.alt("lineAlign",r[1],["start",c,"end"]);break;case"position":r=i.split(","),e.percent(t,r[0]),2===r.length&&e.alt("positionAlign",r[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":e.percent(t,i);break;case"align":e.alt(t,i,["start",c,"end","left","right"])}}),/:/,/\s/),i.region=e.get("region",null),i.vertical=e.get("vertical","");var r=e.get("line","auto");"auto"===r&&-1===u.line&&(r=-1),i.line=r,i.lineAlign=e.get("lineAlign","start"),i.snapToLines=e.get("snapToLines",!0),i.size=e.get("size",100),i.align=e.get("align",c);var s=e.get("position","auto");"auto"===s&&50===u.position&&(s="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=s}(t,i)}function h(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var f=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new r,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var i=t.prototype;return i.parse=function(t){var i=this;function n(){var t=i.buffer,n=0;for(t=h(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var e=t.substr(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,i.buffer=t.substr(n),e}t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var s=(r=n()).match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var o=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(o?o=!1:r=n(),i.state){case"HEADER":/:/.test(r)?a(r,(function(){}),/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new e.default(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{l(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var u=-1!==r.indexOf("--\x3e");if(!r||u&&(o=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(null===i.cue)continue;i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID")}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},i.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(i){t.onparsingerror&&t.onparsingerror(i)}return t.onflush&&t.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":
/*!************************************!*\
  !*** ./src/utils/webvtt-parser.ts ***!
  \************************************/
/*! exports provided: generateCueId, parseWebVTT */function(t,i,n){n.r(i),n.d(i,"generateCueId",(function(){return h})),n.d(i,"parseWebVTT",(function(){return f}));var e=n(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),r=n(/*! ./vttparser */"./src/utils/vttparser.ts"),s=n(/*! ../demux/id3 */"./src/demux/id3.ts"),o=n(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),a=n(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),u=/\r\n|\n\r|\n|\r/g,c=function(t,i,n){return void 0===n&&(n=0),t.substr(n,i.length)===i},l=function(t){for(var i=5381,n=t.length;n;)i=33*i^t.charCodeAt(--n);return(i>>>0).toString()};function h(t,i,n){return l(t.toString())+l(i.toString())+l(n)}function f(t,i,n,l,f,d,m,v){var p,g=new r.VTTParser,w=Object(s.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(u,"\n").split("\n"),b=[],y=Object(o.toMpegTsClockFromTimescale)(i,n),x="00:00.000",k=0,T=0,S=!0,E=!1;g.oncue=function(t){var i=l[f],n=l.ccOffset,e=(k-y)/9e4;if(null!=i&&i.new&&(void 0!==T?n=l.ccOffset=i.start:function(t,i,n){var e=t[i],r=t[e.prevCC];if(!r||!r.new&&e.new)return t.ccOffset=t.presentationOffset=e.start,void(e.new=!1);for(;null!==(s=r)&&void 0!==s&&s.new;){var s;t.ccOffset+=e.start-r.start,e.new=!1,r=t[(e=r).prevCC]}t.presentationOffset=n}(l,f,e)),e&&(n=e-l.presentationOffset),E){var r=t.endTime-t.startTime,s=Object(a.normalizePts)(9e4*(t.startTime+n-T),9e4*d)/9e4;t.startTime=s,t.endTime=s+r}var o=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(o)),t.id||(t.id=h(t.startTime,t.endTime,o)),t.endTime>0&&b.push(t)},g.onparsingerror=function(t){p=t},g.onflush=function(){p?v(p):m(b)},w.forEach((function(t){if(S){if(c(t,"X-TIMESTAMP-MAP=")){S=!1,E=!0,t.substr(16).split(",").forEach((function(t){c(t,"LOCAL:")?x=t.substr(6):c(t,"MPEGTS:")&&(k=parseInt(t.substr(7)))}));try{T=function(t){var i=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),r=parseInt(t.substr(-9,2)),s=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(e.isFiniteNumber)(i)&&Object(e.isFiniteNumber)(n)&&Object(e.isFiniteNumber)(r)&&Object(e.isFiniteNumber)(s)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return i+=1e3*n,(i+=6e4*r)+36e5*s}(x)/1e3}catch(t){E=!1,p=t}return}""===t&&(S=!1)}g.parse(t+"\n")})),g.flush()}},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
  !*** ./src/utils/xhr-loader.ts ***!
  \*********************************/
/*! exports provided: default */function(t,i,n){n.r(i);var e=n(/*! ../utils/logger */"./src/utils/logger.ts"),r=n(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),s=/^age:\s*[\d.]+\s*$/m;i.default=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new r.LoadStats,this.retryDelay=0}var i=t.prototype;return i.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},i.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},i.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},i.load=function(t,i,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=i,this.callbacks=n,this.retryDelay=i.retryDelay,this.loadInternal()},i.loadInternal=function(){var t=this.config,i=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,e=this.stats;e.loading.first=0,e.loaded=0;var r=this.xhrSetup;try{if(r)try{r(n,i.url)}catch(t){n.open("GET",i.url,!0),r(n,i.url)}n.readyState||n.open("GET",i.url,!0);var s=this.context.headers;if(s)for(var o in s)n.setRequestHeader(o,s[o])}catch(t){return void this.callbacks.onError({code:n.status,text:t.message},i,n)}i.rangeEnd&&n.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=i.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),n.send()}},i.readystatechange=function(){var t=this.context,i=this.loader,n=this.stats;if(t&&i){var r=i.readyState,s=this.config;if(!n.aborted&&r>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===r){i.onreadystatechange=null,i.onprogress=null;var o=i.status;if(o>=200&&o<300){var a,u;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),u="arraybuffer"===t.responseType?(a=i.response).byteLength:(a=i.responseText).length,n.loaded=n.total=u,!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(n,t,a,i),!this.callbacks)return;this.callbacks.onSuccess({url:i.responseURL,data:a},n,t,i)}else n.retry>=s.maxRetry||o>=400&&o<499?(e.logger.error(o+" while loading "+t.url),this.callbacks.onError({code:o,text:i.statusText},t,i)):(e.logger.warn(o+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},i.loadtimeout=function(){e.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},i.loadprogress=function(t){var i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total)},i.getCacheAge=function(){var t=null;if(this.loader&&s.test(this.loader.getAllResponseHeaders())){var i=this.loader.getResponseHeader("age");t=i?parseFloat(i):null}return t},t}()}}).default},t.exports=i())}))),v=function(t){var i=t.videoElementId;const n=t.videoElement;var e,r,s=n,o=t.videoSource,a=o;if(m.isSupported()){var u=(new Date).getTime();console.log("new hls created"),(e=new m({liveSyncDurationCount:3,liveMaxLatencyDurationCount:10})).attachMedia(s),e.on(m.Events.MEDIA_ATTACHED,(function(){console.log("video and hls.js are now bound together !"),e.loadSource(o)})),e.on(m.Events.MANIFEST_PARSED,(function(){console.log("start playing video !"),s.play()})),e.on(m.Events.ERROR,(function(){})),e.on(m.Events.BUFFER_APPENDED,(function(t){var n=new Date;u=n.getTime(),console.log("videoElementId::",i),console.log("**** Hls.Events.BUFFER_APPENDED  event ",t,"::",u);var e=s.buffered;e.length>0&&console.log("currentTime = ",s.currentTime," Length=",e.length," start= ",e.start(0)," end = ",e.end(e.length-1))})),e.loadSource(o),r=setInterval((function(){var t=new Date;console.log("videoElementId::",i),console.log("Start-running_counter_time :: "+u),console.log("Current-time               :: "+t.getTime()),t.getTime()-u>1e4&&(console.log("Start-running_counter_time :: "+u),console.log("Current-time               :: "+t.getTime()),console.log("***** restart the video diff-time ",t.getTime()-u),r&&(console.log("********** CLEARING TIMER************"),clearInterval(r),r=null),c(),function(t){console.log("restart_hls_video"),t.dispatchEvent(new Event("restartVideo"))}(n),u=t.getTime())}),1e3)}else s.canPlayType("application/vnd.apple.mpegurl")&&fetch(a).then((function(){s.src=a,s.addEventListener("canplay",(function(){setTimeout((()=>{s.play()}))}))})).catch((function(){}));function c(){r&&(clearInterval(r),r=null),e?(e.stopLoad(),e.destroy()):(s.pause(),s.src=null)}return{play:function(){r&&(clearInterval(r),r=null),e?e.startLoad():s.play()},stop:c}};var p,g=function(t,i){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];return t.apply(i,n)}},w=Object.prototype.toString,b=(p=Object.create(null),function(t){var i=w.call(t);return p[i]||(p[i]=i.slice(8,-1).toLowerCase())});function y(t){return t=t.toLowerCase(),function(i){return b(i)===t}}function x(t){return Array.isArray(t)}function k(t){return void 0===t}var T=y("ArrayBuffer");function S(t){return null!==t&&"object"==typeof t}function E(t){if("object"!==b(t))return!1;var i=Object.getPrototypeOf(t);return null===i||i===Object.prototype}var O=y("Date"),j=y("File"),M=y("Blob"),A=y("FileList");function I(t){return"[object Function]"===w.call(t)}var D=y("URLSearchParams");function C(t,i){if(null!=t)if("object"!=typeof t&&(t=[t]),x(t))for(var n=0,e=t.length;n<e;n++)i.call(null,t[n],n,t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&i.call(null,t[r],r,t)}var R,P=(R="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(t){return R&&t instanceof R}),L={isArray:x,isArrayBuffer:T,isBuffer:function(t){return null!==t&&!k(t)&&null!==t.constructor&&!k(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){var i="[object FormData]";return t&&("function"==typeof FormData&&t instanceof FormData||w.call(t)===i||I(t.toString)&&t.toString()===i)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&T(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:S,isPlainObject:E,isUndefined:k,isDate:O,isFile:j,isBlob:M,isFunction:I,isStream:function(t){return S(t)&&I(t.pipe)},isURLSearchParams:D,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:C,merge:function t(){var i={};function n(n,e){i[e]=E(i[e])&&E(n)?t(i[e],n):E(n)?t({},n):x(n)?n.slice():n}for(var e=0,r=arguments.length;e<r;e++)C(arguments[e],n);return i},extend:function(t,i,n){return C(i,(function(i,e){t[e]=n&&"function"==typeof i?g(i,n):i})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t},inherits:function(t,i,n,e){t.prototype=Object.create(i.prototype,e),t.prototype.constructor=t,n&&Object.assign(t.prototype,n)},toFlatObject:function(t,i,n){var e,r,s,o={};i=i||{};do{for(r=(e=Object.getOwnPropertyNames(t)).length;r-- >0;)o[s=e[r]]||(i[s]=t[s],o[s]=!0);t=Object.getPrototypeOf(t)}while(t&&(!n||n(t,i))&&t!==Object.prototype);return i},kindOf:b,kindOfTest:y,endsWith:function(t,i,n){t=String(t),(void 0===n||n>t.length)&&(n=t.length);var e=t.indexOf(i,n-=i.length);return-1!==e&&e===n},toArray:function(t){if(!t)return null;var i=t.length;if(k(i))return null;for(var n=new Array(i);i-- >0;)n[i]=t[i];return n},isTypedArray:P,isFileList:A};function N(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var U=function(t,i,n){if(!i)return t;var e;if(n)e=n(i);else if(L.isURLSearchParams(i))e=i.toString();else{var r=[];L.forEach(i,(function(t,i){null!=t&&(L.isArray(t)?i+="[]":t=[t],L.forEach(t,(function(t){L.isDate(t)?t=t.toISOString():L.isObject(t)&&(t=JSON.stringify(t)),r.push(N(i)+"="+N(t))})))})),e=r.join("&")}if(e){var s=t.indexOf("#");-1!==s&&(t=t.slice(0,s)),t+=(-1===t.indexOf("?")?"?":"&")+e}return t};function F(){this.handlers=[]}F.prototype.use=function(t,i,n){return this.handlers.push({fulfilled:t,rejected:i,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},F.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},F.prototype.forEach=function(t){L.forEach(this.handlers,(function(i){null!==i&&t(i)}))};var G=F,_=function(t,i){L.forEach(t,(function(n,e){e!==i&&e.toUpperCase()===i.toUpperCase()&&(t[i]=n,delete t[e])}))};function B(t,i,n,e,r){Error.call(this),this.message=t,this.name="AxiosError",i&&(this.code=i),n&&(this.config=n),e&&(this.request=e),r&&(this.response=r)}L.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var q=B.prototype,X={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(t){X[t]={value:t}})),Object.defineProperties(B,X),Object.defineProperty(q,"isAxiosError",{value:!0}),B.from=function(t,i,n,e,r,s){var o=Object.create(q);return L.toFlatObject(t,o,(function(t){return t!==Error.prototype})),B.call(o,t.message,i,n,e,r),o.name=t.name,s&&Object.assign(o,s),o};var W=B,z={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},V=function(t,i){i=i||new FormData;var n=[];function e(t){return null===t?"":L.isDate(t)?t.toISOString():L.isArrayBuffer(t)||L.isTypedArray(t)?"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}return function t(r,s){if(L.isPlainObject(r)||L.isArray(r)){if(-1!==n.indexOf(r))throw Error("Circular reference detected in "+s);n.push(r),L.forEach(r,(function(n,r){if(!L.isUndefined(n)){var o,a=s?s+"."+r:r;if(n&&!s&&"object"==typeof n)if(L.endsWith(r,"{}"))n=JSON.stringify(n);else if(L.endsWith(r,"[]")&&(o=L.toArray(n)))return void o.forEach((function(t){!L.isUndefined(t)&&i.append(a,e(t))}));t(n,a)}})),n.pop()}else i.append(s,e(r))}(t),i},H=L.isStandardBrowserEnv()?{write:function(t,i,n,e,r,s){var o=[];o.push(t+"="+encodeURIComponent(i)),L.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),L.isString(e)&&o.push("path="+e),L.isString(r)&&o.push("domain="+r),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(t){var i=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},J=function(t,i){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)?function(t,i){return i?t.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):t}(t,i):i},K=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],$=L.isStandardBrowserEnv()?function(){var t,i=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function e(t){var e=t;return i&&(n.setAttribute("href",e),e=n.href),n.setAttribute("href",e),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=e(window.location.href),function(i){var n=L.isString(i)?e(i):i;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0};function Y(t){W.call(this,null==t?"canceled":t,W.ERR_CANCELED),this.name="CanceledError"}L.inherits(Y,W,{__CANCEL__:!0});var Q=Y,Z={"Content-Type":"application/x-www-form-urlencoded"};function tt(t,i){!L.isUndefined(t)&&L.isUndefined(t["Content-Type"])&&(t["Content-Type"]=i)}var it,nt={transitional:z,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(it=function(t){return new Promise((function(i,n){var e,r=t.data,s=t.headers,o=t.responseType;function a(){t.cancelToken&&t.cancelToken.unsubscribe(e),t.signal&&t.signal.removeEventListener("abort",e)}L.isFormData(r)&&L.isStandardBrowserEnv()&&delete s["Content-Type"];var u=new XMLHttpRequest;if(t.auth){var c=t.auth.username||"",l=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";s.Authorization="Basic "+btoa(c+":"+l)}var h=J(t.baseURL,t.url);function f(){if(u){var e,r,s,c,l,h="getAllResponseHeaders"in u?(e=u.getAllResponseHeaders(),l={},e?(L.forEach(e.split("\n"),(function(t){if(c=t.indexOf(":"),r=L.trim(t.substr(0,c)).toLowerCase(),s=L.trim(t.substr(c+1)),r){if(l[r]&&K.indexOf(r)>=0)return;l[r]="set-cookie"===r?(l[r]?l[r]:[]).concat([s]):l[r]?l[r]+", "+s:s}})),l):l):null;!function(t,i,n){var e=n.config.validateStatus;n.status&&e&&!e(n.status)?i(new W("Request failed with status code "+n.status,[W.ERR_BAD_REQUEST,W.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}((function(t){i(t),a()}),(function(t){n(t),a()}),{data:o&&"text"!==o&&"json"!==o?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:h,config:t,request:u}),u=null}}if(u.open(t.method.toUpperCase(),U(h,t.params,t.paramsSerializer),!0),u.timeout=t.timeout,"onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(f)},u.onabort=function(){u&&(n(new W("Request aborted",W.ECONNABORTED,t,u)),u=null)},u.onerror=function(){n(new W("Network Error",W.ERR_NETWORK,t,u,u)),u=null},u.ontimeout=function(){var i=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";t.timeoutErrorMessage&&(i=t.timeoutErrorMessage),n(new W(i,(t.transitional||z).clarifyTimeoutError?W.ETIMEDOUT:W.ECONNABORTED,t,u)),u=null},L.isStandardBrowserEnv()){var d=(t.withCredentials||$(h))&&t.xsrfCookieName?H.read(t.xsrfCookieName):void 0;d&&(s[t.xsrfHeaderName]=d)}"setRequestHeader"in u&&L.forEach(s,(function(t,i){void 0===r&&"content-type"===i.toLowerCase()?delete s[i]:u.setRequestHeader(i,t)})),L.isUndefined(t.withCredentials)||(u.withCredentials=!!t.withCredentials),o&&"json"!==o&&(u.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&u.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(e=function(t){u&&(n(!t||t&&t.type?new Q:t),u.abort(),u=null)},t.cancelToken&&t.cancelToken.subscribe(e),t.signal&&(t.signal.aborted?e():t.signal.addEventListener("abort",e))),r||(r=null);var m,v=(m=/^([-+\w]{1,25})(:?\/\/|:)/.exec(h))&&m[1]||"";v&&-1===["http","https","file"].indexOf(v)?n(new W("Unsupported protocol "+v+":",W.ERR_BAD_REQUEST,t)):u.send(r)}))}),it),transformRequest:[function(t,i){if(_(i,"Accept"),_(i,"Content-Type"),L.isFormData(t)||L.isArrayBuffer(t)||L.isBuffer(t)||L.isStream(t)||L.isFile(t)||L.isBlob(t))return t;if(L.isArrayBufferView(t))return t.buffer;if(L.isURLSearchParams(t))return tt(i,"application/x-www-form-urlencoded;charset=utf-8"),t.toString();var n,e=L.isObject(t),r=i&&i["Content-Type"];if((n=L.isFileList(t))||e&&"multipart/form-data"===r){var s=this.env&&this.env.FormData;return V(n?{"files[]":t}:t,s&&new s)}return e||"application/json"===r?(tt(i,"application/json"),function(t){if(L.isString(t))try{return(0,JSON.parse)(t),L.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var i=this.transitional||nt.transitional,n=!(i&&i.silentJSONParsing)&&"json"===this.responseType;if(n||i&&i.forcedJSONParsing&&L.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(n){if("SyntaxError"===t.name)throw W.from(t,W.ERR_BAD_RESPONSE,this,null,this.response);throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};L.forEach(["delete","get","head"],(function(t){nt.headers[t]={}})),L.forEach(["post","put","patch"],(function(t){nt.headers[t]=L.merge(Z)}));var et=nt,rt=function(t,i,n){var e=this||et;return L.forEach(n,(function(n){t=n.call(e,t,i)})),t},st=function(t){return!(!t||!t.__CANCEL__)};function ot(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Q}var at=function(t){return ot(t),t.headers=t.headers||{},t.data=rt.call(t,t.data,t.headers,t.transformRequest),t.headers=L.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),L.forEach(["delete","get","head","post","put","patch","common"],(function(i){delete t.headers[i]})),(t.adapter||et.adapter)(t).then((function(i){return ot(t),i.data=rt.call(t,i.data,i.headers,t.transformResponse),i}),(function(i){return st(i)||(ot(t),i&&i.response&&(i.response.data=rt.call(t,i.response.data,i.response.headers,t.transformResponse))),Promise.reject(i)}))},ut=function(t,i){i=i||{};var n={};function e(t,i){return L.isPlainObject(t)&&L.isPlainObject(i)?L.merge(t,i):L.isPlainObject(i)?L.merge({},i):L.isArray(i)?i.slice():i}function r(n){return L.isUndefined(i[n])?L.isUndefined(t[n])?void 0:e(void 0,t[n]):e(t[n],i[n])}function s(t){if(!L.isUndefined(i[t]))return e(void 0,i[t])}function o(n){return L.isUndefined(i[n])?L.isUndefined(t[n])?void 0:e(void 0,t[n]):e(void 0,i[n])}function a(n){return n in i?e(t[n],i[n]):n in t?e(void 0,t[n]):void 0}var u={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a};return L.forEach(Object.keys(t).concat(Object.keys(i)),(function(t){var i=u[t]||r,e=i(t);L.isUndefined(e)&&i!==a||(n[t]=e)})),n},ct={};["object","boolean","number","function","string","symbol"].forEach((function(t,i){ct[t]=function(n){return typeof n===t||"a"+(i<1?"n ":" ")+t}}));var lt={};ct.transitional=function(t,i,n){function e(t,i){return"[Axios v0.27.2] Transitional option '"+t+"'"+i+(n?". "+n:"")}return function(n,r,s){if(!1===t)throw new W(e(r," has been removed"+(i?" in "+i:"")),W.ERR_DEPRECATED);return i&&!lt[r]&&(lt[r]=!0,console.warn(e(r," has been deprecated since v"+i+" and will be removed in the near future"))),!t||t(n,r,s)}};var ht={assertOptions:function(t,i,n){if("object"!=typeof t)throw new W("options must be an object",W.ERR_BAD_OPTION_VALUE);for(var e=Object.keys(t),r=e.length;r-- >0;){var s=e[r],o=i[s];if(o){var a=t[s],u=void 0===a||o(a,s,t);if(!0!==u)throw new W("option "+s+" must be "+u,W.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new W("Unknown option "+s,W.ERR_BAD_OPTION)}},validators:ct},ft=ht.validators;function dt(t){this.defaults=t,this.interceptors={request:new G,response:new G}}dt.prototype.request=function(t,i){"string"==typeof t?(i=i||{}).url=t:i=t||{},(i=ut(this.defaults,i)).method=i.method?i.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var n=i.transitional;void 0!==n&&ht.assertOptions(n,{silentJSONParsing:ft.transitional(ft.boolean),forcedJSONParsing:ft.transitional(ft.boolean),clarifyTimeoutError:ft.transitional(ft.boolean)},!1);var e=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(i)||(r=r&&t.synchronous,e.unshift(t.fulfilled,t.rejected))}));var s,o=[];if(this.interceptors.response.forEach((function(t){o.push(t.fulfilled,t.rejected)})),!r){var a=[at,void 0];for(Array.prototype.unshift.apply(a,e),a=a.concat(o),s=Promise.resolve(i);a.length;)s=s.then(a.shift(),a.shift());return s}for(var u=i;e.length;){var c=e.shift(),l=e.shift();try{u=c(u)}catch(t){l(t);break}}try{s=at(u)}catch(t){return Promise.reject(t)}for(;o.length;)s=s.then(o.shift(),o.shift());return s},dt.prototype.getUri=function(t){t=ut(this.defaults,t);var i=J(t.baseURL,t.url);return U(i,t.params,t.paramsSerializer)},L.forEach(["delete","get","head","options"],(function(t){dt.prototype[t]=function(i,n){return this.request(ut(n||{},{method:t,url:i,data:(n||{}).data}))}})),L.forEach(["post","put","patch"],(function(t){function i(i){return function(n,e,r){return this.request(ut(r||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:n,data:e}))}}dt.prototype[t]=i(),dt.prototype[t+"Form"]=i(!0)}));var mt=dt;function vt(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var i;this.promise=new Promise((function(t){i=t}));var n=this;this.promise.then((function(t){if(n._listeners){var i,e=n._listeners.length;for(i=0;i<e;i++)n._listeners[i](t);n._listeners=null}})),this.promise.then=function(t){var i,e=new Promise((function(t){n.subscribe(t),i=t})).then(t);return e.cancel=function(){n.unsubscribe(i)},e},t((function(t){n.reason||(n.reason=new Q(t),i(n.reason))}))}vt.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},vt.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},vt.prototype.unsubscribe=function(t){if(this._listeners){var i=this._listeners.indexOf(t);-1!==i&&this._listeners.splice(i,1)}},vt.source=function(){var t;return{token:new vt((function(i){t=i})),cancel:t}};var pt=vt,gt=function t(i){var n=new mt(i),e=g(mt.prototype.request,n);return L.extend(e,mt.prototype,n),L.extend(e,n),e.create=function(n){return t(ut(i,n))},e}(et);gt.Axios=mt,gt.CanceledError=Q,gt.CancelToken=pt,gt.isCancel=st,gt.VERSION="0.27.2",gt.toFormData=V,gt.AxiosError=W,gt.Cancel=gt.CanceledError,gt.all=function(t){return Promise.all(t)},gt.spread=function(t){return function(i){return t.apply(null,i)}},gt.isAxiosError=function(t){return L.isObject(t)&&!0===t.isAxiosError};var wt=gt;wt.default=gt;var bt=wt;console.log(t);const yt=t.V2_BASEURL;class xt{constructor(t){this.authToken=t,this.axios=bt.create({baseURL:yt,headers:{Authorization:`Bearer ${this.authToken}`}})}async prepareDeviceMediaStreaming(t){const{data:{data:i}}=await this.axios.request({method:"POST",url:`/devices/${t}/connect-media`});return i}}var kt;f((function(t){var i=i||window.AdapterJS||{};if(i.options=i.options||{},i.options.getAllCams=!!i.options.getAllCams,i.options.hidePluginInstallPrompt=!!i.options.hidePluginInstallPrompt,i.options.forceSafariPlugin=!!i.options.forceSafariPlugin,i.VERSION="0.15.5",i.onwebrtcready=i.onwebrtcready||function(){},i._onwebrtcreadies=[],i.webRTCReady=function(t){if("function"!=typeof t)throw new Error("Callback provided is not a function");var n=function(){"function"==typeof window.require&&"function"==typeof i._defineMediaSourcePolyfill&&i._defineMediaSourcePolyfill(),t(null!==i.WebRTCPlugin.plugin)};!0===i.onwebrtcreadyDone?n():i._onwebrtcreadies.push(n)},i.WebRTCPlugin=i.WebRTCPlugin||{},i.WebRTCPlugin.pluginInfo=i.WebRTCPlugin.pluginInfo||{prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0",portalLink:"https://skylink.io/plugin/",downloadLink:null,companyName:"Temasys",downloadLinks:{mac:"https://bit.ly/webrtcpluginpkg",win:"https://bit.ly/webrtcpluginmsi"}},null!=i.WebRTCPlugin.pluginInfo.downloadLinks&&(navigator.platform.match(/^Mac/i)?i.WebRTCPlugin.pluginInfo.downloadLink=i.WebRTCPlugin.pluginInfo.downloadLinks.mac:navigator.platform.match(/^Win/i)&&(i.WebRTCPlugin.pluginInfo.downloadLink=i.WebRTCPlugin.pluginInfo.downloadLinks.win)),i.WebRTCPlugin.TAGS={NONE:"none",AUDIO:"audio",VIDEO:"video"},i.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),i.WebRTCPlugin.plugin=null,i.WebRTCPlugin.setLogLevel=null,i.WebRTCPlugin.defineWebRTCInterface=null,i.WebRTCPlugin.isPluginInstalled=null,i.WebRTCPlugin.pluginInjectionInterval=null,i.WebRTCPlugin.injectPlugin=null,i.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.NONE,i.onwebrtcreadyDone=!1,i.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:"NONE",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",VERBOSE:"VERBOSE",SENSITIVE:"SENSITIVE"},i.WebRTCPlugin.WaitForPluginReady=null,i.WebRTCPlugin.callWhenPluginReady=null,i.documentReady=function(){return"interactive"===document.readyState&&!!document.body||"complete"===document.readyState},window.__TemWebRTCReady0=function(){i.documentReady()?(i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.READY,i.maybeThroughWebRTCReady()):setTimeout(__TemWebRTCReady0,100)},i.maybeThroughWebRTCReady=function(){i.onwebrtcreadyDone||(i.onwebrtcreadyDone=!0,i._onwebrtcreadies.length?i._onwebrtcreadies.forEach((function(t){"function"==typeof t&&t(null!==i.WebRTCPlugin.plugin)})):"function"==typeof i.onwebrtcready&&i.onwebrtcready(null!==i.WebRTCPlugin.plugin))},i.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"This website requires you to install a WebRTC-enabling plugin to work on this browser.",REQUIRE_RESTART:"Your plugin is being downloaded. Please run the installer, and restart your browser to begin using it.",NOT_SUPPORTED:"Your browser does not support WebRTC.",BUTTON:"Install Now"},REFRESH:{REQUIRE_REFRESH:"Please refresh page",BUTTON:"Refresh Page"}},i._iceConnectionStates={starting:"starting",checking:"checking",connected:"connected",completed:"connected",done:"completed",disconnected:"disconnected",failed:"failed",closed:"closed"},i._iceConnectionFiredStates=[],i.isDefined=null,window.webrtcDetectedType=null,window.MediaStream="function"==typeof MediaStream?MediaStream:null,window.MediaStreamTrack="function"==typeof MediaStreamTrack?MediaStreamTrack:null,window.RTCPeerConnection="function"==typeof RTCPeerConnection?RTCPeerConnection:null,window.RTCSessionDescription="function"==typeof RTCSessionDescription?RTCSessionDescription:null,window.RTCIceCandidate="function"==typeof RTCIceCandidate?RTCIceCandidate:null,window.getUserMedia="function"==typeof getUserMedia?getUserMedia:null,window.attachMediaStream=null,window.reattachMediaStream=null,window.webrtcDetectedBrowser=null,window.webrtcDetectedVersion=null,window.webrtcMinimumVersion=null,window.webrtcDetectedDCSupport=null,i.parseWebrtcDetectedBrowser=function(){var t=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)t=navigator.userAgent.match(/OPR\/(\d+)/i)||[],window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=26,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){t=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var n=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);window.webrtcDetectedBrowser="bowser",window.webrtcDetectedVersion=parseFloat((t[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=0,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=n>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)t=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)t=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedBrowser="chrome",window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("FxiOS")>0)t=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(document.documentMode)t=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedBrowser="IE",window.webrtcDetectedVersion=parseInt(t[1],10),window.webrtcMinimumVersion=9,window.webrtcDetectedType="plugin",window.webrtcDetectedDCSupport="SCTP",webrtcDetectedVersion||(t=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedVersion=parseInt(t[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))t=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],window.webrtcDetectedBrowser="edge",window.webrtcDetectedVersion=parseFloat((t[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=13.10547,window.webrtcDetectedType="ms",window.webrtcDetectedDCSupport=null;else if("undefined"!=typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)t=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=33,window.webrtcDetectedType="moz",window.webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],window.webrtcDetectedBrowser="chrome",window.webrtcDetectedVersion=parseInt(t[2]||"0",10),window.webrtcMinimumVersion=38,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=window.webrtcDetectedVersion>30?"SCTP":"RTP";else if(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()||navigator.userAgent.match(/AppleWebKit\/(\d+)\./)||navigator.userAgent.match(/Version\/(\d+).(\d+)/)){t=navigator.userAgent.match(/version\/(\d+)\.(\d+)/i)||[];var e=navigator.userAgent.match(/AppleWebKit\/(\d+)/i)||[],r=navigator.userAgent.match(/(iPhone|iPad)/gi),s=e.length>=1&&e[1]>=604;if(window.webrtcDetectedBrowser="safari",window.webrtcDetectedVersion=parseInt(t[1]||"0",10),window.webrtcMinimumVersion=7,r)window.webrtcDetectedType=s?"AppleWebKit":null;else{var o=window.webrtcDetectedVersion,a=parseInt(t[2]||"0",10);window.webrtcDetectedType=!s||i.options.forceSafariPlugin&&11==o&&a<2?"plugin":"AppleWebKit"}window.webrtcDetectedDCSupport="SCTP"}i.webrtcDetectedBrowser=window.webrtcDetectedBrowser,i.webrtcDetectedVersion=window.webrtcDetectedVersion,i.webrtcMinimumVersion=window.webrtcMinimumVersion,i.webrtcDetectedType=window.webrtcDetectedType,i.webrtcDetectedDCSupport=window.webrtcDetectedDCSupport},i.addEvent=function(t,i,n){t.addEventListener?t.addEventListener(i,n,!1):t.attachEvent?t.attachEvent("on"+i,n):t[i]=n},i.renderNotificationBar=function(t,n,e){if(i.documentReady()){var r=window,s=document.createElement("iframe");s.name="adapterjs-alert",s.style.position="fixed",s.style.top="-41px",s.style.left=0,s.style.right=0,s.style.width="100%",s.style.height="40px",s.style.backgroundColor="#ffffe1",s.style.border="none",s.style.borderBottom="1px solid #888888",s.style.zIndex="9999999","string"==typeof s.style.webkitTransition?s.style.webkitTransition="all .5s ease-out":"string"==typeof s.style.transition&&(s.style.transition="all .5s ease-out"),document.body.appendChild(s);var o=s.contentWindow?s.contentWindow:s.contentDocument.document?s.contentDocument.document:s.contentDocument;o.document.open(),o.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+t+"</span>"),n&&"function"==typeof e?(o.document.write('<button id="okay">'+n+'</button><button id="cancel">Cancel</button>'),o.document.close(),i.addEvent(o.document.getElementById("okay"),"click",(function(t){t.preventDefault();try{t.cancelBubble=!0}catch(t){}e(t)})),i.addEvent(o.document.getElementById("cancel"),"click",(function(){r.document.body.removeChild(s)}))):o.document.close(),setTimeout((function(){"string"==typeof s.style.webkitTransform?s.style.webkitTransform="translateY(40px)":"string"==typeof s.style.transform?s.style.transform="translateY(40px)":s.style.top="0px"}),300)}},window.requestUserMedia="function"==typeof requestUserMedia?requestUserMedia:null,i.parseWebrtcDetectedBrowser(),["webkit","moz","ms","AppleWebKit"].indexOf(i.webrtcDetectedType)>-1){navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&window.RTCPeerConnection&&(window.msRTCPeerConnection=window.RTCPeerConnection),t.exports=function t(i,n,e){function r(o,a){if(!n[o]){if(!i[o]){if(!a&&d)return d();if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};i[o][0].call(c.exports,(function(t){return r(i[o][1][t]||t)}),c,c.exports,t,i,n,e)}return n[o].exports}for(var s=d,o=0;o<e.length;o++)r(e[o]);return r}({1:[function(t,i){function n(t,i,n,e,r){var s=a.writeRtpDescription(t.kind,i);if(s+=a.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=a.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":r||"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o=t.rtpSender._initialTrackId||t.rtpSender.track.id;t.rtpSender._initialTrackId=o;var u="msid:"+(e?e.id:"-")+" "+o+"\r\n";s+="a="+u,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+u,t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+u,s+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+a.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+a.localCName+"\r\n"),s}function e(t,i){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},e=function(t,i){t=parseInt(t,10);for(var n=0;n<i.length;n++)if(i[n].payloadType===t||i[n].preferredPayloadType===t)return i[n]},r=function(t,i,n,r){var s=e(t.parameters.apt,n),o=e(i.parameters.apt,r);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return t.codecs.forEach((function(e){for(var s=0;s<i.codecs.length;s++){var o=i.codecs[s];if(e.name.toLowerCase()===o.name.toLowerCase()&&e.clockRate===o.clockRate){if("rtx"===e.name.toLowerCase()&&e.parameters&&o.parameters.apt&&!r(e,o,t.codecs,i.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(e.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(t){for(var i=0;i<e.rtcpFeedback.length;i++)if(e.rtcpFeedback[i].type===t.type&&e.rtcpFeedback[i].parameter===t.parameter)return!0;return!1}));break}}})),t.headerExtensions.forEach((function(t){for(var e=0;e<i.headerExtensions.length;e++){var r=i.headerExtensions[e];if(t.uri===r.uri){n.headerExtensions.push(r);break}}})),n}function r(t,i,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[i][t].indexOf(n)}function s(t,i){var n=t.getRemoteCandidates().find((function(t){return i.foundation===t.foundation&&i.ip===t.ip&&i.port===t.port&&i.priority===t.priority&&i.protocol===t.protocol&&i.type===t.type}));return n||t.addRemoteCandidate(i),!n}function o(t,i){var n=new Error(i);return n.name=t,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],n}var a=t("sdp");i.exports=function(t,i){function u(i,n){n.addTrack(i),n.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:i}))}function c(i,n,e,r){var s=new Event("track");s.track=n,s.receiver=e,s.transceiver={receiver:e},s.streams=r,t.setTimeout((function(){i._dispatchEvent("track",s)}))}var l=function(n){var e=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(t){e[t]=r[t].bind(r)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw o("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(t,i){var n=!1;return(t=JSON.parse(JSON.stringify(t))).filter((function(t){if(t&&(t.urls||t.url)){var e=t.urls||t.url,r="string"==typeof e;return r&&(e=[e]),e=e.filter((function(t){return 0!==t.indexOf("turn:")||-1===t.indexOf("transport=udp")||-1!==t.indexOf("turn:[")||n?0===t.indexOf("stun:")&&i>=14393&&-1===t.indexOf("?transport=udp"):(n=!0,!0)})),delete t.url,t.urls=r?e[0]:e,!!e.length}}))}(n.iceServers||[],i),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new t.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=a.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(t,i){this._isClosed||(this.dispatchEvent(i),"function"==typeof this["on"+t]&&this["on"+t](i))},l.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(t,i){var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();n.iceTransport=e.iceTransport,n.dtlsTransport=e.dtlsTransport}return i||this.transceivers.push(n),n},l.prototype.addTrack=function(i,n){if(this._isClosed)throw o("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find((function(t){return t.track===i})))throw o("InvalidAccessError","Track already exists.");for(var e,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==i.kind||(e=this.transceivers[r]);return e||(e=this._createTransceiver(i.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),e.track=i,e.stream=n,e.rtpSender=new t.RTCRtpSender(i,e.dtlsTransport),e.rtpSender},l.prototype.addStream=function(t){var n=this;if(i>=15025)t.getTracks().forEach((function(i){n.addTrack(i,t)}));else{var e=t.clone();t.getTracks().forEach((function(t,i){var n=e.getTracks()[i];t.addEventListener("enabled",(function(t){n.enabled=t.enabled}))})),e.getTracks().forEach((function(t){n.addTrack(t,e)}))}},l.prototype.removeTrack=function(i){if(this._isClosed)throw o("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(i instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(t){return t.rtpSender===i}));if(!n)throw o("InvalidAccessError","Sender was not created by this connection.");var e=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(t){return t.stream})).indexOf(e)&&this.localStreams.indexOf(e)>-1&&this.localStreams.splice(this.localStreams.indexOf(e),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(t){var i=this;t.getTracks().forEach((function(t){var n=i.getSenders().find((function(i){return i.track===t}));n&&i.removeTrack(n)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(t){return!!t.rtpSender})).map((function(t){return t.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(t){return!!t.rtpReceiver})).map((function(t){return t.rtpReceiver}))},l.prototype._createIceGatherer=function(i,n){var e=this;if(n&&i>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new t.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[i].bufferedCandidateEvents=[],this.transceivers[i].bufferCandidates=function(t){var n=!t.candidate||0===Object.keys(t.candidate).length;r.state=n?"completed":"gathering",null!==e.transceivers[i].bufferedCandidateEvents&&e.transceivers[i].bufferedCandidateEvents.push(t)},r.addEventListener("localcandidate",this.transceivers[i].bufferCandidates),r},l.prototype._gather=function(i,n){var e=this,r=this.transceivers[n].iceGatherer;if(!r.onlocalcandidate){var s=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),r.onlocalcandidate=function(t){if(!(e.usingBundle&&n>0)){var s=new Event("icecandidate");s.candidate={sdpMid:i,sdpMLineIndex:n};var o=t.candidate,u=!o||0===Object.keys(o).length;if(u)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),o.component=1,o.ufrag=r.getLocalParameters().usernameFragment;var c=a.writeCandidate(o);s.candidate=Object.assign(s.candidate,a.parseCandidate(c)),s.candidate.candidate=c,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var l=a.getMediaSections(e._localDescription.sdp);l[s.candidate.sdpMLineIndex]+=u?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",e._localDescription.sdp=a.getDescription(e._localDescription.sdp)+l.join("");var h=e.transceivers.every((function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state}));"gathering"!==e.iceGatheringState&&(e.iceGatheringState="gathering",e._emitGatheringStateChange()),u||e._dispatchEvent("icecandidate",s),h&&(e._dispatchEvent("icecandidate",new Event("icecandidate")),e.iceGatheringState="complete",e._emitGatheringStateChange())}},t.setTimeout((function(){s.forEach((function(t){r.onlocalcandidate(t)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var i=this,n=new t.RTCIceTransport(null);n.onicestatechange=function(){i._updateIceConnectionState(),i._updateConnectionState()};var e=new t.RTCDtlsTransport(n);return e.ondtlsstatechange=function(){i._updateConnectionState()},e.onerror=function(){Object.defineProperty(e,"state",{value:"failed",writable:!0}),i._updateConnectionState()},{iceTransport:n,dtlsTransport:e}},l.prototype._disposeIceAndDtlsTransports=function(t){var i=this.transceivers[t].iceGatherer;i&&(delete i.onlocalcandidate,delete this.transceivers[t].iceGatherer);var n=this.transceivers[t].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[t].iceTransport);var e=this.transceivers[t].dtlsTransport;e&&(delete e.ondtlsstatechange,delete e.onerror,delete this.transceivers[t].dtlsTransport)},l.prototype._transceive=function(t,n,r){var s=e(t.localCapabilities,t.remoteCapabilities);n&&t.rtpSender&&(s.encodings=t.sendEncodingParameters,s.rtcp={cname:a.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(s.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(s)),r&&t.rtpReceiver&&s.codecs.length>0&&("video"===t.kind&&t.recvEncodingParameters&&i<15019&&t.recvEncodingParameters.forEach((function(t){delete t.rtx})),s.encodings=t.recvEncodingParameters.length?t.recvEncodingParameters:[{}],s.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(s.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(s.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(s))},l.prototype.setLocalDescription=function(t){var i,n,s=this;if(-1===["offer","answer"].indexOf(t.type))return Promise.reject(o("TypeError",'Unsupported type "'+t.type+'"'));if(!r("setLocalDescription",t.type,s.signalingState)||s._isClosed)return Promise.reject(o("InvalidStateError","Can not set local "+t.type+" in state "+s.signalingState));if("offer"===t.type)i=a.splitSections(t.sdp),n=i.shift(),i.forEach((function(t,i){var n=a.parseRtpParameters(t);s.transceivers[i].localCapabilities=n})),s.transceivers.forEach((function(t,i){s._gather(t.mid,i)}));else if("answer"===t.type){i=a.splitSections(s._remoteDescription.sdp),n=i.shift();var u=a.matchPrefix(n,"a=ice-lite").length>0;i.forEach((function(t,i){var r=s.transceivers[i],o=r.iceGatherer,c=r.iceTransport,l=r.dtlsTransport,h=r.localCapabilities,f=r.remoteCapabilities;if(!(a.isRejected(t)&&0===a.matchPrefix(t,"a=bundle-only").length||r.rejected)){var d=a.getIceParameters(t,n),m=a.getDtlsParameters(t,n);u&&(m.role="server"),s.usingBundle&&0!==i||(s._gather(r.mid,i),"new"===c.state&&c.start(o,d,u?"controlling":"controlled"),"new"===l.state&&l.start(m));var v=e(h,f);s._transceive(r,v.codecs.length>0,!1)}}))}return s._localDescription={type:t.type,sdp:t.sdp},s._updateSignalingState("offer"===t.type?"have-local-offer":"stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(n){var e=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(o("TypeError",'Unsupported type "'+n.type+'"'));if(!r("setRemoteDescription",n.type,e.signalingState)||e._isClosed)return Promise.reject(o("InvalidStateError","Can not set remote "+n.type+" in state "+e.signalingState));var l={};e.remoteStreams.forEach((function(t){l[t.id]=t}));var h=[],f=a.splitSections(n.sdp),d=f.shift(),m=a.matchPrefix(d,"a=ice-lite").length>0,v=a.matchPrefix(d,"a=group:BUNDLE ").length>0;e.usingBundle=v;var p=a.matchPrefix(d,"a=ice-options:")[0];return e.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,f.forEach((function(r,o){var c=a.splitLines(r),f=a.getKind(r),p=a.isRejected(r)&&0===a.matchPrefix(r,"a=bundle-only").length,g=c[0].substr(2).split(" ")[2],w=a.getDirection(r,d),b=a.parseMsid(r),y=a.getMid(r)||a.generateIdentifier();if(p||"application"===f&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))e.transceivers[o]={mid:y,kind:f,protocol:g,rejected:!0};else{!p&&e.transceivers[o]&&e.transceivers[o].rejected&&(e.transceivers[o]=e._createTransceiver(f,!0));var x,k,T,S,E,O,j,M,A,I,D,C=a.parseRtpParameters(r);p||(I=a.getIceParameters(r,d),(D=a.getDtlsParameters(r,d)).role="client"),j=a.parseRtpEncodingParameters(r);var R=a.parseRtcpParameters(r),P=a.matchPrefix(r,"a=end-of-candidates",d).length>0,L=a.matchPrefix(r,"a=candidate:").map((function(t){return a.parseCandidate(t)})).filter((function(t){return 1===t.component}));if(("offer"===n.type||"answer"===n.type)&&!p&&v&&o>0&&e.transceivers[o]&&(e._disposeIceAndDtlsTransports(o),e.transceivers[o].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[o].iceTransport=e.transceivers[0].iceTransport,e.transceivers[o].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[o].rtpSender&&e.transceivers[o].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[o].rtpReceiver&&e.transceivers[o].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),"offer"!==n.type||p)"answer"!==n.type||p||(k=(x=e.transceivers[o]).iceGatherer,T=x.iceTransport,S=x.dtlsTransport,E=x.rtpReceiver,O=x.sendEncodingParameters,M=x.localCapabilities,e.transceivers[o].recvEncodingParameters=j,e.transceivers[o].remoteCapabilities=C,e.transceivers[o].rtcpParameters=R,L.length&&"new"===T.state&&(!m&&!P||v&&0!==o?L.forEach((function(t){s(x.iceTransport,t)})):T.setRemoteCandidates(L)),v&&0!==o||("new"===T.state&&T.start(k,I,"controlling"),"new"===S.state&&S.start(D)),e._transceive(x,"sendrecv"===w||"recvonly"===w,"sendrecv"===w||"sendonly"===w),!E||"sendrecv"!==w&&"sendonly"!==w?delete x.rtpReceiver:(A=E.track,b?(l[b.stream]||(l[b.stream]=new t.MediaStream),u(A,l[b.stream]),h.push([A,E,l[b.stream]])):(l.default||(l.default=new t.MediaStream),u(A,l.default),h.push([A,E,l.default]))));else{(x=e.transceivers[o]||e._createTransceiver(f)).mid=y,x.iceGatherer||(x.iceGatherer=e._createIceGatherer(o,v)),L.length&&"new"===x.iceTransport.state&&(!P||v&&0!==o?L.forEach((function(t){s(x.iceTransport,t)})):x.iceTransport.setRemoteCandidates(L)),M=t.RTCRtpReceiver.getCapabilities(f),i<15019&&(M.codecs=M.codecs.filter((function(t){return"rtx"!==t.name}))),O=x.sendEncodingParameters||[{ssrc:1001*(2*o+2)}];var N,U=!1;"sendrecv"===w||"sendonly"===w?(U=!x.rtpReceiver,E=x.rtpReceiver||new t.RTCRtpReceiver(x.dtlsTransport,f),U&&(A=E.track,b&&"-"===b.stream||(b?(l[b.stream]||(l[b.stream]=new t.MediaStream,Object.defineProperty(l[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(A,"id",{get:function(){return b.track}}),N=l[b.stream]):(l.default||(l.default=new t.MediaStream),N=l.default)),N&&(u(A,N),x.associatedRemoteMediaStreams.push(N)),h.push([A,E,N]))):x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach((function(i){var n=i.getTracks().find((function(t){return t.id===x.rtpReceiver.track.id}));n&&function(i,n){n.removeTrack(i),n.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:i}))}(n,i)})),x.associatedRemoteMediaStreams=[]),x.localCapabilities=M,x.remoteCapabilities=C,x.rtpReceiver=E,x.rtcpParameters=R,x.sendEncodingParameters=O,x.recvEncodingParameters=j,e._transceive(e.transceivers[o],!1,U)}}})),void 0===e._dtlsRole&&(e._dtlsRole="offer"===n.type?"active":"passive"),e._remoteDescription={type:n.type,sdp:n.sdp},e._updateSignalingState("offer"===n.type?"have-remote-offer":"stable"),Object.keys(l).forEach((function(i){var n=l[i];if(n.getTracks().length){if(-1===e.remoteStreams.indexOf(n)){e.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,t.setTimeout((function(){e._dispatchEvent("addstream",r)}))}h.forEach((function(t){n.id===t[2].id&&c(e,t[0],t[1],[n])}))}})),h.forEach((function(t){t[2]||c(e,t[0],t[1],[])})),t.setTimeout((function(){e&&e.transceivers&&e.transceivers.forEach((function(t){t.iceTransport&&"new"===t.iceTransport.state&&t.iceTransport.getRemoteCandidates().length>0&&t.iceTransport.addRemoteCandidate({})}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(t){this.signalingState=t;var i=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",i)},l.prototype._maybeFireNegotiationNeeded=function(){var i=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,t.setTimeout((function(){if(i.needNegotiation){i.needNegotiation=!1;var t=new Event("negotiationneeded");i._dispatchEvent("negotiationneeded",t)}}),0))},l.prototype._updateIceConnectionState=function(){var t,i={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(t){i[t.iceTransport.state]++})),t="new",i.failed>0?t="failed":i.checking>0?t="checking":i.disconnected>0?t="disconnected":i.new>0?t="new":i.connected>0?t="connected":i.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var t,i={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(t){i[t.iceTransport.state]++,i[t.dtlsTransport.state]++})),i.connected+=i.completed,t="new",i.failed>0?t="failed":i.connecting>0?t="connecting":i.disconnected>0?t="disconnected":i.new>0?t="new":i.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var e=this;if(e._isClosed)return Promise.reject(o("InvalidStateError","Can not call createOffer after close"));var r=e.transceivers.filter((function(t){return"audio"===t.kind})).length,s=e.transceivers.filter((function(t){return"video"===t.kind})).length,u=arguments[0];if(u){if(u.mandatory||u.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==u.offerToReceiveAudio&&(r=!0===u.offerToReceiveAudio?1:!1===u.offerToReceiveAudio?0:u.offerToReceiveAudio),void 0!==u.offerToReceiveVideo&&(s=!0===u.offerToReceiveVideo?1:!1===u.offerToReceiveVideo?0:u.offerToReceiveVideo)}for(e.transceivers.forEach((function(t){"audio"===t.kind?--r<0&&(t.wantReceive=!1):"video"===t.kind&&--s<0&&(t.wantReceive=!1)}));r>0||s>0;)r>0&&(e._createTransceiver("audio"),r--),s>0&&(e._createTransceiver("video"),s--);var c=a.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.transceivers.forEach((function(n,r){var s=n.track,o=n.kind,u=n.mid||a.generateIdentifier();n.mid=u,n.iceGatherer||(n.iceGatherer=e._createIceGatherer(r,e.usingBundle));var c=t.RTCRtpSender.getCapabilities(o);i<15019&&(c.codecs=c.codecs.filter((function(t){return"rtx"!==t.name}))),c.codecs.forEach((function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(i){t.name.toLowerCase()===i.name.toLowerCase()&&t.clockRate===i.clockRate&&(t.preferredPayloadType=i.payloadType)}))})),c.headerExtensions.forEach((function(t){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(i){t.uri===i.uri&&(t.id=i.id)}))}));var l=n.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];s&&i>=15019&&"video"===o&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new t.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=c,n.sendEncodingParameters=l})),"max-compat"!==e._config.bundlePolicy&&(c+="a=group:BUNDLE "+e.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",e.transceivers.forEach((function(t,i){c+=n(t,t.localCapabilities,"offer",t.stream,e._dtlsRole),c+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===e.iceGatheringState||0!==i&&e.usingBundle||(t.iceGatherer.getLocalCandidates().forEach((function(t){t.component=1,c+="a="+a.writeCandidate(t)+"\r\n"})),"completed"===t.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))}));var l=new t.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(l)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(o("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(o("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=a.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n");var u=a.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(t,o){if(!(o+1>u)){if(t.rejected)return"application"===t.kind?s+="DTLS/SCTP"===t.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+t.protocol+" webrtc-datachannel\r\n":"audio"===t.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===t.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+t.mid+"\r\n");var a;t.stream&&("audio"===t.kind?a=t.stream.getAudioTracks()[0]:"video"===t.kind&&(a=t.stream.getVideoTracks()[0]),a&&i>=15019&&"video"===t.kind&&!t.sendEncodingParameters[0].rtx&&(t.sendEncodingParameters[0].rtx={ssrc:t.sendEncodingParameters[0].ssrc+1}));var c=e(t.localCapabilities,t.remoteCapabilities);!c.codecs.filter((function(t){return"rtx"===t.name.toLowerCase()})).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,s+=n(t,c,"answer",t.stream,r._dtlsRole),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}}));var c=new t.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(c)},l.prototype.addIceCandidate=function(t){var i,n=this;return t&&void 0===t.sdpMLineIndex&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(e,r){if(!n._remoteDescription)return r(o("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&""!==t.candidate){var u=t.sdpMLineIndex;if(t.sdpMid)for(var c=0;c<n.transceivers.length;c++)if(n.transceivers[c].mid===t.sdpMid){u=c;break}var l=n.transceivers[u];if(!l)return r(o("OperationError","Can not add ICE candidate"));if(l.rejected)return e();var h=Object.keys(t.candidate).length>0?a.parseCandidate(t.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port))return e();if(h.component&&1!==h.component)return e();if((0===u||u>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,h))return r(o("OperationError","Can not add ICE candidate"));var f=t.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(i=a.getMediaSections(n._remoteDescription.sdp))[u]+="a="+(h.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=a.getDescription(n._remoteDescription.sdp)+i.join("")}else for(var d=0;d<n.transceivers.length&&(n.transceivers[d].rejected||(n.transceivers[d].iceTransport.addRemoteCandidate({}),(i=a.getMediaSections(n._remoteDescription.sdp))[d]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=a.getDescription(n._remoteDescription.sdp)+i.join(""),!n.usingBundle));d++);e()}))},l.prototype.getStats=function(i){if(i&&i instanceof t.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(t){t.rtpSender&&t.rtpSender.track===i?n=t.rtpSender:t.rtpReceiver&&t.rtpReceiver.track===i&&(n=t.rtpReceiver)})),!n)throw o("InvalidAccessError","Invalid selector.");return n.getStats()}var e=[];return this.transceivers.forEach((function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(i){t[i]&&e.push(t[i].getStats())}))})),Promise.all(e).then((function(t){var i=new Map;return t.forEach((function(t){t.forEach((function(t){i.set(t.id,t)}))})),i}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(i){var n=t[i];if(n&&n.prototype&&n.prototype.getStats){var e=n.prototype.getStats;n.prototype.getStats=function(){return e.apply(this).then((function(t){var i=new Map;return Object.keys(t).forEach((function(n){var e;t[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(e=t[n]).type]||e.type,i.set(n,t[n])})),i}))}}}));var h=["createOffer","createAnswer"];return h.forEach((function(t){var i=l.prototype[t];l.prototype[t]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?i.apply(this,[arguments[2]]).then((function(i){"function"==typeof t[0]&&t[0].apply(null,[i])}),(function(i){"function"==typeof t[1]&&t[1].apply(null,[i])})):i.apply(this,arguments)}})),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(t){var i=l.prototype[t];l.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?i.apply(this,arguments).then((function(){"function"==typeof t[1]&&t[1].apply(null)}),(function(i){"function"==typeof t[2]&&t[2].apply(null,[i])})):i.apply(this,arguments)}})),["getStats"].forEach((function(t){var i=l.prototype[t];l.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]?i.apply(this,arguments).then((function(){"function"==typeof t[1]&&t[1].apply(null)})):i.apply(this,arguments)}})),l}},{sdp:2}],2:[function(t,i){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map((function(t){return t.trim()}))},n.splitSections=function(t){return t.split("\nm=").map((function(t,i){return(i>0?"m="+t:t).trim()+"\r\n"}))},n.getDescription=function(t){var i=n.splitSections(t);return i&&i[0]},n.getMediaSections=function(t){var i=n.splitSections(t);return i.shift(),i},n.matchPrefix=function(t,i){return n.splitLines(t).filter((function(t){return 0===t.indexOf(i)}))},n.parseCandidate=function(t){for(var i,n={foundation:(i=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],port:parseInt(i[5],10),type:i[7]},e=8;e<i.length;e+=2)switch(i[e]){case"raddr":n.relatedAddress=i[e+1];break;case"rport":n.relatedPort=parseInt(i[e+1],10);break;case"tcptype":n.tcpType=i[e+1];break;case"ufrag":n.ufrag=i[e+1],n.usernameFragment=i[e+1];break;default:n[i[e]]=i[e+1]}return n},n.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.ip),i.push(t.port);var n=t.type;return i.push("typ"),i.push(n),"host"!==n&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},n.parseIceOptions=function(t){return t.substr(14).split(" ")},n.parseRtpMap=function(t){var i=t.substr(9).split(" "),n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=3===i.length?parseInt(i[2],10):1,n.numChannels=n.channels,n},n.writeRtpMap=function(t){var i=t.payloadType;void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType);var n=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(1!==n?"/"+n:"")+"\r\n"},n.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var i,n={},e=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<e.length;r++)n[(i=e[r].trim().split("="))[0].trim()]=i[1];return n},n.writeFmtp=function(t){var i="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var e=[];Object.keys(t.parameters).forEach((function(i){e.push(t.parameters[i]?i+"="+t.parameters[i]:i)})),i+="a=fmtp:"+n+" "+e.join(";")+"\r\n"}return i},n.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},n.writeRtcpFb=function(t){var i="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((function(t){i+="a=rtcp-fb:"+n+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),i},n.parseSsrcMedia=function(t){var i=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,i-7),10)},e=t.indexOf(":",i);return e>-1?(n.attribute=t.substr(i+1,e-i-1),n.value=t.substr(e+1)):n.attribute=t.substr(i+1),n},n.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map((function(t){return parseInt(t,10)}))}},n.getMid=function(t){var i=n.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},n.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},n.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:n.matchPrefix(t+i,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(t,i){var n="a=setup:"+i+"\r\n";return t.fingerprints.forEach((function(t){n+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),n},n.getIceParameters=function(t,i){var e=n.splitLines(t);return{usernameFragment:(e=e.concat(n.splitLines(i))).filter((function(t){return 0===t.indexOf("a=ice-ufrag:")}))[0].substr(12),password:e.filter((function(t){return 0===t.indexOf("a=ice-pwd:")}))[0].substr(10)}},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=n.splitLines(t)[0].split(" "),r=3;r<e.length;r++){var s=e[r],o=n.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(o){var a=n.parseRtpMap(o),u=n.matchPrefix(t,"a=fmtp:"+s+" ");switch(a.parameters=u.length?n.parseFmtp(u[0]):{},a.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),i.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach((function(t){i.headerExtensions.push(n.parseExtmap(t))})),i},n.writeRtpDescription=function(t,i){var e="";e+="m="+t+" ",e+=i.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=i.codecs.map((function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType})).join(" ")+"\r\n",e+="c=IN IP4 0.0.0.0\r\n",e+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach((function(t){e+=n.writeRtpMap(t),e+=n.writeFmtp(t),e+=n.writeRtcpFb(t)}));var r=0;return i.codecs.forEach((function(t){t.maxptime>r&&(r=t.maxptime)})),r>0&&(e+="a=maxptime:"+r+"\r\n"),e+="a=rtcp-mux\r\n",i.headerExtensions&&i.headerExtensions.forEach((function(t){e+=n.writeExtmap(t)})),e},n.parseRtpEncodingParameters=function(t){var i,e=[],r=n.parseRtpParameters(t),s=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute})),u=a.length>0&&a[0].ssrc,c=n.matchPrefix(t,"a=ssrc-group:FID").map((function(t){return t.substr(17).split(" ").map((function(t){return parseInt(t,10)}))}));c.length>0&&c[0].length>1&&c[0][0]===u&&(i=c[0][1]),r.codecs.forEach((function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:u,codecPayloadType:parseInt(t.parameters.apt,10)};u&&i&&(n.rtx={ssrc:i}),e.push(n),s&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:i,mechanism:o?"red+ulpfec":"red"},e.push(n))}})),0===e.length&&u&&e.push({ssrc:u});var l=n.matchPrefix(t,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,e.forEach((function(t){t.maxBitrate=l}))),e},n.parseRtcpParameters=function(t){var i={},e=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute}))[0];e&&(i.cname=e.value,i.ssrc=e.ssrc);var r=n.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=0===r.length;var s=n.matchPrefix(t,"a=rtcp-mux");return i.mux=s.length>0,i},n.parseMsid=function(t){var i,e=n.matchPrefix(t,"a=msid:");if(1===e.length)return{stream:(i=e[0].substr(7).split(" "))[0],track:i[1]};var r=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"msid"===t.attribute}));return r.length>0?{stream:(i=r[0].value.split(" "))[0],track:i[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(t,i){var e=void 0!==i?i:2;return"v=0\r\no=thisisadapterortc "+(t||n.generateSessionId())+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,i,e,r){var s=n.writeRtpDescription(t.kind,i);if(s+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===e?"actpass":"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.direction?"a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o="msid:"+r.id+" "+t.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+o,t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s},n.getDirection=function(t,i){for(var e=n.splitLines(t),r=0;r<e.length;r++)switch(e[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[r].substr(2)}return i?n.getDirection(i):"sendrecv"},n.getKind=function(t){return n.splitLines(t)[0].split(" ")[0].substr(2)},n.isRejected=function(t){return"0"===t.split(" ",2)[1]},n.parseMLine=function(t){var i=n.splitLines(t)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},n.parseOLine=function(t){var i=n.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},n.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var i=n.splitLines(t),e=0;e<i.length;e++)if(i[e].length<2||"="!==i[e].charAt(1))return!1;return!0},"object"==typeof i&&(i.exports=n)},{}],3:[function(t,i){(function(n){var e=t("./adapter_factory.js");i.exports=e({window:n.window})}).call(this,void 0!==l?l:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(t,i){var n=t("./utils");i.exports=function(i,e){var r=i&&i.window,s={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var o in e)hasOwnProperty.call(e,o)&&(s[o]=e[o]);var a=n.log,u=n.detectBrowser(r),c=t("./chrome/chrome_shim")||null,l=t("./edge/edge_shim")||null,h=t("./firefox/firefox_shim")||null,f=t("./safari/safari_shim")||null,d=t("./common_shim")||null,m={browserDetails:u,commonShim:d,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!c||!c.shimPeerConnection||!s.shimChrome)return a("Chrome shim is not included in this adapter release."),m;a("adapter.js shimming chrome."),m.browserShim=c,d.shimCreateObjectURL(r),c.shimGetUserMedia(r),c.shimMediaStream(r),c.shimSourceObject(r),c.shimPeerConnection(r),c.shimOnTrack(r),c.shimAddTrackRemoveTrack(r),c.shimGetSendersWithDtmf(r),c.shimSenderReceiverGetStats(r),c.fixNegotiationNeeded(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"firefox":if(!h||!h.shimPeerConnection||!s.shimFirefox)return a("Firefox shim is not included in this adapter release."),m;a("adapter.js shimming firefox."),m.browserShim=h,d.shimCreateObjectURL(r),h.shimGetUserMedia(r),h.shimSourceObject(r),h.shimPeerConnection(r),h.shimOnTrack(r),h.shimRemoveStream(r),h.shimSenderGetStats(r),h.shimReceiverGetStats(r),h.shimRTCDataChannel(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"edge":if(!l||!l.shimPeerConnection||!s.shimEdge)return a("MS edge shim is not included in this adapter release."),m;a("adapter.js shimming edge."),m.browserShim=l,d.shimCreateObjectURL(r),l.shimGetUserMedia(r),l.shimPeerConnection(r),l.shimReplaceTrack(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"safari":if(!f||!s.shimSafari)return a("Safari shim is not included in this adapter release."),m;a("adapter.js shimming safari."),m.browserShim=f,d.shimCreateObjectURL(r),f.shimRTCIceServerUrls(r),f.shimCreateOfferLegacy(r),f.shimCallbacksAPI(r),f.shimLocalStreamsAPI(r),f.shimRemoteStreamsAPI(r),f.shimTrackEventTransceiver(r),f.shimGetUserMedia(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;default:a("Unsupported browser!")}return m}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(t,i){function n(t,i,e){i&&!e.has(i.id)&&(e.set(i.id,i),Object.keys(i).forEach((function(r){r.endsWith("Id")?n(t,t.get(i[r]),e):r.endsWith("Ids")&&i[r].forEach((function(i){n(t,t.get(i),e)}))})))}function e(t,i,e){var r=e?"outbound-rtp":"inbound-rtp",s=new Map;if(null===i)return s;var o=[];return t.forEach((function(t){"track"===t.type&&t.trackIdentifier===i.id&&o.push(t)})),o.forEach((function(i){t.forEach((function(e){e.type===r&&e.trackId===i.id&&n(t,e,s)}))})),s}var r=t("../utils.js"),s=r.log;i.exports={shimGetUserMedia:t("./getusermedia"),shimMediaStream:function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},shimOnTrack:function(t){if("object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype)"RTCRtpTransceiver"in t||r.wrapPeerConnectionEvent(t,"track",(function(t){return t.transceiver||(t.transceiver={receiver:t.receiver}),t}));else{Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});var i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(i){i.stream.addEventListener("addtrack",(function(e){var r;r=t.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(t){return t.track&&t.track.id===e.track.id})):{track:e.track};var s=new Event("track");s.track=e.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],n.dispatchEvent(s)})),i.stream.getTracks().forEach((function(e){var r;r=t.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(t){return t.track&&t.track.id===e.id})):{track:e};var s=new Event("track");s.track=e,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],n.dispatchEvent(s)}))},n.addEventListener("addstream",n._ontrackpoly)),i.apply(n,arguments)}}},shimGetSendersWithDtmf:function(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var i=function(t,i){return{track:i,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===i.kind?t.createDTMFSender(i):null),this._dtmf},_pc:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this,s=n.apply(r,arguments);return s||(s=i(r,t),r._senders.push(s)),s};var e=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){var i=this;e.apply(i,arguments);var n=i._senders.indexOf(t);-1!==n&&i._senders.splice(n,1)}}var r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var n=this;n._senders=n._senders||[],r.apply(n,[t]),t.getTracks().forEach((function(t){n._senders.push(i(n,t))}))};var s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var i=this;i._senders=i._senders||[],s.apply(i,[t]),t.getTracks().forEach((function(t){var n=i._senders.find((function(i){return i.track===t}));n&&i._senders.splice(i._senders.indexOf(n),1)}))}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var o=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var t=this,i=o.apply(t,[]);return i.forEach((function(i){i._pc=t})),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},shimSenderReceiverGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,n=i.apply(t,[]);return n.forEach((function(i){i._pc=t})),n});var n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then((function(i){return e(i,t.track,!0)}))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,i=s.apply(t,[]);return i.forEach((function(i){i._pc=t})),i}),r.wrapPeerConnectionEvent(t,"track",(function(t){return t.receiver._pc=t.srcElement,t})),t.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then((function(i){return e(i,t.track,!1)}))}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var i=this;if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var n,e,r,s=arguments[0];return i.getSenders().forEach((function(t){t.track===s&&(n?r=!0:n=t)})),i.getReceivers().forEach((function(t){return t.track===s&&(e?r=!0:e=t),t.track===s})),r||n&&e?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():e?e.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(i,arguments)}}}},shimSourceObject:function(t){var i=t&&t.URL;"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(t){var n=this;this._srcObject=t,this.src&&i.revokeObjectURL(this.src),t?(this.src=i.createObjectURL(t),t.addEventListener("addtrack",(function(){n.src&&i.revokeObjectURL(n.src),n.src=i.createObjectURL(t)})),t.addEventListener("removetrack",(function(){n.src&&i.revokeObjectURL(n.src),n.src=i.createObjectURL(t)}))):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(i){return t._shimmedLocalStreams[i][0]}))};var i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){if(!n)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var e=i.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(e)&&this._shimmedLocalStreams[n.id].push(e):this._shimmedLocalStreams[n.id]=[n,e],e};var n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},t.getTracks().forEach((function(t){if(i.getSenders().find((function(i){return i.track===t})))throw new DOMException("Track already exists.","InvalidAccessError")}));var e=i.getSenders();n.apply(this,arguments);var r=i.getSenders().filter((function(t){return-1===e.indexOf(t)}));this._shimmedLocalStreams[t.id]=[t].concat(r)};var e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[t.id],e.apply(this,arguments)};var r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){var i=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var e=i._shimmedLocalStreams[n].indexOf(t);-1!==e&&i._shimmedLocalStreams[n].splice(e,1),1===i._shimmedLocalStreams[n].length&&delete i._shimmedLocalStreams[n]})),r.apply(this,arguments)}},shimAddTrackRemoveTrack:function(t){function i(t,i){var n=i.sdp;return Object.keys(t._reverseStreams||[]).forEach((function(i){var e=t._reverseStreams[i];n=n.replace(new RegExp(t._streams[e.id].id,"g"),e.id)})),new RTCSessionDescription({type:i.type,sdp:n})}function n(t,i){var n=i.sdp;return Object.keys(t._reverseStreams||[]).forEach((function(i){var e=t._reverseStreams[i],r=t._streams[e.id];n=n.replace(new RegExp(e.id,"g"),r.id)})),new RTCSessionDescription({type:i.type,sdp:n})}var e=r.detectBrowser(t);if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return this.shimAddTrackRemoveTrackWithNative(t);var s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,i=s.apply(this);return t._reverseStreams=t._reverseStreams||{},i.map((function(i){return t._reverseStreams[i.id]}))};var o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},i.getTracks().forEach((function(t){if(n.getSenders().find((function(i){return i.track===t})))throw new DOMException("Track already exists.","InvalidAccessError")})),!n._reverseStreams[i.id]){var e=new t.MediaStream(i.getTracks());n._streams[i.id]=e,n._reverseStreams[e.id]=i,i=e}o.apply(n,[i])};var a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var i=this;i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},a.apply(i,[i._streams[t.id]||t]),delete i._reverseStreams[i._streams[t.id]?i._streams[t.id].id:t.id],delete i._streams[t.id]},t.RTCPeerConnection.prototype.addTrack=function(i,n){var e=this;if("closed"===e.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((function(t){return t===i})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(e.getSenders().find((function(t){return t.track===i})))throw new DOMException("Track already exists.","InvalidAccessError");e._streams=e._streams||{},e._reverseStreams=e._reverseStreams||{};var s=e._streams[n.id];if(s)s.addTrack(i),Promise.resolve().then((function(){e.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new t.MediaStream([i]);e._streams[n.id]=o,e._reverseStreams[o.id]=n,e.addStream(o)}return e.getSenders().find((function(t){return t.track===i}))},["createOffer","createAnswer"].forEach((function(n){var e=t.RTCPeerConnection.prototype[n];t.RTCPeerConnection.prototype[n]=function(){var t=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?e.apply(t,[function(e){var r=i(t,e);n[0].apply(null,[r])},function(t){n[1]&&n[1].apply(null,t)},arguments[2]]):e.apply(t,arguments).then((function(n){return i(t,n)}))}}));var u=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type?(arguments[0]=n(t,arguments[0]),u.apply(t,arguments)):u.apply(t,arguments)};var c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=c.get.apply(this);return""===t.type?t:i(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){var i,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==n)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach((function(e){n._streams[e].getTracks().find((function(i){return t.track===i}))&&(i=n._streams[e])})),i&&(1===i.getTracks().length?n.removeStream(n._reverseStreams[i.id]):i.removeTrack(t.track),n.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(t){var i=r.detectBrowser(t);if(!t.RTCPeerConnection&&t.webkitRTCPeerConnection)t.RTCPeerConnection=function(i,n){return s("PeerConnection"),i&&i.iceTransportPolicy&&(i.iceTransports=i.iceTransportPolicy),new t.webkitRTCPeerConnection(i,n)},t.RTCPeerConnection.prototype=t.webkitRTCPeerConnection.prototype,t.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return t.webkitRTCPeerConnection.generateCertificate}});else{var n=t.RTCPeerConnection;t.RTCPeerConnection=function(t,i){if(t&&t.iceServers){for(var e=[],s=0;s<t.iceServers.length;s++){var o=t.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,e.push(o)):e.push(t.iceServers[s])}t.iceServers=e}return new n(t,i)},t.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,i,n){var r=this,s=arguments;if(arguments.length>0&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof arguments[0]))return e.apply(this,[]);var o=function(t){var i={};return t.result().forEach((function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach((function(i){n[i]=t.stat(i)})),i[n.id]=n})),i},a=function(t){return new Map(Object.keys(t).map((function(i){return[i,t[i]]})))};return arguments.length>=2?e.apply(this,[function(t){s[1](a(o(t)))},arguments[0]]):new Promise((function(t,i){e.apply(r,[function(i){t(a(o(i)))},i])})).then(i,n)},i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){var n=t.RTCPeerConnection.prototype[i];t.RTCPeerConnection.prototype[i]=function(){var t=arguments,i=this,e=new Promise((function(e,r){n.apply(i,[t[0],e,r])}));return t.length<2?e:e.then((function(){t[1].apply(null,[])}),(function(i){t.length>=3&&t[2].apply(null,[i])}))}})),i.version<52&&["createOffer","createAnswer"].forEach((function(i){var n=t.RTCPeerConnection.prototype[i];t.RTCPeerConnection.prototype[i]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise((function(e,r){n.apply(t,[e,r,i])}))}return n.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){var n=t.RTCPeerConnection.prototype[i];t.RTCPeerConnection.prototype[i]=function(){return arguments[0]=new("addIceCandidate"===i?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var o=t.RTCPeerConnection.prototype.addIceCandidate;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(t){r.wrapPeerConnectionEvent(t,"negotiationneeded",(function(t){if("stable"===t.target.signalingState)return t}))},shimGetDisplayMedia:function(t,i){"getDisplayMedia"in t.navigator||"function"==typeof i&&(navigator.getDisplayMedia=function(t){return i(t).then((function(i){return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:t.video.frameRate||3}},navigator.mediaDevices.getUserMedia(t)}))})}}},{"../utils.js":14,"./getusermedia":6}],6:[function(t,i){var n=t("../utils.js"),e=n.log;i.exports=function(t){var i=n.detectBrowser(t),r=t&&t.navigator,s=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;var i={};return Object.keys(t).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var e="object"==typeof t[n]?t[n]:{ideal:t[n]};void 0!==e.exact&&"number"==typeof e.exact&&(e.min=e.max=e.exact);var r=function(t,i){return t?t+i.charAt(0).toUpperCase()+i.slice(1):"deviceId"===i?"sourceId":i};if(void 0!==e.ideal){i.optional=i.optional||[];var s={};"number"==typeof e.ideal?(s[r("min",n)]=e.ideal,i.optional.push(s),(s={})[r("max",n)]=e.ideal,i.optional.push(s)):(s[r("",n)]=e.ideal,i.optional.push(s))}void 0!==e.exact&&"number"!=typeof e.exact?(i.mandatory=i.mandatory||{},i.mandatory[r("",n)]=e.exact):["min","max"].forEach((function(t){void 0!==e[t]&&(i.mandatory=i.mandatory||{},i.mandatory[r(t,n)]=e[t])}))}})),t.advanced&&(i.optional=(i.optional||[]).concat(t.advanced)),i},o=function(t,n){if(i.version>=61)return n(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"==typeof t.audio){var o=function(t,i,n){i in t&&!(n in t)&&(t[n]=t[i],delete t[i])};o((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),o(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=s(t.audio)}if(t&&"object"==typeof t.video){var a,u=t.video.facingMode,c=i.version<66;if((u=u&&("object"==typeof u?u:{ideal:u}))&&("user"===u.exact||"environment"===u.exact||"user"===u.ideal||"environment"===u.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete t.video.facingMode,"environment"===u.exact||"environment"===u.ideal?a=["back","rear"]:"user"!==u.exact&&"user"!==u.ideal||(a=["front"]),a))return r.mediaDevices.enumerateDevices().then((function(i){var r=(i=i.filter((function(t){return"videoinput"===t.kind}))).find((function(t){return a.some((function(i){return-1!==t.label.toLowerCase().indexOf(i)}))}));return!r&&i.length&&-1!==a.indexOf("back")&&(r=i[i.length-1]),r&&(t.video.deviceId=u.exact?{exact:r.deviceId}:{ideal:r.deviceId}),t.video=s(t.video),e("chrome: "+JSON.stringify(t)),n(t)}));t.video=s(t.video)}return e("chrome: "+JSON.stringify(t)),n(t)},a=function(t){return i.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(t,i,n){o(t,(function(t){r.webkitGetUserMedia(t,i,(function(t){n&&n(a(t))}))}))};var u=function(t){return new Promise((function(i,n){r.getUserMedia(t,i,n)}))};if(r.mediaDevices||(r.mediaDevices={getUserMedia:u,enumerateDevices:function(){return new Promise((function(i){var n={audio:"audioinput",video:"videoinput"};return t.MediaStreamTrack.getSources((function(t){i(t.map((function(t){return{label:t.label,kind:n[t.kind],deviceId:t.id,groupId:""}})))}))}))},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,(function(t){return c(t).then((function(i){if(t.audio&&!i.getAudioTracks().length||t.video&&!i.getVideoTracks().length)throw i.getTracks().forEach((function(t){t.stop()})),new DOMException("","NotFoundError");return i}),(function(t){return Promise.reject(a(t))}))}))}}else r.mediaDevices.getUserMedia=function(t){return u(t)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(t,i){var n=t("sdp"),e=t("./utils");i.exports={shimRTCIceCandidate:function(t){if(t.RTCIceCandidate&&(!t.RTCIceCandidate||!("foundation"in t.RTCIceCandidate.prototype))){var i=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){var e=new i(t),r=n.parseCandidate(t.candidate),s=Object.assign(e,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new i(t)},t.RTCIceCandidate.prototype=i.prototype,e.wrapPeerConnectionEvent(t,"icecandidate",(function(i){return i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i}))}},shimCreateObjectURL:function(t){var i=t&&t.URL;if("object"==typeof t&&t.HTMLMediaElement&&"srcObject"in t.HTMLMediaElement.prototype&&i.createObjectURL&&i.revokeObjectURL){var n=i.createObjectURL.bind(i),r=i.revokeObjectURL.bind(i),s=new Map,o=0;i.createObjectURL=function(t){if("getTracks"in t){var i="polyblob:"+ ++o;return s.set(i,t),e.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),i}return n(t)},i.revokeObjectURL=function(t){r(t),s.delete(t)};var a=Object.getOwnPropertyDescriptor(t.HTMLMediaElement.prototype,"src");Object.defineProperty(t.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(t){return this.srcObject=s.get(t)||null,a.set.apply(this,[t])}});var u=t.HTMLMediaElement.prototype.setAttribute;t.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),u.apply(this,arguments)}}},shimMaxMessageSize:function(t){if(!t.RTCSctpTransport&&t.RTCPeerConnection){var i=e.detectBrowser(t);"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(t){var i=n.splitSections(t.sdp);return i.shift(),i.some((function(t){var i=n.parseMLine(t);return i&&"application"===i.kind&&-1!==i.protocol.indexOf("SCTP")}))},s=function(t){var i=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===i||i.length<2)return-1;var n=parseInt(i[1],10);return n!=n?-1:n},o=function(t){var n=65536;return"firefox"===i.browser&&(n=i.version<57?-1===t?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),n},a=function(t,e){var r=65536;"firefox"===i.browser&&57===i.version&&(r=65535);var s=n.matchPrefix(t.sdp,"a=max-message-size:");return s.length>0?r=parseInt(s[0].substr(19),10):"firefox"===i.browser&&-1!==e&&(r=2147483637),r},u=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;if(t._sctp=null,r(arguments[0])){var i,n=s(arguments[0]),e=o(n),c=a(arguments[0],n);i=0===e&&0===c?Number.POSITIVE_INFINITY:0===e||0===c?Math.max(e,c):Math.min(e,c);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return i}}),t._sctp=l}return u.apply(t,arguments)}}},shimSendThrowTypeError:function(t){function i(t,i){var n=t.send;t.send=function(){var e=arguments[0];if("open"===t.readyState&&i.sctp&&(e.length||e.size||e.byteLength)>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}if(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype){var n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){var t=this,e=n.apply(t,arguments);return i(e,t),e},e.wrapPeerConnectionEvent(t,"datachannel",(function(t){return i(t.channel,t.target),t}))}}}},{"./utils":14,sdp:2}],8:[function(t,i){var n=t("../utils"),e=t("./filtericeservers"),r=t("rtcpeerconnection-shim");i.exports={shimGetUserMedia:t("./getusermedia"),shimPeerConnection:function(t){var i=n.detectBrowser(t);if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(t){return t}),t.RTCSessionDescription||(t.RTCSessionDescription=function(t){return t}),i.version<15025)){var s=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set:function(t){s.set.call(this,t);var i=new Event("enabled");i.enabled=t,this.dispatchEvent(i)}})}!t.RTCRtpSender||"dtmf"in t.RTCRtpSender.prototype||Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);var o=r(t,i.version);t.RTCPeerConnection=function(t){return t&&t.iceServers&&(t.iceServers=e(t.iceServers)),new o(t)},t.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(t){!t.RTCRtpSender||"replaceTrack"in t.RTCRtpSender.prototype||(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(t,i){var n=t("../utils");i.exports=function(t,i){var e=!1;return(t=JSON.parse(JSON.stringify(t))).filter((function(t){if(t&&(t.urls||t.url)){var r=t.urls||t.url;t.url&&!t.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var s="string"==typeof r;return s&&(r=[r]),r=r.filter((function(t){return 0!==t.indexOf("turn:")||-1===t.indexOf("transport=udp")||-1!==t.indexOf("turn:[")||e?0===t.indexOf("stun:")&&i>=14393&&-1===t.indexOf("?transport=udp"):(e=!0,!0)})),delete t.url,t.urls=s?r[0]:r,!!r.length}}))}},{"../utils":14}],10:[function(t,i){i.exports=function(t){var i=t&&t.navigator,n=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return n(t).catch((function(t){return Promise.reject(function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}}(t))}))}}},{}],11:[function(t,i){var n=t("../utils");i.exports={shimGetUserMedia:t("./getusermedia"),shimOnTrack:function(t){"object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.getTracks().forEach(function(i){var n=new Event("track");n.track=i,n.receiver={track:i},n.transceiver={receiver:n.receiver},n.streams=[t.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(t){"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(t){var i=n.detectBrowser(t);if("object"==typeof t&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){t.RTCPeerConnection||(t.RTCPeerConnection=function(n,e){if(i.version<38&&n&&n.iceServers){for(var r=[],s=0;s<n.iceServers.length;s++){var o=n.iceServers[s];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var u={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(u.username=o.username,u.credential=o.credential),r.push(u)}else r.push(n.iceServers[s])}n.iceServers=r}return new t.mozRTCPeerConnection(n,e)},t.RTCPeerConnection.prototype=t.mozRTCPeerConnection.prototype,t.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return t.mozRTCPeerConnection.generateCertificate}}),t.RTCSessionDescription=t.mozRTCSessionDescription,t.RTCIceCandidate=t.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){var n=t.RTCPeerConnection.prototype[i];t.RTCPeerConnection.prototype[i]=function(){return arguments[0]=new("addIceCandidate"===i?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var e=t.RTCPeerConnection.prototype.addIceCandidate;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,n,e){return s.apply(this,[t||null]).then((function(t){if(i.version<48&&(t=function(t){var i=new Map;return Object.keys(t).forEach((function(n){i.set(n,t[n]),i[n]=t[n]})),i}(t)),i.version<53&&!n)try{t.forEach((function(t){t.type=r[t.type]||t.type}))}catch(i){if("TypeError"!==i.name)throw i;t.forEach((function(i,n){t.set(n,Object.assign({},i,{type:r[i.type]||i.type}))}))}return t})).then(n,e)}}},shimSenderGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpSender.prototype))){var i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,n=i.apply(t,[]);return n.forEach((function(i){i._pc=t})),n});var n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpReceiver.prototype))){var i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,n=i.apply(t,[]);return n.forEach((function(i){i._pc=t})),n}),n.wrapPeerConnectionEvent(t,"track",(function(t){return t.receiver._pc=t.srcElement,t})),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var i=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&-1!==t.getTracks().indexOf(n.track)&&i.removeTrack(n)}))})},shimRTCDataChannel:function(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},shimGetDisplayMedia:function(t,i){"getDisplayMedia"in t.navigator||(navigator.getDisplayMedia=function(t){if(!t||!t.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===t.video?t.video={mediaSource:i}:t.video.mediaSource=i,navigator.mediaDevices.getUserMedia(t)})}}},{"../utils":14,"./getusermedia":12}],12:[function(t,i){var n=t("../utils"),e=n.log;i.exports=function(t){var i=n.detectBrowser(t),r=t&&t.navigator,s=t&&t.MediaStreamTrack,o=function(t){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},a=function(t,n,s){var a=function(t){if("object"!=typeof t||t.require)return t;var i=[];return Object.keys(t).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var e=t[n]="object"==typeof t[n]?t[n]:{ideal:t[n]};if(void 0===e.min&&void 0===e.max&&void 0===e.exact||i.push(n),void 0!==e.exact&&("number"==typeof e.exact?e.min=e.max=e.exact:t[n]=e.exact,delete e.exact),void 0!==e.ideal){t.advanced=t.advanced||[];var r={};r[n]="number"==typeof e.ideal?{min:e.ideal,max:e.ideal}:e.ideal,t.advanced.push(r),delete e.ideal,Object.keys(e).length||delete t[n]}}})),i.length&&(t.require=i),t};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(e("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),e("ff37: "+JSON.stringify(t))),r.mozGetUserMedia(t,n,(function(t){s(o(t))}))};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(t){return new Promise((function(i,n){a(t,i,n)}))},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise((function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},i.version<41){var u=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return u().then(void 0,(function(t){if("NotFoundError"===t.name)return[];throw t}))}}if(i.version<49){var c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return c(t).then((function(i){if(t.audio&&!i.getAudioTracks().length||t.video&&!i.getVideoTracks().length)throw i.getTracks().forEach((function(t){t.stop()})),new DOMException("The object can not be found here.","NotFoundError");return i}),(function(t){return Promise.reject(o(t))}))}}if(!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var l=function(t,i,n){i in t&&!(n in t)&&(t[n]=t[i],delete t[i])},h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(t){return"object"==typeof t&&"object"==typeof t.audio&&(t=JSON.parse(JSON.stringify(t)),l(t.audio,"autoGainControl","mozAutoGainControl"),l(t.audio,"noiseSuppression","mozNoiseSuppression")),h(t)},s&&s.prototype.getSettings){var f=s.prototype.getSettings;s.prototype.getSettings=function(){var t=f.apply(this,arguments);return l(t,"mozAutoGainControl","autoGainControl"),l(t,"mozNoiseSuppression","noiseSuppression"),t}}if(s&&s.prototype.applyConstraints){var d=s.prototype.applyConstraints;s.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)),l(t,"autoGainControl","mozAutoGainControl"),l(t,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[t])}}}r.getUserMedia=function(t,e,s){if(i.version<44)return a(t,e,s);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(t).then(e,s)}}},{"../utils":14}],13:[function(t,i){var n=t("../utils");i.exports={shimLocalStreamsAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getStreamById=function(t){var i=null;return this._localStreams&&this._localStreams.forEach((function(n){n.id===t&&(i=n)})),this._remoteStreams&&this._remoteStreams.forEach((function(n){n.id===t&&(i=n)})),i}),!("addStream"in t.RTCPeerConnection.prototype)){var i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(t)&&this._localStreams.push(t);var n=this;t.getTracks().forEach((function(e){i.call(n,e,t)}))},t.RTCPeerConnection.prototype.addTrack=function(t,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),i.call(this,t,n)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);var i=this._localStreams.indexOf(t);if(-1!==i){this._localStreams.splice(i,1);var n=this,e=t.getTracks();this.getSenders().forEach((function(t){-1!==e.indexOf(t.track)&&n.removeTrack(t)}))}})}},shimRemoteStreamsAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(t){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=t)}});var i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach((function(i){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(i)>=0)){t._remoteStreams.push(i);var n=new Event("addstream");n.stream=i,t.dispatchEvent(n)}}))}),i.apply(t,arguments)}}},shimCallbacksAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){var i=t.RTCPeerConnection.prototype,n=i.createOffer,e=i.createAnswer,r=i.setLocalDescription,s=i.setRemoteDescription,o=i.addIceCandidate;i.createOffer=function(t,i){var e=n.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return i?(e.then(t,i),Promise.resolve()):e},i.createAnswer=function(t,i){var n=e.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return i?(n.then(t,i),Promise.resolve()):n};var a=function(t,i,n){var e=r.apply(this,[t]);return n?(e.then(i,n),Promise.resolve()):e};i.setLocalDescription=a,i.setRemoteDescription=a=function(t,i,n){var e=s.apply(this,[t]);return n?(e.then(i,n),Promise.resolve()):e},i.addIceCandidate=a=function(t,i,n){var e=o.apply(this,[t]);return n?(e.then(i,n),Promise.resolve()):e}}},shimGetUserMedia:function(t){var i=t&&t.navigator;i.getUserMedia||(i.webkitGetUserMedia?i.getUserMedia=i.webkitGetUserMedia.bind(i):i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(t,n,e){i.mediaDevices.getUserMedia(t).then(n,e)}.bind(i)))},shimRTCIceServerUrls:function(t){var i=t.RTCPeerConnection;t.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var r=[],s=0;s<t.iceServers.length;s++){var o=t.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,r.push(o)):r.push(t.iceServers[s])}t.iceServers=r}return new i(t,e)},t.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in t.RTCPeerConnection&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return i.generateCertificate}})},shimTrackEventTransceiver:function(t){"object"==typeof t&&t.RTCPeerConnection&&"receiver"in t.RTCTrackEvent.prototype&&!t.RTCTransceiver&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(t){var i=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){var n=this;if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var e=n.getTransceivers().find((function(t){return t.sender.track&&"audio"===t.sender.track.kind}));!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||n.addTransceiver("audio"),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var r=n.getTransceivers().find((function(t){return t.sender.track&&"video"===t.sender.track.kind}));!1===t.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==t.offerToReceiveVideo||r||n.addTransceiver("video")}return i.apply(n,arguments)}}}},{"../utils":14}],14:[function(t,i){function n(t,i,n){var e=t.match(i);return e&&e.length>=n&&parseInt(e[n],10)}i.exports={extractVersion:n,wrapPeerConnectionEvent:function(t,i,n){if(t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,r=e.addEventListener;e.addEventListener=function(t,e){if(t!==i)return r.apply(this,arguments);var s=function(t){var i=n(t);i&&e(i)};return this._eventMap=this._eventMap||{},this._eventMap[e]=s,r.apply(this,[t,s])};var s=e.removeEventListener;e.removeEventListener=function(t,n){if(t!==i||!this._eventMap||!this._eventMap[n])return s.apply(this,arguments);var e=this._eventMap[n];return delete this._eventMap[n],s.apply(this,[t,e])},Object.defineProperty(e,"on"+i,{get:function(){return this["_on"+i]},set:function(t){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),t&&this.addEventListener(i,this["_on"+i]=t)},enumerable:!0,configurable:!0})}},disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):t?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):"adapter.js deprecation warnings "+(t?"disabled":"enabled")},log:function(){},deprecated:function(){},detectBrowser:function(t){var i=t&&t.navigator,e={browser:null,version:null};if(void 0===t||!t.navigator)return e.browser="Not a browser.",e;if(i.mozGetUserMedia)e.browser="firefox",e.version=n(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia)e.browser="chrome",e.version=n(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=n(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=n(i.userAgent,/AppleWebKit\/(\d+)\./,1)}return e}}},{}]},{},[3])(3),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(t){setTimeout((function(){t([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])}),0)},attachMediaStream=function(t,i){return t.srcObject=i,t},reattachMediaStream=function(t,i){return t.srcObject=i.srcObject,t}):navigator.webkitGetUserMedia?(attachMediaStream=function(t,n){return i.webrtcDetectedVersion>=43?t.srcObject=n:void 0!==t.src&&(t.src=URL.createObjectURL(n)),t},reattachMediaStream=function(t,n){return i.webrtcDetectedVersion>=43?t.srcObject=n.srcObject:t.src=n.src,t}):"AppleWebKit"===i.webrtcDetectedType?(attachMediaStream=function(t,i){return t.srcObject=i,t},reattachMediaStream=function(t,i){return t.srcObject=i.srcObject,t},navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=getUserMedia=function(t,i,n){navigator.mediaDevices.getUserMedia(t).then(i).catch(n)})):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(attachMediaStream=function(t,i){return t.srcObject=i,t},reattachMediaStream=function(t,i){return t.srcObject=i.srcObject,t});var n=attachMediaStream;"opera"===i.webrtcDetectedBrowser&&(n=function(t,n){i.webrtcDetectedVersion>38?t.srcObject=n:void 0!==t.src&&(t.src=URL.createObjectURL(n))}),attachMediaStream=function(t,e){return"chrome"!==i.webrtcDetectedBrowser&&"opera"!==i.webrtcDetectedBrowser||e?n(t,e):t.src="",t};var e=reattachMediaStream;reattachMediaStream=function(t,i){return e(t,i),t},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=function(t,i,n){navigator.getUserMedia(t,i,n)},i.attachMediaStream=attachMediaStream,i.reattachMediaStream=reattachMediaStream,i.getUserMedia=getUserMedia,"undefined"==typeof Promise&&(requestUserMedia=null),i.maybeThroughWebRTCReady()}else"object"==typeof console&&"function"==typeof console.log||(console={}||console,console.log=function(){},console.info=function(){},console.error=function(){},console.dir=function(){},console.exception=function(){},console.trace=function(){},console.warn=function(){},console.count=function(){},console.debug=function(){},console.count=function(){},console.time=function(){},console.timeEnd=function(){},console.group=function(){},console.groupCollapsed=function(){},console.groupEnd=function(){}),i.WebRTCPlugin.WaitForPluginReady=function(){},i.WebRTCPlugin.callWhenPluginReady=function(t){if(i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.READY)t();else var n=setInterval((function(){i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(n),t())}),100)},i.WebRTCPlugin.setLogLevel=function(t){i.WebRTCPlugin.callWhenPluginReady((function(){i.WebRTCPlugin.plugin.setLogLevel(t)}))},i.WebRTCPlugin.injectPlugin=function(){if(i.documentReady()&&i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTING;var t=document.getElementById(i.WebRTCPlugin.pluginInfo.pluginId);if(t)if(i.WebRTCPlugin.plugin=t,i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTED,i.WebRTCPlugin.plugin.valid)window[i.WebRTCPlugin.pluginInfo.onload]();else var n=setInterval((function(){i.WebRTCPlugin.plugin.valid&&(clearInterval(n),window[i.WebRTCPlugin.pluginInfo.onload]())}),100);else{if("IE"===i.webrtcDetectedBrowser&&i.webrtcDetectedVersion<=10){var e=document.createDocumentFragment();for(i.WebRTCPlugin.plugin=document.createElement("div"),i.WebRTCPlugin.plugin.innerHTML='<object id="'+i.WebRTCPlugin.pluginInfo.pluginId+'" type="'+i.WebRTCPlugin.pluginInfo.type+'" width="1" height="1"><param name="pluginId" value="'+i.WebRTCPlugin.pluginInfo.pluginId+'" /> <param name="windowless" value="false" /> <param name="pageId" value="'+i.WebRTCPlugin.pageId+'" /> <param name="onload" value="'+i.WebRTCPlugin.pluginInfo.onload+'" /><param name="tag" value="'+i.WebRTCPlugin.TAGS.NONE+'" />'+(i.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";i.WebRTCPlugin.plugin.firstChild;)e.appendChild(i.WebRTCPlugin.plugin.firstChild);document.body.appendChild(e),i.WebRTCPlugin.plugin=document.getElementById(i.WebRTCPlugin.pluginInfo.pluginId)}else i.WebRTCPlugin.plugin=document.createElement("object"),i.WebRTCPlugin.plugin.id=i.WebRTCPlugin.pluginInfo.pluginId,"IE"===i.webrtcDetectedBrowser?(i.WebRTCPlugin.plugin.width="1px",i.WebRTCPlugin.plugin.height="1px"):(i.WebRTCPlugin.plugin.width="0px",i.WebRTCPlugin.plugin.height="0px"),i.WebRTCPlugin.plugin.type=i.WebRTCPlugin.pluginInfo.type,i.WebRTCPlugin.plugin.innerHTML='<param name="onload" value="'+i.WebRTCPlugin.pluginInfo.onload+'"><param name="pluginId" value="'+i.WebRTCPlugin.pluginInfo.pluginId+'"><param name="windowless" value="false" /> '+(i.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+i.WebRTCPlugin.pageId+'"><param name="tag" value="'+i.WebRTCPlugin.TAGS.NONE+'" />',document.body.appendChild(i.WebRTCPlugin.plugin);i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTED}}},i.WebRTCPlugin.isPluginInstalled=function(t,n,e,r,s){if("IE"!==i.webrtcDetectedBrowser){var o=navigator.mimeTypes;if(void 0!==o){for(var a=0;a<o.length;a++)if(o[a].type.indexOf(e)>=0)return void r();s()}else i.renderNotificationBar(i.TEXT.PLUGIN.NOT_SUPPORTED)}else{try{new ActiveXObject(t+"."+n)}catch(t){return void s()}r()}},i.WebRTCPlugin.defineWebRTCInterface=function(){if(i.WebRTCPlugin.pluginState!==i.WebRTCPlugin.PLUGIN_STATES.READY){i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,i.isDefined=function(t){return null!=t},RTCSessionDescription=function(t){return i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.ConstructSessionDescription(t.type,t.sdp)},MediaStream=function(t){return i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.MediaStream(t)},RTCPeerConnection=function(t,n){if(null!=t&&!Array.isArray(t.iceServers))throw new Error("Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration");if(null!=n){var e=!1;if(e|="object"!=typeof n,e|=n.hasOwnProperty("mandatory")&&null!=n.mandatory&&n.mandatory.constructor!==Object,e|=n.hasOwnProperty("optional")&&null!=n.optional&&!Array.isArray(n.optional))throw new Error("Failed to construct 'RTCPeerConnection': Malformed constraints object")}i.WebRTCPlugin.WaitForPluginReady();var r=null;if(t&&Array.isArray(t.iceServers)){r=t.iceServers;for(var s=0;s<r.length;s++)r[s].urls&&!r[s].url&&(r[s].url=r[s].urls),r[s].hasCredentials=i.isDefined(r[s].username)&&i.isDefined(r[s].credential)}return i.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&i.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1?(r&&(t.iceServers=r),i.WebRTCPlugin.plugin.PeerConnection(t)):i.WebRTCPlugin.plugin.PeerConnection(i.WebRTCPlugin.pageId,r,n&&n.mandatory?n.mandatory:null,n&&n.optional?n.optional:null)},MediaStreamTrack=function(){},MediaStreamTrack.getSources=function(t){i.WebRTCPlugin.callWhenPluginReady((function(){i.WebRTCPlugin.plugin.GetSources(t)}))};var t=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;var i={};return Object.keys(t).forEach((function(n){if("require"!==n&&"advanced"!==n){if("string"==typeof t[n])return void(i[n]=t[n]);var e="object"==typeof t[n]?t[n]:{ideal:t[n]};void 0!==e.exact&&"number"==typeof e.exact&&(e.min=e.max=e.exact);var r=function(t,i){return t?t+i.charAt(0).toUpperCase()+i.slice(1):"deviceId"===i?"sourceId":i};if("sourceId"===r("",n)&&void 0!==e.exact&&(e.ideal=e.exact,e.exact=void 0),void 0!==e.ideal){i.optional=i.optional||[];var s={};"number"==typeof e.ideal?(s[r("min",n)]=e.ideal,i.optional.push(s),(s={})[r("max",n)]=e.ideal,i.optional.push(s)):(s[r("",n)]=e.ideal,i.optional.push(s))}void 0!==e.exact&&"number"!=typeof e.exact?(i.mandatory=i.mandatory||{},i.mandatory[r("",n)]=e.exact):["min","max"].forEach((function(t){void 0!==e[t]&&(i.mandatory=i.mandatory||{},i.mandatory[r(t,n)]=e[t])}))}})),t.advanced&&(i.optional=(i.optional||[]).concat(t.advanced)),i};getUserMedia=function(n,e,r){var s={};s.audio=!!n.audio&&t(n.audio),s.video=!!n.video&&t(n.video),i.WebRTCPlugin.callWhenPluginReady((function(){i.WebRTCPlugin.plugin.getUserMedia(s,e,r)}))},window.navigator.getUserMedia=getUserMedia,"undefined"!=typeof Promise&&(requestUserMedia=function(t){return new Promise((function(i,n){try{getUserMedia(t,i,n)}catch(t){n(t)}}))},void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia=requestUserMedia,navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(t){var i={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(n){t(n.map((function(t){return{label:t.label,kind:i[t.kind],id:t.id,deviceId:t.id,groupId:""}})))}))}))}),attachMediaStream=function(t,n){if(t&&t.parentNode){var e;null===n?e="":(void 0!==n.enableSoundTracks&&n.enableSoundTracks(!0),e=n.id);var r=0===t.id.length?Math.random().toString(36).slice(2):t.id,s=t.nodeName.toLowerCase();if("object"!==s){var o;switch(s){case"audio":o=i.WebRTCPlugin.TAGS.AUDIO;break;case"video":o=i.WebRTCPlugin.TAGS.VIDEO;break;default:o=i.WebRTCPlugin.TAGS.NONE}var a=document.createDocumentFragment(),u=document.createElement("div"),c="";for(t.className?c='class="'+t.className+'" ':t.attributes&&t.attributes.class&&(c='class="'+t.attributes.class.value+'" '),u.innerHTML='<object id="'+r+'" '+c+'type="'+i.WebRTCPlugin.pluginInfo.type+'"><param name="pluginId" value="'+r+'" /> <param name="pageId" value="'+i.WebRTCPlugin.pageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+e+'" /> <param name="tag" value="'+o+'" /> </object>';u.firstChild;)a.appendChild(u.firstChild);var l="",h="";t.clientWidth||t.clientHeight?(h=t.clientWidth,l=t.clientHeight):(t.width||t.height)&&(h=t.width,l=t.height),t.parentNode.insertBefore(a,t),(a=document.getElementById(r)).width=h,a.height=l,t.parentNode.removeChild(t)}else{for(var f=t.children,d=0;d!==f.length;++d)if("streamId"===f[d].name){f[d].value=e;break}t.setStreamId(e)}var m=document.getElementById(r);return i.forwardEventHandlers(m,t,Object.getPrototypeOf(t)),m}},reattachMediaStream=function(t,n){for(var e=null,r=n.children,s=0;s!==r.length;++s)if("streamId"===r[s].name){i.WebRTCPlugin.WaitForPluginReady(),e=i.WebRTCPlugin.plugin.getStreamWithId(i.WebRTCPlugin.pageId,r[s].value);break}if(null!==e)return attachMediaStream(t,e)},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,i.attachMediaStream=attachMediaStream,i.reattachMediaStream=reattachMediaStream,i.getUserMedia=getUserMedia,i.forwardEventHandlers=function(t,n,e){var r=Object.getOwnPropertyNames(e);for(var s in r)if(s){var o=r[s];"function"==typeof o.slice&&"on"===o.slice(0,2)&&"function"==typeof n[o]&&i.addEvent(t,o.slice(2),n[o])}var a=Object.getPrototypeOf(e);a&&i.forwardEventHandlers(t,n,a)},RTCIceCandidate=function(t){return t.sdpMid||(t.sdpMid=""),i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.ConstructIceCandidate(t.sdpMid,t.sdpMLineIndex,t.candidate)},i.addEvent(document,"readystatechange",i.WebRTCPlugin.injectPlugin),i.WebRTCPlugin.injectPlugin()}},i.WebRTCPlugin.pluginNeededButNotInstalledCb=i.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){i.addEvent(document,"readystatechange",i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(i.documentReady()&&(document.removeEventListener("readystatechange",i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),!i.options.hidePluginInstallPrompt)){var t,n=i.WebRTCPlugin.pluginInfo.downloadLink;n?(i.WebRTCPlugin.pluginInfo.companyName?(t="This website requires you to install the ",t+=i.WebRTCPlugin.pluginInfo.portalLink?' <a href="'+i.WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+i.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a>":i.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin",t+=" to work on this browser."):t=i.TEXT.PLUGIN.REQUIRE_INSTALLATION,i.renderNotificationBar(t,i.TEXT.PLUGIN.BUTTON,(function(){if(window.open(n,"_top"),"safari"===webrtcDetectedBrowser&&11==webrtcDetectedVersion)i.renderNotificationBar(i.TEXT.PLUGIN.REQUIRE_RESTART);else var t=setInterval((function(){"IE"!==i.webrtcDetectedBrowser&&navigator.plugins.refresh(!1),i.WebRTCPlugin.isPluginInstalled(i.WebRTCPlugin.pluginInfo.prefix,i.WebRTCPlugin.pluginInfo.plugName,i.WebRTCPlugin.pluginInfo.type,(function(){clearInterval(t),i.WebRTCPlugin.defineWebRTCInterface()}),(function(){}))}),500)}))):i.renderNotificationBar(i.TEXT.PLUGIN.NOT_SUPPORTED)}},i.WebRTCPlugin.isPluginInstalled(i.WebRTCPlugin.pluginInfo.prefix,i.WebRTCPlugin.pluginInfo.plugName,i.WebRTCPlugin.pluginInfo.type,i.WebRTCPlugin.defineWebRTCInterface,i.WebRTCPlugin.pluginNeededButNotInstalledCb);t.exports=i})),function(t){t.Webrtc="webrtc",t.Hls="hls"}(kt||(kt={}));const Tt=kt.Webrtc,St=class{constructor(t){i(this,t),this.closePlayer=r(this,"close",7),this.renderVideoElement=!0,this.playerType=kt.Webrtc,this.playerState={fullscreen:!1,playStatus:!1},this.showPlayerTypeDropdown=!1,this.surfApiHelper=new xt(this.authToken)}updateToken(t,i){if("string"!=typeof t||""===t)throw new Error("thingToDo is a required property and cannot be empty");this.surfApiHelper=new xt(this.authToken)}closePlayerHandler(){alert("closePlayerHandler"),this.closePlayer.emit()}get videoElementId(){return`${this.imei}-${this.cameraId}`}setPlayerState(t){this.playerState=Object.assign(Object.assign({},this.playerState),t)}connectedCallback(){}async initPlayer(){switch(console.log("this.videoElement",this.videoElement),this.playerType){case kt.Webrtc:this.player=c({videoElementId:this.videoElementId,videoSource:await this.getVideoSource(),videoElement:this.videoElement});break;case kt.Hls:this.player=v({videoElementId:this.videoElementId,videoSource:await this.getVideoSource(),videoElement:this.videoElement})}this.videoElement.addEventListener("restartVideo",this.restartPlayer.bind(this),{once:!0}),this.setPlayerState({playStatus:!0})}async stopPlayer(){this.player&&this.player.stop(),this.setPlayerState({playStatus:!1}),await this.toggleVideoElement()}async restartPlayer(){console.log("restartPlayer"),await this.stopPlayer(),this.initPlayer()}async getVideoSource(){let t;const{address:i,mediaToken:n}=await this.surfApiHelper.prepareDeviceMediaStreaming(this.imei);switch(this.playerType){case kt.Webrtc:t=`https://${i}/${Tt}/#PEERID#/${this.imei}/${this.cameraId}/${n}`;break;case kt.Hls:t=`https://${i}/${this.imei}/${this.cameraId}/${n}/playlist.m3u8`}return t}togglePlayer(){this.playerState.playStatus?this.stopPlayer():this.initPlayer()}togglePlayerTypeDropdown(){this.showPlayerTypeDropdown=!this.showPlayerTypeDropdown}async changePlayerType(t){this.showPlayerTypeDropdown=!1,this.playerType=t,await this.stopPlayer(),this.initPlayer()}goFullscreen(){try{(t=>{try{t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():null!=t.webkitEnterFullScreen&&t.webkitEnterFullScreen()}catch(t){throw t}})(this.hostElement),this.fullscreenTimer=window.setInterval((()=>{this.setPlayerState({fullscreen:s()}),this.playerState.fullscreen||window.clearInterval(this.fullscreenTimer)}),1e3),this.setPlayerState({fullscreen:!0})}catch(t){console.error(t)}}toggleFullscreen(){const t=s();t?(()=>{for(const t of["exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen"])if(document[t]){document[t]();break}})():this.goFullscreen(),this.setPlayerState({fullscreen:!t})}async toggleVideoElement(){this.renderVideoElement=!1,await(1e3,new Promise((t=>{setTimeout(t,1e3)}))),this.renderVideoElement=!0}render(){return n(e,null,n("div",{class:"columns m-0",ref:t=>this.hostElement=t},n("div",{class:"live-video-container columns p-0 mx-0 my-auto is-flex-wrap-wrap column is-full is-relative"},this.renderVideoElement?n("video",{ref:t=>{console.log("el",t),this.videoElement=t},style:{width:"100%"},muted:!0,id:`remoteVideo-${this.videoElementId}`,playsinline:"true",autoplay:!0}):null,n("div",{class:"live-video-controls-container is-flex is-flex-direction-row"},n("span",{class:"is-flex-grow-1"},`${this.imei} - ${this.cameraId}`),n("slot",{name:"button"}),n("span",{class:"icon is-clickable",onClick:()=>this.togglePlayer(),innerHTML:this.playerState.playStatus?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8 19c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2s-2 .9-2 2v10c0 1.1.9 2 2 2zm6-12v10c0 1.1.9 2 2 2s2-.9 2-2V7c0-1.1-.9-2-2-2s-2 .9-2 2z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.69L9.54 5.98A.998.998 0 0 0 8 6.82z"/></svg>'}),n("div",{class:"dropdown is-up "+(this.showPlayerTypeDropdown?"is-active":"")},n("div",{class:"dropdown-trigger"},n("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:()=>this.togglePlayerTypeDropdown()},n("span",null,this.playerType),n("span",{class:"icon is-small"},n("i",{class:"fas fa-angle-down","aria-hidden":"true"})))),n("div",{class:"dropdown-menu",id:"dropdown-menu",role:"menu"},n("div",{class:"dropdown-content"},[kt.Webrtc,kt.Hls].map((t=>n("span",{class:"dropdown-item "+(this.playerType===t?"is-active":""),onClick:()=>this.changePlayerType(t)},t)))))),n("span",{class:"icon is-clickable",onClick:()=>this.toggleFullscreen(),innerHTML:this.playerState.fullscreen?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 16h2v2c0 .55.45 1 1 1s1-.45 1-1v-3c0-.55-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1zm2-8H6c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1s-1 .45-1 1v2zm7 11c.55 0 1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1h-3c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm1-11V6c0-.55-.45-1-1-1s-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1h-2z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 14c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1H7v-2c0-.55-.45-1-1-1zm0-4c.55 0 1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm11 7h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v2zM14 6c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1z"/></svg>'}),n("span",{class:"icon is-clickable",onClick:()=>this.closePlayerHandler(),innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>'})))))}static get watchers(){return{authToken:["updateToken"]}}};St.style=".is-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.is-overlay{bottom:0;left:0;position:absolute;right:0;top:0}.is-block{display:block !important}@media screen and (max-width: 768px){.is-block-mobile{display:block !important}}@media screen and (min-width: 769px), print{.is-block-tablet{display:block !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-block-tablet-only{display:block !important}}@media screen and (max-width: 1023px){.is-block-touch{display:block !important}}@media screen and (min-width: 1024px){.is-block-desktop{display:block !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-block-desktop-only{display:block !important}}@media screen and (min-width: 1216px){.is-block-widescreen{display:block !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-block-widescreen-only{display:block !important}}@media screen and (min-width: 1408px){.is-block-fullhd{display:block !important}}.is-flex{display:flex !important}@media screen and (max-width: 768px){.is-flex-mobile{display:flex !important}}@media screen and (min-width: 769px), print{.is-flex-tablet{display:flex !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-flex-tablet-only{display:flex !important}}@media screen and (max-width: 1023px){.is-flex-touch{display:flex !important}}@media screen and (min-width: 1024px){.is-flex-desktop{display:flex !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-flex-desktop-only{display:flex !important}}@media screen and (min-width: 1216px){.is-flex-widescreen{display:flex !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-flex-widescreen-only{display:flex !important}}@media screen and (min-width: 1408px){.is-flex-fullhd{display:flex !important}}.is-inline{display:inline !important}@media screen and (max-width: 768px){.is-inline-mobile{display:inline !important}}@media screen and (min-width: 769px), print{.is-inline-tablet{display:inline !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-inline-tablet-only{display:inline !important}}@media screen and (max-width: 1023px){.is-inline-touch{display:inline !important}}@media screen and (min-width: 1024px){.is-inline-desktop{display:inline !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-inline-desktop-only{display:inline !important}}@media screen and (min-width: 1216px){.is-inline-widescreen{display:inline !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-inline-widescreen-only{display:inline !important}}@media screen and (min-width: 1408px){.is-inline-fullhd{display:inline !important}}.is-inline-block{display:inline-block !important}@media screen and (max-width: 768px){.is-inline-block-mobile{display:inline-block !important}}@media screen and (min-width: 769px), print{.is-inline-block-tablet{display:inline-block !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-inline-block-tablet-only{display:inline-block !important}}@media screen and (max-width: 1023px){.is-inline-block-touch{display:inline-block !important}}@media screen and (min-width: 1024px){.is-inline-block-desktop{display:inline-block !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-inline-block-desktop-only{display:inline-block !important}}@media screen and (min-width: 1216px){.is-inline-block-widescreen{display:inline-block !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-inline-block-widescreen-only{display:inline-block !important}}@media screen and (min-width: 1408px){.is-inline-block-fullhd{display:inline-block !important}}.is-inline-flex{display:inline-flex !important}@media screen and (max-width: 768px){.is-inline-flex-mobile{display:inline-flex !important}}@media screen and (min-width: 769px), print{.is-inline-flex-tablet{display:inline-flex !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-inline-flex-tablet-only{display:inline-flex !important}}@media screen and (max-width: 1023px){.is-inline-flex-touch{display:inline-flex !important}}@media screen and (min-width: 1024px){.is-inline-flex-desktop{display:inline-flex !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-inline-flex-desktop-only{display:inline-flex !important}}@media screen and (min-width: 1216px){.is-inline-flex-widescreen{display:inline-flex !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-inline-flex-widescreen-only{display:inline-flex !important}}@media screen and (min-width: 1408px){.is-inline-flex-fullhd{display:inline-flex !important}}.is-hidden{display:none !important}.is-sr-only{border:none !important;clip:rect(0, 0, 0, 0) !important;height:0.01em !important;overflow:hidden !important;padding:0 !important;position:absolute !important;white-space:nowrap !important;width:0.01em !important}@media screen and (max-width: 768px){.is-hidden-mobile{display:none !important}}@media screen and (min-width: 769px), print{.is-hidden-tablet{display:none !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-hidden-tablet-only{display:none !important}}@media screen and (max-width: 1023px){.is-hidden-touch{display:none !important}}@media screen and (min-width: 1024px){.is-hidden-desktop{display:none !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-hidden-desktop-only{display:none !important}}@media screen and (min-width: 1216px){.is-hidden-widescreen{display:none !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-hidden-widescreen-only{display:none !important}}@media screen and (min-width: 1408px){.is-hidden-fullhd{display:none !important}}.is-invisible{visibility:hidden !important}@media screen and (max-width: 768px){.is-invisible-mobile{visibility:hidden !important}}@media screen and (min-width: 769px), print{.is-invisible-tablet{visibility:hidden !important}}@media screen and (min-width: 769px) and (max-width: 1023px){.is-invisible-tablet-only{visibility:hidden !important}}@media screen and (max-width: 1023px){.is-invisible-touch{visibility:hidden !important}}@media screen and (min-width: 1024px){.is-invisible-desktop{visibility:hidden !important}}@media screen and (min-width: 1024px) and (max-width: 1215px){.is-invisible-desktop-only{visibility:hidden !important}}@media screen and (min-width: 1216px){.is-invisible-widescreen{visibility:hidden !important}}@media screen and (min-width: 1216px) and (max-width: 1407px){.is-invisible-widescreen-only{visibility:hidden !important}}@media screen and (min-width: 1408px){.is-invisible-fullhd{visibility:hidden !important}}.is-flex-direction-row{flex-direction:row !important}.is-flex-direction-row-reverse{flex-direction:row-reverse !important}.is-flex-direction-column{flex-direction:column !important}.is-flex-direction-column-reverse{flex-direction:column-reverse !important}.is-flex-wrap-nowrap{flex-wrap:nowrap !important}.is-flex-wrap-wrap{flex-wrap:wrap !important}.is-flex-wrap-wrap-reverse{flex-wrap:wrap-reverse !important}.is-justify-content-flex-start{justify-content:flex-start !important}.is-justify-content-flex-end{justify-content:flex-end !important}.is-justify-content-center{justify-content:center !important}.is-justify-content-space-between{justify-content:space-between !important}.is-justify-content-space-around{justify-content:space-around !important}.is-justify-content-space-evenly{justify-content:space-evenly !important}.is-justify-content-start{justify-content:start !important}.is-justify-content-end{justify-content:end !important}.is-justify-content-left{justify-content:left !important}.is-justify-content-right{justify-content:right !important}.is-align-content-flex-start{align-content:flex-start !important}.is-align-content-flex-end{align-content:flex-end !important}.is-align-content-center{align-content:center !important}.is-align-content-space-between{align-content:space-between !important}.is-align-content-space-around{align-content:space-around !important}.is-align-content-space-evenly{align-content:space-evenly !important}.is-align-content-stretch{align-content:stretch !important}.is-align-content-start{align-content:start !important}.is-align-content-end{align-content:end !important}.is-align-content-baseline{align-content:baseline !important}.is-align-items-stretch{align-items:stretch !important}.is-align-items-flex-start{align-items:flex-start !important}.is-align-items-flex-end{align-items:flex-end !important}.is-align-items-center{align-items:center !important}.is-align-items-baseline{align-items:baseline !important}.is-align-items-start{align-items:start !important}.is-align-items-end{align-items:end !important}.is-align-items-self-start{align-items:self-start !important}.is-align-items-self-end{align-items:self-end !important}.is-align-self-auto{align-self:auto !important}.is-align-self-flex-start{align-self:flex-start !important}.is-align-self-flex-end{align-self:flex-end !important}.is-align-self-center{align-self:center !important}.is-align-self-baseline{align-self:baseline !important}.is-align-self-stretch{align-self:stretch !important}.is-flex-grow-0{flex-grow:0 !important}.is-flex-grow-1{flex-grow:1 !important}.is-flex-grow-2{flex-grow:2 !important}.is-flex-grow-3{flex-grow:3 !important}.is-flex-grow-4{flex-grow:4 !important}.is-flex-grow-5{flex-grow:5 !important}.is-flex-shrink-0{flex-shrink:0 !important}.is-flex-shrink-1{flex-shrink:1 !important}.is-flex-shrink-2{flex-shrink:2 !important}.is-flex-shrink-3{flex-shrink:3 !important}.is-flex-shrink-4{flex-shrink:4 !important}.is-flex-shrink-5{flex-shrink:5 !important}.is-marginless{margin:0 !important}.is-paddingless{padding:0 !important}.m-0{margin:0 !important}.mt-0{margin-top:0 !important}.mr-0{margin-right:0 !important}.mb-0{margin-bottom:0 !important}.ml-0{margin-left:0 !important}.mx-0{margin-left:0 !important;margin-right:0 !important}.my-0{margin-top:0 !important;margin-bottom:0 !important}.m-1{margin:0.25rem !important}.mt-1{margin-top:0.25rem !important}.mr-1{margin-right:0.25rem !important}.mb-1{margin-bottom:0.25rem !important}.ml-1{margin-left:0.25rem !important}.mx-1{margin-left:0.25rem !important;margin-right:0.25rem !important}.my-1{margin-top:0.25rem !important;margin-bottom:0.25rem !important}.m-2{margin:0.5rem !important}.mt-2{margin-top:0.5rem !important}.mr-2{margin-right:0.5rem !important}.mb-2{margin-bottom:0.5rem !important}.ml-2{margin-left:0.5rem !important}.mx-2{margin-left:0.5rem !important;margin-right:0.5rem !important}.my-2{margin-top:0.5rem !important;margin-bottom:0.5rem !important}.m-3{margin:0.75rem !important}.mt-3{margin-top:0.75rem !important}.mr-3{margin-right:0.75rem !important}.mb-3{margin-bottom:0.75rem !important}.ml-3{margin-left:0.75rem !important}.mx-3{margin-left:0.75rem !important;margin-right:0.75rem !important}.my-3{margin-top:0.75rem !important;margin-bottom:0.75rem !important}.m-4{margin:1rem !important}.mt-4{margin-top:1rem !important}.mr-4{margin-right:1rem !important}.mb-4{margin-bottom:1rem !important}.ml-4{margin-left:1rem !important}.mx-4{margin-left:1rem !important;margin-right:1rem !important}.my-4{margin-top:1rem !important;margin-bottom:1rem !important}.m-5{margin:1.5rem !important}.mt-5{margin-top:1.5rem !important}.mr-5{margin-right:1.5rem !important}.mb-5{margin-bottom:1.5rem !important}.ml-5{margin-left:1.5rem !important}.mx-5{margin-left:1.5rem !important;margin-right:1.5rem !important}.my-5{margin-top:1.5rem !important;margin-bottom:1.5rem !important}.m-6{margin:3rem !important}.mt-6{margin-top:3rem !important}.mr-6{margin-right:3rem !important}.mb-6{margin-bottom:3rem !important}.ml-6{margin-left:3rem !important}.mx-6{margin-left:3rem !important;margin-right:3rem !important}.my-6{margin-top:3rem !important;margin-bottom:3rem !important}.m-auto{margin:auto !important}.mt-auto{margin-top:auto !important}.mr-auto{margin-right:auto !important}.mb-auto{margin-bottom:auto !important}.ml-auto{margin-left:auto !important}.mx-auto{margin-left:auto !important;margin-right:auto !important}.my-auto{margin-top:auto !important;margin-bottom:auto !important}.p-0{padding:0 !important}.pt-0{padding-top:0 !important}.pr-0{padding-right:0 !important}.pb-0{padding-bottom:0 !important}.pl-0{padding-left:0 !important}.px-0{padding-left:0 !important;padding-right:0 !important}.py-0{padding-top:0 !important;padding-bottom:0 !important}.p-1{padding:0.25rem !important}.pt-1{padding-top:0.25rem !important}.pr-1{padding-right:0.25rem !important}.pb-1{padding-bottom:0.25rem !important}.pl-1{padding-left:0.25rem !important}.px-1{padding-left:0.25rem !important;padding-right:0.25rem !important}.py-1{padding-top:0.25rem !important;padding-bottom:0.25rem !important}.p-2{padding:0.5rem !important}.pt-2{padding-top:0.5rem !important}.pr-2{padding-right:0.5rem !important}.pb-2{padding-bottom:0.5rem !important}.pl-2{padding-left:0.5rem !important}.px-2{padding-left:0.5rem !important;padding-right:0.5rem !important}.py-2{padding-top:0.5rem !important;padding-bottom:0.5rem !important}.p-3{padding:0.75rem !important}.pt-3{padding-top:0.75rem !important}.pr-3{padding-right:0.75rem !important}.pb-3{padding-bottom:0.75rem !important}.pl-3{padding-left:0.75rem !important}.px-3{padding-left:0.75rem !important;padding-right:0.75rem !important}.py-3{padding-top:0.75rem !important;padding-bottom:0.75rem !important}.p-4{padding:1rem !important}.pt-4{padding-top:1rem !important}.pr-4{padding-right:1rem !important}.pb-4{padding-bottom:1rem !important}.pl-4{padding-left:1rem !important}.px-4{padding-left:1rem !important;padding-right:1rem !important}.py-4{padding-top:1rem !important;padding-bottom:1rem !important}.p-5{padding:1.5rem !important}.pt-5{padding-top:1.5rem !important}.pr-5{padding-right:1.5rem !important}.pb-5{padding-bottom:1.5rem !important}.pl-5{padding-left:1.5rem !important}.px-5{padding-left:1.5rem !important;padding-right:1.5rem !important}.py-5{padding-top:1.5rem !important;padding-bottom:1.5rem !important}.p-6{padding:3rem !important}.pt-6{padding-top:3rem !important}.pr-6{padding-right:3rem !important}.pb-6{padding-bottom:3rem !important}.pl-6{padding-left:3rem !important}.px-6{padding-left:3rem !important;padding-right:3rem !important}.py-6{padding-top:3rem !important;padding-bottom:3rem !important}.p-auto{padding:auto !important}.pt-auto{padding-top:auto !important}.pr-auto{padding-right:auto !important}.pb-auto{padding-bottom:auto !important}.pl-auto{padding-left:auto !important}.px-auto{padding-left:auto !important;padding-right:auto !important}.py-auto{padding-top:auto !important;padding-bottom:auto !important}.is-relative{position:relative !important}.is-radiusless{border-radius:0 !important}.is-shadowless{box-shadow:none !important}.is-clickable{cursor:pointer !important;pointer-events:all !important}.column{display:block;flex-basis:0;flex-grow:1;flex-shrink:1;padding:0.75rem}.columns.is-mobile>.column.is-narrow{flex:none;width:unset}.columns.is-mobile>.column.is-full{flex:none;width:100%}.columns.is-mobile>.column.is-three-quarters{flex:none;width:75%}.columns.is-mobile>.column.is-two-thirds{flex:none;width:66.6666%}.columns.is-mobile>.column.is-half{flex:none;width:50%}.columns.is-mobile>.column.is-one-third{flex:none;width:33.3333%}.columns.is-mobile>.column.is-one-quarter{flex:none;width:25%}.columns.is-mobile>.column.is-one-fifth{flex:none;width:20%}.columns.is-mobile>.column.is-two-fifths{flex:none;width:40%}.columns.is-mobile>.column.is-three-fifths{flex:none;width:60%}.columns.is-mobile>.column.is-four-fifths{flex:none;width:80%}.columns.is-mobile>.column.is-offset-three-quarters{margin-left:75%}.columns.is-mobile>.column.is-offset-two-thirds{margin-left:66.6666%}.columns.is-mobile>.column.is-offset-half{margin-left:50%}.columns.is-mobile>.column.is-offset-one-third{margin-left:33.3333%}.columns.is-mobile>.column.is-offset-one-quarter{margin-left:25%}.columns.is-mobile>.column.is-offset-one-fifth{margin-left:20%}.columns.is-mobile>.column.is-offset-two-fifths{margin-left:40%}.columns.is-mobile>.column.is-offset-three-fifths{margin-left:60%}.columns.is-mobile>.column.is-offset-four-fifths{margin-left:80%}.columns.is-mobile>.column.is-0{flex:none;width:0%}.columns.is-mobile>.column.is-offset-0{margin-left:0%}.columns.is-mobile>.column.is-1{flex:none;width:8.33333337%}.columns.is-mobile>.column.is-offset-1{margin-left:8.33333337%}.columns.is-mobile>.column.is-2{flex:none;width:16.66666674%}.columns.is-mobile>.column.is-offset-2{margin-left:16.66666674%}.columns.is-mobile>.column.is-3{flex:none;width:25%}.columns.is-mobile>.column.is-offset-3{margin-left:25%}.columns.is-mobile>.column.is-4{flex:none;width:33.33333337%}.columns.is-mobile>.column.is-offset-4{margin-left:33.33333337%}.columns.is-mobile>.column.is-5{flex:none;width:41.66666674%}.columns.is-mobile>.column.is-offset-5{margin-left:41.66666674%}.columns.is-mobile>.column.is-6{flex:none;width:50%}.columns.is-mobile>.column.is-offset-6{margin-left:50%}.columns.is-mobile>.column.is-7{flex:none;width:58.33333337%}.columns.is-mobile>.column.is-offset-7{margin-left:58.33333337%}.columns.is-mobile>.column.is-8{flex:none;width:66.66666674%}.columns.is-mobile>.column.is-offset-8{margin-left:66.66666674%}.columns.is-mobile>.column.is-9{flex:none;width:75%}.columns.is-mobile>.column.is-offset-9{margin-left:75%}.columns.is-mobile>.column.is-10{flex:none;width:83.33333337%}.columns.is-mobile>.column.is-offset-10{margin-left:83.33333337%}.columns.is-mobile>.column.is-11{flex:none;width:91.66666674%}.columns.is-mobile>.column.is-offset-11{margin-left:91.66666674%}.columns.is-mobile>.column.is-12{flex:none;width:100%}.columns.is-mobile>.column.is-offset-12{margin-left:100%}@media screen and (max-width: 768px){.column.is-narrow-mobile{flex:none;width:unset}.column.is-full-mobile{flex:none;width:100%}.column.is-three-quarters-mobile{flex:none;width:75%}.column.is-two-thirds-mobile{flex:none;width:66.6666%}.column.is-half-mobile{flex:none;width:50%}.column.is-one-third-mobile{flex:none;width:33.3333%}.column.is-one-quarter-mobile{flex:none;width:25%}.column.is-one-fifth-mobile{flex:none;width:20%}.column.is-two-fifths-mobile{flex:none;width:40%}.column.is-three-fifths-mobile{flex:none;width:60%}.column.is-four-fifths-mobile{flex:none;width:80%}.column.is-offset-three-quarters-mobile{margin-left:75%}.column.is-offset-two-thirds-mobile{margin-left:66.6666%}.column.is-offset-half-mobile{margin-left:50%}.column.is-offset-one-third-mobile{margin-left:33.3333%}.column.is-offset-one-quarter-mobile{margin-left:25%}.column.is-offset-one-fifth-mobile{margin-left:20%}.column.is-offset-two-fifths-mobile{margin-left:40%}.column.is-offset-three-fifths-mobile{margin-left:60%}.column.is-offset-four-fifths-mobile{margin-left:80%}.column.is-0-mobile{flex:none;width:0%}.column.is-offset-0-mobile{margin-left:0%}.column.is-1-mobile{flex:none;width:8.33333337%}.column.is-offset-1-mobile{margin-left:8.33333337%}.column.is-2-mobile{flex:none;width:16.66666674%}.column.is-offset-2-mobile{margin-left:16.66666674%}.column.is-3-mobile{flex:none;width:25%}.column.is-offset-3-mobile{margin-left:25%}.column.is-4-mobile{flex:none;width:33.33333337%}.column.is-offset-4-mobile{margin-left:33.33333337%}.column.is-5-mobile{flex:none;width:41.66666674%}.column.is-offset-5-mobile{margin-left:41.66666674%}.column.is-6-mobile{flex:none;width:50%}.column.is-offset-6-mobile{margin-left:50%}.column.is-7-mobile{flex:none;width:58.33333337%}.column.is-offset-7-mobile{margin-left:58.33333337%}.column.is-8-mobile{flex:none;width:66.66666674%}.column.is-offset-8-mobile{margin-left:66.66666674%}.column.is-9-mobile{flex:none;width:75%}.column.is-offset-9-mobile{margin-left:75%}.column.is-10-mobile{flex:none;width:83.33333337%}.column.is-offset-10-mobile{margin-left:83.33333337%}.column.is-11-mobile{flex:none;width:91.66666674%}.column.is-offset-11-mobile{margin-left:91.66666674%}.column.is-12-mobile{flex:none;width:100%}.column.is-offset-12-mobile{margin-left:100%}}@media screen and (min-width: 769px), print{.column.is-narrow,.column.is-narrow-tablet{flex:none;width:unset}.column.is-full,.column.is-full-tablet{flex:none;width:100%}.column.is-three-quarters,.column.is-three-quarters-tablet{flex:none;width:75%}.column.is-two-thirds,.column.is-two-thirds-tablet{flex:none;width:66.6666%}.column.is-half,.column.is-half-tablet{flex:none;width:50%}.column.is-one-third,.column.is-one-third-tablet{flex:none;width:33.3333%}.column.is-one-quarter,.column.is-one-quarter-tablet{flex:none;width:25%}.column.is-one-fifth,.column.is-one-fifth-tablet{flex:none;width:20%}.column.is-two-fifths,.column.is-two-fifths-tablet{flex:none;width:40%}.column.is-three-fifths,.column.is-three-fifths-tablet{flex:none;width:60%}.column.is-four-fifths,.column.is-four-fifths-tablet{flex:none;width:80%}.column.is-offset-three-quarters,.column.is-offset-three-quarters-tablet{margin-left:75%}.column.is-offset-two-thirds,.column.is-offset-two-thirds-tablet{margin-left:66.6666%}.column.is-offset-half,.column.is-offset-half-tablet{margin-left:50%}.column.is-offset-one-third,.column.is-offset-one-third-tablet{margin-left:33.3333%}.column.is-offset-one-quarter,.column.is-offset-one-quarter-tablet{margin-left:25%}.column.is-offset-one-fifth,.column.is-offset-one-fifth-tablet{margin-left:20%}.column.is-offset-two-fifths,.column.is-offset-two-fifths-tablet{margin-left:40%}.column.is-offset-three-fifths,.column.is-offset-three-fifths-tablet{margin-left:60%}.column.is-offset-four-fifths,.column.is-offset-four-fifths-tablet{margin-left:80%}.column.is-0,.column.is-0-tablet{flex:none;width:0%}.column.is-offset-0,.column.is-offset-0-tablet{margin-left:0%}.column.is-1,.column.is-1-tablet{flex:none;width:8.33333337%}.column.is-offset-1,.column.is-offset-1-tablet{margin-left:8.33333337%}.column.is-2,.column.is-2-tablet{flex:none;width:16.66666674%}.column.is-offset-2,.column.is-offset-2-tablet{margin-left:16.66666674%}.column.is-3,.column.is-3-tablet{flex:none;width:25%}.column.is-offset-3,.column.is-offset-3-tablet{margin-left:25%}.column.is-4,.column.is-4-tablet{flex:none;width:33.33333337%}.column.is-offset-4,.column.is-offset-4-tablet{margin-left:33.33333337%}.column.is-5,.column.is-5-tablet{flex:none;width:41.66666674%}.column.is-offset-5,.column.is-offset-5-tablet{margin-left:41.66666674%}.column.is-6,.column.is-6-tablet{flex:none;width:50%}.column.is-offset-6,.column.is-offset-6-tablet{margin-left:50%}.column.is-7,.column.is-7-tablet{flex:none;width:58.33333337%}.column.is-offset-7,.column.is-offset-7-tablet{margin-left:58.33333337%}.column.is-8,.column.is-8-tablet{flex:none;width:66.66666674%}.column.is-offset-8,.column.is-offset-8-tablet{margin-left:66.66666674%}.column.is-9,.column.is-9-tablet{flex:none;width:75%}.column.is-offset-9,.column.is-offset-9-tablet{margin-left:75%}.column.is-10,.column.is-10-tablet{flex:none;width:83.33333337%}.column.is-offset-10,.column.is-offset-10-tablet{margin-left:83.33333337%}.column.is-11,.column.is-11-tablet{flex:none;width:91.66666674%}.column.is-offset-11,.column.is-offset-11-tablet{margin-left:91.66666674%}.column.is-12,.column.is-12-tablet{flex:none;width:100%}.column.is-offset-12,.column.is-offset-12-tablet{margin-left:100%}}@media screen and (max-width: 1023px){.column.is-narrow-touch{flex:none;width:unset}.column.is-full-touch{flex:none;width:100%}.column.is-three-quarters-touch{flex:none;width:75%}.column.is-two-thirds-touch{flex:none;width:66.6666%}.column.is-half-touch{flex:none;width:50%}.column.is-one-third-touch{flex:none;width:33.3333%}.column.is-one-quarter-touch{flex:none;width:25%}.column.is-one-fifth-touch{flex:none;width:20%}.column.is-two-fifths-touch{flex:none;width:40%}.column.is-three-fifths-touch{flex:none;width:60%}.column.is-four-fifths-touch{flex:none;width:80%}.column.is-offset-three-quarters-touch{margin-left:75%}.column.is-offset-two-thirds-touch{margin-left:66.6666%}.column.is-offset-half-touch{margin-left:50%}.column.is-offset-one-third-touch{margin-left:33.3333%}.column.is-offset-one-quarter-touch{margin-left:25%}.column.is-offset-one-fifth-touch{margin-left:20%}.column.is-offset-two-fifths-touch{margin-left:40%}.column.is-offset-three-fifths-touch{margin-left:60%}.column.is-offset-four-fifths-touch{margin-left:80%}.column.is-0-touch{flex:none;width:0%}.column.is-offset-0-touch{margin-left:0%}.column.is-1-touch{flex:none;width:8.33333337%}.column.is-offset-1-touch{margin-left:8.33333337%}.column.is-2-touch{flex:none;width:16.66666674%}.column.is-offset-2-touch{margin-left:16.66666674%}.column.is-3-touch{flex:none;width:25%}.column.is-offset-3-touch{margin-left:25%}.column.is-4-touch{flex:none;width:33.33333337%}.column.is-offset-4-touch{margin-left:33.33333337%}.column.is-5-touch{flex:none;width:41.66666674%}.column.is-offset-5-touch{margin-left:41.66666674%}.column.is-6-touch{flex:none;width:50%}.column.is-offset-6-touch{margin-left:50%}.column.is-7-touch{flex:none;width:58.33333337%}.column.is-offset-7-touch{margin-left:58.33333337%}.column.is-8-touch{flex:none;width:66.66666674%}.column.is-offset-8-touch{margin-left:66.66666674%}.column.is-9-touch{flex:none;width:75%}.column.is-offset-9-touch{margin-left:75%}.column.is-10-touch{flex:none;width:83.33333337%}.column.is-offset-10-touch{margin-left:83.33333337%}.column.is-11-touch{flex:none;width:91.66666674%}.column.is-offset-11-touch{margin-left:91.66666674%}.column.is-12-touch{flex:none;width:100%}.column.is-offset-12-touch{margin-left:100%}}@media screen and (min-width: 1024px){.column.is-narrow-desktop{flex:none;width:unset}.column.is-full-desktop{flex:none;width:100%}.column.is-three-quarters-desktop{flex:none;width:75%}.column.is-two-thirds-desktop{flex:none;width:66.6666%}.column.is-half-desktop{flex:none;width:50%}.column.is-one-third-desktop{flex:none;width:33.3333%}.column.is-one-quarter-desktop{flex:none;width:25%}.column.is-one-fifth-desktop{flex:none;width:20%}.column.is-two-fifths-desktop{flex:none;width:40%}.column.is-three-fifths-desktop{flex:none;width:60%}.column.is-four-fifths-desktop{flex:none;width:80%}.column.is-offset-three-quarters-desktop{margin-left:75%}.column.is-offset-two-thirds-desktop{margin-left:66.6666%}.column.is-offset-half-desktop{margin-left:50%}.column.is-offset-one-third-desktop{margin-left:33.3333%}.column.is-offset-one-quarter-desktop{margin-left:25%}.column.is-offset-one-fifth-desktop{margin-left:20%}.column.is-offset-two-fifths-desktop{margin-left:40%}.column.is-offset-three-fifths-desktop{margin-left:60%}.column.is-offset-four-fifths-desktop{margin-left:80%}.column.is-0-desktop{flex:none;width:0%}.column.is-offset-0-desktop{margin-left:0%}.column.is-1-desktop{flex:none;width:8.33333337%}.column.is-offset-1-desktop{margin-left:8.33333337%}.column.is-2-desktop{flex:none;width:16.66666674%}.column.is-offset-2-desktop{margin-left:16.66666674%}.column.is-3-desktop{flex:none;width:25%}.column.is-offset-3-desktop{margin-left:25%}.column.is-4-desktop{flex:none;width:33.33333337%}.column.is-offset-4-desktop{margin-left:33.33333337%}.column.is-5-desktop{flex:none;width:41.66666674%}.column.is-offset-5-desktop{margin-left:41.66666674%}.column.is-6-desktop{flex:none;width:50%}.column.is-offset-6-desktop{margin-left:50%}.column.is-7-desktop{flex:none;width:58.33333337%}.column.is-offset-7-desktop{margin-left:58.33333337%}.column.is-8-desktop{flex:none;width:66.66666674%}.column.is-offset-8-desktop{margin-left:66.66666674%}.column.is-9-desktop{flex:none;width:75%}.column.is-offset-9-desktop{margin-left:75%}.column.is-10-desktop{flex:none;width:83.33333337%}.column.is-offset-10-desktop{margin-left:83.33333337%}.column.is-11-desktop{flex:none;width:91.66666674%}.column.is-offset-11-desktop{margin-left:91.66666674%}.column.is-12-desktop{flex:none;width:100%}.column.is-offset-12-desktop{margin-left:100%}}@media screen and (min-width: 1216px){.column.is-narrow-widescreen{flex:none;width:unset}.column.is-full-widescreen{flex:none;width:100%}.column.is-three-quarters-widescreen{flex:none;width:75%}.column.is-two-thirds-widescreen{flex:none;width:66.6666%}.column.is-half-widescreen{flex:none;width:50%}.column.is-one-third-widescreen{flex:none;width:33.3333%}.column.is-one-quarter-widescreen{flex:none;width:25%}.column.is-one-fifth-widescreen{flex:none;width:20%}.column.is-two-fifths-widescreen{flex:none;width:40%}.column.is-three-fifths-widescreen{flex:none;width:60%}.column.is-four-fifths-widescreen{flex:none;width:80%}.column.is-offset-three-quarters-widescreen{margin-left:75%}.column.is-offset-two-thirds-widescreen{margin-left:66.6666%}.column.is-offset-half-widescreen{margin-left:50%}.column.is-offset-one-third-widescreen{margin-left:33.3333%}.column.is-offset-one-quarter-widescreen{margin-left:25%}.column.is-offset-one-fifth-widescreen{margin-left:20%}.column.is-offset-two-fifths-widescreen{margin-left:40%}.column.is-offset-three-fifths-widescreen{margin-left:60%}.column.is-offset-four-fifths-widescreen{margin-left:80%}.column.is-0-widescreen{flex:none;width:0%}.column.is-offset-0-widescreen{margin-left:0%}.column.is-1-widescreen{flex:none;width:8.33333337%}.column.is-offset-1-widescreen{margin-left:8.33333337%}.column.is-2-widescreen{flex:none;width:16.66666674%}.column.is-offset-2-widescreen{margin-left:16.66666674%}.column.is-3-widescreen{flex:none;width:25%}.column.is-offset-3-widescreen{margin-left:25%}.column.is-4-widescreen{flex:none;width:33.33333337%}.column.is-offset-4-widescreen{margin-left:33.33333337%}.column.is-5-widescreen{flex:none;width:41.66666674%}.column.is-offset-5-widescreen{margin-left:41.66666674%}.column.is-6-widescreen{flex:none;width:50%}.column.is-offset-6-widescreen{margin-left:50%}.column.is-7-widescreen{flex:none;width:58.33333337%}.column.is-offset-7-widescreen{margin-left:58.33333337%}.column.is-8-widescreen{flex:none;width:66.66666674%}.column.is-offset-8-widescreen{margin-left:66.66666674%}.column.is-9-widescreen{flex:none;width:75%}.column.is-offset-9-widescreen{margin-left:75%}.column.is-10-widescreen{flex:none;width:83.33333337%}.column.is-offset-10-widescreen{margin-left:83.33333337%}.column.is-11-widescreen{flex:none;width:91.66666674%}.column.is-offset-11-widescreen{margin-left:91.66666674%}.column.is-12-widescreen{flex:none;width:100%}.column.is-offset-12-widescreen{margin-left:100%}}@media screen and (min-width: 1408px){.column.is-narrow-fullhd{flex:none;width:unset}.column.is-full-fullhd{flex:none;width:100%}.column.is-three-quarters-fullhd{flex:none;width:75%}.column.is-two-thirds-fullhd{flex:none;width:66.6666%}.column.is-half-fullhd{flex:none;width:50%}.column.is-one-third-fullhd{flex:none;width:33.3333%}.column.is-one-quarter-fullhd{flex:none;width:25%}.column.is-one-fifth-fullhd{flex:none;width:20%}.column.is-two-fifths-fullhd{flex:none;width:40%}.column.is-three-fifths-fullhd{flex:none;width:60%}.column.is-four-fifths-fullhd{flex:none;width:80%}.column.is-offset-three-quarters-fullhd{margin-left:75%}.column.is-offset-two-thirds-fullhd{margin-left:66.6666%}.column.is-offset-half-fullhd{margin-left:50%}.column.is-offset-one-third-fullhd{margin-left:33.3333%}.column.is-offset-one-quarter-fullhd{margin-left:25%}.column.is-offset-one-fifth-fullhd{margin-left:20%}.column.is-offset-two-fifths-fullhd{margin-left:40%}.column.is-offset-three-fifths-fullhd{margin-left:60%}.column.is-offset-four-fifths-fullhd{margin-left:80%}.column.is-0-fullhd{flex:none;width:0%}.column.is-offset-0-fullhd{margin-left:0%}.column.is-1-fullhd{flex:none;width:8.33333337%}.column.is-offset-1-fullhd{margin-left:8.33333337%}.column.is-2-fullhd{flex:none;width:16.66666674%}.column.is-offset-2-fullhd{margin-left:16.66666674%}.column.is-3-fullhd{flex:none;width:25%}.column.is-offset-3-fullhd{margin-left:25%}.column.is-4-fullhd{flex:none;width:33.33333337%}.column.is-offset-4-fullhd{margin-left:33.33333337%}.column.is-5-fullhd{flex:none;width:41.66666674%}.column.is-offset-5-fullhd{margin-left:41.66666674%}.column.is-6-fullhd{flex:none;width:50%}.column.is-offset-6-fullhd{margin-left:50%}.column.is-7-fullhd{flex:none;width:58.33333337%}.column.is-offset-7-fullhd{margin-left:58.33333337%}.column.is-8-fullhd{flex:none;width:66.66666674%}.column.is-offset-8-fullhd{margin-left:66.66666674%}.column.is-9-fullhd{flex:none;width:75%}.column.is-offset-9-fullhd{margin-left:75%}.column.is-10-fullhd{flex:none;width:83.33333337%}.column.is-offset-10-fullhd{margin-left:83.33333337%}.column.is-11-fullhd{flex:none;width:91.66666674%}.column.is-offset-11-fullhd{margin-left:91.66666674%}.column.is-12-fullhd{flex:none;width:100%}.column.is-offset-12-fullhd{margin-left:100%}}.columns{margin-left:-0.75rem;margin-right:-0.75rem;margin-top:-0.75rem}.columns:last-child{margin-bottom:-0.75rem}.columns:not(:last-child){margin-bottom:calc(1.5rem - 0.75rem)}.columns.is-centered{justify-content:center}.columns.is-gapless{margin-left:0;margin-right:0;margin-top:0}.columns.is-gapless>.column{margin:0;padding:0 !important}.columns.is-gapless:not(:last-child){margin-bottom:1.5rem}.columns.is-gapless:last-child{margin-bottom:0}.columns.is-mobile{display:flex}.columns.is-multiline{flex-wrap:wrap}.columns.is-vcentered{align-items:center}@media screen and (min-width: 769px), print{.columns:not(.is-desktop){display:flex}}@media screen and (min-width: 1024px){.columns.is-desktop{display:flex}}.columns.is-variable{--columnGap:0.75rem;margin-left:calc(-1 * var(--columnGap));margin-right:calc(-1 * var(--columnGap))}.columns.is-variable>.column{padding-left:var(--columnGap);padding-right:var(--columnGap)}.columns.is-variable.is-0{--columnGap:0rem}@media screen and (max-width: 768px){.columns.is-variable.is-0-mobile{--columnGap:0rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-0-tablet{--columnGap:0rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-0-tablet-only{--columnGap:0rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-0-touch{--columnGap:0rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-0-desktop{--columnGap:0rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-0-desktop-only{--columnGap:0rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-0-widescreen{--columnGap:0rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-0-widescreen-only{--columnGap:0rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-0-fullhd{--columnGap:0rem}}.columns.is-variable.is-1{--columnGap:0.25rem}@media screen and (max-width: 768px){.columns.is-variable.is-1-mobile{--columnGap:0.25rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-1-tablet{--columnGap:0.25rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-1-tablet-only{--columnGap:0.25rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-1-touch{--columnGap:0.25rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-1-desktop{--columnGap:0.25rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-1-desktop-only{--columnGap:0.25rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-1-widescreen{--columnGap:0.25rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-1-widescreen-only{--columnGap:0.25rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-1-fullhd{--columnGap:0.25rem}}.columns.is-variable.is-2{--columnGap:0.5rem}@media screen and (max-width: 768px){.columns.is-variable.is-2-mobile{--columnGap:0.5rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-2-tablet{--columnGap:0.5rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-2-tablet-only{--columnGap:0.5rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-2-touch{--columnGap:0.5rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-2-desktop{--columnGap:0.5rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-2-desktop-only{--columnGap:0.5rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-2-widescreen{--columnGap:0.5rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-2-widescreen-only{--columnGap:0.5rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-2-fullhd{--columnGap:0.5rem}}.columns.is-variable.is-3{--columnGap:0.75rem}@media screen and (max-width: 768px){.columns.is-variable.is-3-mobile{--columnGap:0.75rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-3-tablet{--columnGap:0.75rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-3-tablet-only{--columnGap:0.75rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-3-touch{--columnGap:0.75rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-3-desktop{--columnGap:0.75rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-3-desktop-only{--columnGap:0.75rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-3-widescreen{--columnGap:0.75rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-3-widescreen-only{--columnGap:0.75rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-3-fullhd{--columnGap:0.75rem}}.columns.is-variable.is-4{--columnGap:1rem}@media screen and (max-width: 768px){.columns.is-variable.is-4-mobile{--columnGap:1rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-4-tablet{--columnGap:1rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-4-tablet-only{--columnGap:1rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-4-touch{--columnGap:1rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-4-desktop{--columnGap:1rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-4-desktop-only{--columnGap:1rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-4-widescreen{--columnGap:1rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-4-widescreen-only{--columnGap:1rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-4-fullhd{--columnGap:1rem}}.columns.is-variable.is-5{--columnGap:1.25rem}@media screen and (max-width: 768px){.columns.is-variable.is-5-mobile{--columnGap:1.25rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-5-tablet{--columnGap:1.25rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-5-tablet-only{--columnGap:1.25rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-5-touch{--columnGap:1.25rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-5-desktop{--columnGap:1.25rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-5-desktop-only{--columnGap:1.25rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-5-widescreen{--columnGap:1.25rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-5-widescreen-only{--columnGap:1.25rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-5-fullhd{--columnGap:1.25rem}}.columns.is-variable.is-6{--columnGap:1.5rem}@media screen and (max-width: 768px){.columns.is-variable.is-6-mobile{--columnGap:1.5rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-6-tablet{--columnGap:1.5rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-6-tablet-only{--columnGap:1.5rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-6-touch{--columnGap:1.5rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-6-desktop{--columnGap:1.5rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-6-desktop-only{--columnGap:1.5rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-6-widescreen{--columnGap:1.5rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-6-widescreen-only{--columnGap:1.5rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-6-fullhd{--columnGap:1.5rem}}.columns.is-variable.is-7{--columnGap:1.75rem}@media screen and (max-width: 768px){.columns.is-variable.is-7-mobile{--columnGap:1.75rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-7-tablet{--columnGap:1.75rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-7-tablet-only{--columnGap:1.75rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-7-touch{--columnGap:1.75rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-7-desktop{--columnGap:1.75rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-7-desktop-only{--columnGap:1.75rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-7-widescreen{--columnGap:1.75rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-7-widescreen-only{--columnGap:1.75rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-7-fullhd{--columnGap:1.75rem}}.columns.is-variable.is-8{--columnGap:2rem}@media screen and (max-width: 768px){.columns.is-variable.is-8-mobile{--columnGap:2rem}}@media screen and (min-width: 769px), print{.columns.is-variable.is-8-tablet{--columnGap:2rem}}@media screen and (min-width: 769px) and (max-width: 1023px){.columns.is-variable.is-8-tablet-only{--columnGap:2rem}}@media screen and (max-width: 1023px){.columns.is-variable.is-8-touch{--columnGap:2rem}}@media screen and (min-width: 1024px){.columns.is-variable.is-8-desktop{--columnGap:2rem}}@media screen and (min-width: 1024px) and (max-width: 1215px){.columns.is-variable.is-8-desktop-only{--columnGap:2rem}}@media screen and (min-width: 1216px){.columns.is-variable.is-8-widescreen{--columnGap:2rem}}@media screen and (min-width: 1216px) and (max-width: 1407px){.columns.is-variable.is-8-widescreen-only{--columnGap:2rem}}@media screen and (min-width: 1408px){.columns.is-variable.is-8-fullhd{--columnGap:2rem}}.tile{align-items:stretch;display:block;flex-basis:0;flex-grow:1;flex-shrink:1;min-height:min-content}.tile.is-ancestor{margin-left:-0.75rem;margin-right:-0.75rem;margin-top:-0.75rem}.tile.is-ancestor:last-child{margin-bottom:-0.75rem}.tile.is-ancestor:not(:last-child){margin-bottom:0.75rem}.tile.is-child{margin:0 !important}.tile.is-parent{padding:0.75rem}.tile.is-vertical{flex-direction:column}.tile.is-vertical>.tile.is-child:not(:last-child){margin-bottom:1.5rem !important}@media screen and (min-width: 769px), print{.tile:not(.is-child){display:flex}.tile.is-1{flex:none;width:8.33333337%}.tile.is-2{flex:none;width:16.66666674%}.tile.is-3{flex:none;width:25%}.tile.is-4{flex:none;width:33.33333337%}.tile.is-5{flex:none;width:41.66666674%}.tile.is-6{flex:none;width:50%}.tile.is-7{flex:none;width:58.33333337%}.tile.is-8{flex:none;width:66.66666674%}.tile.is-9{flex:none;width:75%}.tile.is-10{flex:none;width:83.33333337%}.tile.is-11{flex:none;width:91.66666674%}.tile.is-12{flex:none;width:100%}}.dropdown{display:inline-flex;position:relative;vertical-align:top}.dropdown.is-active .dropdown-menu,.dropdown.is-hoverable:hover .dropdown-menu{display:block}.dropdown.is-right .dropdown-menu{left:auto;right:0}.dropdown.is-up .dropdown-menu{bottom:100%;padding-bottom:4px;padding-top:initial;top:auto}.dropdown-menu{display:none;left:0;min-width:12rem;padding-top:4px;position:absolute;top:100%;z-index:20}.dropdown-content{background-color:white;border-radius:4px;box-shadow:0 0.5em 1em -0.125em rgba(10, 10, 10, 0.1), 0 0px 0 1px rgba(10, 10, 10, 0.02);padding-bottom:0.5rem;padding-top:0.5rem}.dropdown-item{color:#4a4a4a;display:block;font-size:0.875rem;line-height:1.5;padding:0.375rem 1rem;position:relative}a.dropdown-item,button.dropdown-item{padding-right:3rem;text-align:inherit;white-space:nowrap;width:100%}a.dropdown-item:hover,button.dropdown-item:hover{background-color:whitesmoke;color:#0a0a0a}a.dropdown-item.is-active,button.dropdown-item.is-active{background-color:#485fc7;color:#fff}.dropdown-divider{background-color:#ededed;border:none;display:block;height:1px;margin:0.5rem 0}:host{display:block;border:1px solid gray;margin:5px}.live-video-container .live-video-controls-container{position:absolute;width:100%;background-color:#80808070;bottom:0;color:white;fill:white}";export{o as my_component,St as surf_live_video}